<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers storage - ğŸ¾Corgi</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="ğŸ¾Corgi"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="ğŸ¾Corgi"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="virtcontainers åº“ä¸­ PersistDriver å’Œ FilesystemSharer æ¨¡å—æºç èµ°è¯»"><meta property="og:type" content="blog"><meta property="og:title" content="ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers storage"><meta property="og:url" content="http://shenxianghong.github.io/2023/03/05/2023-03-05%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20vircontainers%20storage/"><meta property="og:site_name" content="ğŸ¾Corgi"><meta property="og:description" content="virtcontainers åº“ä¸­ PersistDriver å’Œ FilesystemSharer æ¨¡å—æºç èµ°è¯»"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://picsum.photos/0?sig=20230305"><meta property="article:published_time" content="2023-03-04T16:00:00.000Z"><meta property="article:modified_time" content="2023-05-09T01:34:52.845Z"><meta property="article:author" content="Shen Xianghong"><meta property="article:tag" content="Kata Containers"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://picsum.photos/0?sig=20230305"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://shenxianghong.github.io/2023/03/05/2023-03-05%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20vircontainers%20storage/"},"headline":"ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers storage","image":[],"datePublished":"2023-03-04T16:00:00.000Z","dateModified":"2023-05-09T01:34:52.845Z","author":{"@type":"Person","name":"Shen Xianghong"},"publisher":{"@type":"Organization","name":"ğŸ¾Corgi","logo":{"@type":"ImageObject","url":"http://shenxianghong.github.io/img/logo.svg"}},"description":"virtcontainers åº“ä¸­ PersistDriver å’Œ FilesystemSharer æ¨¡å—æºç èµ°è¯»"}</script><link rel="canonical" href="http://shenxianghong.github.io/2023/03/05/2023-03-05%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20vircontainers%20storage/"><link rel="alternate" href="/atom.xml" title="ğŸ¾Corgi" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/xcode.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="ğŸ¾Corgi" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://picsum.photos/0?sig=20230305" alt="ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers storage"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="fa fa-calendar"></i>Â <time dateTime="${date_xml(page.date)}" title="${date_xml(page.date)}">2023-03-05</time></span><span class="level-item"><i class="fa fa-calendar-check"></i>Â <time dateTime="${date_xml(page.updated)}" title="${date_xml(page.updated)}">2023-05-09</time></span><span class="level-item"><i class="far fa-folder-open"></i>Â <a class="link-muted" href="/categories/Container-Runtime/">Container Runtime</a></span><span class="level-item"><i class="far fa-clock"></i>Â 17 minutes read (About 2591 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers storage</h1><div class="content"><div align=center><img width="200" style="border: 0px" src="https://katacontainers.io/static/logo-a1e2d09ad097b3fc8536cb77aa615c42.svg"></div>

<hr>
<blockquote>
<p>based on <strong>3.0.0</strong></p>
</blockquote>
<h1 id="PersistDriver"><a href="#PersistDriver" class="headerlink" title="PersistDriver"></a>PersistDriver</h1><p><em><u>src&#x2F;runtime&#x2F;virtcontainers&#x2F;persist&#x2F;api&#x2F;interface.go</u></em></p>
<p>PersistDriverï¼ˆä¹Ÿç§° storeï¼‰çš„å®ç°æœ‰ä¸¤ç±»ï¼šfs å’Œ rootlessã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> FS <span class="keyword">struct</span> &#123;</span><br><span class="line">	sandboxState    *persistapi.SandboxState</span><br><span class="line">	containerState  <span class="keyword">map</span>[<span class="type">string</span>]persistapi.ContainerState</span><br><span class="line">	storageRootPath <span class="type">string</span></span><br><span class="line">	driverName      <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ fs driver ä¸­ï¼ŒstorageRootPath ä¸º &#x2F;run&#x2F;vcï¼Œç”¨äºä¿å­˜ sandboxï¼ˆsbsï¼Œå…¶ä¸­å®¹å™¨ä¿¡æ¯ä»¥å­ç›®å½•å½¢å¼ä¿å­˜ï¼‰å’Œ VMï¼ˆvmï¼‰ç›¸å…³çŠ¶æ€ä¿¡æ¯ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RootlessFS <span class="keyword">struct</span> &#123;</span><br><span class="line">	*FS</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>rootlessfs driver å®Œå…¨ç»§æ‰¿ fs driverï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äº rootlessfs driver çš„ storageRootPath ä¸º &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;vcï¼ˆå½“ç¯å¢ƒå˜é‡ XDG_RUNTIME_DIR ç¼ºçœæ—¶ä¸º &#x2F;run&#x2F;user&#x2F;&lt;UID&gt;ï¼‰ã€‚</p>
<p><strong>å·¥å‚å‡½æ•°</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/persist/manager.go#L49">source code</a></p>
<ol>
<li>æ ¹æ®å½“å‰æ˜¯å¦ä¸º root ç”¨æˆ·æƒé™ï¼Œè¿”å›å¯¹åº”çš„ fs å®ç°</li>
</ol>
<p><em>ä»¥ä¸‹æ¥å£ fs å’Œ rootlessfs å®ç°æ–¹å¼å®Œå…¨ä¸€æ ·ã€‚</em></p>
<h2 id="ToDisk"><a href="#ToDisk" class="headerlink" title="ToDisk"></a>ToDisk</h2><p><strong>ä¿å­˜ sandbox å’Œå®¹å™¨çŠ¶æ€ä¿¡æ¯åˆ°æ–‡ä»¶ä¸­</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/persist/fs/fs.go#L77">source code</a></p>
<ol>
<li>ä»¥å½“å‰ç”¨æˆ·ç»„ä¿¡æ¯åˆ›å»º &lt;RunStoragePath&gt;&#x2F;&lt;sandboxID&gt; ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰</li>
<li>åˆ›å»º &lt;RunStoragePath&gt;&#x2F;&lt;sandboxID&gt;&#x2F;persist.json æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼Œå†™å…¥ sandbox çŠ¶æ€ä¿¡æ¯</li>
<li>éå†æ‰€æœ‰çš„å®¹å™¨çŠ¶æ€ä¿¡æ¯<ol>
<li>ä»¥å½“å‰ç”¨æˆ·ç»„ä¿¡æ¯åˆ›å»º &lt;RunStoragePath&gt;&#x2F;&lt;sandboxID&gt;&#x2F;&lt;containerID&gt; ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰</li>
<li>åˆ›å»º &lt;RunStoragePath&gt;&#x2F;&lt;sandboxID&gt;&#x2F;&lt;containerID&gt;&#x2F;persist.json æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼Œå†™å…¥å®¹å™¨çŠ¶æ€ä¿¡æ¯</li>
</ol>
</li>
<li>éå† &lt;RunStoragePath&gt;&#x2F;&lt;sandboxID&gt; ç›®å½•ï¼ˆç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•åç§°å‡ä¸º containerIDï¼‰ï¼Œç”±äºæ­¥éª¤ 3 ä¸­ä¸ºå½“å‰å…¨é‡çš„å®¹å™¨çŠ¶æ€ä¿¡æ¯ï¼Œä»¥æ­¤ä¸ºå‡†ç§»é™¤ä¸å­˜åœ¨çš„å®¹å™¨ç›®å½•</li>
</ol>
<h2 id="FromDisk"><a href="#FromDisk" class="headerlink" title="FromDisk"></a>FromDisk</h2><p><strong>è¯»å–å†™å…¥æ–‡ä»¶ä¸­çš„ sandbox å’Œå®¹å™¨çŠ¶æ€ä¿¡æ¯</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/persist/fs/fs.go#L170">source code</a></p>
<ol>
<li>è¯»å– &lt;RunStoragePath&gt;&#x2F;&lt;sandboxID&gt;&#x2F;persist.json æ–‡ä»¶å†…å®¹ï¼Œè·å– sandbox çŠ¶æ€ä¿¡æ¯</li>
<li>éå† &lt;RunStoragePath&gt;&#x2F;&lt;sandboxID&gt; ç›®å½•ï¼ˆç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•åç§°å‡ä¸º containerIDï¼‰ï¼Œè¯»å– &lt;RunStoragePath&gt;&#x2F;&lt;sandboxID&gt;&#x2F;&lt;containerID&gt;&#x2F;persist.json æ–‡ä»¶å†…å®¹ï¼Œè·å–å®¹å™¨çŠ¶æ€ä¿¡æ¯</li>
</ol>
<h2 id="Destroy"><a href="#Destroy" class="headerlink" title="Destroy"></a>Destroy</h2><p><strong>åˆ é™¤ sandbox çŠ¶æ€ä¿¡æ¯ç›®å½•</strong></p>
<p><em>å› ä¸º sandbox å’Œå®¹å™¨çŠ¶æ€ä¿¡æ¯ç›®å½•ä¹‹é—´ä¸ºçˆ¶å­ç›®å½•å…³ç³»ï¼Œåˆ é™¤çˆ¶ç›®å½•å³å¯</em></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/persist/fs/fs.go#L228">source code</a></p>
<ol>
<li>åˆ é™¤ &lt;RunStoragePath&gt;&#x2F;&lt;sandboxID&gt; ç›®å½•</li>
</ol>
<h2 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h2><p><strong>å¯¹ sandbox çŠ¶æ€ä¿¡æ¯ç›®å½•ä¸Šé”</strong></p>
<p><em>å› ä¸º sandbox å’Œå®¹å™¨çŠ¶æ€ä¿¡æ¯ç›®å½•ä¹‹é—´ä¸ºçˆ¶å­ç›®å½•å…³ç³»ï¼Œå¯¹çˆ¶ç›®å½•ä¸Šé”å³å¯</em></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/persist/fs/fs.go#L244">source code</a></p>
<ol>
<li>è°ƒç”¨ syscall.Flockï¼Œå¯¹ &lt;RunStoragePath&gt;&#x2F;&lt;sandboxID&gt; ç›®å½•ä¸Šå…±äº«é”æˆ–æ’ä»–é”ï¼ˆæ ¹æ®å‡½æ•°ä¼ å‚è€Œå®šï¼‰</li>
<li>è¿”å›ä¸€ä¸ªè°ƒç”¨ syscall.Flock çš„å‡½æ•°ä½“ï¼Œå¯¹ &lt;RunStoragePath&gt;&#x2F;&lt;sandboxID&gt; ç›®å½•é‡Šæ”¾é”ï¼ˆå³ syscall.LOCK_UNï¼‰</li>
</ol>
<h2 id="GlobalWrite"><a href="#GlobalWrite" class="headerlink" title="GlobalWrite"></a>GlobalWrite</h2><p><strong>åœ¨çŠ¶æ€ä¿¡æ¯ç›®å½•ä¸­çš„æ–‡ä»¶å†™å…¥å†…å®¹</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/persist/fs/fs.go#L282">source code</a></p>
<ol>
<li>ä»¥å½“å‰ç”¨æˆ·ç»„ä¿¡æ¯åˆ›å»º &lt;storageRootPath&gt;&#x2F;&lt;relativePath&gt; ï¼ˆrelativePath ä¸ºå‡½æ•°ä¼ å‚ä¸­çš„å¾…å†™å…¥å†…å®¹çš„ç›¸å¯¹è·¯å¾„ï¼‰æ‰€åœ¨ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰</li>
<li>åˆ›å»º &lt;storageRootPath&gt;&#x2F;&lt;relativePath&gt; æ–‡ä»¶ï¼Œå†™å…¥æ•°æ®</li>
</ol>
<h2 id="GlobalRead"><a href="#GlobalRead" class="headerlink" title="GlobalRead"></a>GlobalRead</h2><p><strong>è¯»å–çŠ¶æ€ä¿¡æ¯ç›®å½•ä¸­çš„æ–‡ä»¶å†…å®¹</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/persist/fs/fs.go#L315">source code</a></p>
<ol>
<li>è¯»å– &lt;storageRootPath&gt;&#x2F;&lt;relativePath&gt; æ–‡ä»¶å†…å®¹</li>
</ol>
<h2 id="RunStoragePath"><a href="#RunStoragePath" class="headerlink" title="RunStoragePath"></a>RunStoragePath</h2><p><strong>è·å– sandbox çŠ¶æ€ä¿¡æ¯ç›®å½•</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/persist/fs/fs.go#L337">source code</a></p>
<ol>
<li>è¿”å› &lt;storageRootPath&gt;&#x2F;sbs è·¯å¾„</li>
</ol>
<h2 id="RunVMStoragePath"><a href="#RunVMStoragePath" class="headerlink" title="RunVMStoragePath"></a>RunVMStoragePath</h2><p><strong>è·å– vm çŠ¶æ€ä¿¡æ¯ç›®å½•</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/persist/fs/fs.go#L341">source code</a></p>
<ol>
<li>è¿”å› &lt;storageRootPath&gt;&#x2F;vm è·¯å¾„</li>
</ol>
<h1 id="FilesystemSharer"><a href="#FilesystemSharer" class="headerlink" title="FilesystemSharer"></a>FilesystemSharer</h1><p><em><u>src&#x2F;runtime&#x2F;virtcontainers&#x2F;fs_share.go</u></em></p>
<p>FilesystemSharerï¼ˆä¹Ÿç§° fsSharerï¼‰ä»…æœ‰ linux æ“ä½œç³»ç»Ÿä¸‹çš„å®ç°ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> FilesystemShare <span class="keyword">struct</span> &#123;</span><br><span class="line">	sandbox *Sandbox</span><br><span class="line">	sync.Mutex</span><br><span class="line">	prepared <span class="type">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>å·¥å‚å‡½æ•°ä¸ºå‚æ•°èµ‹å€¼åˆå§‹åŒ–ï¼Œæ— å¤æ‚é€»è¾‘ï¼Œä¸ä½œè¯¦è¿°ã€‚</em></p>
<h2 id="bindMount"><a href="#bindMount" class="headerlink" title="bindMount"></a>bindMount</h2><p><strong>å°† src ç»‘å®šæŒ‚è½½åˆ° dst</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/mount.go#L257">source code</a></p>
<ol>
<li>å¤„ç† src ä¸­çš„ç¬¦å·é“¾æ¥ï¼Œè·å¾—ç»å¯¹è·¯å¾„ï¼Œæ ¡éªŒå…¶æ˜¯å¦å­˜åœ¨</li>
<li>åˆ›å»º dst çš„çˆ¶ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰</li>
<li>æ ¹æ® src çš„æ ¼å¼ï¼ˆç›®å½•æˆ–æ–‡ä»¶ï¼‰ï¼Œåˆ›å»º dst</li>
<li>å°† src ä»¥ MS_BIND çš„å±æ€§ç»‘å®šæŒ‚è½½åˆ° dst ä¸‹<br><em>ç­‰ä»·äº mount â€“bind foo barï¼Œä¹Ÿå°±æ˜¯æŠŠ foo ç›®å½•ç»‘å®šæŒ‚è½½åˆ° bar ç›®å½•ï¼Œbar ç›®å½•ä¸º foo ç›®å½•çš„é•œåƒæŒ‚è½½ç‚¹ã€‚ç»‘å®šåçš„ä¸¤ä¸ªç›®å½•ç±»ä¼¼äºç¡¬é“¾æ¥ï¼Œæ— è®ºè¯»å†™ bar è¿˜æ˜¯è¯»å†™ fooï¼Œéƒ½ä¼šååº”åœ¨å¦ä¸€æ–¹ï¼Œå†…æ ¸åœ¨åº•å±‚æ‰€æ“ä½œçš„éƒ½æ˜¯åŒä¸€ä¸ªç‰©ç†ä½ç½®ã€‚å°† bar å¸è½½åï¼Œbar ç›®å½•å›å½’åŸå§‹ç©ºç›®å½•çŠ¶æ€ï¼ŒæœŸé—´æ‰€æ‰§è¡Œçš„ä¿®æ”¹éƒ½ä¿ç•™åœ¨ foo ç›®å½•ä¸‹</em></li>
<li>æ›´æ”¹ dst ç›®å½•æŒ‚è½½å±æ€§ï¼ˆå³ MS_SHAREDã€MS_PRIVATEã€MS_SLAVE å’Œ MS_UNBINDABLEï¼‰<br><em>ç­‰ä»·äº mount â€“make-slave barï¼Œä¹Ÿå¯ä»¥å’Œæ­¥éª¤ 4 åˆå¹¶æ“ä½œ mount â€“make-slave â€“bind foo barã€‚å•å‘ä¼ æ’­æ¨¡å¼ä¸‹ï¼Œåœ¨ foo ä¸‹æ·»åŠ æˆ–ç§»é™¤å­æŒ‚è½½ç‚¹ï¼Œä¼šåŒæ­¥åˆ° bar æŒ‚è½½ç‚¹ï¼Œè€Œåœ¨ bar ä¸‹æ·»åŠ æˆ–ç§»é™¤å­æŒ‚è½½ç‚¹ï¼Œä¸ä¼šå½±å“ foo</em></li>
<li>å¦‚æœæŒ‚è½½ä¸ºåªè¯»å±æ€§ï¼Œåˆ™è¿½åŠ è‡³ç»‘å®šæŒ‚è½½å±æ€§ä¸­<br><em>ç­‰ä»·äº mount â€“read-only â€“bind foo bar</em></li>
</ol>
<h2 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h2><p><strong>å‡†å¤‡ host&#x2F;guest çš„å…±äº«æ–‡ä»¶ç³»ç»Ÿç›®å½•</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/fs_share_linux.go#L127">source code</a></p>
<ol>
<li>åˆ›å»º &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;shared ç›®å½•ï¼ˆç”¨äº 9p&#x2F;virtiofs åœ¨ host å’Œ guest ä¹‹é—´å…±äº«æ•°æ®ï¼‰</li>
<li>åˆ›å»º &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts ç›®å½•ï¼ˆç”¨äºç»´æŠ¤æ‰€æœ‰ host å’Œ guest ä¹‹é—´çš„æŒ‚è½½ç‚¹ï¼‰</li>
<li>è°ƒç”¨ <strong>bindMount</strong>ï¼Œå°† mounts ç›®å½•ä»¥åªè¯»å’Œ MS_SLAVE çš„å±æ€§ç»‘å®šæŒ‚è½½åˆ° shared ç›®å½•ä¸‹ï¼ˆä¸ºäº†åé¢ mounts æŒ‚è½½ç‚¹ä¸‹çš„å­æŒ‚è½½ä¹Ÿèƒ½å‡ºç°åœ¨ shared ä¸­ï¼‰</li>
<li>å¤„ç† [runtime]. sandbox_bind_mounts æŒ‚è½½ç‚¹<ol>
<li>åˆ›å»º &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;sandbox-mounts ç›®å½•</li>
<li>é’ˆå¯¹ sandbox_bind_mounts ç›®å½•ä¸­çš„æ¯ä¸€ä¸ªæŒ‚è½½ç‚¹ï¼Œè°ƒç”¨ <strong>bindMount</strong>ï¼Œä»¥åªè¯»å’Œ MS_PRIVATE çš„å±æ€§ç»‘å®šæŒ‚è½½åˆ° &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;sandbox-mounts&#x2F;&lt;sandbox_bind_mounts&gt; ä¸­ï¼Œå¹¶è¿½åŠ  &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;shared&#x2F;sandbox-mounts&#x2F;&lt;sandbox_bind_mounts&gt; ç»‘å®šæŒ‚è½½çš„åªè¯»å±æ€§</li>
</ol>
</li>
<li>è®¾ç½® prepared ä¸º trueï¼Œè¡¨ç¤ºå…±äº«æ–‡ä»¶ç³»ç»Ÿå·²å°±ç»ªï¼ˆæ ‡è¯†ä½ä¹Ÿç”¨äºä¿è¯ Prepare å’Œ Cleanup æ“ä½œçš„å¹‚ç­‰æ€§ï¼‰</li>
</ol>
<h2 id="Cleanup"><a href="#Cleanup" class="headerlink" title="Cleanup"></a>Cleanup</h2><p><strong>æ¸…ç† host&#x2F;guest çš„å…±äº«æ–‡ä»¶ç³»ç»Ÿç›®å½•</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/fs_share_linux.go#L180">source code</a></p>
<ol>
<li>å¤„ç† [runtime]. sandbox_bind_mounts æŒ‚è½½ç‚¹<ol>
<li>é’ˆå¯¹ sandbox_bind_mounts ç›®å½•ä¸­çš„æ¯ä¸€ä¸ªæŒ‚è½½ç‚¹ï¼Œç§»é™¤ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;sandbox-mounts&#x2F;&lt;sandbox_bind_mounts&gt; æŒ‚è½½ç‚¹</li>
<li>åˆ é™¤ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;sandbox-mounts ç›®å½•</li>
</ol>
</li>
<li>ç§»é™¤ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;shared æŒ‚è½½ç‚¹</li>
<li>ç§»é™¤ sandbox ä¸­æ‰€æœ‰å®¹å™¨çš„æŒ‚è½½ç‚¹ã€‚å¦‚æœå®¹å™¨ rootfs çš„ç±»å‹ä¸º fuse.nydus-overlayfsï¼Œåˆ™ç§»é™¤ &#x2F;rafs&#x2F;&lt;containerID&gt;&#x2F;lowerdir virtiofs æŒ‚è½½ç‚¹ï¼Œç§»é™¤ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt;&#x2F;snapshotdir æŒ‚è½½ç‚¹å¹¶åˆ é™¤æ­¤ç›®å½•ï¼Œåˆ é™¤ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt;&#x2F;rootfs ç›®å½•ï¼ˆè¯¥ç›®å½•å’Œ &#x2F;run&#x2F;containerd&#x2F;io.containerd.runtime.v2.task&#x2F;k8s.io&#x2F;&lt;containerID&gt;&#x2F;rootfs æ•°æ®åŒæ­¥ï¼Œå€ŸåŠ© 9pfs&#x2F;virtiofs å®ç°å®¹å™¨æ–‡ä»¶ç³»ç»Ÿå…±äº«ï¼Œåœ¨ host ä¸Šä»¥ overlay æŒ‚è½½ç‚¹å½¢å¼å­˜åœ¨ï¼‰ï¼›å¦åˆ™ï¼Œç§»é™¤ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt;&#x2F;rootfs æŒ‚è½½ç‚¹å¹¶åˆ é™¤æ­¤ç›®å½•</li>
<li>åˆ é™¤ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt; ç›®å½•</li>
</ol>
<h2 id="ShareFile"><a href="#ShareFile" class="headerlink" title="ShareFile"></a>ShareFile</h2><p><strong>å…±äº« host æ–‡ä»¶è‡³ guest ä¸­</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/fs_share_linux.go#L227">source code</a></p>
<ol>
<li>å…±äº«æ–‡ä»¶ï¼ˆshareFileï¼‰åç§°æ ¼å¼ä¸º &lt;containerID&gt;-&lt;random bytes&gt;-&lt;dst&gt;<br><em>ä¾‹å¦‚ï¼š&lt;containerID&gt;-47dcc9007bca8805-hostname</em></li>
<li>è°ƒç”¨ hypervisor çš„ <strong>Capabilities</strong>ï¼Œåˆ¤æ–­æ˜¯å¦æ”¯æŒ host æ–‡ä»¶ç³»ç»Ÿå…±äº«ç‰¹æ€§ï¼ˆQEMU åœºæ™¯ä¸‹æ”¯æŒï¼‰<ul>
<li>å¦‚æœä¸æ”¯æŒï¼Œåˆ™é€šè¿‡æ–‡ä»¶æ‹·è´å®ç°å…±äº«<ol>
<li>æ ¡éªŒ src æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœ src éå¸¸è§„æ–‡ä»¶ï¼Œåˆ™ä¸åšå¤„ç†ï¼ˆè¿™é‡Œå¹¶æœªè§†ä¸ºé”™è¯¯ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ç§å±€é™æ€§å°†å…¶å¿½ç•¥ï¼‰</li>
<li>è°ƒç”¨ agent çš„ <strong>copyFile</strong>ï¼Œå°† src æ–‡ä»¶æ‹·è´è‡³ sandbox çš„ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;containers&#x2F;&lt;shareFile&gt; æ–‡ä»¶ä½ç½®</li>
</ol>
</li>
<li>å¦‚æœæ”¯æŒï¼Œåˆ™é€šè¿‡æ–‡ä»¶æŒ‚è½½å®ç°å…±äº«<ol>
<li>å¦‚æœæŒ‚è½½ä¸ºè¯»å†™å±æ€§ï¼Œåˆ™è°ƒç”¨ <strong>bindMount</strong>ï¼Œå°† src ä»¥è¯»å†™å’Œ MS_PRIVATE çš„å±æ€§ç»‘å®šæŒ‚è½½åˆ° &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;shareFile&gt;</li>
<li>å¦åˆ™ï¼Œè°ƒç”¨ <strong>bindMount</strong>ï¼Œå°† src ä»¥åªè¯»å’Œ MS_PRIVATE çš„å±æ€§ç»‘å®šæŒ‚è½½åˆ° &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;private&#x2F;&lt;shareFile&gt;ï¼Œè¿›è€Œè°ƒç”¨ <strong>bindMount</strong>ï¼Œå°† &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;private&#x2F;&lt;shareFile&gt; ä»¥è¯»å†™å’Œ MS_PRIVATE çš„å±æ€§ç»‘å®šæŒ‚è½½åˆ° &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;shareFile&gt;<br><em>å¯¹äºåªè¯»æŒ‚è½½ï¼ŒbindMount é‡æ–°æŒ‚è½½äº‹ä»¶ä¸ä¼šä¼ æ’­åˆ°æŒ‚è½½å­æ ‘ï¼Œå¹¶ä¸”å®ƒä¹Ÿä¸ä¼šå‡ºç°åœ¨ virtiofsd ç‹¬ç«‹æŒ‚è½½å‘½åç©ºé—´ä¸­</em></li>
<li>è®¾ç½®æŒ‚è½½ä¿¡æ¯çš„ host ä¾§è·¯å¾„ä¸º &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;shareFile&gt;</li>
</ol>
</li>
</ul>
</li>
</ol>
<h2 id="UnshareFile"><a href="#UnshareFile" class="headerlink" title="UnshareFile"></a>UnshareFile</h2><p><strong>ç§»é™¤ host&#x2F;guest å…±äº«æ–‡ä»¶çš„æŒ‚è½½ç‚¹</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/fs_share_linux.go#L296">source code</a></p>
<ol>
<li>ç§»é™¤æŒ‚è½½ä¿¡æ¯çš„ host ä¾§æŒ‚è½½ç‚¹</li>
<li>å¦‚æœæŒ‚è½½ç±»å‹ä¸º bindï¼Œæ ¡éªŒ host ä¾§æŒ‚è½½ç‚¹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœä¸ºå¸¸è§„æ–‡ä»¶ä¸”ä¸ºç©ºï¼Œåˆ™ç›´æ¥åˆ é™¤ï¼›å¦‚æœä¸ºç›®å½•ï¼Œåˆ™ç§»é™¤ç›®å½•</li>
</ol>
<h2 id="ShareRootFilesystem"><a href="#ShareRootFilesystem" class="headerlink" title="ShareRootFilesystem"></a>ShareRootFilesystem</h2><p><strong>åˆ›å»º guest ä¸­å®¹å™¨ rootfs å…±äº«æŒ‚è½½</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/fs_share_linux.go#L373">source code</a></p>
<ol>
<li>å¦‚æœ rootfs ç±»å‹ä¸º fuse.nydus-overlayfs<ol>
<li>é€šè¿‡ virtiofsd æŒ‚è½½ &#x2F;rafs&#x2F;&lt;containerID&gt;&#x2F;lowerdir ç›®å½•è‡³ guest ä¸­</li>
<li>åˆ›å»º &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt;&#x2F;rootfs ç›®å½•</li>
<li>è°ƒç”¨ <strong>bindMount</strong>ï¼Œå°† rootfs æŒ‚è½½å‚æ•°ä¸­çš„ snapshotdir ç›®å½•ä»¥åªè¯»å’Œ MS_SLAVE çš„å±æ€§ç»‘å®šæŒ‚è½½åˆ° &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt;&#x2F;snapshotdir</li>
<li>æŒ‚è½½ç±»å‹ä»ä¸ºè”åˆæ–‡ä»¶ç³»ç»Ÿçš„ overlay å½¢å¼</li>
</ol>
</li>
<li>å¦‚æœ rootfs ç±»å‹ä¸æ˜¯ fuse.nydus-overlayfsï¼Œå¹¶ä¸”æ˜¯åŸºäºå—è®¾å¤‡çš„ rootfs<ol>
<li>è°ƒç”¨ devManager çš„ <strong>GetDeviceByID</strong>ï¼Œæ ¹æ®å®¹å™¨çŠ¶æ€ä¸­çš„ä¿¡æ¯è·å–åˆ°è®¾å¤‡ä¿¡æ¯</li>
<li>æŒ‚è½½ç±»å‹è§† [hypervisor].block_device_driver è€Œå®š</li>
<li>åˆ›å»º &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt;&#x2F;rootfs ç›®å½•</li>
</ol>
</li>
<li>å¯¹äºä¼ ç»Ÿçš„ rootfsï¼ˆä¹Ÿå°±æ˜¯é fuse.nydus-overlayfs ç±»å‹ï¼Œå¹¶ä¸”ä¸æ˜¯åŸºäºå—è®¾å¤‡çš„ï¼‰ï¼Œè°ƒç”¨ <strong>bindMount</strong>ï¼Œä»¥è¯»å†™å’Œ MS_PRIVATE çš„å±æ€§å°† rootfsï¼ˆä¾‹å¦‚ &#x2F;run&#x2F;containerd&#x2F;io.containerd.runtime.v2.task&#x2F;k8s.io&#x2F;&lt;containerID&gt;&#x2F;rootfsï¼‰ç»‘å®šæŒ‚è½½åˆ° &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt;&#x2F;rootfs<br><em>è¿™ä¸ªç›®å½•æœ¬èº«ä¸ºå…±äº«ç›®å½•ï¼Œå› æ­¤æ— éœ€å‘ŠçŸ¥ agent å»æŒ‚è½½ï¼Œåœ¨ host ä¾§æŒ‚è½½åä¼šè‡ªåŠ¨åœ¨ guest ä¸­å‡ºç°</em></li>
<li>æ— è®ºä»¥ä¸Šå“ªç§æŒ‚è½½å½¢å¼ï¼Œæœ€ç»ˆ guest ä¸­å®¹å™¨ rootfs çš„æŒ‚è½½ç‚¹å‡ä¸º <XDG_RUNTIME_DIR>&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;containers&#x2F;&lt;containerID&gt;&#x2F;rootfs</li>
</ol>
<h2 id="UnshareRootFilesystem"><a href="#UnshareRootFilesystem" class="headerlink" title="UnshareRootFilesystem"></a>UnshareRootFilesystem</h2><p><strong>ç§»é™¤ guest ä¸­å®¹å™¨ rootfs å…±äº«æŒ‚è½½</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/fs_share_linux.go#L455">source code</a></p>
<ol>
<li>å¦‚æœ rootfs ç±»å‹ä¸º fuse.nydus-overlayfs<ol>
<li>é€šè¿‡ virtiofsd ç§»é™¤ guest ä¸­çš„ &#x2F;rafs&#x2F;&lt;containerID&gt;&#x2F;lowerdir æŒ‚è½½ç‚¹</li>
<li>ç§»é™¤ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt;&#x2F;snapshotdir æŒ‚è½½ç‚¹ï¼Œå¹¶åˆ é™¤ç›®å½•</li>
<li>ç§»é™¤ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt;&#x2F;rootfs ç›®å½•</li>
</ol>
</li>
<li>å¦‚æœ rootfs ç±»å‹ä¸æ˜¯ fuse.nydus-overlayfsï¼Œåˆ™ç§»é™¤ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt;&#x2F;rootfs æŒ‚è½½ç‚¹ï¼Œå¹¶åˆ é™¤ç›®å½•</li>
<li>åˆ é™¤ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;&lt;sandboxID&gt;&#x2F;mounts&#x2F;&lt;containerID&gt; ç›®å½•</li>
</ol>
</div><div class="article-licensing box"><div class="licensing-title"><p>ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers storage</p><p><a href="http://shenxianghong.github.io/2023/03/05/2023-03-05 Kata Containers æºç èµ°è¯» - vircontainers storage/">http://shenxianghong.github.io/2023/03/05/2023-03-05 Kata Containers æºç èµ°è¯» - vircontainers storage/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Shen Xianghong</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2023-03-05</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-05-09</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i>Â <a class="link-muted" rel="tag" href="/tags/Kata-Containers/">Kata Containers </a></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/03/12/2023-03-12%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20vircontainers%20factory/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers factory</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/01/30/2023-01-30%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20virtcontainers/"><span class="level-item">ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars.githubusercontent.com/u/35031258?v=4" alt="ğŸ¾Corgi"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">ğŸ¾Corgi</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">51</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">9</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/shenxianghong" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Youtube" href="https://youtube.com"><i class="fab fa-youtube"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Bilibili" href="https://bilibili.com"><i class="fab fa-bilibili"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Reddit" href="https://reddit.com"><i class="fab fa-reddit"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://google.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Google</span></span><span class="level-right"><span class="level-item tag">google.com</span></span></a></li><li><a class="level is-mobile" href="https://freegpt.one" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ChatGPT</span></span><span class="level-right"><span class="level-item tag">freegpt.one</span></span></a></li></ul></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#PersistDriver"><span class="level-left"><span class="level-item">1</span><span class="level-item">PersistDriver</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ToDisk"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">ToDisk</span></span></a></li><li><a class="level is-mobile" href="#FromDisk"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">FromDisk</span></span></a></li><li><a class="level is-mobile" href="#Destroy"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">Destroy</span></span></a></li><li><a class="level is-mobile" href="#Lock"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">Lock</span></span></a></li><li><a class="level is-mobile" href="#GlobalWrite"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">GlobalWrite</span></span></a></li><li><a class="level is-mobile" href="#GlobalRead"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">GlobalRead</span></span></a></li><li><a class="level is-mobile" href="#RunStoragePath"><span class="level-left"><span class="level-item">1.7</span><span class="level-item">RunStoragePath</span></span></a></li><li><a class="level is-mobile" href="#RunVMStoragePath"><span class="level-left"><span class="level-item">1.8</span><span class="level-item">RunVMStoragePath</span></span></a></li></ul></li><li><a class="level is-mobile" href="#FilesystemSharer"><span class="level-left"><span class="level-item">2</span><span class="level-item">FilesystemSharer</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#bindMount"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">bindMount</span></span></a></li><li><a class="level is-mobile" href="#Prepare"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Prepare</span></span></a></li><li><a class="level is-mobile" href="#Cleanup"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">Cleanup</span></span></a></li><li><a class="level is-mobile" href="#ShareFile"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">ShareFile</span></span></a></li><li><a class="level is-mobile" href="#UnshareFile"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">UnshareFile</span></span></a></li><li><a class="level is-mobile" href="#ShareRootFilesystem"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">ShareRootFilesystem</span></span></a></li><li><a class="level is-mobile" href="#UnshareRootFilesystem"><span class="level-left"><span class="level-item">2.7</span><span class="level-item">UnshareRootFilesystem</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Container-Runtime/"><span class="level-start"><span class="level-item">Container Runtime</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Disaster-Recovery/"><span class="level-start"><span class="level-item">Disaster Recovery</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Kubernetes/"><span class="level-start"><span class="level-item">Kubernetes</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/Programming/Elegant-Coding/"><span class="level-start"><span class="level-item">Elegant Coding</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Quick-Start/"><span class="level-start"><span class="level-item">Quick Start</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Serverless/"><span class="level-start"><span class="level-item">Serverless</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Service-Mesh/"><span class="level-start"><span class="level-item">Service Mesh</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="ğŸ¾Corgi" height="28"></a><p class="is-size-7"><span>&copy; 2023 Shen Xianghong</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p><p class="is-size-7"><br/>And did you get what you wanted from this life, even so?</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>