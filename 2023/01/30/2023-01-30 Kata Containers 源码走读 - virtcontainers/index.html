<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers - ğŸ¾Corgi</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="ğŸ¾Corgi"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="ğŸ¾Corgi"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="virtcontainers ä¸­ä¸ VCã€VCSandboxã€VCContainer ç­‰ç¡¬ä»¶è™šæ‹ŸåŒ–ç®¡ç†å¹³é¢ç›¸å…³çš„æµç¨‹æ¢³ç†"><meta property="og:type" content="blog"><meta property="og:title" content="ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers"><meta property="og:url" content="http://shenxianghong.github.io/2023/01/30/2023-01-30%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20virtcontainers/"><meta property="og:site_name" content="ğŸ¾Corgi"><meta property="og:description" content="virtcontainers ä¸­ä¸ VCã€VCSandboxã€VCContainer ç­‰ç¡¬ä»¶è™šæ‹ŸåŒ–ç®¡ç†å¹³é¢ç›¸å…³çš„æµç¨‹æ¢³ç†"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://picsum.photos/0?sig=20230130"><meta property="article:published_time" content="2023-01-29T16:00:00.000Z"><meta property="article:modified_time" content="2023-05-31T09:10:05.405Z"><meta property="article:author" content="Shen Xianghong"><meta property="article:tag" content="Kata Containers"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://picsum.photos/0?sig=20230130"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://shenxianghong.github.io/2023/01/30/2023-01-30%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20virtcontainers/"},"headline":"ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers","image":[],"datePublished":"2023-01-29T16:00:00.000Z","dateModified":"2023-05-31T09:10:05.405Z","author":{"@type":"Person","name":"Shen Xianghong"},"publisher":{"@type":"Organization","name":"ğŸ¾Corgi","logo":{"@type":"ImageObject","url":"http://shenxianghong.github.io/img/logo.svg"}},"description":"virtcontainers ä¸­ä¸ VCã€VCSandboxã€VCContainer ç­‰ç¡¬ä»¶è™šæ‹ŸåŒ–ç®¡ç†å¹³é¢ç›¸å…³çš„æµç¨‹æ¢³ç†"}</script><link rel="canonical" href="http://shenxianghong.github.io/2023/01/30/2023-01-30%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20virtcontainers/"><link rel="alternate" href="/atom.xml" title="ğŸ¾Corgi" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/xcode.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="ğŸ¾Corgi" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://picsum.photos/0?sig=20230130" alt="ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="fa fa-calendar"></i>Â <time dateTime="${date_xml(page.date)}" title="${date_xml(page.date)}">2023-01-30</time></span><span class="level-item"><i class="fa fa-calendar-check"></i>Â <time dateTime="${date_xml(page.updated)}" title="${date_xml(page.updated)}">2023-05-31</time></span><span class="level-item"><i class="far fa-folder-open"></i>Â <a class="link-muted" href="/categories/Container-Runtime/">Container Runtime</a></span><span class="level-item"><i class="far fa-clock"></i>Â an hour read (About 7651 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers</h1><div class="content"><div align=center><img width="200" style="border: 0px" src="https://katacontainers.io/static/logo-a1e2d09ad097b3fc8536cb77aa615c42.svg"></div>

<hr>
<blockquote>
<p>based on <strong>3.0.0</strong></p>
</blockquote>
<p>virtcontainers æœ¬è´¨ä¸Šä¸æ˜¯ç‹¬ç«‹ç»„ä»¶ï¼Œè€Œæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç¡¬ä»¶è™šæ‹ŸåŒ–å®¹å™¨è¿è¡Œæ—¶çš„ Golang åº“ã€‚</p>
<p>ç°æœ‰çš„å°‘æ•°éƒ¨åˆ†åŸºäº VM çš„å®¹å™¨è¿è¡Œæ—¶éƒ½å…±äº«ç›¸åŒçš„ç¡¬ä»¶è™šæ‹ŸåŒ–è¯­ä¹‰ï¼Œä½†æ˜¯ä½¿ç”¨ä¸åŒçš„ä»£ç åº“æ¥å®ç°ï¼Œvirtcontainers çš„ç›®æ ‡å°±æ˜¯å°†è¿™éƒ¨åˆ†å°è£…æˆä¸€ä¸ªé€šç”¨çš„ Golang åº“ã€‚</p>
<p>ç†æƒ³æƒ…å†µä¸‹ï¼ŒåŸºäº VM çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œä¼šä»å°†å®ƒä»¬å®ç°çš„è¿è¡Œæ—¶è§„èŒƒï¼ˆä¾‹å¦‚ OCI spec æˆ– Kubernetes CRIï¼‰è½¬æ¢æˆ virtcontainers APIã€‚</p>
<p>virtcontainers API å¤§è‡´å—åˆ° Kubernetes CRI çš„å¯å‘ã€‚ç„¶è€Œï¼Œå°½ç®¡è¿™ä¸¤ä¸ªé¡¹ç›®ä¹‹é—´çš„ API ç›¸ä¼¼ï¼Œä½† virtcontainers çš„ç›®æ ‡ä¸æ˜¯æ„å»º CRI å®ç°ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ªé€šç”¨çš„ã€è¿è¡Œæ—¶è§„èŒƒä¸å¯çŸ¥çš„ã€ç¡¬ä»¶è™šæ‹ŸåŒ–çš„å®¹å™¨åº“ï¼Œå…¶ä»–é¡¹ç›®å¯ä»¥åˆ©ç”¨å®ƒæ¥è‡ªå·±å®ç° CRIã€‚</p>
<h1 id="VC"><a href="#VC" class="headerlink" title="VC"></a>VC</h1><p><em><u>src&#x2F;runtime&#x2F;virtcontainers&#x2F;interfaces.go</u></em></p>
<p>virtcontainers åº“çš„å…¥å£æ¨¡å—ï¼ŒVC åˆå§‹åŒ– VCSandbox æ¨¡å—ç®¡ç† sandboxï¼Œè¿›è€Œåˆå§‹åŒ– VCContainer æ¨¡å—ç®¡ç†å®¹å™¨ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> VCImpl <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// factory çš„å…·ä½“å®ç°ï¼Œä¸ä¸ºç©ºæ—¶è¡¨ç¤ºä¸º VM factory åœºæ™¯</span></span><br><span class="line">	factory Factory</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>VC ä¸­å£°æ˜çš„ <strong>SetLogger</strong> å’Œ <strong>SetFactory</strong> å‡ä¸ºå‚æ•°èµ‹å€¼ï¼Œæ— å¤æ‚é€»è¾‘ï¼Œä¸ä½œè¯¦è¿°ã€‚</p>
<h2 id="CreateSandbox"><a href="#CreateSandbox" class="headerlink" title="CreateSandbox"></a>CreateSandbox</h2><p><strong>åˆ›å»º sandbox ä¸ pod_sandbox å®¹å™¨</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/implementation.go#L34">source code</a></p>
<ol>
<li>åˆ›å»º sandbox<ol>
<li>æ ¡éªŒ sandboxConfig çš„ annotation ä¸­è‡ªå®šä¹‰è¿è¡Œæ—¶é…ç½®ï¼ˆç§°ä¸º assets ï¼‰çš„åˆæ³•æ€§å¹¶è®¾ç½®<br><em>annotation ä¾‹å¦‚ io.katacontainers.hypervisor.kernel ä¸ºç”¨æˆ·ä¸Šå±‚é€šè¿‡ Pod annotation å®šä¹‰ï¼ŒCRI ä¼šé€ä¼ ç»™åº•å±‚è¿è¡Œæ—¶</em></li>
<li>åˆå§‹åŒ– VCSandboxï¼Œå‡†å¤‡æ‰€éœ€ç¯å¢ƒ</li>
<li>å¦‚æœ sandbox ä¸­çŠ¶æ€ä¿¡æ¯ï¼ˆå³ sandbox.stateï¼‰å·²ç»å­˜åœ¨ï¼Œåˆ™è¡¨æ˜ä¸æ˜¯æ–°åˆ›å»ºçš„ pod_sandbox å®¹å™¨ï¼Œæ— éœ€åç»­åŠ¨ä½œï¼Œä»…ç”¨äºçŠ¶æ€æ›´æ–°ç»´æŠ¤ï¼Œç›´æ¥è¿”å› sandbox å³å¯</li>
<li>è°ƒç”¨ fsShare çš„ <strong>Prepare</strong>ï¼Œå‡†å¤‡ sandbox æ‰€éœ€çš„å…±äº«æ–‡ä»¶ç³»ç»Ÿç›®å½•</li>
<li>è°ƒç”¨ agent çš„ <strong>createSandbox</strong>ï¼Œå‡†å¤‡ sandbox æ‰€éœ€ç¯å¢ƒ</li>
<li>è®¾ç½® sandbox çŠ¶æ€ä¸º ready</li>
</ol>
</li>
<li>å¦‚æœæœªå¯ç”¨ [runtime].disable_new_netns å¹¶ä¸”ä¸æ˜¯ VM factory åœºæ™¯ï¼ˆåœ¨ VM factory åœºæ™¯ä¸‹ï¼Œç½‘å¡æ˜¯åœ¨ VM å¯åŠ¨åçƒ­æ’è¿›å»çš„ï¼‰ï¼Œåˆ™è°ƒç”¨ network çš„ <strong>AddEndpoints</strong>ï¼Œæ·»åŠ  netns ä¸­çš„æ‰€æœ‰ç½‘å¡åˆ° VM ä¸­<br><em>netns è¦ä¹ˆæ˜¯ Kata Containers åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œè¦ä¹ˆæ˜¯ CNI ç­‰å¤–éƒ¨ç»„ä»¶é¢„å…ˆåˆ›å»ºã€‚æ€»ä¹‹ï¼Œæ­¤æ—¶ netns å·²ç»å­˜åœ¨äº†</em></li>
<li>è°ƒç”¨ resCtrl çš„ <strong>setupResourceController</strong>ï¼Œå°†å½“å‰è¿›ç¨‹åŠ å…¥ cgroup ä¸­ç®¡ç†</li>
<li>å¯åŠ¨ VMï¼ˆåœ¨ 1-2 æ­¥éª¤ä¸­çš„ VCSandbox åˆå§‹åŒ–æµç¨‹ä¸­ï¼Œå·²ç»åˆ›å»ºäº† VMï¼‰<ol>
<li>å¦‚æœ [hypervisor].enable_debug å¯ç”¨ï¼ˆç”¨äºè¾“å‡º  hypervisor å’Œ kernel äº§ç”Ÿçš„æ¶ˆæ¯ï¼‰ï¼Œåˆ™è°ƒç”¨ hypervisor çš„ <strong>GetVMConsole</strong>ï¼Œè·å– VM console åœ°å€ï¼ˆ&#x2F;run&#x2F;vc&#x2F;vm&#x2F;&lt;sandboxID&gt;&#x2F;console.sockï¼‰</li>
<li>è°ƒç”¨ network çš„ <strong>Run</strong>ï¼Œè¿›å…¥åˆ°è¯¥ netns ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹é€»è¾‘ï¼šå¦‚æœä¸º VM factory åœºæ™¯ï¼Œåˆ™è·å– factory ä¸­ç¼“å­˜çš„ VMï¼Œè°ƒç”¨ agent çš„ <strong>reuseAgent</strong>ï¼Œæ›´æ–° agent å®ä¾‹ï¼Œå¹¶åˆ›å»ºè½¯é“¾æ¥ &#x2F;run&#x2F;vc&#x2F;vm&#x2F;&lt;sandboxID&gt; æŒ‡å‘ &#x2F;run&#x2F;vc&#x2F;vm&#x2F;&lt;vmID&gt;ï¼›å¦åˆ™ï¼Œè°ƒç”¨ hypervisor çš„ <strong>StartVM</strong>ï¼Œå¯åŠ¨ VM è¿›ç¨‹</li>
<li>å¦‚æœä¸º VM factory åœºæ™¯ï¼Œåˆ™è°ƒç”¨ network çš„ <strong>AddEndpoints</strong>ï¼Œçƒ­æ·»åŠ  netns ä¸­çš„æ‰€æœ‰ç½‘å¡åˆ° VM ä¸­</li>
<li>å¦‚æœå¯ç”¨ [hypervisor].enable_debugï¼Œå®æ—¶è¯»å– VM console åœ°å€è·å–å…¶å®æ—¶å†…å®¹ï¼Œå¹¶ä»¥ debug çº§åˆ«æ—¥å¿—å½¢å¼è¾“å‡º</li>
<li>è°ƒç”¨ agent çš„ <strong>startSandbox</strong></li>
</ol>
</li>
<li>è°ƒç”¨ network çš„ <strong>Endpoints</strong>ï¼Œè·å– VM æ‰€æœ‰çš„ç½‘å¡è®¾å¤‡ï¼Œè°ƒç”¨ endpoint çš„ <strong>NetworkPair</strong>ï¼Œå…³é—­ä½äº host ä¾§çš„ vhost_net å¥æŸ„ï¼ˆå³ &#x2F;dev&#x2F;vhost-netï¼‰<br><em>æˆªè‡³ Kata 3.0ï¼Œç›®å‰ä»…å¯¹ macvtap ç±»å‹çš„ endpoint ç”Ÿæ•ˆ</em></li>
<li>è°ƒç”¨ agent çš„ <strong>getGuestDetails</strong>ï¼Œè·å–å¦‚ seccompSupported ç­‰ guest ä¿¡æ¯è¯¦æƒ…ï¼Œæ›´æ–°è‡³ sandbox ä¸­</li>
<li>åˆ›å»º sandbox ä¸­çš„æ¯ä¸€ä¸ªå®¹å™¨ï¼ˆå…¶å®ï¼Œæ­¤æ—¶ sandbox ä¸­ä»…æœ‰ä¸€ä¸ªå®¹å™¨ï¼Œå°±æ˜¯ pod_sandbox å®¹å™¨æœ¬èº«ï¼‰<ol>
<li>åˆå§‹åŒ– VCContainerï¼Œå‡†å¤‡å®¹å™¨æ‰€éœ€ç¯å¢ƒ</li>
<li>æ ¹æ® [hypervisor].disable_block_device_useã€agent æ˜¯å¦å…·å¤‡ä½¿ç”¨å—è®¾å¤‡èƒ½åŠ›ä»¥åŠ hypervisor æ˜¯å¦å…è®¸å—è®¾å¤‡çƒ­æ’æ‹”ï¼Œåˆ¤æ–­æ˜¯å¦å½“å‰æ”¯æŒå—è®¾å¤‡ï¼Œå¹¶ä¸”å®¹å™¨çš„ rootfs ç±»å‹ä¸æ˜¯ fuse.nydus-overlayfsï¼Œä¹Ÿå°±æ˜¯ rootfs æ˜¯åŸºäºå—è®¾å¤‡åˆ›å»ºçš„<ol>
<li>é€šè¿‡ &#x2F;sys&#x2F;dev&#x2F;block&#x2F;&lt;major&gt;-&lt;minor&gt;&#x2F;dm çš„å­˜åœ¨æ€§ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º devicemapper å—è®¾å¤‡</li>
<li>å¦‚æœæ˜¯ devicemapper å—è®¾å¤‡ï¼Œåˆ™è°ƒç”¨ devManager çš„ <strong>NewDevice</strong>ï¼Œåˆå§‹åŒ–è®¾å¤‡ï¼Œå¹¶è°ƒç”¨ devManager çš„ <strong>AttachDevice</strong>ï¼Œçƒ­æ’åˆ° VM ä¸­ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;containers&#x2F;&lt;sandboxID&gt; è·¯å¾„</li>
</ol>
</li>
<li>é’ˆå¯¹å®¹å™¨ä¸­çš„æ¯ä¸€ä¸ªè®¾å¤‡ï¼Œè°ƒç”¨ devManager çš„ <strong>AttachDevice</strong>ï¼Œattach åˆ° VM ä¸­</li>
<li>è°ƒç”¨ agent çš„ <strong>createContainer</strong>ï¼Œåˆ›å»º pod_sandbox å®¹å™¨</li>
<li>è®¾ç½®å®¹å™¨çŠ¶æ€ä¸º ready</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
<li>æ›´æ–°ç»´æŠ¤åœ¨ sandbox ä¸­çš„å®¹å™¨ä¿¡æ¯</li>
</ol>
</li>
<li>è°ƒç”¨ <strong>updateResources</strong>ï¼Œçƒ­æ›´æ–° VM çš„èµ„æºè§„æ ¼ï¼ˆç”±äºè¯¥æµç¨‹ä¸­ä»…ä¸ºåˆ›å»º pod_sandboxï¼Œä¸æ¶‰åŠ pod_containerï¼Œå› æ­¤ä¸ºé…ç½®ä¸­å£°æ˜çš„ [hypervisor].default_vcpus å’Œ [hypervisor].default_memoryï¼‰</li>
<li>è°ƒç”¨ resCtrl çš„ <strong>resourceControllerUpdate</strong>ï¼Œæ›´æ–° sandbox çš„ cgroup</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="CleanupContainer"><a href="#CleanupContainer" class="headerlink" title="CleanupContainer"></a>CleanupContainer</h2><p><strong>å…³åœã€åˆ é™¤å®¹å™¨å¹¶é”€æ¯ sandbox ç¯å¢ƒ</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/implementation.go#L41">source code</a></p>
<ol>
<li>è°ƒç”¨ store çš„ <strong>FromDisk</strong>ï¼Œè¯»å– sandbox çŠ¶æ€ä¿¡æ¯</li>
<li>è·å– sandbox å¹¶æ›´æ–°å…¶ä¸­çš„å®¹å™¨ï¼ˆæ›´æ–°çš„æ„ä¹‰åœ¨äºåç»­çš„åˆ é™¤æ“ä½œä»¥æ–‡ä»¶å†…å®¹ä¸ºå‡†ï¼‰</li>
<li>è°ƒç”¨ VCSandbox çš„ <strong>StopContainer</strong> å’Œ <strong>DeleteContainer</strong>ï¼Œå…³åœå¹¶åˆ é™¤è¯¥å®¹å™¨</li>
<li>è°ƒç”¨ VCSandbox çš„ <strong>GetAllContainers</strong>ï¼Œè·å– sandbox ä¸­çš„æ‰€æœ‰å®¹å™¨ï¼Œå¦‚æœä»å¤§äº 0ï¼ˆè¯´æ˜å½“å‰ sandbox ä»æœ‰å®¹å™¨å­˜åœ¨ï¼Œéœ€è¦ä¿ç•™ sandbox ç¯å¢ƒï¼‰ï¼Œå¦åˆ™è°ƒç”¨ VCSandbox çš„ <strong>Stop</strong>ï¼Œå…³åœ sandboxï¼Œå¹¶è°ƒç”¨ VCSandbox çš„ <strong>Delete</strong>ï¼Œåˆ é™¤ sandbox</li>
</ol>
<h1 id="VCSandbox"><a href="#VCSandbox" class="headerlink" title="VCSandbox"></a>VCSandbox</h1><p><em><u>src&#x2F;runtime&#x2F;virtcontainers&#x2F;interfaces.go</u></em></p>
<p>virtcontainers åº“ä¸­ç”¨äºç®¡ç† sandbox çš„æ¨¡å—ï¼ŒåŒæ—¶è°ƒç”¨ VCContainer æ¨¡å—é—´æ¥ç®¡ç†å®¹å™¨ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sandbox is composed of a set of containers and a runtime environment.</span></span><br><span class="line"><span class="comment">// A Sandbox can be created, deleted, started, paused, stopped, listed, entered, and restored.</span></span><br><span class="line"><span class="keyword">type</span> Sandbox <span class="keyword">struct</span> &#123;</span><br><span class="line">	ctx             context.Context</span><br><span class="line">	id							<span class="type">string</span></span><br><span class="line">	sync.Mutex</span><br><span class="line">	annotationsLock *sync.RWMutex</span><br><span class="line">	wg              *sync.WaitGroup</span><br><span class="line">	monitor         *monitor</span><br><span class="line">	config          *SandboxConfig</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// virtcontainers ä¸­çš„å„ç±»å­æ¨¡å—</span></span><br><span class="line">	devManager api.DeviceManager</span><br><span class="line">	factory    Factory</span><br><span class="line">	hypervisor Hypervisor</span><br><span class="line">	agent      agent</span><br><span class="line">	store      persistapi.PersistDriver</span><br><span class="line">	fsShare    FilesystemSharer</span><br><span class="line">	network    Network</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// sandbox ä¸­çš„ SWAP è®¾å¤‡</span></span><br><span class="line">	swapDevices   []*config.BlockDrive</span><br><span class="line">	<span class="comment">// sandbox ä¸­çš„ SWAP è®¾å¤‡æ€»å¤§å°</span></span><br><span class="line">	swapSizeBytes <span class="type">int64</span></span><br><span class="line">	<span class="comment">// sandbox ä¸­çš„ SWAP è®¾å¤‡æ•°é‡</span></span><br><span class="line">	swapDeviceNum <span class="type">uint</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">// host å’Œ sandbox çš„å…±äº«å·</span></span><br><span class="line">	volumes []types.Volume</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ˜¯å¦æ‰€æœ‰å®¹å™¨å…±äº«ç›¸åŒçš„ sandbox çº§åˆ«çš„ PID å‘½åç©ºé—´</span></span><br><span class="line">	sharePidNs <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç”¨äºç›‘è§† guest console è¾“å‡ºæµ</span></span><br><span class="line">	cw *consoleWatcher</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// [runtime].sandbox_cgroup_only]ï¼Œé»˜è®¤ä¸º false</span></span><br><span class="line">	<span class="comment">// - falseï¼šsandboxController å’Œ overheadController åŒæ—¶å­˜åœ¨</span></span><br><span class="line">	<span class="comment">// - trueï¼šä»…æœ‰ sandboxControllerï¼ŒoverheadController ä¸º nil</span></span><br><span class="line">	sandboxController  resCtrl.ResourceController</span><br><span class="line">	overheadController resCtrl.ResourceController</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// sandbox ä¸­çš„å®¹å™¨ï¼ŒKey ä¸º containerID</span></span><br><span class="line">	containers <span class="keyword">map</span>[<span class="type">string</span>]*Container</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// sandbox çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬ cgroup è·¯å¾„ã€å—è®¾å¤‡ç´¢å¼•è®°å½•ç­‰</span></span><br><span class="line">	state types.SandboxState</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// destination ä¸º /dev/shmï¼Œtype ä¸º bind çš„æŒ‚è½½ç‚¹çš„ source å¤§å°</span></span><br><span class="line">	shmSize <span class="type">uint64</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// guest ç‰¹æ€§ï¼Œéœ€è¦è°ƒç”¨ agent æ¥å£è·å¾—</span></span><br><span class="line">	<span class="comment">// guest æ˜¯å¦æ”¯æŒ seccomp ç‰¹æ€§</span></span><br><span class="line">	seccompSupported  <span class="type">bool</span></span><br><span class="line">	<span class="comment">// æ˜¯å¦ç¦æ­¢ VM å…³æœº</span></span><br><span class="line">	disableVMShutdown <span class="type">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å·¥å‚å‡½æ•°</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L527">source code</a></p>
<ol>
<li>æ ¡éªŒ [runtime].experimental æ˜¯å¦ä¸ºå¯æ”¯æŒçš„ç‰¹æ€§</li>
<li>åˆå§‹åŒ– hypervisorã€agentã€storeã€fsSharerã€devManager ç­‰ virtcontainers å­æ¨¡å—</li>
<li>åˆå§‹åŒ– resourceControllerï¼ˆ[runtime].sandbox_cgroup_only ä¸º true è¡¨ç¤º Pod æ‰€æœ‰çš„çº¿ç¨‹å…¨éƒ¨ç”± sandboxController ç®¡ç†ï¼›åä¹‹ï¼Œä»… vCPU çº¿ç¨‹ç”± sandboxController ç®¡ç†ï¼Œè€Œå…¶ä½™çš„ç”± overheadController ç®¡ç†ï¼‰<ol>
<li>è·å–åˆ° spec.Linux.CgroupsPathï¼ˆç¼ºçœä¸º &#x2F;vcï¼‰ï¼Œå¦‚æœ cgroup ä¸æ˜¯ç”± systemd çº³ç®¡ï¼ˆé€šè¿‡ cgroupPath æ ¼å¼åˆ¤æ–­ï¼‰ï¼Œåˆ™æœ€åä¸€çº§è·¯å¾„æ–°å¢ kata_ å‰ç¼€</li>
<li>è·å– spec.Linux.Resources.Devices ä¸­ &#x2F;dev&#x2F;null å’Œ &#x2F;dev&#x2F;urandom è®¾å¤‡ä¿¡æ¯ï¼ˆå¦‚æœæœªå£°æ˜ï¼Œåˆ™æ„å»ºï¼‰</li>
<li>è°ƒç”¨ devManager çš„ <strong>GetAllDevices</strong>ï¼Œè·å–æ‰€æœ‰çš„è®¾å¤‡ï¼›è¿›ä¸€æ­¥è°ƒç”¨ device çš„ <strong>GetHostPath</strong>ï¼Œè·å–è®¾å¤‡ä½äº host ä¸Šçš„è·¯å¾„ï¼Œå°†å…¶æ„å»ºæˆ cgroup ç®¡ç†å½¢å¼</li>
<li>è°ƒç”¨ resCtrl çš„ <strong>NewSandboxResourceController</strong>ï¼Œåˆå§‹åŒ– sandboxControllerï¼ˆcgroupPath ä¸ºæ­¥éª¤ 1 å¤„ç†åçš„ç»“æœï¼‰</li>
<li>å¦‚æœ [runtime].sandbox_cgroup_only ä¸º falseï¼Œåˆ™è°ƒç”¨ resCtrl çš„ <strong>NewResourceController</strong>ï¼Œåˆå§‹åŒ– overheadController ï¼ˆcgroupPath ä¸º &#x2F;kata_overhead&#x2F;&lt;sandboxID&gt;ï¼‰</li>
</ol>
</li>
<li>ä»æ–‡ä»¶æ¢å¤ sandbox çŠ¶æ€ä¿¡æ¯<ol>
<li>è°ƒç”¨ store çš„ <strong>FromDisk</strong>ï¼Œå°è¯•ä»æ–‡ä»¶ä¸­æ¢å¤ sandbox çŠ¶æ€ä¿¡æ¯<br><em>å½“ sandbox æ–°åˆ›å»ºçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰çŠ¶æ€æ–‡ä»¶ï¼Œå› æ­¤å¿…ç„¶å¤±è´¥ï¼Œä½†æ˜¯ä¼šå¿½ç•¥é”™è¯¯ä¿¡æ¯</em></li>
<li>è°ƒç”¨ hypervisor çš„ <strong>Load</strong>ï¼ŒåŠ è½½ hypervisor ä¿¡æ¯</li>
<li>è°ƒç”¨ devManager çš„ <strong>LoadDevices</strong>ï¼ŒåŠ è½½è®¾å¤‡ä¿¡æ¯</li>
<li>è°ƒç”¨ agent çš„ <strong>load</strong>ï¼ŒåŠ è½½ agent ä¿¡æ¯</li>
<li>è°ƒç”¨ endpoint çš„ <strong>load</strong>ï¼ŒåŠ è½½ç½‘ç»œ endpoint ä¿¡æ¯</li>
</ol>
</li>
<li>æ ¡éªŒ sandboxConfig ä¸­çš„ hypervisor é…ç½®çš„åˆæ³•æ€§ï¼Œå…¶ä¸­åŒ…æ‹¬ [hypervisor].kernel æ˜¯å¦ä¸ä¸ºç©ºï¼Œ[hypervisor].image å’Œ [hypervisor].initrd æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªã€‚å¹¶è®¾ç½® [hypervisor].default_vcpus ç¼ºçœæ—¶ä¸º 1ï¼Œ[hypervisor].default_memory ç¼ºçœæ—¶ä¸º 2048</li>
<li>è°ƒç”¨ hypervisor çš„ <strong>CreateVM</strong>ï¼Œåˆ›å»º VM</li>
<li>è°ƒç”¨ agent çš„ <strong>init</strong>ï¼Œå‡†å¤‡ agent ç¯å¢ƒ</li>
</ol>
<p>VCSandbox ä¸­å£°æ˜çš„ <strong>Annotations</strong>ã€<strong>GetNetNs</strong>ã€<strong>GetAllContainers</strong>ã€<strong>GetAnnotations</strong>ã€<strong>GetContainer</strong>ã€<strong>ID</strong> å’Œ <strong>SetAnnotations</strong> å‡ä¸ºå‚æ•°è·å–ä¸èµ‹å€¼ï¼Œæ— å¤æ‚é€»è¾‘ï¼Œä¸ä½œè¯¦è¿°ã€‚</p>
<h2 id="updateResources"><a href="#updateResources" class="headerlink" title="updateResources"></a>updateResources</h2><p><strong>çƒ­æ›´æ–° VM çš„èµ„æºè§„æ ¼</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1966">source code</a></p>
<ol>
<li><p>å¦‚æœ [runtime].static_sandbox_resource_mgmt å¯ç”¨æ—¶ï¼ˆKata å°†åœ¨å¯åŠ¨è™šæ‹Ÿæœºä¹‹å‰ç¡®å®šåˆé€‚çš„ sandbox å†…å­˜å’Œ CPU å¤§å°ï¼Œè€ŒéåŠ¨æ€æ›´æ–°ã€‚ ä½œä¸º hypervisor ä¸æ”¯æŒ CPUã€å†…å­˜çƒ­æ’æ‹”æ—¶çš„è§£å†³æ–¹æ¡ˆï¼‰ï¼Œåˆ™ä¸è§¦å‘æ›´æ–°æ“ä½œï¼Œç›´æ¥è¿”å›</p>
</li>
<li><p>è®¡ç®— sandbox ä¸­æ‰€æœ‰çŠ¶æ€é stopped å®¹å™¨çš„ CPU ã€å†…å­˜å’Œ SWAP æ€»é‡ï¼ˆå‰ææ˜¯ [hypervisor].enable_guest_swap å¼€å¯ï¼Œå¹¶ä¸” memory.swappiness å¤§äº 0ï¼Œæ‰ä¼šè€ƒè™‘ SWAP èµ„æºï¼‰ï¼ŒåŠ ä¸ŠåŸºç¡€ VM å¤§å°ï¼Œå¾—å‡ºæœ€åé¢„æœŸçš„ VM å¤§å°ï¼Œå…¬å¼ä¸º</p>
<blockquote>
<p>CPU &#x3D; (C1.cpu-quota * 1000 &#x2F; C1.cpu-period + 999) &#x2F; 1000 + C2â€¦ + [hypervisor].default_vcpus</p>
<p>MEM &#x3D; C1.memory-limit + C1.hugepages-limit + C2â€¦ + [hypervisor].default_memory</p>
<p>SWAP &#x3D; </p>
<table>
<thead>
<tr>
<th><code>swap_in_bytes</code></th>
<th><code>memory_limit_in_bytes</code></th>
<th>swap size</th>
</tr>
</thead>
<tbody><tr>
<td>set</td>
<td>set</td>
<td><code>io.katacontainers.container.resource.swap_in_bytes</code>- <code>memory_limit_in_bytes</code></td>
</tr>
<tr>
<td>not set</td>
<td>set</td>
<td><code>memory_limit_in_bytes</code></td>
</tr>
<tr>
<td>not set</td>
<td>not set</td>
<td><code>io.katacontainers.config.hypervisor.default_memory</code></td>
</tr>
<tr>
<td>set</td>
<td>not set</td>
<td>cgroup doesnâ€™t support this usage</td>
</tr>
</tbody></table>
</blockquote>
<p><em>æˆªè‡³ Kata 3.0ï¼Œåœ¨ K8s åœºæ™¯ä¸‹ï¼ŒSWAP åŠŸèƒ½ä»å­˜åœ¨å¼‚å¸¸ï¼šå‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/issues/5627">https://github.com/kata-containers/kata-containers/issues/5627</a></em></p>
</li>
<li><p>å¦‚æœé¢„æœŸ SWAP æ¯”å½“å‰ sandbox çš„ SWAP å¤šï¼Œåˆ™éœ€è¦æ–°å¢ä¸€ä¸ªå¤§å°ä¸ºä¸¤è€…å·®å€¼çš„ SWAP æ–‡ä»¶</p>
<ol>
<li>åˆ›å»º &#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;swap&lt;ID&gt; æ–‡ä»¶ï¼ˆsandbox ä¸­çš„ SWAP åºå·ä» 0 é€’å¢ï¼‰</li>
<li>è°ƒæ•´æ–‡ä»¶çš„å¤§å°ä¸ºå·®å€¼å’Œ 10 å€å†…å­˜åˆ†é¡µä¸­æœ€å¤§å€¼ï¼ˆå°äº 10 å€å†…é¡µåˆ†é¡µçš„ SWAP ä¼šè¢« mkswap æ‹’ç»ï¼šmkswap: error: swap area needs to be at least 40 KiBï¼Œå†…å­˜åˆ†é¡µï¼š4096ï¼‰ï¼Œå¹¶é¢å¤–è¿½åŠ ä¸€ä¸ªå†…å­˜åˆ†é¡µå¤§å°ï¼ˆSWAP æ–‡ä»¶éœ€è¦ä¸€ä¸ªå†…å­˜åˆ†é¡µå¤§å°å‚¨å­˜å…ƒæ•°æ®ï¼‰</li>
<li>è°ƒç”¨ç³»ç»Ÿå‘½ä»¤ mkswapï¼Œè½¬æ¢ä¸º SWAP æ–‡ä»¶ï¼Œå¹¶æ„å»º raw æ ¼å¼çš„å—è®¾å¤‡ç±»å‹</li>
<li>è°ƒç”¨ hypervisor çš„ <strong>HotplugAddDevice</strong>ï¼Œçƒ­æ·»åŠ  SWAP æ–‡ä»¶åˆ° VM ä¸­</li>
<li>è°ƒç”¨ agent çš„ <strong>addSwap</strong>ï¼Œé…ç½® SWAP æ–‡ä»¶</li>
</ol>
</li>
<li><p>è°ƒç”¨ hypervisor çš„ <strong>ResizeVCPUs</strong>ï¼Œè°ƒæ•´ VM CPU æ•°é‡</p>
</li>
<li><p>å¦‚æœä¸ºæ–°å¢è°ƒæ•´ï¼Œåˆ™è°ƒç”¨ agent çš„ <strong>onlineCPUMem</strong>ï¼Œé€šçŸ¥ agent ä¸Šçº¿çƒ­æ·»åŠ éƒ¨åˆ†çš„ CPU</p>
</li>
<li><p>å¾ªç¯è°ƒç”¨ hypervisor çš„ <strong>GetTotalMemoryMB</strong>ï¼Œè·å–å½“å‰ VM çš„å†…å­˜æ•°é‡ï¼Œæ¯”å¯¹é¢„æœŸ VM çš„å†…å­˜æ•°é‡ï¼Œåœ¨ä¸è¶…å‡ºæœ€å¤§çƒ­æ·»åŠ å†…å­˜æ•°é‡é™åˆ¶çš„å‰æä¸‹ï¼ˆéƒ¨åˆ†åœºæ™¯ä¸‹ï¼Œä¾‹å¦‚ ACPI çƒ­æ’æ‹”ï¼Œå†…å­˜çš„å•æ¬¡çƒ­æ·»åŠ æœ‰æœ€å¤§æ•°é‡é™åˆ¶ï¼›è€Œåœ¨ virtio-mem ä¸‹ï¼Œå³ [hypervisor].enable_virtio_mem å¯ç”¨ï¼Œ ä¸” &#x2F;proc&#x2F;sys&#x2F;vm&#x2F;overcommit_memory æ–‡ä»¶å†…å®¹ä¸º 1ï¼Œåˆ™æ²¡æœ‰æœ€å¤§çƒ­æ·»åŠ æ•°é‡é™åˆ¶ï¼‰ï¼Œè°ƒç”¨ hypervisor çš„ <strong>ResizeMemory</strong>ï¼Œåˆ†æ‰¹çƒ­æ·»åŠ  VM å†…å­˜</p>
</li>
<li><p>è°ƒç”¨ agent çš„ <strong>memHotplugByProbe</strong>ï¼Œé€šçŸ¥ agent å†…å­˜çƒ­æ’äº‹ä»¶ï¼ˆå¦‚æœ guest å†…æ ¸æ”¯æŒå†…å­˜çƒ­æ·»åŠ æ¢æµ‹ï¼‰ï¼Œå¹¶è°ƒç”¨ agent çš„ <strong>onlineCPUMem</strong>ï¼Œé€šçŸ¥ agent ä¸Šçº¿çƒ­æ·»åŠ éƒ¨åˆ†çš„å†…å­˜</p>
</li>
</ol>
<h2 id="Stats"><a href="#Stats" class="headerlink" title="Stats"></a>Stats</h2><p><strong>è·å– sandbox çš„ç»Ÿè®¡ä¿¡æ¯</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1547">source code</a></p>
<ol>
<li>è°ƒç”¨ sandboxController çš„ <strong>Stat</strong>ï¼Œè·å– sandbox å…¨éƒ¨çš„ cgroup ç»Ÿè®¡ä¿¡æ¯ï¼ˆæˆªè‡³å½“å‰ï¼Œå¹¶æœªèšåˆ kata_overhead çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå³ overheadController éƒ¨åˆ†ï¼‰</li>
<li>è°ƒç”¨ hypervisor çš„ <strong>GetThreadIDs</strong>ï¼Œè·å– hypervisor ä½¿ç”¨çš„ CPU æ•°é‡</li>
<li>èšåˆä»¥ä¸Šä¿¡æ¯å¹¶è¿”å›</li>
</ol>
<h2 id="Start"><a href="#Start" class="headerlink" title="Start"></a>Start</h2><p><strong>å¯åŠ¨ sandbox ä¸ pod_sandbox å®¹å™¨</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1662">source code</a></p>
<ol>
<li>æ ¡éªŒ sandbox çŠ¶æ€æ˜¯å¦ä¸º readyã€paused æˆ– stopped</li>
<li>è®¾ç½® sandbox çŠ¶æ€ä¸º running</li>
<li>é’ˆå¯¹ sandbox ä¸­çš„æ¯ä¸€ä¸ªå®¹å™¨ï¼Œè°ƒç”¨ VCContainer çš„ <strong>start</strong>ï¼Œå¯åŠ¨å®¹å™¨ï¼ˆå…¶å®ï¼Œæ­¤æ—¶ sandbox ä¸­ä»…æœ‰ä¸€ä¸ªå®¹å™¨ï¼Œå°±æ˜¯ pod_sandbox å®¹å™¨æœ¬èº«ï¼‰</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="Stop"><a href="#Stop" class="headerlink" title="Stop"></a>Stop</h2><p><strong>å…³åœ sandbox ä¸å®¹å™¨ï¼Œå¹¶æ¸…ç†ç›¸å…³èµ„æº</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1687">source code</a></p>
<ol>
<li>å¦‚æœ sandbox çŠ¶æ€å·²ç»ä¸º stoppedï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œ</li>
<li>æ ¡éªŒ sandbox çŠ¶æ€æ˜¯å¦ä¸º readyã€running æˆ–è€… paused</li>
<li>é’ˆå¯¹ sandbox ä¸­çš„æ¯ä¸€ä¸ªå®¹å™¨ï¼Œè°ƒç”¨ VCContainer çš„ <strong>stop</strong>ï¼Œå…³åœå®¹å™¨</li>
<li>è°ƒç”¨ agent çš„ <strong>stopSandbox</strong>ï¼Œå…³åœ sandbox</li>
<li>è°ƒç”¨ hypervisor çš„ <strong>StopVM</strong>ï¼Œå…³åœ VM</li>
<li>å¦‚æœ [hypervisor]. enable_debug å¯ç”¨ï¼Œåˆ™å…³é—­ VM console</li>
<li>è®¾ç½® sandbox çŠ¶æ€ä¸º stopped</li>
<li>è°ƒç”¨ network çš„ <strong>RemoveEndpoints</strong>ï¼Œç§»é™¤ VM ä¸­çš„æ‰€æœ‰ç½‘å¡</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
<li>è°ƒç”¨ agent çš„ <strong>disconnect</strong>ï¼Œå…³é—­ä¸ agent çš„è¿æ¥</li>
<li>ç§»é™¤ host ä¸Šçš„ &#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;sandboxes&#x2F;swap&lt;ID&gt; æ–‡ä»¶ï¼ˆsandbox ä¸­çš„ SWAP åºå·ä» 0 é€’å¢ï¼‰</li>
</ol>
<h2 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h2><p><strong>é”€æ¯ sandbox ä¸å®¹å™¨ï¼Œå¹¶æ¸…ç†ç›¸å…³èµ„æº</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L798">source code</a></p>
<ol>
<li>æ ¡éªŒ sandbox çš„çŠ¶æ€æ˜¯å¦ä¸º readyã€paused å’Œ stopped</li>
<li>é’ˆå¯¹ sandbox ä¸­çš„æ¯ä¸€ä¸ªå®¹å™¨ï¼Œè°ƒç”¨ VCContainer çš„ <strong>delete</strong>ï¼Œåˆ é™¤å®¹å™¨</li>
<li>å¦‚æœåœ¨ root æƒé™ä¸‹ï¼Œåˆ™è°ƒç”¨ resCtrl çš„ <strong>resourceControllerDelete</strong>ï¼Œåˆ é™¤ç›¸å…³çš„ resourceController ä»¥åŠ cgroup èµ„æº</li>
<li>å…³åœ sandbox çš„ monitor</li>
<li>è°ƒç”¨ hypervisor çš„ <strong>Cleanup</strong>ï¼Œæ¸…ç† hypervisor èµ„æº</li>
<li>è°ƒç”¨ fsShare çš„ <strong>Cleanup</strong>ï¼Œæ¸…ç† sandbox çš„å…±äº«æ–‡ä»¶ç³»ç»Ÿ</li>
<li>è°ƒç”¨ store çš„ <strong>Destroy</strong>ï¼Œåˆ é™¤çŠ¶æ€æ•°æ®ç›®å½•</li>
</ol>
<h2 id="Status"><a href="#Status" class="headerlink" title="Status"></a>Status</h2><p><strong>è·å– sandbox ä¸å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L333">source code</a></p>
<ol>
<li>é’ˆå¯¹ sandbox ä¸­çš„æ¯ä¸€ä¸ªå®¹å™¨ï¼Œè·å–å…¶çŠ¶æ€ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šIDã€rootfsã€çŠ¶æ€ã€å¯åŠ¨æ—¶é—´ã€annotationã€PID ç­‰ï¼‰</li>
<li>ç»“åˆ sandbox çš„çŠ¶æ€ä¿¡æ¯ï¼ˆä¾‹å¦‚ IDã€çŠ¶æ€ã€hypervisor ç±»åˆ«ã€hypervisor é…ç½®ã€annotation ç­‰ï¼‰è¿”å›</li>
</ol>
<h2 id="CreateContainer"><a href="#CreateContainer" class="headerlink" title="CreateContainer"></a>CreateContainer</h2><p><strong>åˆ›å»º pod_container å®¹å™¨å¹¶çƒ­æ›´æ–° sandbox è§„æ ¼</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1300">source code</a></p>
<ol>
<li>åˆå§‹åŒ– VCContainerï¼Œå‡†å¤‡å®¹å™¨ç¯å¢ƒï¼ŒæŒ‚è½½è®¾å¤‡ç­‰</li>
<li>æ ¹æ® [hypervisor].disable_block_device_useã€agent æ˜¯å¦å…·å¤‡ä½¿ç”¨å—è®¾å¤‡èƒ½åŠ›ä»¥åŠ hypervisor æ˜¯å¦å…è®¸å—è®¾å¤‡çƒ­æ’æ‹”ï¼Œåˆ¤æ–­æ˜¯å¦å½“å‰æ”¯æŒå—è®¾å¤‡ï¼Œå¹¶ä¸”å®¹å™¨çš„ rootfs ç±»å‹ä¸æ˜¯ fuse.nydus-overlayfsï¼Œä¹Ÿå°±æ˜¯ rootfs æ˜¯åŸºäºå—è®¾å¤‡åˆ›å»ºçš„<ol>
<li>é€šè¿‡ &#x2F;sys&#x2F;dev&#x2F;block&#x2F;&lt;major&gt;-&lt;minor&gt;&#x2F;dm çš„å­˜åœ¨æ€§ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º devicemapper å—è®¾å¤‡</li>
<li>å¦‚æœæ˜¯ devicemapper å—è®¾å¤‡ï¼Œåˆ™è°ƒç”¨ devManager <strong>NewDevice</strong>ï¼Œåˆå§‹åŒ–è®¾å¤‡ï¼Œå¹¶è°ƒç”¨ devManager çš„ <strong>AttachDevice</strong>ï¼Œçƒ­æ’åˆ° VM ä¸­ &lt;XDG_RUNTIME_DIR&gt;&#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;containers&#x2F;&lt;sandboxID&gt; è·¯å¾„</li>
</ol>
</li>
<li>é’ˆå¯¹å®¹å™¨ä¸­çš„æ¯ä¸€ä¸ªè®¾å¤‡ï¼Œè°ƒç”¨ devManager çš„ <strong>AttachDevice</strong>ï¼Œçƒ­æ’åˆ° VM ä¸­</li>
<li>è°ƒç”¨ agent çš„ <strong>createContainer</strong>ï¼Œåˆ›å»º pod_container å®¹å™¨</li>
<li>è®¾ç½®å®¹å™¨çŠ¶æ€ä¸º ready</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
<li>æ›´æ–°ç»´æŠ¤åœ¨ sandbox ä¸­çš„å®¹å™¨ä¿¡æ¯</li>
<li>è°ƒç”¨ <strong>updateResources</strong>ï¼Œçƒ­æ›´æ–° VM çš„èµ„æºè§„æ ¼</li>
<li>è°ƒç”¨ resCtrl çš„ <strong>resourceControllerUpdate</strong>ï¼Œæ›´æ–° sandbox çš„ cgroup</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="DeleteContainer"><a href="#DeleteContainer" class="headerlink" title="DeleteContainer"></a>DeleteContainer</h2><p><strong>åˆ é™¤ sandbox ä¸­çš„æŒ‡å®šå®¹å™¨</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1431">source code</a></p>
<ol>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œå¹¶è°ƒç”¨ VCContainer çš„ <strong>delete</strong>ï¼Œåˆ é™¤ç»´æŠ¤çš„å®¹å™¨ä¿¡æ¯</li>
<li>è°ƒç”¨ resCtrl çš„ <strong>resourceControllerUpdate</strong>ï¼Œæ›´æ–° sandbox çš„ cgroup</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="StartContainer"><a href="#StartContainer" class="headerlink" title="StartContainer"></a>StartContainer</h2><p><strong>å¯åŠ¨ sandbox ä¸­çš„ pod_container å®¹å™¨</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1364">source code</a></p>
<ol>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œå¹¶è°ƒç”¨ VCContainer çš„ <strong>start</strong>ï¼Œå¯åŠ¨å®¹å™¨</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
<li>è°ƒç”¨ <strong>updateResources</strong>ï¼Œçƒ­æ›´æ–° VM çš„èµ„æºä¿¡æ¯</li>
</ol>
<h2 id="StopContainer"><a href="#StopContainer" class="headerlink" title="StopContainer"></a>StopContainer</h2><p><strong>å…³åœ sandbox ä¸­çš„æŒ‡å®šå®¹å™¨</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1392">source code</a></p>
<ol>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œå¹¶è°ƒç”¨ VCContainer çš„ <strong>stop</strong>ï¼Œå…³åœå®¹å™¨å¹¶æ¸…ç†ç›¸å…³èµ„æº</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="KillContainer"><a href="#KillContainer" class="headerlink" title="KillContainer"></a>KillContainer</h2><p><strong>æ€æ­» sandbox ä¸­çš„æŒ‡å®šå®¹å™¨è¿›ç¨‹</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1411">source code</a></p>
<ol>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œå¹¶è°ƒç”¨ VCContainer çš„ <strong>signalProcess</strong>ï¼Œå‘é€ kill ä¿¡å·ï¼ˆç†è®ºä¸Šæ˜¯è¿™æ ·ï¼Œç„¶è€Œå¹¶æœªæœ‰çœŸå®è°ƒç”¨ï¼‰</li>
</ol>
<h2 id="StatusContainer"><a href="#StatusContainer" class="headerlink" title="StatusContainer"></a>StatusContainer</h2><p><strong>è·å– sandbox ä¸­æŒ‡å®šå®¹å™¨çš„çŠ¶æ€</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1467">source code</a></p>
<ol>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œè·å–å…¶çŠ¶æ€ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šIDã€rootfsã€çŠ¶æ€ã€å¯åŠ¨æ—¶é—´ã€annotationã€PID ç­‰ï¼‰</li>
</ol>
<h2 id="StatsContainer"><a href="#StatsContainer" class="headerlink" title="StatsContainer"></a>StatsContainer</h2><p><strong>è·å– sandbox ä¸­æŒ‡å®šå®¹å™¨çš„ç»Ÿè®¡ä¿¡æ¯</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1532">source code</a></p>
<ol>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œæ ¡éªŒå…¶çŠ¶æ€æ˜¯å¦ä¸º running</li>
<li>è°ƒç”¨ agent çš„ <strong>statsContainer</strong>ï¼Œè·å–å®¹å™¨çŠ¶æ€ä¿¡æ¯</li>
</ol>
<h2 id="PauseContainer"><a href="#PauseContainer" class="headerlink" title="PauseContainer"></a>PauseContainer</h2><p><strong>æš‚åœ sandbox ä¸­çš„æŒ‡å®šå®¹å™¨</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1576">source code</a></p>
<ol>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œæ ¡éªŒå…¶çŠ¶æ€æ˜¯å¦ä¸º running</li>
<li>è°ƒç”¨ agent çš„ <strong>pauseContainer</strong>ï¼Œæš‚åœå®¹å™¨</li>
<li>è®¾ç½®å®¹å™¨çŠ¶æ€ä¸º paused</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="ResumeContainer"><a href="#ResumeContainer" class="headerlink" title="ResumeContainer"></a>ResumeContainer</h2><p><strong>æ¢å¤ sandbox ä¸­çš„æŒ‡å®šå®¹å™¨</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1595">source code</a></p>
<ol>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œæ ¡éªŒå…¶çŠ¶æ€æ˜¯å¦ä¸º running</li>
<li>è°ƒç”¨ agent çš„ <strong>resumeContainer</strong>ï¼Œæ¢å¤å®¹å™¨</li>
<li>è®¾ç½®å®¹å™¨çŠ¶æ€ä¸º running</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="EnterContainer"><a href="#EnterContainer" class="headerlink" title="EnterContainer"></a>EnterContainer</h2><p><strong>åœ¨ sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1493">source code</a></p>
<ol>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œæ ¡éªŒå…¶çŠ¶æ€æ˜¯å¦ä¸º running</li>
<li>è°ƒç”¨ agent çš„ <strong>exec</strong>ï¼Œè¿›å…¥å®¹å™¨æ‰§è¡ŒæŒ‡å®šå‘½ä»¤</li>
</ol>
<h2 id="UpdateContainer"><a href="#UpdateContainer" class="headerlink" title="UpdateContainer"></a>UpdateContainer</h2><p><strong>æ›´æ–° sandbox ä¸­çš„æŒ‡å®šå®¹å™¨èµ„æºè§„æ ¼</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1510">source code</a></p>
<ol>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œæ ¡éªŒå…¶çŠ¶æ€æ˜¯å¦ä¸º running</li>
<li>è°ƒç”¨ <strong>updateResources</strong>ï¼Œçƒ­æ›´æ–° VM çš„èµ„æºè§„æ ¼</li>
<li>è°ƒç”¨ agent çš„ <strong>updateContainer</strong>ï¼Œæ›´æ–°å®¹å™¨</li>
<li>è°ƒç”¨ resCtrl çš„ <strong>resourceControllerUpdate</strong>ï¼Œæ›´æ–° sandbox çš„ cgroup</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="WaitProcess"><a href="#WaitProcess" class="headerlink" title="WaitProcess"></a>WaitProcess</h2><p><strong>ç­‰å¾… sandbox ä¸­çš„æŒ‡å®šå®¹å™¨è¿›ç¨‹è¿”å›é€€å‡ºç </strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L377">source code</a></p>
<ol>
<li>æ ¡éªŒ sandbox çš„çŠ¶æ€æ˜¯å¦ä¸º running</li>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œæ ¡éªŒå…¶çŠ¶æ€æ˜¯å¦ä¸º ready æˆ– running</li>
<li>è°ƒç”¨ agent çš„ <strong>waitProcess</strong>ï¼Œç­‰å¾…è¿›ç¨‹è¿”å›é€€å‡ºç </li>
</ol>
<h2 id="SignalProcess"><a href="#SignalProcess" class="headerlink" title="SignalProcess"></a>SignalProcess</h2><p><strong>å‘ sandbox ä¸­çš„æŒ‡å®šå®¹å™¨è¿›ç¨‹å‘é€æŒ‡å®šä¿¡å·</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L392">source code</a></p>
<ol>
<li>æ ¡éªŒ sandbox çš„çŠ¶æ€æ˜¯å¦ä¸º running</li>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œè°ƒç”¨ VCContainer çš„ <strong>signalProcess</strong>ï¼Œå‘å®¹å™¨è¿›ç¨‹å‘é€æŒ‡å®šä¿¡å·</li>
</ol>
<h2 id="WinsizeProcess"><a href="#WinsizeProcess" class="headerlink" title="WinsizeProcess"></a>WinsizeProcess</h2><p><strong>è®¾ç½® sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ tty å¤§å°</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L406">source code</a></p>
<ol>
<li>æ ¡éªŒ sandbox çš„çŠ¶æ€æ˜¯å¦ä¸º running</li>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œæ ¡éªŒå…¶çŠ¶æ€æ˜¯å¦ä¸º ready æˆ– running</li>
<li>è°ƒç”¨ agent çš„ <strong>winsizeProcess</strong>ï¼Œè®¾ç½®è¿›ç¨‹çš„ tty å¤§å°</li>
</ol>
<h2 id="IOStream"><a href="#IOStream" class="headerlink" title="IOStream"></a>IOStream</h2><p><strong>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ IO æµ</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L420">source code</a></p>
<ol>
<li>æ ¡éªŒ sandbox çš„çŠ¶æ€æ˜¯å¦ä¸º running</li>
<li>è·å– sandbox ä¸­çš„æŒ‡å®šå®¹å™¨ï¼Œæ ¡éªŒå…¶çŠ¶æ€æ˜¯å¦ä¸º ready æˆ– running</li>
<li>åˆå§‹åŒ– IO æµï¼Œè¿”å›å…¶ stdinã€stdout å’Œ stderr</li>
</ol>
<h2 id="AddDevice"><a href="#AddDevice" class="headerlink" title="AddDevice"></a>AddDevice</h2><p><strong>å‘ sandbox ä¸­æ·»åŠ è®¾å¤‡</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L1932">source code</a></p>
<ol>
<li>è°ƒç”¨ devManager çš„ <strong>NewDevice</strong>ï¼Œåˆå§‹åŒ–å¯¹åº”ç±»å‹çš„è®¾å¤‡</li>
<li>è°ƒç”¨ devManager çš„ <strong>AttachDevice</strong>ï¼Œæ·»åŠ è¯¥è®¾å¤‡</li>
</ol>
<h2 id="AddInterface"><a href="#AddInterface" class="headerlink" title="AddInterface"></a>AddInterface</h2><p><strong>å‘ sandbox ä¸­æ·»åŠ ç½‘å¡</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L918">source code</a></p>
<ol>
<li>å°† rpc è¯·æ±‚ä½“è½¬æ¢æˆç½‘å¡ä¿¡æ¯ç»“æ„</li>
<li>è°ƒç”¨ network çš„ <strong>AddEndpoints</strong>ï¼Œçƒ­æ·»åŠ è¯¥ç½‘å¡</li>
<li>è·å–ç½‘å¡ PCI åœ°å€ï¼Œè°ƒç”¨ agent çš„ <strong>updateInterface</strong>ï¼Œæ›´æ–°ç½‘å¡ä¿¡æ¯</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="RemoveInterface"><a href="#RemoveInterface" class="headerlink" title="RemoveInterface"></a>RemoveInterface</h2><p><strong>ç§»é™¤ sandbox ä¸­çš„æŒ‡å®šç½‘å¡</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L956">source code</a></p>
<ol>
<li>è°ƒç”¨ network çš„ <strong>Endpoints</strong>ï¼Œæ ¹æ® MAC åœ°å€åŒ¹é…æ‰€æœ‰ç½‘å¡ä¸­å¾…ç§»é™¤çš„ç½‘å¡</li>
<li>è°ƒç”¨ network çš„ <strong>RemoveEndpoints</strong>ï¼Œç§»é™¤è¯¥ç½‘å¡</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="ListInterfaces"><a href="#ListInterfaces" class="headerlink" title="ListInterfaces"></a>ListInterfaces</h2><p><strong>è·å– sandbox çš„æ‰€æœ‰ç½‘å¡é…ç½®</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L975">source code</a></p>
<ol>
<li>è°ƒç”¨ agent çš„ <strong>listInterfaces</strong>ï¼Œè·å–æ‰€æœ‰ç½‘å¡é…ç½®</li>
</ol>
<h2 id="UpdateRoutes"><a href="#UpdateRoutes" class="headerlink" title="UpdateRoutes"></a>UpdateRoutes</h2><p><strong>æ›´æ–° sandbox çš„è·¯ç”±è¡¨</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L980">source code</a></p>
<ol>
<li>è°ƒç”¨ agent çš„ <strong>updateRoutes</strong>ï¼Œæ›´æ–°è·¯ç”±è¡¨</li>
</ol>
<h2 id="ListRoutes"><a href="#ListRoutes" class="headerlink" title="ListRoutes"></a>ListRoutes</h2><p><strong>è·å– sandbox çš„æ‰€æœ‰è·¯ç”±é…ç½®</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L985">source code</a></p>
<ol>
<li>è°ƒç”¨ agent çš„ <strong>listRoutes</strong>ï¼Œè·å–æ‰€æœ‰è·¯ç”±é…ç½®</li>
</ol>
<h2 id="GetOOMEvent"><a href="#GetOOMEvent" class="headerlink" title="GetOOMEvent"></a>GetOOMEvent</h2><p><strong>è·å– sandbox çš„ OOM äº‹ä»¶ä¿¡æ¯</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L2320">source code</a></p>
<ol>
<li>è°ƒç”¨ agent çš„ <strong>getOOMEvent</strong>ï¼Œè·å– OOM äº‹ä»¶ä¿¡æ¯</li>
</ol>
<h2 id="GetHypervisorPid"><a href="#GetHypervisorPid" class="headerlink" title="GetHypervisorPid"></a>GetHypervisorPid</h2><p><strong>è·å– sandbox çš„ hypervisor PID</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L292">source code</a></p>
<ol>
<li>è°ƒç”¨ hypervisor çš„ <strong>GetPids</strong>ï¼Œè·å–æ‰€æœ‰ PID åˆ—è¡¨</li>
<li>è¿”å› PID åˆ—è¡¨é¦–ä½ï¼ˆå› ä¸ºé¦–ä½æ˜¯ hypervisor PIDï¼Œæ¬¡ä½ä¸º virtiofsd PIDï¼‰</li>
</ol>
<h2 id="UpdateRuntimeMetrics"><a href="#UpdateRuntimeMetrics" class="headerlink" title="UpdateRuntimeMetrics"></a>UpdateRuntimeMetrics</h2><p><strong>æ›´æ–° sandbox çš„ hypervisor ç›¸å…³æŒ‡æ ‡</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox_metrics.go#L134">source code</a></p>
<ol>
<li>è°ƒç”¨ hypervisor çš„ <strong>GetPids</strong>ï¼Œè·å– hypervisor çš„ PID</li>
<li>è·å– &#x2F;proc&#x2F;&lt;hypervisorPID&gt;&#x2F;fd ç›®å½•ä¸‹çš„æ–‡ä»¶æ•°é‡ï¼ˆè¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ˜¯æŒ‡å‘å®é™…æ–‡ä»¶çš„ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œä¾‹å¦‚ 0 è¡¨ç¤º stdinã€1 è¡¨ç¤º stdoutã€2 è¡¨ç¤º stderr ç­‰ç­‰ï¼‰ï¼Œä¸ŠæŠ¥ kata_hypervisor_fds æŒ‡æ ‡</li>
<li>è§£æ &#x2F;proc&#x2F;&lt;hypervisorPID&gt;&#x2F;net&#x2F;dev æ–‡ä»¶å†…å®¹ï¼ˆç½‘ç»œè®¾å¤‡çŠ¶æ€ä¿¡æ¯ï¼Œä¾‹å¦‚ eth0ã€loã€tap0_kata å’Œ tunl0 æ¥å—å’Œå‘é€çš„æ•°æ®åŒ…ã€é”™è¯¯å’Œå†²çªçš„æ•°é‡ä»¥åŠå…¶ä»–åŸºæœ¬ç»Ÿè®¡ï¼Œå‚è€ƒ ifconfig å‘½ä»¤ç»“æœï¼‰ï¼Œä¸ŠæŠ¥ kata_hypervisor_netdev æŒ‡æ ‡</li>
<li>è§£æ &#x2F;proc&#x2F;&lt;hypervisorPID&gt;&#x2F;stat æ–‡ä»¶å†…å®¹ï¼ˆè¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œå‚è€ƒ ps å‘½ä»¤ç»“æœï¼‰ï¼Œä¸ŠæŠ¥ kata_hypervisor_proc_stat æŒ‡æ ‡</li>
<li>è§£æ &#x2F;proc&#x2F;&lt;hypervisorPID&gt;&#x2F;status æ–‡ä»¶å†…å®¹ï¼ˆè¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œç›¸è¾ƒäº &#x2F;proc&#x2F;&lt;hypervisorPID&gt;&#x2F;stat æ›´æ˜“è¯»ï¼‰ï¼Œä¸ŠæŠ¥ kata_hypervisor_proc_status æŒ‡æ ‡</li>
<li>è§£æ &#x2F;proc&#x2F;&lt;hypervisorPID&gt;&#x2F;io æ–‡ä»¶å†…å®¹ï¼ˆè¿›ç¨‹çš„ IO ç»Ÿè®¡ä¿¡æ¯ï¼‰ï¼Œä¸ŠæŠ¥ kata_hypervisor_io æŒ‡æ ‡</li>
<li>è°ƒç”¨ hypervisor çš„ <strong>GetVirtioFsPid</strong>ï¼Œè·å– virtiofsd çš„ PID</li>
<li>è·å– &#x2F;proc&#x2F;&lt;virtiofsdPID&gt;&#x2F;fd ç›®å½•ä¸‹çš„æ–‡ä»¶æ•°é‡ï¼Œä¸ŠæŠ¥ kata_virtiofsd_fds æŒ‡æ ‡</li>
<li>è§£æ &#x2F;proc&#x2F;&lt;virtiofsdPID&gt;&#x2F;stat æ–‡ä»¶å†…å®¹ï¼Œä¸ŠæŠ¥ kata_virtiofsd_proc_stat æŒ‡æ ‡</li>
<li>è§£æ &#x2F;proc&#x2F;&lt;hypervisorPID&gt;&#x2F;status æ–‡ä»¶å†…å®¹ï¼Œä¸ŠæŠ¥ kata_virtiofsd_proc_status æŒ‡æ ‡</li>
<li>è§£æ &#x2F;proc&#x2F;&lt;hypervisorPID&gt;&#x2F;io æ–‡ä»¶å†…å®¹ï¼Œä¸ŠæŠ¥ kata_virtiofsd_io æŒ‡æ ‡</li>
</ol>
<h2 id="GetAgentMetrics"><a href="#GetAgentMetrics" class="headerlink" title="GetAgentMetrics"></a>GetAgentMetrics</h2><p><strong>è·å– sandbox çš„ agent ç›¸å…³æŒ‡æ ‡</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox_metrics.go#L221">source code</a></p>
<ol>
<li>è°ƒç”¨ agent çš„ <strong>getAgentMetrics</strong>ï¼Œè·å– agent çš„æŒ‡æ ‡ä¿¡æ¯</li>
</ol>
<h2 id="GetAgentURL"><a href="#GetAgentURL" class="headerlink" title="GetAgentURL"></a>GetAgentURL</h2><p><strong>è·å– sandbox çš„ agent URI ä¿¡æ¯</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L2324">source code</a></p>
<ol>
<li>è°ƒç”¨ agent çš„ <strong>getAgentURl</strong>ï¼Œè·å– URI ä¿¡æ¯</li>
</ol>
<h2 id="GuestVolumeStats"><a href="#GuestVolumeStats" class="headerlink" title="GuestVolumeStats"></a>GuestVolumeStats</h2><p><strong>è·å– sandbox ä¸­çš„æŒ‡å®šæŒ‚è½½å·ä¿¡æ¯</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L2339">source code</a></p>
<ol>
<li>æ ¡éªŒå·è·¯å¾„æ˜¯å¦å­˜åœ¨</li>
<li>éå†æ‰€æœ‰å®¹å™¨çš„æ‰€æœ‰æŒ‚è½½ç‚¹ï¼Œè·å–æŒ‚è½½æºä¸ºæŒ‡å®šå·ç›®å½•çš„ sandbox å†…çš„æŒ‚è½½ç‚¹</li>
<li>è°ƒç”¨ agent çš„ <strong>getGuestVolumeStats</strong>ï¼Œè·å–å·ä¿¡æ¯</li>
</ol>
<h2 id="ResizeGuestVolume"><a href="#ResizeGuestVolume" class="headerlink" title="ResizeGuestVolume"></a>ResizeGuestVolume</h2><p><strong>è°ƒæ•´ sandbox ä¸­çš„æŒ‡å®šæŒ‚è½½å·å¤§å°</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox.go#L2348">source code</a></p>
<ol>
<li>æ ¡éªŒå·è·¯å¾„æ˜¯å¦å­˜åœ¨</li>
<li>éå†æ‰€æœ‰å®¹å™¨çš„æ‰€æœ‰æŒ‚è½½ç‚¹ï¼Œè·å–æŒ‚è½½æºä¸ºæŒ‡å®šå·ç›®å½•çš„ sandbox å†…çš„æŒ‚è½½ç‚¹</li>
<li>è°ƒç”¨ agent çš„ <strong>resizeGuestVolume</strong>ï¼Œè°ƒæ•´å·å¤§å°</li>
</ol>
<h2 id="GetIPTables"><a href="#GetIPTables" class="headerlink" title="GetIPTables"></a>GetIPTables</h2><p><strong>è·å– sandbox çš„ iptables ä¿¡æ¯</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox_metrics.go#L2329">source code</a></p>
<ol>
<li>è°ƒç”¨ agent çš„ <strong>getIPTables</strong>ï¼Œè·å– iptables ä¿¡æ¯</li>
</ol>
<h2 id="SetIPTables"><a href="#SetIPTables" class="headerlink" title="SetIPTables"></a>SetIPTables</h2><p><strong>è®¾ç½® sandbox çš„ iptables ä¿¡æ¯</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/sandbox_metrics.go#L2334">source code</a></p>
<ol>
<li>è°ƒç”¨ agent çš„ <strong>setIPTables</strong>ï¼Œè®¾ç½® iptables ä¿¡æ¯</li>
</ol>
<h1 id="VCContainer"><a href="#VCContainer" class="headerlink" title="VCContainer"></a>VCContainer</h1><p><em><u>src&#x2F;runtime&#x2F;virtcontainers&#x2F;interfaces.go</u></em></p>
<p>virtcontainers åº“ä¸­ç”¨äºç®¡ç†å®¹å™¨çš„æ¨¡å—ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Container is composed of a set of containers and a runtime environment.</span></span><br><span class="line"><span class="comment">// A Container can be created, deleted, started, stopped, listed, entered, paused and restored.</span></span><br><span class="line"><span class="keyword">type</span> Container <span class="keyword">struct</span> &#123;</span><br><span class="line">	ctx           context.Context</span><br><span class="line">	config        *ContainerConfig</span><br><span class="line">	sandbox       *Sandbox</span><br><span class="line">	id            <span class="type">string</span></span><br><span class="line">	sandboxID     <span class="type">string</span></span><br><span class="line">	<span class="comment">// &lt;sandboxID&gt;/&lt;id&gt;</span></span><br><span class="line">	containerPath <span class="type">string</span></span><br><span class="line">	<span class="comment">// å›ºå®šä¸º rootfs</span></span><br><span class="line">	rootfsSuffix  <span class="type">string</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// å®¹å™¨æŒ‚è½½ä¿¡æ¯ï¼ŒåŒ…æ‹¬ sourceã€destinationã€typeã€options ç­‰ã€‚ä» OCI spec è§£æè·å¾—</span></span><br><span class="line">	mounts []Mount</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// å®¹å™¨è®¾å¤‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬è®¾å¤‡ IDã€å®¹å™¨ä¸­çš„è®¾å¤‡è·¯å¾„ã€æ–‡ä»¶æ¨¡å¼ç­‰ä¿¡æ¯</span></span><br><span class="line">	devices []ContainerDevice</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// å®¹å™¨çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿è¡ŒçŠ¶æ€ï¼ˆreadyã€runningã€pausedã€stopped ä»¥åŠ creatingï¼‰ã€rootfs çš„å—è®¾å¤‡ IDï¼ˆDeviceMapper åœºæ™¯ä¸‹ï¼Œrootfs ä¸ºçƒ­æ·»åŠ çš„å—è®¾å¤‡ï¼‰ã€rootfs çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆrootfs ä¸ºå—è®¾å¤‡æ—¶ï¼‰ä»¥åŠ sandbox è¿›ç¨‹æ‰€åœ¨çš„ cgroup è·¯å¾„</span></span><br><span class="line">	state types.ContainerState</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å®¹å™¨è¿›ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬ PIDï¼ˆæœ¬è´¨ä¸Šå°±æ˜¯ shimIDï¼‰ã€Token ä»¥åŠå¯åŠ¨æ—¶é—´ç­‰</span></span><br><span class="line">	process Process</span><br><span class="line">	</span><br><span class="line"> 	<span class="comment">// å®¹å™¨ rootfs åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ sourceã€targetã€typeã€options ç­‰</span></span><br><span class="line">	rootFs RootFs</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// systemMountsInfo.BindMountDev è¡¨ç¤ºæ˜¯å¦å°† host çš„ /dev ç›®å½•ä»¥ bind å½¢å¼æŒ‚è½½åˆ°å®¹å™¨çš„ /dev ä¸­</span></span><br><span class="line">	<span class="comment">// systemMountsInfo.DevShmSize è¡¨ç¤º host çš„ /dev/shm å¤§å°</span></span><br><span class="line">	systemMountsInfo SystemMountsInfo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å·¥å‚å‡½æ•°</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/container.go#L714">source code</a></p>
<ol>
<li>æ£€éªŒ containerConfig é…ç½®æ˜¯å¦åˆæ³•ï¼ˆcontainerConfig å–è‡ªäº sandboxConfig ä¸­çš„ç›¸å…³é…ç½®ï¼‰</li>
<li>æ ¡éªŒ annotation ä¸­ SWAP èµ„æºå£°æ˜æ˜¯å¦åˆæ³•ï¼ˆio.katacontainers.container.resource.swappiness å¿…é¡»å°äº 200ï¼‰ï¼Œå¹¶é€ä¼ è®¾ç½®ï¼ˆåŒºåˆ«äº CPU å’Œå†…å­˜ç­‰èµ„æºï¼ŒSWAP æ— æ³•é€šè¿‡ spec.Containers.Resources çš„æ–¹å¼å£°æ˜ï¼Œè€Œéœ€è¦é€šè¿‡ annotation å£°æ˜ï¼‰</li>
<li>è°ƒç”¨ store çš„ <strong>FromDisk</strong>ï¼Œè·å– sandbox å’Œå®¹å™¨çš„çŠ¶æ€ä¿¡æ¯ã€‚å¦‚æœæˆåŠŸè·å–åˆ™è¡¨æ˜ä¸æ˜¯æ–°åˆ›å»ºçš„å®¹å™¨ï¼Œæ— éœ€åç»­åŠ¨ä½œï¼Œä»…ç”¨äºçŠ¶æ€æ›´æ–°ç»´æŠ¤ï¼Œç›´æ¥è¿”å›å®¹å™¨å®ä¾‹å³å¯</li>
<li>å¤„ç†å®¹å™¨æŒ‚è½½ä¿¡æ¯ï¼Œå³ container.mounts<br><em>é™¤äº†å€ŸåŠ© virtcontainers&#x2F;kata-agent çš„å…±äº«ç›®å½•æŒ‚è½½ä¹‹å¤–ï¼Œå—è®¾å¤‡ç±»å‹çš„æŒ‚è½½è¿˜å¯ä»¥é€šè¿‡ hypervisor çƒ­æ·»åŠ åˆ° VMã€‚è¿™é‡Œä»…å¤„ç†æŒ‚è½½æºä¸ºå—è®¾å¤‡ç±»å‹çš„æŒ‚è½½ä¿¡æ¯ï¼Œå¸¸è§„å…±äº«ç›®å½•æŒ‚è½½ä»ç„¶ç”± virtcontainers&#x2F;kata-agent å¤„ç†</em><ol>
<li>å¦‚æœæœªç¦ç”¨ [hypervisor].disable_block_device_useï¼Œåˆ™è°ƒç”¨ agent çš„ <strong>capabilities</strong> å’Œ hypervisor çš„ <strong>Capabilities</strong>ï¼Œæ ¹æ® agent æ˜¯å¦å…·å¤‡ä½¿ç”¨å—è®¾å¤‡èƒ½åŠ›ä»¥åŠ hypervisor æ˜¯å¦å…è®¸å—è®¾å¤‡çƒ­æ’æ‹”åˆ¤æ–­æ˜¯å¦å½“å‰æ”¯æŒå—è®¾å¤‡<br><em>é»˜è®¤åœºæ™¯ä¸‹ï¼Œrootfs ç”± virtio-fs ä¼ é€’å…±äº«ï¼›åœ¨æœªç¦ç”¨ [hypervisor].disable_block_device_use æ—¶ï¼Œrootfs åŸºäºå—è®¾å¤‡åˆ›å»ºï¼Œå¹¶çƒ­æ’åˆ° VM ä¸­ä½¿ç”¨ï¼Œä»¥æé«˜æ€§èƒ½ã€‚ä¾‹å¦‚ devicemapper åœºæ™¯ä¸‹ rootfs å¿…é¡»æ˜¯åŸºäºå—è®¾å¤‡åˆ›å»ºçš„</em></li>
<li>é’ˆå¯¹å®¹å™¨ä¸­çš„æ‰€æœ‰æŒ‚è½½ä¿¡æ¯<ol>
<li>å¦‚æœ mounts.BlockDeviceID å·²ç»å­˜åœ¨ï¼Œåˆ™è¡¨æ˜å·²ç»æœ‰ä¸€ä¸ªè®¾å¤‡å’ŒæŒ‚è½½ç‚¹ç›¸å…³è”ï¼Œå› æ­¤ä¸éœ€è¦åˆ›å»ºè®¾å¤‡ï¼Œè·³è¿‡å³å¯</li>
<li>å¦‚æœæŒ‚è½½ç±»å‹ä¸æ˜¯ bindï¼Œè·³è¿‡å³å¯</li>
<li>è·å– &#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;direct-volumes&#x2F;&lt;base64 mounts.Source&gt;&#x2F;mountInfo.json æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œè¡¨æ˜å½“å‰æŒ‚è½½è®¾å¤‡éœ€è¦ä»¥ç›´é€šå·çš„æ–¹å¼å¤„ç†ï¼Œå³åˆ›å»º &#x2F;run&#x2F;kata-containers&#x2F;shared&#x2F;direct-volumes&#x2F;&lt;base64 mounts.Source&gt;&#x2F;&lt;sandboxID&gt; æ–‡ä»¶ï¼Œå¹¶æ›¿æ¢åŸæœ¬ mounts ä¸­ Sourceã€Typeã€Optionsã€ReadOnlyã€FSGroupï¼ˆå–è‡ª mountInfo.Metadata[â€œFSGroupâ€]ï¼‰ã€FSGroupChangePolicyï¼ˆå–è‡ª mountInfo.Metadata[â€œFSGroupChangePolicyâ€]ï¼‰ ç­‰ä¿¡æ¯ä¸º mountInfo.json çš„å¯¹åº”å­—æ®µï¼Œåç»­æ”¯æŒç›´é€šå·çš„ CSI ä¼šæ ¹æ®æ­¤æ–‡ä»¶ä¸ä¿¡æ¯ä¸ Kata äº¤äº’<br><em>mounts.Source æ ¼å¼ä¸º &#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;pods&#x2F;&lt;podUID&gt;&#x2F;volumes&#x2F;kubernetes.io~csi&#x2F;&lt;pvName&gt;&#x2F;mountï¼›<br>mountInfo.json ä¸­ device å­—æ®µçš„æ ¼å¼ä¸º &#x2F;dev&#x2F;sdaï¼ˆå–å†³äº host ä¸Šçš„å…·ä½“è®¾å¤‡ï¼‰</em></li>
<li>å¦‚æœæŒ‚è½½æºä¸ºå—è®¾å¤‡ç±»å‹æˆ– PMEM è®¾å¤‡ï¼Œåˆ™è°ƒç”¨ devManager çš„ <strong>NewDevice</strong>ï¼Œåˆå§‹åŒ–æŒ‚è½½å—è®¾å¤‡ä¿¡æ¯ï¼Œå›å†™ mounts.BlockDeviceID å­—æ®µä¿¡æ¯<br><em>å—è®¾å¤‡ DeviceInfo çš„ HostPathã€ContainerPath ç­‰ä¿¡æ¯å‡ä¸º mounts ä¸­ä¿¡æ¯ï¼›<br>PMEM è®¾å¤‡ DeviceInfo çš„ HostPath å¤„ç†æ–¹å¼æ¯”è¾ƒç‰¹æ®Šï¼šå¦‚æœ DevType ä¸º c æˆ–è€… uï¼Œåˆ™ backingFile è·¯å¾„ä¸º &#x2F;sys&#x2F;dev&#x2F;char&#x2F;&lt;major:minor&gt;&#x2F;loop&#x2F;backing_fileï¼›å¦‚æœ DevType ä¸º bï¼Œåˆ™ backingFile è·¯å¾„ä¸º &#x2F;sys&#x2F;dev&#x2F;block&#x2F;&lt;major:minor&gt;&#x2F;loop&#x2F;backing_fileã€‚è¯»å– backingFile æ–‡ä»¶å†…å®¹ä½œä¸º HostPathã€‚æ­¤å¤–ï¼Œåˆ¤æ–­ HostPath ç­¾åæ˜¯å¦åˆæ³•ï¼ˆå½“ä½¿ç”¨ PMEM è®¾å¤‡å’Œ DAX æŠ€æœ¯æ—¶ï¼Œéœ€è¦ç¡®ä¿æ–‡ä»¶æˆ–è®¾å¤‡è·¯å¾„å…·æœ‰æ­£ç¡®çš„ PFN ç­¾åï¼Œä»¥ä¾¿å†…æ ¸å¯ä»¥æ­£ç¡®åœ°ç®¡ç† PMEM è®¾å¤‡å’Œå¯ç”¨ DAX æŠ€æœ¯ï¼‰ä»¥åŠé€šè¿‡ &#x2F;proc&#x2F;mounts è·å– PMEM çš„æŒ‚è½½æºçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ fstype</em></li>
</ol>
</li>
</ol>
</li>
<li>å‡†å¤‡å®¹å™¨è®¾å¤‡ä¿¡æ¯ï¼Œå³ container.devices<br><em>è®¾å¤‡å‡é€šè¿‡ hypervisor çƒ­æ·»åŠ åˆ° VM ä¸­</em><ol>
<li>é’ˆå¯¹å®¹å™¨ä¸­æ‰€æœ‰çš„è®¾å¤‡ä¿¡æ¯ï¼Œè°ƒç”¨ devManager çš„ <strong>NewDevice</strong>ï¼Œåˆå§‹åŒ–è®¾å¤‡ä¿¡æ¯ï¼Œå¹¶è¿‡æ»¤ç±»å‹ä¸º CDROM å’Œ floppy çš„è®¾å¤‡</li>
</ol>
</li>
</ol>
<p>VCContainer ä¸­å£°æ˜çš„ <strong>GetAnnotations</strong>ã€<strong>GetPid</strong>ã€<strong>GetToken</strong>ã€<strong>ID</strong>ã€<strong>Sandbox</strong> ä»¥åŠ <strong>Process</strong> å‡ä¸ºå‚æ•°è·å–ä¸èµ‹å€¼ï¼Œæ— å¤æ‚é€»è¾‘ï¼Œä¸ä½œè¯¦è¿°ã€‚</p>
<h2 id="start"><a href="#start" class="headerlink" title="start"></a>start</h2><p><strong>å¯åŠ¨å®¹å™¨</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/container.go#L940">source code</a></p>
<ol>
<li>æ ¡éªŒ sandbox çŠ¶æ€æ˜¯å¦ä¸º running</li>
<li>æ ¡éªŒå®¹å™¨çŠ¶æ€æ˜¯å¦ä¸º ready æˆ– stopped</li>
<li>è°ƒç”¨ agent çš„ <strong>startContainer</strong>ï¼Œå¯åŠ¨å®¹å™¨</li>
<li>å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œåˆ™è°ƒç”¨ <strong>stop</strong>ï¼Œæ‰§è¡Œå›æ»šæ“ä½œï¼›å¦åˆ™ï¼Œè®¾ç½®å®¹å™¨çŠ¶æ€ä¸º runningï¼Œå¹¶è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜ sandbox å’Œå®¹å™¨çš„çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h2><p><strong>å…³åœå®¹å™¨ï¼Œå¹¶æ¸…ç†ç›¸å…³èµ„æº</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/container.go#L966">source code</a></p>
<ol>
<li>å¦‚æœå®¹å™¨çŠ¶æ€å·²ç»ä¸º stoppedï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œ</li>
<li>æ ¡éªŒå®¹å™¨çŠ¶æ€æ˜¯å¦ä¸º readyã€running æˆ– paused</li>
<li>è°ƒç”¨ <strong>signalProcess</strong>ï¼Œå‘ sandbox ä¸­çš„å®¹å™¨è¿›ç¨‹å‘é€ kill ä¿¡å·</li>
<li>è°ƒç”¨ agent çš„ <strong>waitProcess</strong>ï¼Œç¡®ä¿å®¹å™¨è¿›ç¨‹å·²é€€å‡º</li>
<li>è°ƒç”¨ agent çš„ <strong>stopContainer</strong>ï¼Œå…³åœå®¹å™¨</li>
<li>é’ˆå¯¹å®¹å™¨ä¸­æ¯ä¸€ä¸ªæŒ‚è½½ä¿¡æ¯ï¼Œè°ƒç”¨ fsShare çš„ <strong>UnshareFile</strong>ï¼Œç§»é™¤ host ä¾§çš„ sandbox å…±äº«æ–‡ä»¶</li>
<li>è°ƒç”¨ fsShare çš„ <strong>UnshareRootFilesystem</strong>ï¼Œç§»é™¤ sandbox ä¸­çš„å®¹å™¨ rootfs å…±äº«æŒ‚è½½</li>
<li>è°ƒç”¨ devManager çš„ <strong>DetachDevice</strong> å’Œ <strong>RemoveDevice</strong>ï¼Œdetach å¹¶ç§»é™¤ sandbox ä¸­çš„æ‰€æœ‰è®¾å¤‡ï¼ˆå«å—è®¾å¤‡ï¼‰</li>
<li>å¦‚æœå®¹å™¨çš„ rootfs æ˜¯å—è®¾å¤‡ï¼Œåˆ™è°ƒç”¨ devManager çš„ <strong>DetachDevice</strong> å’Œ <strong>RemoveDevice</strong>ï¼Œdetach å¹¶ç§»é™¤å®¹å™¨çš„ rootfs å—è®¾å¤‡</li>
<li>è®¾ç½®å®¹å™¨çŠ¶æ€ä¸º stoppedï¼Œå¹¶è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜ sandbox å’Œå®¹å™¨çš„çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><p><strong>åˆ é™¤å®¹å™¨ä¿¡æ¯</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/container.go#L896">source code</a></p>
<ol>
<li>æ ¡éªŒå®¹å™¨çŠ¶æ€æ˜¯å¦ä¸º ready æˆ– stopped</li>
<li>åˆ é™¤ç»´æŠ¤åœ¨ sandbox ä¸­çš„å®¹å™¨ä¿¡æ¯</li>
<li>è°ƒç”¨ store çš„ <strong>ToDisk</strong>ï¼Œä¿å­˜ sandbox å’Œå®¹å™¨çš„çŠ¶æ€æ•°æ®åˆ°æ–‡ä»¶ä¸­</li>
</ol>
<h2 id="signalProcess"><a href="#signalProcess" class="headerlink" title="signalProcess"></a>signalProcess</h2><p><strong>å‘å®¹å™¨è¿›ç¨‹å‘é€æŒ‡å®šä¿¡å·</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/3.0.0/src/runtime/virtcontainers/container.go#L1074">source code</a></p>
<ol>
<li>æ ¡éªŒ sandbox çŠ¶æ€æ˜¯å¦ä¸º ready æˆ–è€… running</li>
<li>æ ¡éªŒå®¹å™¨çŠ¶æ€æ˜¯å¦ä¸º readyã€running æˆ–è€… paused</li>
<li>è°ƒç”¨ agent çš„ <strong>signalProcess</strong>ï¼Œå‘ sandbox ä¸­çš„æŒ‡å®šå®¹å™¨è¿›ç¨‹å‘é€ä¿¡å·ï¼ˆç”±äº Containerd å’Œ CRIO å¹¶ä¸ä¼šå¤„ç† <code>ESRCH: No such process</code> é”™è¯¯ï¼Œå› æ­¤ Kata runtime åœ¨è¿™é‡Œåšäº†ç‰¹æ®Šæ“ä½œï¼Œé’ˆå¯¹æ­¤æŠ¥é”™ä»…è¾“å‡º warning æ—¥å¿—ï¼Œä¸ä½œè¿”å›ï¼‰</li>
</ol>
</div><div class="article-licensing box"><div class="licensing-title"><p>ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers</p><p><a href="http://shenxianghong.github.io/2023/01/30/2023-01-30 Kata Containers æºç èµ°è¯» - virtcontainers/">http://shenxianghong.github.io/2023/01/30/2023-01-30 Kata Containers æºç èµ°è¯» - virtcontainers/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Shen Xianghong</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2023-01-30</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-05-31</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i>Â <a class="link-muted" rel="tag" href="/tags/Kata-Containers/">Kata Containers </a></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/03/05/2023-03-05%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20virtcontainers%20storage/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">ã€Œ Kata Containers ã€æºç èµ°è¯» â€” virtcontainers/storage</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/01/29/2023-01-29%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20kata-monitor/"><span class="level-item">ã€Œ Kata Containers ã€æºç èµ°è¯» â€” kata-monitor</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars.githubusercontent.com/u/35031258?v=4" alt="ğŸ¾Corgi"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">ğŸ¾Corgi</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">51</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">9</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/shenxianghong" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Youtube" href="https://youtube.com"><i class="fab fa-youtube"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Bilibili" href="https://bilibili.com"><i class="fab fa-bilibili"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Reddit" href="https://reddit.com"><i class="fab fa-reddit"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://google.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Google</span></span><span class="level-right"><span class="level-item tag">google.com</span></span></a></li><li><a class="level is-mobile" href="https://poe.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Poe</span></span><span class="level-right"><span class="level-item tag">poe.com</span></span></a></li></ul></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#VC"><span class="level-left"><span class="level-item">1</span><span class="level-item">VC</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#CreateSandbox"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">CreateSandbox</span></span></a></li><li><a class="level is-mobile" href="#CleanupContainer"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">CleanupContainer</span></span></a></li></ul></li><li><a class="level is-mobile" href="#VCSandbox"><span class="level-left"><span class="level-item">2</span><span class="level-item">VCSandbox</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#updateResources"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">updateResources</span></span></a></li><li><a class="level is-mobile" href="#Stats"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Stats</span></span></a></li><li><a class="level is-mobile" href="#Start"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">Start</span></span></a></li><li><a class="level is-mobile" href="#Stop"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">Stop</span></span></a></li><li><a class="level is-mobile" href="#Delete"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">Delete</span></span></a></li><li><a class="level is-mobile" href="#Status"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">Status</span></span></a></li><li><a class="level is-mobile" href="#CreateContainer"><span class="level-left"><span class="level-item">2.7</span><span class="level-item">CreateContainer</span></span></a></li><li><a class="level is-mobile" href="#DeleteContainer"><span class="level-left"><span class="level-item">2.8</span><span class="level-item">DeleteContainer</span></span></a></li><li><a class="level is-mobile" href="#StartContainer"><span class="level-left"><span class="level-item">2.9</span><span class="level-item">StartContainer</span></span></a></li><li><a class="level is-mobile" href="#StopContainer"><span class="level-left"><span class="level-item">2.10</span><span class="level-item">StopContainer</span></span></a></li><li><a class="level is-mobile" href="#KillContainer"><span class="level-left"><span class="level-item">2.11</span><span class="level-item">KillContainer</span></span></a></li><li><a class="level is-mobile" href="#StatusContainer"><span class="level-left"><span class="level-item">2.12</span><span class="level-item">StatusContainer</span></span></a></li><li><a class="level is-mobile" href="#StatsContainer"><span class="level-left"><span class="level-item">2.13</span><span class="level-item">StatsContainer</span></span></a></li><li><a class="level is-mobile" href="#PauseContainer"><span class="level-left"><span class="level-item">2.14</span><span class="level-item">PauseContainer</span></span></a></li><li><a class="level is-mobile" href="#ResumeContainer"><span class="level-left"><span class="level-item">2.15</span><span class="level-item">ResumeContainer</span></span></a></li><li><a class="level is-mobile" href="#EnterContainer"><span class="level-left"><span class="level-item">2.16</span><span class="level-item">EnterContainer</span></span></a></li><li><a class="level is-mobile" href="#UpdateContainer"><span class="level-left"><span class="level-item">2.17</span><span class="level-item">UpdateContainer</span></span></a></li><li><a class="level is-mobile" href="#WaitProcess"><span class="level-left"><span class="level-item">2.18</span><span class="level-item">WaitProcess</span></span></a></li><li><a class="level is-mobile" href="#SignalProcess"><span class="level-left"><span class="level-item">2.19</span><span class="level-item">SignalProcess</span></span></a></li><li><a class="level is-mobile" href="#WinsizeProcess"><span class="level-left"><span class="level-item">2.20</span><span class="level-item">WinsizeProcess</span></span></a></li><li><a class="level is-mobile" href="#IOStream"><span class="level-left"><span class="level-item">2.21</span><span class="level-item">IOStream</span></span></a></li><li><a class="level is-mobile" href="#AddDevice"><span class="level-left"><span class="level-item">2.22</span><span class="level-item">AddDevice</span></span></a></li><li><a class="level is-mobile" href="#AddInterface"><span class="level-left"><span class="level-item">2.23</span><span class="level-item">AddInterface</span></span></a></li><li><a class="level is-mobile" href="#RemoveInterface"><span class="level-left"><span class="level-item">2.24</span><span class="level-item">RemoveInterface</span></span></a></li><li><a class="level is-mobile" href="#ListInterfaces"><span class="level-left"><span class="level-item">2.25</span><span class="level-item">ListInterfaces</span></span></a></li><li><a class="level is-mobile" href="#UpdateRoutes"><span class="level-left"><span class="level-item">2.26</span><span class="level-item">UpdateRoutes</span></span></a></li><li><a class="level is-mobile" href="#ListRoutes"><span class="level-left"><span class="level-item">2.27</span><span class="level-item">ListRoutes</span></span></a></li><li><a class="level is-mobile" href="#GetOOMEvent"><span class="level-left"><span class="level-item">2.28</span><span class="level-item">GetOOMEvent</span></span></a></li><li><a class="level is-mobile" href="#GetHypervisorPid"><span class="level-left"><span class="level-item">2.29</span><span class="level-item">GetHypervisorPid</span></span></a></li><li><a class="level is-mobile" href="#UpdateRuntimeMetrics"><span class="level-left"><span class="level-item">2.30</span><span class="level-item">UpdateRuntimeMetrics</span></span></a></li><li><a class="level is-mobile" href="#GetAgentMetrics"><span class="level-left"><span class="level-item">2.31</span><span class="level-item">GetAgentMetrics</span></span></a></li><li><a class="level is-mobile" href="#GetAgentURL"><span class="level-left"><span class="level-item">2.32</span><span class="level-item">GetAgentURL</span></span></a></li><li><a class="level is-mobile" href="#GuestVolumeStats"><span class="level-left"><span class="level-item">2.33</span><span class="level-item">GuestVolumeStats</span></span></a></li><li><a class="level is-mobile" href="#ResizeGuestVolume"><span class="level-left"><span class="level-item">2.34</span><span class="level-item">ResizeGuestVolume</span></span></a></li><li><a class="level is-mobile" href="#GetIPTables"><span class="level-left"><span class="level-item">2.35</span><span class="level-item">GetIPTables</span></span></a></li><li><a class="level is-mobile" href="#SetIPTables"><span class="level-left"><span class="level-item">2.36</span><span class="level-item">SetIPTables</span></span></a></li></ul></li><li><a class="level is-mobile" href="#VCContainer"><span class="level-left"><span class="level-item">3</span><span class="level-item">VCContainer</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#start"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">start</span></span></a></li><li><a class="level is-mobile" href="#stop"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">stop</span></span></a></li><li><a class="level is-mobile" href="#delete"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">delete</span></span></a></li><li><a class="level is-mobile" href="#signalProcess"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">signalProcess</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Container-Runtime/"><span class="level-start"><span class="level-item">Container Runtime</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Disaster-Recovery/"><span class="level-start"><span class="level-item">Disaster Recovery</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Scheduling-Orchestration/"><span class="level-start"><span class="level-item">Scheduling &amp; Orchestration</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/Scheduling-Orchestration/Kubernetes/"><span class="level-start"><span class="level-item">Kubernetes</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Serverless/"><span class="level-start"><span class="level-item">Serverless</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Service-Mesh/"><span class="level-start"><span class="level-item">Service Mesh</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="ğŸ¾Corgi" height="28"></a><p class="is-size-7"><span>&copy; 2023 Shen Xianghong</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p><p class="is-size-7"><br/>And did you get what you wanted from this life, even so?</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>