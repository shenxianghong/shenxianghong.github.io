<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ã€Œ Kata Containers ã€å¿«é€Ÿå¼€å§‹ - ğŸ¾Corgi</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="ğŸ¾Corgi"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="ğŸ¾Corgi"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Kata Containers åœ¨ Kubernetes é›†ç¾¤åœºæ™¯ä¸­çš„é…ç½®ä¸åŸºç¡€ä½¿ç”¨ç¤ºä¾‹"><meta property="og:type" content="blog"><meta property="og:title" content="ã€Œ Kata Containers ã€å¿«é€Ÿå¼€å§‹"><meta property="og:url" content="http://shenxianghong.github.io/2021/04/15/2021-04-15%20Kata%20Containers%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/"><meta property="og:site_name" content="ğŸ¾Corgi"><meta property="og:description" content="Kata Containers åœ¨ Kubernetes é›†ç¾¤åœºæ™¯ä¸­çš„é…ç½®ä¸åŸºç¡€ä½¿ç”¨ç¤ºä¾‹"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://picsum.photos/0?sig=20210415"><meta property="article:published_time" content="2021-04-14T16:00:00.000Z"><meta property="article:modified_time" content="2023-05-29T09:49:40.595Z"><meta property="article:author" content="Shen Xianghong"><meta property="article:tag" content="Kata Containers"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://picsum.photos/0?sig=20210415"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://shenxianghong.github.io/2021/04/15/2021-04-15%20Kata%20Containers%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/"},"headline":"ã€Œ Kata Containers ã€å¿«é€Ÿå¼€å§‹","image":[],"datePublished":"2021-04-14T16:00:00.000Z","dateModified":"2023-05-29T09:49:40.595Z","author":{"@type":"Person","name":"Shen Xianghong"},"publisher":{"@type":"Organization","name":"ğŸ¾Corgi","logo":{"@type":"ImageObject","url":"http://shenxianghong.github.io/img/logo.svg"}},"description":"Kata Containers åœ¨ Kubernetes é›†ç¾¤åœºæ™¯ä¸­çš„é…ç½®ä¸åŸºç¡€ä½¿ç”¨ç¤ºä¾‹"}</script><link rel="canonical" href="http://shenxianghong.github.io/2021/04/15/2021-04-15%20Kata%20Containers%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/"><link rel="alternate" href="/atom.xml" title="ğŸ¾Corgi" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/xcode.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="ğŸ¾Corgi" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://picsum.photos/0?sig=20210415" alt="ã€Œ Kata Containers ã€å¿«é€Ÿå¼€å§‹"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="fa fa-calendar"></i>Â <time dateTime="${date_xml(page.date)}" title="${date_xml(page.date)}">2021-04-15</time></span><span class="level-item"><i class="fa fa-calendar-check"></i>Â <time dateTime="${date_xml(page.updated)}" title="${date_xml(page.updated)}">2023-05-29</time></span><span class="level-item"><i class="far fa-folder-open"></i>Â <a class="link-muted" href="/categories/Container-Runtime/">Container Runtime</a></span><span class="level-item"><i class="far fa-clock"></i>Â an hour read (About 6874 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">ã€Œ Kata Containers ã€å¿«é€Ÿå¼€å§‹</h1><div class="content"><div align=center><img width="200" style="border: 0px" src="https://katacontainers.io/static/logo-a1e2d09ad097b3fc8536cb77aa615c42.svg"></div>

<hr>
<blockquote>
<p>based on <strong>3.0.0</strong></p>
</blockquote>
<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>Kata Containers ç¤¾åŒºæä¾›äº† x86 æ¶æ„åˆ¶å“ï¼Œarm64 æ¶æ„åˆ¶å“éœ€è¦æ‰‹åŠ¨ç¼–è¯‘ã€‚è¿™é‡Œä»¥ x86 æ¶æ„çš„ç¤¾åŒºåˆ¶å“å®‰è£…ä¸ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wget https://github.com/kata-containers/kata-containers/releases/download/3.0.0/kata-static-3.0.0-x86_64.tar.xz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tar -xvf kata-static-3.0.0-x86_64.tar.xz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree opt/kata/</span></span><br><span class="line">opt/kata/</span><br><span class="line">â”œâ”€â”€ bin # å¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸è„šæœ¬</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ cloud-hypervisor</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ containerd-shim-kata-v2</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ firecracker</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ jailer</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ kata-collect-data.sh</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ kata-monitor</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ kata-runtime</span><br><span class="line">â”‚Â Â  â””â”€â”€ qemu-system-x86_64</span><br><span class="line">â”œâ”€â”€ libexec # å¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line">â”‚Â Â  â””â”€â”€ virtiofsd</span><br><span class="line">â”œâ”€â”€ runtime-rs # Rust å®ç°ä¸‹çš„ shimv2</span><br><span class="line">â”‚Â Â  â””â”€â”€ bin</span><br><span class="line">â”‚Â Â      â””â”€â”€ containerd-shim-kata-v2</span><br><span class="line">â””â”€â”€ share</span><br><span class="line">    â”œâ”€â”€ bash-completion # å‘½ä»¤è¡Œè¡¥å…¨è„šæœ¬</span><br><span class="line">    â”‚Â Â  â””â”€â”€ completions</span><br><span class="line">    â”‚Â Â      â””â”€â”€ kata-runtime</span><br><span class="line">    â”œâ”€â”€ defaults # ä¸åŒ hypervisor å®ç°ä¸‹çš„é™æ€é…ç½®æ–‡ä»¶</span><br><span class="line">    â”‚Â Â  â””â”€â”€ kata-containers</span><br><span class="line">    â”‚Â Â      â”œâ”€â”€ configuration-acrn.toml</span><br><span class="line">    â”‚Â Â      â”œâ”€â”€ configuration-clh.toml</span><br><span class="line">    â”‚Â Â      â”œâ”€â”€ configuration-dragonball.toml</span><br><span class="line">    â”‚Â Â      â”œâ”€â”€ configuration-fc.toml</span><br><span class="line">    â”‚Â Â      â”œâ”€â”€ configuration-qemu.toml</span><br><span class="line">    â”‚Â Â      â””â”€â”€ configuration.toml -&gt; configuration-qemu.toml</span><br><span class="line">    â”œâ”€â”€ kata-containers # å†…æ ¸ä¸ guest é•œåƒ</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ config-5.19.2</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ kata-alpine-3.15.initrd</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ kata-clearlinux-latest.image</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ kata-containers.img -&gt; kata-clearlinux-latest.image</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ kata-containers-initrd.img -&gt; kata-alpine-3.15.initrd</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ vmlinux-5.19.2-96</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ vmlinux.container -&gt; vmlinux-5.19.2-96</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ vmlinuz-5.19.2-96</span><br><span class="line">    â”‚Â Â  â””â”€â”€ vmlinuz.container -&gt; vmlinuz-5.19.2-96</span><br><span class="line">    â””â”€â”€ kata-qemu # QEMU ä¾èµ–</span><br><span class="line">        â””â”€â”€ qemu</span><br><span class="line">            â”œâ”€â”€ bios-256k.bin</span><br><span class="line">            â”œâ”€â”€ bios.bin</span><br><span class="line">            â”œâ”€â”€ bios-microvm.bin</span><br><span class="line">            â”œâ”€â”€ edk2-aarch64-code.fd</span><br><span class="line">            â”œâ”€â”€ edk2-arm-code.fd</span><br><span class="line">            â”œâ”€â”€ edk2-arm-vars.fd</span><br><span class="line">            â”œâ”€â”€ edk2-i386-code.fd</span><br><span class="line">            â”œâ”€â”€ edk2-i386-secure-code.fd</span><br><span class="line">            â”œâ”€â”€ edk2-i386-vars.fd</span><br><span class="line">            â”œâ”€â”€ edk2-licenses.txt</span><br><span class="line">            â”œâ”€â”€ edk2-x86_64-code.fd</span><br><span class="line">            â”œâ”€â”€ edk2-x86_64-secure-code.fd</span><br><span class="line">            â”œâ”€â”€ efi-virtio.rom</span><br><span class="line">            â”œâ”€â”€ firmware</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ 50-edk2-i386-secure.json</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ 50-edk2-x86_64-secure.json</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ 60-edk2-aarch64.json</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ 60-edk2-arm.json</span><br><span class="line">            â”‚Â Â  â”œâ”€â”€ 60-edk2-i386.json</span><br><span class="line">            â”‚Â Â  â””â”€â”€ 60-edk2-x86_64.json</span><br><span class="line">            â”œâ”€â”€ hppa-firmware.img</span><br><span class="line">            â”œâ”€â”€ kvmvapic.bin</span><br><span class="line">            â”œâ”€â”€ linuxboot.bin</span><br><span class="line">            â”œâ”€â”€ linuxboot_dma.bin</span><br><span class="line">            â”œâ”€â”€ multiboot_dma.bin</span><br><span class="line">            â”œâ”€â”€ pvh.bin</span><br><span class="line">            â”œâ”€â”€ qboot.rom</span><br><span class="line">            â”œâ”€â”€ qemu-nsis.bmp</span><br><span class="line">            â”œâ”€â”€ s390-ccw.img</span><br><span class="line">            â””â”€â”€ s390-netboot.img</span><br></pre></td></tr></table></figure>

<h1 id="é…ç½®å‚æ•°"><a href="#é…ç½®å‚æ•°" class="headerlink" title="é…ç½®å‚æ•°"></a>é…ç½®å‚æ•°</h1><p>Kata Containers ä¸­é…ç½®çš„ä¼˜å…ˆçº§ä¸ºï¼šåŠ¨æ€é…ç½®é¡¹ &gt; é™æ€é…ç½®é¡¹ &gt; é»˜è®¤å€¼</p>
<ul>
<li>åŠ¨æ€é…ç½®é¡¹æ˜¯é€šè¿‡ OCI spec ä¸­çš„ annotations ä¼ é€’ï¼Œä¸»æµçš„ CRI å®ç°æ”¯æŒå°† Kubernetes Pod annotations é€ä¼ è‡³ Kata è¿è¡Œæ—¶</li>
<li>å„ä¸ªåŠ¨æ€ä¸é™æ€é…ç½®é¡¹æ”¯æŒä¸å¦è§† hypervisor å…·ä½“å®ç°çš„èƒ½åŠ›æœ‰æ‰€åŒºåˆ«</li>
</ul>
<h2 id="hypervisor"><a href="#hypervisor" class="headerlink" title="hypervisor"></a>hypervisor</h2><p>åŠ¨æ€é…ç½®é¡¹çš„å‰ç¼€ä¸º io.katacontainers.hypervisor.&lt;é™æ€é…ç½®é¡¹&gt;</p>
<h3 id="QEMU"><a href="#QEMU" class="headerlink" title="QEMU"></a>QEMU</h3><table>
<thead>
<tr>
<th>é™æ€é…ç½®é¡¹</th>
<th>åŠ¨æ€é…ç½®</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>path</td>
<td>Y</td>
<td>hypervisor å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„</td>
</tr>
<tr>
<td>kernel</td>
<td>Y</td>
<td>VM å†…æ ¸è·¯å¾„</td>
</tr>
<tr>
<td>image</td>
<td>Y</td>
<td>VM rootfs é•œåƒè·¯å¾„ï¼Œä¸ initrd æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª</td>
</tr>
<tr>
<td>initrd</td>
<td>Y</td>
<td>VM rootfs é•œåƒè·¯å¾„ï¼Œä¸ image æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª</td>
</tr>
<tr>
<td>machine_type</td>
<td>Y</td>
<td>QEMU æœºå™¨ç±»å‹ï¼Œä¾‹å¦‚ amd64 æ¶æ„ä¸‹ä¸º q35ã€arm64 æ¶æ„ä¸‹ä¸º virt</td>
</tr>
<tr>
<td>confidential_guest</td>
<td>N</td>
<td>æ˜¯å¦å¯ç”¨æœºå¯†å®¹å™¨ç‰¹æ€§ã€‚æœºå¯†å®¹å™¨éœ€è¦ host æ”¯æŒ tdxProtectionï¼ˆ<a target="_blank" rel="noopener" href="https://software.intel.com/content/www/us/en/develop/articles/intel-trust-domain-extensions.html">Intel Trust Domain Extensions</a>ï¼‰ã€sevProtectionï¼ˆ<a target="_blank" rel="noopener" href="https://developer.amd.com/sev/">AMD Secure Encrypted Virtualization</a>ï¼‰ã€pefProtectionï¼ˆ<a target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/latest/powerpc/ultravisor.html">IBM POWER 9 Protected Execution Facility</a>ï¼‰ä»¥åŠ seProtectionï¼ˆ<a target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/latest/virt/kvm/s390-pv.html">IBM Secure Execution (IBM Z &amp; LinuxONE)</a>ï¼‰ã€‚ä¸æ”¯æŒ CPU å’Œå†…å­˜çš„çƒ­æ’æ‹”ä»¥åŠ NVDIMM è®¾å¤‡ã€‚ä¸æ”¯æŒ arm64 æ¶æ„</td>
</tr>
<tr>
<td>rootless</td>
<td>Y</td>
<td>æ˜¯å¦ä»¥é root æƒé™çš„éšæœºç”¨æˆ·å¯åŠ¨ QEMU VMM</td>
</tr>
<tr>
<td>enable_annotations</td>
<td>N</td>
<td>å…è®¸ hypervisor åŠ¨æ€é…ç½®çš„é…ç½®é¡¹</td>
</tr>
<tr>
<td>valid_hypervisor_paths</td>
<td>N</td>
<td>ä»¥ glob(3) è§„åˆ™æ ¡éªŒ path å‚æ•°æ˜¯å¦åˆæ³•çš„è·¯å¾„é›†åˆ</td>
</tr>
<tr>
<td>kernel_params</td>
<td>Y</td>
<td>VM kernel çš„é™„åŠ å‚æ•°</td>
</tr>
<tr>
<td>firmware</td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>firmware_volume</td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>machine_accelerators</td>
<td>Y</td>
<td>æœºå™¨åŠ é€Ÿå™¨å‚æ•°</td>
</tr>
<tr>
<td>seccompsandbox</td>
<td>N</td>
<td>seccomp å‚æ•°ã€‚QEMU seccomp sandbox æ˜¯ QEMU VM ä¸­çš„ä¸€ç§å®‰å…¨ç‰¹æ€§ï¼Œé€šè¿‡é™åˆ¶ QEMU è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä»¥æé«˜ VM çš„å®‰å…¨æ€§ã€‚å®ƒä½¿ç”¨äº† Linux å†…æ ¸æä¾›çš„ seccomp æœºåˆ¶ï¼Œå°† QEMU è¿›ç¨‹é™åˆ¶åœ¨ä¸€ç»„å®‰å…¨çš„ç³»ç»Ÿè°ƒç”¨ä¸­ï¼Œä»è€Œé™ä½ VM é­å—æ”»å‡»çš„é£é™©ã€‚æ¨èå¯ç”¨ &#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;bpf_jit_enableï¼Œä»¥é™ä½è¯¥ç‰¹æ€§å¸¦æ¥çš„æ€§èƒ½ä¸‹é™</td>
</tr>
<tr>
<td>cpu_features</td>
<td>Y</td>
<td>CPU ç‰¹æ€§å‚æ•°ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„ pmu&#x3D;off å‚æ•°ç”¨äºç¦ç”¨ VM ä¸­çš„æ€§èƒ½ç›‘è§†å™¨å•å…ƒï¼ˆPerformance Monitoring Unitï¼ŒPMUï¼‰ã€‚PMU æ˜¯ä¸€ç§ç¡¬ä»¶è®¾å¤‡ï¼Œç”¨äºç›‘æ§ CPU çš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚æŒ‡ä»¤æ‰§è¡Œæ¬¡æ•°ã€ç¼“å­˜å‘½ä¸­ç‡ç­‰ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒPMU å¯èƒ½ä¼šè¢«ç”¨äºè¿›è¡Œä¾§ä¿¡é“æ”»å‡»æˆ–çªƒå–æ•æ„Ÿä¿¡æ¯</td>
</tr>
<tr>
<td>default_vcpus</td>
<td>Y</td>
<td>VM é»˜è®¤çš„ CPU æ•°é‡ï¼Œé»˜è®¤ä¸º 1ï¼Œæœ€å¤§ä¸º host CPU æ•°é‡</td>
</tr>
<tr>
<td>default_maxvcpus</td>
<td>Y</td>
<td>VM æœ€å¤§çš„ CPU æ•°é‡ï¼Œé»˜è®¤ä¸º host CPU æ•°é‡ï¼Œå…·ä½“èƒ½å¦ä½¿ç”¨åˆ° host CPU æ•°é‡ï¼Œè¿˜éœ€è¦è§† hypervisor é™åˆ¶è€Œå®šã€‚è¿‡å¤§çš„ CPU æ•°é‡ä¼šå½±å“åˆ° VM çš„æ€§èƒ½ä»¥åŠå†…å­˜å æ¯”</td>
</tr>
<tr>
<td>default_bridges</td>
<td>N</td>
<td>VM é»˜è®¤çš„ PCI æ¡¥æ•°é‡ï¼Œé»˜è®¤ä¸º 1ï¼Œæœ€å¤§ä¸º 5ã€‚ç›®å‰ï¼Œä»…æ”¯æŒ PCI bridgeï¼Œæ¯ä¸ª PCI bridge æœ€å¤šæ”¯æŒ 30 ä¸ªè®¾å¤‡çš„çƒ­æ’æ‹”ï¼Œæ¯ä¸ª VM æœ€å¤šæ”¯æŒ 5 ä¸ª PCI bridgeï¼ˆè¿™å¯èƒ½æ˜¯ QEMU æˆ–å†…æ ¸ä¸­çš„ä¸€ä¸ª bugï¼‰</td>
</tr>
<tr>
<td>default_memory</td>
<td>Y</td>
<td>VM é»˜è®¤çš„å†…å­˜æ€»é‡ï¼Œé»˜è®¤ä¸º 1ï¼Œæœ€å¤§ä¸º host å†…å­˜æ€»é‡</td>
</tr>
<tr>
<td>memory_slots</td>
<td>Y</td>
<td>VM é»˜è®¤çš„å†…å­˜æ’æ§½æ•°é‡ï¼Œé»˜è®¤ä¸º 10ï¼Œå³å†…å­˜çƒ­æ·»åŠ æ•°é‡çš„ä¸Šé™ä¸º 10</td>
</tr>
<tr>
<td>default_maxmemory</td>
<td>Y</td>
<td>VM æœ€å¤§çš„å†…å­˜æ€»é‡ï¼Œé»˜è®¤ä¸º  host å†…å­˜æ€»é‡</td>
</tr>
<tr>
<td>memory_offset</td>
<td>Y</td>
<td>VM å†…å­˜åç§»é‡ï¼Œç”¨äºæè¿° NVDIMM è®¾å¤‡çš„å†…å­˜ç©ºé—´ï¼Œå½“ block_device_driver ä¸º nvdimm æ—¶ï¼Œéœ€è¦è®¾ç½®æ­¤å‚æ•°ï¼Œæœ€ç»ˆä¼šè¿½åŠ åˆ° default_maxmemory ä¸­</td>
</tr>
<tr>
<td>enable_virtio_mem</td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>disable_block_device_use</td>
<td></td>
<td></td>
</tr>
<tr>
<td>shared_fs</td>
<td></td>
<td></td>
</tr>
<tr>
<td>virtio_fs_daemon</td>
<td></td>
<td></td>
</tr>
<tr>
<td>valid_virtio_fs_daemon_paths</td>
<td></td>
<td></td>
</tr>
<tr>
<td>virtio_fs_cache_size</td>
<td></td>
<td></td>
</tr>
<tr>
<td>virtio_fs_extra_args</td>
<td></td>
<td></td>
</tr>
<tr>
<td>virtio_fs_cache</td>
<td></td>
<td></td>
</tr>
<tr>
<td>block_device_driver</td>
<td></td>
<td></td>
</tr>
<tr>
<td>block_device_aio</td>
<td></td>
<td></td>
</tr>
<tr>
<td>block_device_cache_set</td>
<td></td>
<td></td>
</tr>
<tr>
<td>block_device_cache_direct</td>
<td></td>
<td></td>
</tr>
<tr>
<td>block_device_cache_noflush</td>
<td></td>
<td></td>
</tr>
<tr>
<td>enable_iothreads</td>
<td></td>
<td></td>
</tr>
<tr>
<td>enable_mem_prealloc</td>
<td></td>
<td></td>
</tr>
<tr>
<td>enable_hugepages</td>
<td></td>
<td></td>
</tr>
<tr>
<td>enable_vhost_user_store</td>
<td></td>
<td></td>
</tr>
<tr>
<td>vhost_user_store_path</td>
<td></td>
<td></td>
</tr>
<tr>
<td>enable_iommu</td>
<td></td>
<td></td>
</tr>
<tr>
<td>enable_iommu_platform</td>
<td></td>
<td></td>
</tr>
<tr>
<td>valid_vhost_user_store_paths</td>
<td></td>
<td></td>
</tr>
<tr>
<td>file_mem_backend</td>
<td></td>
<td></td>
</tr>
<tr>
<td>valid_file_mem_backends</td>
<td></td>
<td></td>
</tr>
<tr>
<td>pflashes</td>
<td></td>
<td></td>
</tr>
<tr>
<td>enable_debug</td>
<td></td>
<td></td>
</tr>
<tr>
<td>disable_nesting_checks</td>
<td></td>
<td></td>
</tr>
<tr>
<td>msize_9p</td>
<td></td>
<td></td>
</tr>
<tr>
<td>disable_image_nvdimm</td>
<td></td>
<td></td>
</tr>
<tr>
<td>hotplug_vfio_on_root_bus</td>
<td></td>
<td></td>
</tr>
<tr>
<td>pcie_root_port</td>
<td></td>
<td></td>
</tr>
<tr>
<td>disable_vhost_net</td>
<td></td>
<td></td>
</tr>
<tr>
<td>entropy_source</td>
<td></td>
<td></td>
</tr>
<tr>
<td>valid_entropy_sources</td>
<td></td>
<td></td>
</tr>
<tr>
<td>guest_hook_path</td>
<td></td>
<td></td>
</tr>
<tr>
<td>rx_rate_limiter_max_rate</td>
<td></td>
<td></td>
</tr>
<tr>
<td>tx_rate_limiter_max_rate</td>
<td></td>
<td></td>
</tr>
<tr>
<td>guest_memory_dump_path</td>
<td></td>
<td></td>
</tr>
<tr>
<td>guest_memory_dump_paging</td>
<td></td>
<td></td>
</tr>
<tr>
<td>enable_guest_swap</td>
<td></td>
<td></td>
</tr>
<tr>
<td>use_legacy_serial</td>
<td></td>
<td></td>
</tr>
<tr>
<td>disable_selinux</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h1 id="CRI-é…ç½®"><a href="#CRI-é…ç½®" class="headerlink" title="CRI é…ç½®"></a>CRI é…ç½®</h1><p>Kata Containers åœ¨ä¸ Kubernetes é›†æˆæ—¶ï¼Œé»˜è®¤æ”¯æŒ Containerd å’Œ CRI-O ä½œä¸º CRIï¼Œä¸æ”¯æŒä½¿ç”¨ docker-shim ä½œä¸º CRIã€‚</p>
<h2 id="Containerd"><a href="#Containerd" class="headerlink" title="Containerd"></a>Containerd</h2><p><em>&#x2F;etc&#x2F;containerd&#x2F;config.toml</em></p>
<p>åœ¨ Dockerï¼ˆdocker-shimï¼‰ä½œä¸º CRI çš„åœºæ™¯ä¸‹ï¼ŒContainerd æœ¬èº«ä¹Ÿæ˜¯ Docker çš„ç»„ä»¶ä¹‹ä¸€ï¼Œä½†æ˜¯ç¦ç”¨äº† Containerd ä½œä¸º CRIã€‚</p>
<p><strong>é CRI</strong></p>
<p>é»˜è®¤å®‰è£… Docker æœåŠ¡æ—¶ï¼Œä¼šè‡ªåŠ¨å®‰è£… Containerdï¼Œé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   Copyright 2018-2022 Docker Inc.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment">#   you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment">#   You may obtain a copy of the License at</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#       http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#   Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">#   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment">#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">#   See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">#   limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">disabled_plugins</span> = [<span class="string">&quot;cri&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#root = &quot;/var/lib/containerd&quot;</span></span><br><span class="line"><span class="comment">#state = &quot;/run/containerd&quot;</span></span><br><span class="line"><span class="comment">#subreaper = true</span></span><br><span class="line"><span class="comment">#oom_score = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[grpc]</span></span><br><span class="line"><span class="comment">#  address = &quot;/run/containerd/containerd.sock&quot;</span></span><br><span class="line"><span class="comment">#  uid = 0</span></span><br><span class="line"><span class="comment">#  gid = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[debug]</span></span><br><span class="line"><span class="comment">#  address = &quot;/run/containerd/debug.sock&quot;</span></span><br><span class="line"><span class="comment">#  uid = 0</span></span><br><span class="line"><span class="comment">#  gid = 0</span></span><br><span class="line"><span class="comment">#  level = &quot;info&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>CRI</strong></p>
<p>å€ŸåŠ© Containerd è‡ªå¸¦çš„é…ç½®ç”Ÿæˆèƒ½åŠ›ï¼Œåˆ›å»ºå…¶ä½œä¸º CRI çš„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">mkdir</span> -p /etc/containerd</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">containerd config default | sudo <span class="built_in">tee</span> /etc/containerd/config.toml</span></span><br></pre></td></tr></table></figure>

<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">disabled_plugins</span> = []</span><br><span class="line"><span class="attr">imports</span> = []</span><br><span class="line"><span class="attr">oom_score</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">plugin_dir</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">required_plugins</span> = []</span><br><span class="line"><span class="attr">root</span> = <span class="string">&quot;/var/lib/containerd&quot;</span></span><br><span class="line"><span class="attr">state</span> = <span class="string">&quot;/run/containerd&quot;</span></span><br><span class="line"><span class="attr">temp</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="section">[cgroup]</span></span><br><span class="line">  <span class="attr">path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[debug]</span></span><br><span class="line">  <span class="attr">address</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">format</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">gid</span> = <span class="number">0</span></span><br><span class="line">  <span class="attr">level</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">uid</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[grpc]</span></span><br><span class="line">  <span class="attr">address</span> = <span class="string">&quot;/run/containerd/containerd.sock&quot;</span></span><br><span class="line">  <span class="attr">gid</span> = <span class="number">0</span></span><br><span class="line">  <span class="attr">max_recv_message_size</span> = <span class="number">16777216</span></span><br><span class="line">  <span class="attr">max_send_message_size</span> = <span class="number">16777216</span></span><br><span class="line">  <span class="attr">tcp_address</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">tcp_tls_ca</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">tcp_tls_cert</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">tcp_tls_key</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">uid</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[metrics]</span></span><br><span class="line">  <span class="attr">address</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">grpc_histogram</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="section">[plugins]</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.gc.v1.scheduler&quot;]</span></span><br><span class="line">    <span class="attr">deletion_threshold</span> = <span class="number">0</span></span><br><span class="line">    <span class="attr">mutation_threshold</span> = <span class="number">100</span></span><br><span class="line">    <span class="attr">pause_threshold</span> = <span class="number">0.02</span></span><br><span class="line">    <span class="attr">schedule_delay</span> = <span class="string">&quot;0s&quot;</span></span><br><span class="line">    <span class="attr">startup_delay</span> = <span class="string">&quot;100ms&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;]</span></span><br><span class="line">    <span class="attr">device_ownership_from_security_context</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">disable_apparmor</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">disable_cgroup</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">disable_hugetlb_controller</span> = <span class="literal">true</span></span><br><span class="line">    <span class="attr">disable_proc_mount</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">disable_tcp_service</span> = <span class="literal">true</span></span><br><span class="line">    <span class="attr">enable_selinux</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">enable_tls_streaming</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">enable_unprivileged_icmp</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">enable_unprivileged_ports</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">ignore_image_defined_volumes</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">max_concurrent_downloads</span> = <span class="number">3</span></span><br><span class="line">    <span class="attr">max_container_log_line_size</span> = <span class="number">16384</span></span><br><span class="line">    <span class="attr">netns_mounts_under_state_dir</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">restrict_oom_score_adj</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">sandbox_image</span> = <span class="string">&quot;registry.k8s.io/pause:3.6&quot;</span></span><br><span class="line">    <span class="attr">selinux_category_range</span> = <span class="number">1024</span></span><br><span class="line">    <span class="attr">stats_collect_period</span> = <span class="number">10</span></span><br><span class="line">    <span class="attr">stream_idle_timeout</span> = <span class="string">&quot;4h0m0s&quot;</span></span><br><span class="line">    <span class="attr">stream_server_address</span> = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    <span class="attr">stream_server_port</span> = <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="attr">systemd_cgroup</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">tolerate_missing_hugetlb_controller</span> = <span class="literal">true</span></span><br><span class="line">    <span class="attr">unset_seccomp_profile</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.cni]</span></span><br><span class="line">      <span class="attr">bin_dir</span> = <span class="string">&quot;/opt/cni/bin&quot;</span></span><br><span class="line">      <span class="attr">conf_dir</span> = <span class="string">&quot;/etc/cni/net.d&quot;</span></span><br><span class="line">      <span class="attr">conf_template</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">ip_pref</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">max_conf_num</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd]</span></span><br><span class="line">      <span class="attr">default_runtime_name</span> = <span class="string">&quot;runc&quot;</span></span><br><span class="line">      <span class="attr">disable_snapshot_annotations</span> = <span class="literal">true</span></span><br><span class="line">      <span class="attr">discard_unpacked_layers</span> = <span class="literal">false</span></span><br><span class="line">      <span class="attr">ignore_rdt_not_enabled_errors</span> = <span class="literal">false</span></span><br><span class="line">      <span class="attr">no_pivot</span> = <span class="literal">false</span></span><br><span class="line">      <span class="attr">snapshotter</span> = <span class="string">&quot;overlayfs&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime]</span></span><br><span class="line">        <span class="attr">base_runtime_spec</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">cni_conf_dir</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">cni_max_conf_num</span> = <span class="number">0</span></span><br><span class="line">        <span class="attr">container_annotations</span> = []</span><br><span class="line">        <span class="attr">pod_annotations</span> = []</span><br><span class="line">        <span class="attr">privileged_without_host_devices</span> = <span class="literal">false</span></span><br><span class="line">        <span class="attr">runtime_engine</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_root</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_type</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime.options]</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes]</span></span><br><span class="line"></span><br><span class="line">        <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]</span></span><br><span class="line">          <span class="attr">base_runtime_spec</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">cni_conf_dir</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">cni_max_conf_num</span> = <span class="number">0</span></span><br><span class="line">          <span class="attr">container_annotations</span> = []</span><br><span class="line">          <span class="attr">pod_annotations</span> = []</span><br><span class="line">          <span class="attr">privileged_without_host_devices</span> = <span class="literal">false</span></span><br><span class="line">          <span class="attr">runtime_engine</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">runtime_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">runtime_root</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">runtime_type</span> = <span class="string">&quot;io.containerd.runc.v2&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]</span></span><br><span class="line">            <span class="attr">BinaryName</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">CriuImagePath</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">CriuPath</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">CriuWorkPath</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">IoGid</span> = <span class="number">0</span></span><br><span class="line">            <span class="attr">IoUid</span> = <span class="number">0</span></span><br><span class="line">            <span class="attr">NoNewKeyring</span> = <span class="literal">false</span></span><br><span class="line">            <span class="attr">NoPivotRoot</span> = <span class="literal">false</span></span><br><span class="line">            <span class="attr">Root</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">ShimCgroup</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">SystemdCgroup</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.untrusted_workload_runtime]</span></span><br><span class="line">        <span class="attr">base_runtime_spec</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">cni_conf_dir</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">cni_max_conf_num</span> = <span class="number">0</span></span><br><span class="line">        <span class="attr">container_annotations</span> = []</span><br><span class="line">        <span class="attr">pod_annotations</span> = []</span><br><span class="line">        <span class="attr">privileged_without_host_devices</span> = <span class="literal">false</span></span><br><span class="line">        <span class="attr">runtime_engine</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_root</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_type</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.untrusted_workload_runtime.options]</span></span><br><span class="line"></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.image_decryption]</span></span><br><span class="line">      <span class="attr">key_model</span> = <span class="string">&quot;node&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry]</span></span><br><span class="line">      <span class="attr">config_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.auths]</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs]</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.headers]</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors]</span></span><br><span class="line"></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.x509_key_pair_streaming]</span></span><br><span class="line">      <span class="attr">tls_cert_file</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">tls_key_file</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.internal.v1.opt&quot;]</span></span><br><span class="line">    <span class="attr">path</span> = <span class="string">&quot;/opt/containerd&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.internal.v1.restart&quot;]</span></span><br><span class="line">    <span class="attr">interval</span> = <span class="string">&quot;10s&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.internal.v1.tracing&quot;]</span></span><br><span class="line">    <span class="attr">sampling_ratio</span> = <span class="number">1.0</span></span><br><span class="line">    <span class="attr">service_name</span> = <span class="string">&quot;containerd&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.metadata.v1.bolt&quot;]</span></span><br><span class="line">    <span class="attr">content_sharing_policy</span> = <span class="string">&quot;shared&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.monitor.v1.cgroups&quot;]</span></span><br><span class="line">    <span class="attr">no_prometheus</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.runtime.v1.linux&quot;]</span></span><br><span class="line">    <span class="attr">no_shim</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">runtime</span> = <span class="string">&quot;runc&quot;</span></span><br><span class="line">    <span class="attr">runtime_root</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">shim</span> = <span class="string">&quot;containerd-shim&quot;</span></span><br><span class="line">    <span class="attr">shim_debug</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.runtime.v2.task&quot;]</span></span><br><span class="line">    <span class="attr">platforms</span> = [<span class="string">&quot;linux/amd64&quot;</span>]</span><br><span class="line">    <span class="attr">sched_core</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.service.v1.diff-service&quot;]</span></span><br><span class="line">    <span class="attr">default</span> = [<span class="string">&quot;walking&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.service.v1.tasks-service&quot;]</span></span><br><span class="line">    <span class="attr">rdt_config_file</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.aufs&quot;]</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.btrfs&quot;]</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.devmapper&quot;]</span></span><br><span class="line">    <span class="attr">async_remove</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">base_image_size</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">discard_blocks</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">fs_options</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">fs_type</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">pool_name</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.native&quot;]</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.overlayfs&quot;]</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">upperdir_label</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.zfs&quot;]</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.tracing.processor.v1.otlp&quot;]</span></span><br><span class="line">    <span class="attr">endpoint</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">insecure</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">protocol</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[proxy_plugins]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[stream_processors]</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[stream_processors.&quot;io.containerd.ocicrypt.decoder.v1.tar&quot;]</span></span><br><span class="line">    <span class="attr">accepts</span> = [<span class="string">&quot;application/vnd.oci.image.layer.v1.tar+encrypted&quot;</span>]</span><br><span class="line">    <span class="attr">args</span> = [<span class="string">&quot;--decryption-keys-path&quot;</span>, <span class="string">&quot;/etc/containerd/ocicrypt/keys&quot;</span>]</span><br><span class="line">    <span class="attr">env</span> = [<span class="string">&quot;OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf&quot;</span>]</span><br><span class="line">    <span class="attr">path</span> = <span class="string">&quot;ctd-decoder&quot;</span></span><br><span class="line">    <span class="attr">returns</span> = <span class="string">&quot;application/vnd.oci.image.layer.v1.tar&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[stream_processors.&quot;io.containerd.ocicrypt.decoder.v1.tar.gzip&quot;]</span></span><br><span class="line">    <span class="attr">accepts</span> = [<span class="string">&quot;application/vnd.oci.image.layer.v1.tar+gzip+encrypted&quot;</span>]</span><br><span class="line">    <span class="attr">args</span> = [<span class="string">&quot;--decryption-keys-path&quot;</span>, <span class="string">&quot;/etc/containerd/ocicrypt/keys&quot;</span>]</span><br><span class="line">    <span class="attr">env</span> = [<span class="string">&quot;OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf&quot;</span>]</span><br><span class="line">    <span class="attr">path</span> = <span class="string">&quot;ctd-decoder&quot;</span></span><br><span class="line">    <span class="attr">returns</span> = <span class="string">&quot;application/vnd.oci.image.layer.v1.tar+gzip&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[timeouts]</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.bolt.open&quot;</span> = <span class="string">&quot;0s&quot;</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.shim.cleanup&quot;</span> = <span class="string">&quot;5s&quot;</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.shim.load&quot;</span> = <span class="string">&quot;5s&quot;</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.shim.shutdown&quot;</span> = <span class="string">&quot;3s&quot;</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.task.state&quot;</span> = <span class="string">&quot;2s&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ttrpc]</span></span><br><span class="line">  <span class="attr">address</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">gid</span> = <span class="number">0</span></span><br><span class="line">  <span class="attr">uid</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒContainerd çš„é»˜è®¤ OCI è¿è¡Œæ—¶ä¸º runCï¼Œå¯ä»¥é€šè¿‡æ–°å¢ä»¥ä¸‹å†…å®¹ï¼Œç”¨äºå¯¹ Kata Containers çš„æ”¯æŒï¼š</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes]</span></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.kata]</span></span><br><span class="line">        <span class="attr">runtime_type</span> = <span class="string">&quot;io.containerd.kata.v2&quot;</span></span><br><span class="line">        <span class="attr">privileged_without_host_devices</span> = <span class="literal">true</span></span><br><span class="line">        <span class="attr">pod_annotations</span> = [<span class="string">&quot;io.katacontainers.*&quot;</span>]</span><br><span class="line">        <span class="attr">container_annotations</span> = [<span class="string">&quot;io.katacontainers.*&quot;</span>]</span><br><span class="line">        <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.kata.options]</span></span><br><span class="line">           <span class="attr">ConfigPath</span> = <span class="string">&quot;/opt/kata/share/defaults/kata-containers/configuration.toml&quot;</span>ã€</span><br></pre></td></tr></table></figure>

<h2 id="CRI-O"><a href="#CRI-O" class="headerlink" title="CRI-O"></a>CRI-O</h2><p>TODO</p>
<h1 id="RuntimeClass"><a href="#RuntimeClass" class="headerlink" title="RuntimeClass"></a>RuntimeClass</h1><p>RuntimeClass æ˜¯ä¸€ä¸ªç”¨äºé€‰æ‹©å®¹å™¨è¿è¡Œæ—¶é…ç½®çš„ç‰¹æ€§ï¼Œå®¹å™¨è¿è¡Œæ—¶é…ç½®ç”¨äºè¿è¡Œ Pod ä¸­çš„å®¹å™¨ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">RuntimeClass</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">node.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kata-containers</span></span><br><span class="line"><span class="attr">handler:</span> <span class="string">kata</span></span><br><span class="line"><span class="attr">overhead:</span></span><br><span class="line">  <span class="attr">podFixed:</span></span><br><span class="line">    <span class="attr">memory:</span> <span class="string">&quot;140Mi&quot;</span></span><br><span class="line">    <span class="attr">cpu:</span> <span class="string">&quot;250m&quot;</span></span><br><span class="line"><span class="attr">scheduling:</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">runtime:</span> <span class="string">kata</span></span><br></pre></td></tr></table></figure>

<h2 id="handler"><a href="#handler" class="headerlink" title="handler"></a>handler</h2><p>éœ€è¦å’Œ CRI ä¸­æ³¨å†Œçš„ handlerï¼ˆHANDLER_NAMEï¼‰ ä¿æŒä¸€è‡´ï¼Œç”¨äºå£°æ˜ç”±å…·ä½“å®ç°çš„ runtimeã€‚</p>
<p><strong>Containerd</strong></p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.$&#123;HANDLER_NAME&#125;]</span></span><br></pre></td></tr></table></figure>

<p><strong>CRI-O</strong></p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[crio.runtime.runtimes.$&#123;HANDLER_NAME&#125;]</span></span><br></pre></td></tr></table></figure>

<h2 id="scheduling"><a href="#scheduling" class="headerlink" title="scheduling"></a>scheduling</h2><p>é€šè¿‡ä¸º RuntimeClass æŒ‡å®š scheduling å­—æ®µï¼Œ å¯ä»¥é€šè¿‡è®¾ç½®çº¦æŸï¼Œç¡®ä¿è¿è¡Œè¯¥ RuntimeClass çš„ Pod è¢«è°ƒåº¦åˆ°æ”¯æŒè¯¥ RuntimeClass çš„èŠ‚ç‚¹ä¸Šã€‚ å¦‚æœæœªè®¾ç½® schedulingï¼Œåˆ™å‡å®šæ‰€æœ‰èŠ‚ç‚¹å‡æ”¯æŒæ­¤ RuntimeClass ã€‚</p>
<p>ä¸ºäº†ç¡®ä¿ Pod ä¼šè¢«è°ƒåº¦åˆ°æ”¯æŒæŒ‡å®šè¿è¡Œæ—¶çš„èŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹éœ€è¦è®¾ç½®ä¸€ä¸ªé€šç”¨çš„ label ç”¨äºè¢« runtimeclass.scheduling.nodeSelector æŒ‘é€‰ã€‚åœ¨ admission é˜¶æ®µï¼ŒRuntimeClass çš„ nodeSelector å°†ä¼šä¸ Pod çš„ nodeSelector åˆå¹¶ï¼Œå–äºŒè€…çš„äº¤é›†ã€‚å¦‚æœæœ‰å†²çªï¼ŒPod å°†ä¼šè¢«æ‹’ç»ã€‚</p>
<p>å¦‚æœèŠ‚ç‚¹éœ€è¦é˜»æ­¢æŸäº›éœ€è¦ç‰¹å®š RuntimeClass çš„ Podï¼Œå¯ä»¥åœ¨ tolerations ä¸­æŒ‡å®šã€‚ ä¸ nodeSelector ä¸€æ ·ï¼Œtolerations ä¹Ÿåœ¨ admission é˜¶æ®µä¸ Pod çš„ tolerations åˆå¹¶ï¼Œå–äºŒè€…çš„å¹¶é›†ã€‚</p>
<h2 id="overhead"><a href="#overhead" class="headerlink" title="overhead"></a>overhead</h2><p>åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œ Pod æ—¶ï¼ŒPod æœ¬èº«å ç”¨å¤§é‡ç³»ç»Ÿèµ„æºã€‚è¿™äº›èµ„æºæ˜¯è¿è¡Œ Pod å†…å®¹å™¨æ‰€éœ€èµ„æºçš„é™„åŠ èµ„æºã€‚Overhead æ˜¯ä¸€ä¸ªç‰¹æ€§ï¼Œç”¨äºè®¡ç®— Pod åŸºç¡€è®¾æ–½åœ¨å®¹å™¨è¯·æ±‚å’Œé™åˆ¶ä¹‹ä¸Šæ¶ˆè€—çš„èµ„æºã€‚</p>
<p>åœ¨ Kubernetes ä¸­ï¼ŒPod çš„å¼€é”€æ˜¯æ ¹æ®ä¸ Pod çš„ <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/containers/runtime-class/">RuntimeClass</a> ç›¸å…³è”çš„å¼€é”€åœ¨<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks">å‡†å…¥</a>æ—¶è®¾ç½®çš„ã€‚</p>
<p>å¦‚æœå¯ç”¨äº† Pod Overheadï¼Œåœ¨è°ƒåº¦ Pod æ—¶ï¼Œé™¤äº†è€ƒè™‘å®¹å™¨èµ„æºè¯·æ±‚çš„æ€»å’Œå¤–ï¼Œè¿˜è¦è€ƒè™‘ Pod å¼€é”€ã€‚ ç±»ä¼¼åœ°ï¼Œkubelet å°†åœ¨ç¡®å®š Pod cgroups çš„å¤§å°å’Œæ‰§è¡Œ Pod é©±é€æ’åºæ—¶ä¹Ÿä¼šè€ƒè™‘ Pod å¼€é”€ã€‚</p>
<h1 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h1><h3 id="å®šåˆ¶åŒ–çš„-annotation"><a href="#å®šåˆ¶åŒ–çš„-annotation" class="headerlink" title="å®šåˆ¶åŒ–çš„ annotation"></a>å®šåˆ¶åŒ–çš„ annotation</h3><p>Kata Containers å¯ä»¥é€šè¿‡ Pod annotation çš„æ–¹å¼å®ç°å®šåˆ¶åŒ–æ¯ä¸€ä¸ª Pod çš„åº•å±‚ Kata å‚æ•°ã€‚éœ€è¦åšçš„æ˜¯ä¸Šå±‚ CRI å°† Pod annotation é€ä¼ è‡³åº•å±‚ runtimeï¼ŒåŒæ—¶ Kata Containers å¼€å¯è¯†åˆ«ç‰¹å®šçš„ Pod annotationï¼Œå¹¶ä¸” CRI éœ€è¦æ”¯æŒæ­¤åŠŸèƒ½ï¼ˆå¦‚ Containerd ä¾èµ– 1.4.x ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰å¯ä»¥ï¼Œä¸”å¯¹åº”çš„ runtime é…ç½®ä¸­æ–°å¢ç›¸å…³ annotations æ”¯æŒï¼›CRI-O é»˜è®¤é€ä¼ æ‰€æœ‰å‚æ•°ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼‰</p>
<p><strong>å…¨å±€é…ç½®</strong></p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Type</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><code>io.katacontainers.config_path</code></td>
<td>string</td>
<td>Kata config file location that overrides the default config paths</td>
</tr>
<tr>
<td><code>io.katacontainers.pkg.oci.bundle_path</code></td>
<td>string</td>
<td>OCI bundle path</td>
</tr>
<tr>
<td><code>io.katacontainers.pkg.oci.container_type</code></td>
<td>string</td>
<td>OCI container type. Only accepts <code>pod_container</code> and <code>pod_sandbox</code></td>
</tr>
</tbody></table>
<p><strong>Runtime é…ç½®</strong></p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Type</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><code>io.katacontainers.config.runtime.experimental</code></td>
<td><code>boolean</code></td>
<td>determines if experimental features enabled</td>
</tr>
<tr>
<td><code>io.katacontainers.config.runtime.disable_guest_seccomp</code></td>
<td><code>boolean</code></td>
<td>determines if <code>seccomp</code> should be applied inside guest</td>
</tr>
<tr>
<td><code>io.katacontainers.config.runtime.disable_new_netns</code></td>
<td><code>boolean</code></td>
<td>determines if a new netns is created for the hypervisor process</td>
</tr>
<tr>
<td><code>io.katacontainers.config.runtime.internetworking_model</code></td>
<td>string</td>
<td>determines how the VM should be connected to the container network interface. Valid values are <code>macvtap</code>, <code>tcfilter</code> and <code>none</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.runtime.sandbox_cgroup_only</code></td>
<td><code>boolean</code></td>
<td>determines if Kata processes are managed only in sandbox cgroup</td>
</tr>
<tr>
<td><code>io.katacontainers.config.runtime.enable_pprof</code></td>
<td><code>boolean</code></td>
<td>enables Golang <code>pprof</code> for <code>containerd-shim-kata-v2</code> process</td>
</tr>
</tbody></table>
<p><strong>Agent é…ç½®</strong></p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Type</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><code>io.katacontainers.config.agent.enable_tracing</code></td>
<td><code>boolean</code></td>
<td>enable tracing for the agent</td>
</tr>
<tr>
<td><code>io.katacontainers.config.agent.container_pipe_size</code></td>
<td>uint32</td>
<td>specify the size of the std(in&#x2F;out) pipes created for containers</td>
</tr>
<tr>
<td><code>io.katacontainers.config.agent.kernel_modules</code></td>
<td>string</td>
<td>the list of kernel modules and their parameters that will be loaded in the guest kernel. Semicolon separated list of kernel modules and their parameters. These modules will be loaded in the guest kernel using <code>modprobe</code>(8). E.g., <code>e1000e InterruptThrottleRate=3000,3000,3000 EEE=1; i915 enable_ppgtt=0</code></td>
</tr>
</tbody></table>
<p><strong>Hypervisor é…ç½®</strong></p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Type</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><code>io.katacontainers.config.hypervisor.asset_hash_type</code></td>
<td>string</td>
<td>the hash type used for assets verification, default is <code>sha512</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.block_device_cache_direct</code></td>
<td><code>boolean</code></td>
<td>Denotes whether use of <code>O_DIRECT</code> (bypass the host page cache) is enabled</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.block_device_cache_noflush</code></td>
<td><code>boolean</code></td>
<td>Denotes whether flush requests for the device are ignored</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.block_device_cache_set</code></td>
<td><code>boolean</code></td>
<td>cache-related options will be set to block devices or not</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.block_device_driver</code></td>
<td>string</td>
<td>the driver to be used for block device, valid values are <code>virtio-blk</code>, <code>virtio-scsi</code>, <code>nvdimm</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.cpu_features</code></td>
<td><code>string</code></td>
<td>Comma-separated list of CPU features to pass to the CPU (QEMU)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.ctlpath</code> (R)</td>
<td><code>string</code></td>
<td>Path to the <code>acrnctl</code>binary for the ACRN hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.default_max_vcpus</code></td>
<td>uint32</td>
<td>the maximum number of vCPUs allocated for the VM by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.default_memory</code></td>
<td>uint32</td>
<td>the memory assigned for a VM by the hypervisor in <code>MiB</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.default_vcpus</code></td>
<td>uint32</td>
<td>the default vCPUs assigned for a VM by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.disable_block_device_use</code></td>
<td><code>boolean</code></td>
<td>disallow a block device from being used</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.disable_image_nvdimm</code></td>
<td><code>boolean</code></td>
<td>specify if a <code>nvdimm</code> device should be used as rootfs for the guest (QEMU)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.disable_vhost_net</code></td>
<td><code>boolean</code></td>
<td>specify if <code>vhost-net</code> is not available on the host</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_hugepages</code></td>
<td><code>boolean</code></td>
<td>if the memory should be <code>pre-allocated</code> from huge pages</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_iommu_platform</code></td>
<td><code>boolean</code></td>
<td>enable <code>iommu</code> on CCW devices (QEMU s390x)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_iommu</code></td>
<td><code>boolean</code></td>
<td>enable <code>iommu</code> on Q35 (QEMU x86_64)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_iothreads</code></td>
<td><code>boolean</code></td>
<td>enable IO to be processed in a separate thread. Supported currently for virtio-<code>scsi</code> driver</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_mem_prealloc</code></td>
<td><code>boolean</code></td>
<td>the memory space used for <code>nvdimm</code> device by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_vhost_user_store</code></td>
<td><code>boolean</code></td>
<td>enable vhost-user storage device (QEMU)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_virtio_mem</code></td>
<td><code>boolean</code></td>
<td>enable virtio-mem (QEMU)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.entropy_source</code> (R)</td>
<td>string</td>
<td>the path to a host source of entropy (<code>/dev/random</code>, <code>/dev/urandom</code> or real hardware RNG device)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.file_mem_backend</code> (R)</td>
<td>string</td>
<td>file based memory backend root directory</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.firmware_hash</code></td>
<td>string</td>
<td>container firmware SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.firmware</code></td>
<td>string</td>
<td>the guest firmware that will run the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.firmware_volume_hash</code></td>
<td>string</td>
<td>container firmware volume SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.firmware_volume</code></td>
<td>string</td>
<td>the guest firmware volume that will be passed to the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.guest_hook_path</code></td>
<td>string</td>
<td>the path within the VM that will be used for drop in hooks</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.hotplug_vfio_on_root_bus</code></td>
<td><code>boolean</code></td>
<td>indicate if devices need to be hotplugged on the root bus instead of a bridge</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.hypervisor_hash</code></td>
<td>string</td>
<td>container hypervisor binary SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.image_hash</code></td>
<td>string</td>
<td>container guest image SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.image</code></td>
<td>string</td>
<td>the guest image that will run in the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.initrd_hash</code></td>
<td>string</td>
<td>container guest initrd SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.initrd</code></td>
<td>string</td>
<td>the guest initrd image that will run in the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.jailer_hash</code></td>
<td>string</td>
<td>container jailer SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.jailer_path</code> (R)</td>
<td>string</td>
<td>the jailer that will constrain the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.kernel_hash</code></td>
<td>string</td>
<td>container kernel image SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.kernel_params</code></td>
<td>string</td>
<td>additional guest kernel parameters</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.kernel</code></td>
<td>string</td>
<td>the kernel used to boot the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.machine_accelerators</code></td>
<td>string</td>
<td>machine specific accelerators for the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.machine_type</code></td>
<td>string</td>
<td>the type of machine being emulated by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.memory_offset</code></td>
<td>uint64</td>
<td>the memory space used for <code>nvdimm</code> device by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.memory_slots</code></td>
<td>uint32</td>
<td>the memory slots assigned to the VM by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.msize_9p</code></td>
<td>uint32</td>
<td>the <code>msize</code> for 9p shares</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.path</code></td>
<td>string</td>
<td>the hypervisor that will run the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.pcie_root_port</code></td>
<td>specify the number of PCIe Root Port devices. The PCIe Root Port device is used to hot-plug a PCIe device (QEMU)</td>
<td></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.shared_fs</code></td>
<td>string</td>
<td>the shared file system type, either <code>virtio-9p</code> or <code>virtio-fs</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.use_vsock</code></td>
<td><code>boolean</code></td>
<td>specify use of <code>vsock</code> for agent communication</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.vhost_user_store_path</code> (R)</td>
<td><code>string</code></td>
<td>specify the directory path where vhost-user devices related folders, sockets and device nodes should be (QEMU)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.virtio_fs_cache_size</code></td>
<td>uint32</td>
<td>virtio-fs DAX cache size in <code>MiB</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.virtio_fs_cache</code></td>
<td>string</td>
<td>the cache mode for virtio-fs, valid values are <code>always</code>, <code>auto</code> and <code>none</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.virtio_fs_daemon</code></td>
<td>string</td>
<td>virtio-fs <code>vhost-user</code>daemon path</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.virtio_fs_extra_args</code></td>
<td>string</td>
<td>extra options passed to <code>virtiofs</code> daemon</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_guest_swap</code></td>
<td><code>boolean</code></td>
<td>enable swap in the guest</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.use_legacy_serial</code></td>
<td><code>boolean</code></td>
<td>uses legacy serial device for guestâ€™s console (QEMU)</td>
</tr>
</tbody></table>
<p><strong>Container é…ç½®</strong></p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Type</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><code>io.katacontainers.container.resource.swappiness&quot;</code></td>
<td><code>uint64</code></td>
<td>specify the <code>Resources.Memory.Swappiness</code></td>
</tr>
<tr>
<td><code>io.katacontainers.container.resource.swap_in_bytes&quot;</code></td>
<td><code>uint64</code></td>
<td>specify the <code>Resources.Memory.Swap</code></td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼Œé€šè¿‡ Pod Annotation å¯åŠ¨ä¸€ä¸ªå¿½ç•¥åº•å±‚é»˜è®¤å¤§å°çš„ï¼Œå…·æœ‰ 5C çš„ VM</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">io.katacontainers.config.hypervisor.default_vcpus:</span> <span class="string">&quot;5&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">runtimeClassName:</span> <span class="string">kata-containers</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">uname-kata</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;uname -r &amp;&amp; tail -f /dev/null&quot;</span>]</span><br></pre></td></tr></table></figure>

<h1 id="VMCache"><a href="#VMCache" class="headerlink" title="VMCache"></a>VMCache</h1><p>VMCache æ˜¯ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå¯åœ¨ä½¿ç”¨å‰å°† VM åˆ›å»ºä¸ºç¼“å­˜ã€‚å®ƒæœ‰åŠ©äºåŠ å¿«æ–°å®¹å™¨çš„åˆ›å»ºã€‚</p>
<p>è¯¥åŠŸèƒ½ç”±å€ŸåŠ© Unix Socket é€šä¿¡çš„ä¸€ä¸ª Server å’Œä¸€äº› Client ç»„æˆã€‚è¯¥åè®®æ˜¯ protocols&#x2F;cache&#x2F;cache.proto ä¸­çš„ gRPCã€‚</p>
<p>VMCache Server å°†åˆ›å»ºä¸€äº› VM å¹¶é€šè¿‡ factory cache ç¼“å­˜å®ƒä»¬ã€‚å®ƒå°† VM è½¬æ¢ä¸º gRPC æ ¼å¼å¹¶åœ¨æ”¶åˆ° client è¯·æ±‚æ—¶ä¼ è¾“å®ƒã€‚</p>
<p>grpccache Factory æ˜¯ VMCache å®¢æˆ·ç«¯ã€‚å®ƒå°†è¯·æ±‚ gRPC æ ¼å¼çš„ VM å¹¶å°†å…¶è½¬æ¢å› VMã€‚å¦‚æœå¯ç”¨äº† VMCache åŠŸèƒ½ï¼Œkata-runtime åœ¨åˆ›å»ºæ–°çš„ sandbox æ—¶ä¼šå‘ grpccache è¯·æ±‚ VMã€‚</p>
<p><strong>ä¸ VM Tmplating çš„åŒºåˆ«</strong></p>
<p>VM Tmplating å’Œ VMCache éƒ½æœ‰åŠ©äºåŠ å¿«æ–°å®¹å™¨çš„åˆ›å»ºã€‚</p>
<p>å½“å¯ç”¨ VM æ¨¡æ¿æ—¶ï¼Œé€šè¿‡ä»é¢„å…ˆåˆ›å»ºçš„æ¨¡æ¿ VM å…‹éš†æ¥åˆ›å»ºæ–°çš„ VMï¼Œå®ƒä»¬å°†ä»¥åªè¯»æ¨¡å¼å…±äº«ç›¸åŒçš„ initramfsã€å†…æ ¸å’Œ agent å†…å­˜ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨åŒä¸€å°ä¸»æœºä¸Šè¿è¡Œè®¸å¤š Kata å®¹å™¨ï¼Œå®ƒä¼šèŠ‚çœå¤§é‡å†…å­˜ã€‚</p>
<p>VMCache ä¸å®¹æ˜“å—åˆ°å…±äº«å†…å­˜ CVE çš„å½±å“ï¼Œå› ä¸ºæ¯ä¸ª VM ä¸å…±äº«å†…å­˜ã€‚</p>
<p><strong>å¦‚ä½•å¯ç”¨ VM Cache</strong></p>
<p>é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ä»¥ä¸‹é…ç½®é¡¹ï¼š</p>
<ul>
<li>vm_cache_number æŒ‡å®š VMCache ç¼“å­˜çš„ä¸ªæ•°ï¼Œä¸æŒ‡å®šæˆ–è€…ä¸º 0 æ—¶ä»£è¡¨ VMCache è¢«ç¦ç”¨ï¼›&gt; 0 æ—¶å³ä¸ºç¼“å­˜ä¸ªæ•°</li>
<li>vm_cache_endpoint æŒ‡å®š socket åœ°å€</li>
</ul>
<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ª VM æ¨¡æ¿ä¾›ä»¥åä½¿ç”¨ï¼Œé€šè¿‡ CTRL+C é€€å‡º</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime factory init</span></span><br></pre></td></tr></table></figure>

<p><strong>å·²çŸ¥é™åˆ¶</strong></p>
<ul>
<li>æ— æ³•ä¸ VM Templating å…±å­˜</li>
<li>ä»…æ”¯æŒ QEMU ä½œä¸º hypervisor</li>
</ul>
<h1 id="VM-Templating"><a href="#VM-Templating" class="headerlink" title="VM Templating"></a>VM Templating</h1><p>VM Templating æ˜¯ Kata Containers çš„ä¸€é¡¹åŠŸèƒ½ï¼Œå¯ä»¥å€ŸåŠ©å…‹éš†æŠ€æœ¯åˆ›å»ºæ–°çš„ VMã€‚å¯ç”¨åï¼Œé€šè¿‡ä»é¢„å…ˆåˆ›å»ºçš„æ¨¡æ¿ VM å…‹éš†åˆ›å»ºæ–°çš„ VMï¼Œå®ƒä»¬å°†ä»¥åªè¯»æ¨¡å¼å…±äº«ç›¸åŒçš„ initramfsã€å†…æ ¸å’Œ agent å†…å­˜ã€‚ç±»ä¼¼äºå†…æ ¸çš„ fork è¿›ç¨‹æ“ä½œï¼Œè¿™é‡Œ fork çš„æ˜¯ VMã€‚</p>
<p><strong>ä¸ VMCache çš„åŒºåˆ«</strong></p>
<p>VMCache å’Œ VM Templating éƒ½æœ‰åŠ©äºåŠ å¿«æ–°å®¹å™¨çš„åˆ›å»ºã€‚</p>
<p>å¯ç”¨ VMCache åï¼ŒVMCache æœåŠ¡å™¨ä¼šåˆ›å»ºæ–°çš„ VMã€‚æ‰€ä»¥å®ƒä¸å®¹æ˜“å—åˆ°å…±äº«å†…å­˜ CVE çš„æ”»å‡»ï¼Œå› ä¸ºæ¯ä¸ª VM éƒ½ä¸å…±äº«å†…å­˜ã€‚</p>
<p>å¦‚æœåœ¨åŒä¸€å°ä¸»æœºä¸Šè¿è¡Œè®¸å¤š Kata å®¹å™¨ï¼ŒVM Templating å¯ä»¥èŠ‚çœå¤§é‡å†…å­˜</p>
<p><strong>ä¼˜åŠ¿</strong></p>
<p>å¦‚æœåœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œè®¸å¤š Kata å®¹å™¨ï¼ŒVM Templating æœ‰åŠ©äºåŠ å¿«æ–°å®¹å™¨çš„åˆ›å»ºå¹¶èŠ‚çœå¤§é‡å†…å­˜ã€‚å¦‚æœæ­£åœ¨è¿è¡Œé«˜å¯†åº¦å·¥ä½œè´Ÿè½½ï¼Œæˆ–è€…éå¸¸å…³å¿ƒå®¹å™¨å¯åŠ¨é€Ÿåº¦ï¼ŒVM Templating å¯èƒ½éå¸¸æœ‰ç”¨ã€‚</p>
<p>åœ¨ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œåˆ›å»ºäº† 100 ä¸ª Kata å®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨éƒ½æ‹¥æœ‰ 128MB çš„ Guest å†…å­˜ï¼Œå¹¶ä¸”åœ¨å¯ç”¨ VM Templating ç‰¹æ€§æ—¶æœ€ç»ˆæ€»å…±èŠ‚çœäº† 9GB çš„å†…å­˜ï¼Œè¿™å¤§çº¦æ˜¯ Guest å†…å­˜æ€»é‡çš„ 72%ã€‚<a target="_blank" rel="noopener" href="https://github.com/kata-containers/runtime/pull/303#issuecomment-395846767">å®Œæ•´ç»“æœå‚è€ƒ</a>ã€‚</p>
<p>åœ¨å¦ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ containerd shimv2 åˆ›å»ºäº† 10 ä¸ª Kata å®¹å™¨ï¼Œå¹¶è®¡ç®—äº†æ¯ä¸ªå®¹å™¨çš„å¹³å‡å¯åŠ¨é€Ÿåº¦ã€‚ç»“æœè¡¨æ˜ï¼ŒVM Templating å°† Kata å®¹å™¨çš„åˆ›å»ºé€Ÿåº¦æé«˜äº† 38.68%ã€‚<a target="_blank" rel="noopener" href="https://gist.github.com/bergwolf/06974a3c5981494a40e2c408681c085d">å®Œæ•´ç»“æœå‚è€ƒ</a>ã€‚</p>
<p><strong>ä¸è¶³</strong></p>
<p>VM Templating çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯å®ƒæ— æ³•é¿å…è·¨ VM ä¾§é€šé“æ”»å‡»ï¼Œä¾‹å¦‚æœ€åˆé’ˆå¯¹ Linux KSM åŠŸèƒ½çš„ CVE-2015-2877ã€‚å¾—å‡ºçš„ç»“è®ºæ˜¯ï¼Œâ€œç›¸äº’ä¸ä¿¡ä»»çš„ç§Ÿæˆ·ä¹‹é—´ç”¨äºå†…å­˜ä¿æŠ¤çš„å…±äº«ç›´åˆ°å†™å…¥çš„æ–¹æ³•æœ¬è´¨ä¸Šæ˜¯å¯æ£€æµ‹çš„ä¿¡æ¯æ³„éœ²ï¼Œå¹¶ä¸”å¯ä»¥å½’ç±»ä¸ºæ½œåœ¨çš„è¢«è¯¯è§£çš„è¡Œä¸ºè€Œä¸æ˜¯æ¼æ´ã€‚â€å¦‚æœå¯¹æ­¤æ•æ„Ÿï¼Œä¸è¦ä½¿ç”¨ VM Templating æˆ– KSMã€‚</p>
<p><strong>å¦‚ä½•å¯ç”¨ VM Templating</strong></p>
<p>é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ä»¥ä¸‹é…ç½®é¡¹ï¼š</p>
<ul>
<li>hypervisor ä¸º qemuï¼Œä¸”ç‰ˆæœ¬ä¸º v4.1.0 ä»¥ä¸Š</li>
<li>enable_template è®¾ä¸º true</li>
<li>VM é•œåƒä¸º initrd ç±»å‹</li>
<li>shared_fs ä¸ä¸º virtio-fs</li>
</ul>
<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªVM æ¨¡æ¿ä¾›ä»¥åä½¿ç”¨</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kata-runtime factory init</span><br><span class="line">vm factory initialized</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºçš„æ¨¡æ¿ä½äº</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls /run/vc/vm/template</span><br><span class="line">memory  state</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤é”€æ¯</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kata-runtime factory destroy</span><br><span class="line">vm factory destroyed</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸æƒ³æ‰‹åŠ¨è°ƒç”¨ kata-runtime factory initï¼Œé»˜è®¤åˆ›å»ºçš„ç¬¬ä¸€ä¸ª Kata å®¹å™¨å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª VM æ¨¡æ¿ã€‚</p>
<h1 id="kata-runtime"><a href="#kata-runtime" class="headerlink" title="kata-runtime"></a>kata-runtime</h1><h2 id="check-kata-check"><a href="#check-kata-check" class="headerlink" title="check (kata-check)"></a>check (kata-check)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime check --verbose</span></span><br><span class="line">INFO[0000] Looking for releases                          arch=amd64 name=kata-runtime pid=33900 source=runtime url=&quot;https://api.github.com/repos/kata-containers/kata-containers/releases&quot;</span><br><span class="line">Newer major release available: 3.0.0 (url: https://github.com/kata-containers/kata-containers/releases/download/3.0.0/kata-containers-3.0.0-vendor.tar.gz, date: 2022-10-09T09:48:18Z)</span><br><span class="line">INFO[0002] CPU property found                            arch=amd64 description=&quot;Intel Architecture CPU&quot; name=GenuineIntel pid=33900 source=runtime type=attribute</span><br><span class="line">INFO[0002] CPU property found                            arch=amd64 description=&quot;Virtualization support&quot; name=vmx pid=33900 source=runtime type=flag</span><br><span class="line">INFO[0002] CPU property found                            arch=amd64 description=&quot;64Bit CPU&quot; name=lm pid=33900 source=runtime type=flag</span><br><span class="line">INFO[0002] CPU property found                            arch=amd64 description=SSE4.1 name=sse4_1 pid=33900 source=runtime type=flag</span><br><span class="line">INFO[0002] kernel property found                         arch=amd64 description=&quot;Host kernel accelerator for virtio&quot; name=vhost pid=33900 source=runtime type=module</span><br><span class="line">INFO[0002] kernel property found                         arch=amd64 description=&quot;Host kernel accelerator for virtio network&quot; name=vhost_net pid=33900 source=runtime type=module</span><br><span class="line">INFO[0002] kernel property found                         arch=amd64 description=&quot;Host Support for Linux VM Sockets&quot; name=vhost_vsock pid=33900 source=runtime type=module</span><br><span class="line">INFO[0002] kernel property found                         arch=amd64 description=&quot;Intel KVM&quot; name=kvm_intel pid=33900 source=runtime type=module</span><br><span class="line">INFO[0002] kernel property found                         arch=amd64 description=&quot;Kernel-based Virtual Machine&quot; name=kvm pid=33900 source=runtime type=module</span><br><span class="line">System is capable of running Kata Containers</span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„ flags åŒ…æ‹¬</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>â€“check-version-only</td>
<td>ä»…å¯¹æ¯”å‰ä½¿ç”¨ç‰ˆæœ¬å’Œæœ€æ–°å¯ç”¨ç‰ˆæœ¬ï¼ˆéœ€è¦ç½‘ç»œæ”¯æŒï¼Œä¸”é root ç”¨æˆ·ï¼‰</td>
</tr>
<tr>
<td>â€“include-all-releases</td>
<td>åŒ…å«è¿‡æ»¤é¢„å‘å¸ƒçš„ç‰ˆæœ¬</td>
</tr>
<tr>
<td>â€“no-network-checks</td>
<td>ä¸å€ŸåŠ©ç½‘ç»œæ‰§è¡Œæ£€æµ‹</td>
</tr>
<tr>
<td>â€“only-list-releases</td>
<td>ä»…åˆ—å‡ºè¾ƒæ–°çš„å¯ç”¨ç‰ˆæœ¬ï¼ˆéœ€è¦ç½‘ç»œæ”¯æŒï¼Œä¸”é root ç”¨æˆ·ï¼‰</td>
</tr>
<tr>
<td>â€“strict</td>
<td>è¿›è¡Œä¸¥æ ¼æ£€æŸ¥</td>
</tr>
<tr>
<td>â€“verbose</td>
<td>å±•ç¤ºè¯¦ç»†çš„æ£€æŸ¥é¡¹</td>
</tr>
</tbody></table>
<h2 id="env-kata-env"><a href="#env-kata-env" class="headerlink" title="env (kata-env)"></a>env (kata-env)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime <span class="built_in">env</span></span> </span><br><span class="line">[Kernel]</span><br><span class="line">  Path = &quot;/opt/kata/share/kata-containers/vmlinux.container&quot;</span><br><span class="line">  Parameters = &quot;systemd.unit=kata-containers.target systemd.mask=systemd-networkd.service systemd.mask=systemd-networkd.socket scsi_mod.scan=none agent.debug_console agent.debug_console_vport=1026&quot;</span><br><span class="line"></span><br><span class="line">[Meta]</span><br><span class="line">  Version = &quot;1.0.26&quot;</span><br><span class="line"></span><br><span class="line">[Image]</span><br><span class="line">  Path = &quot;/opt/kata/share/kata-containers/kata-containers.img&quot;</span><br><span class="line"></span><br><span class="line">[Initrd]</span><br><span class="line">  Path = &quot;&quot;</span><br><span class="line"></span><br><span class="line">[Hypervisor]</span><br><span class="line">  MachineType = &quot;q35&quot;</span><br><span class="line">  Version = &quot;QEMU emulator version 6.2.0 (kata-static)\nCopyright (c) 2003-2021 Fabrice Bellard and the QEMU Project developers&quot;</span><br><span class="line">  Path = &quot;/opt/kata/bin/qemu-system-x86_64&quot;</span><br><span class="line">  BlockDeviceDriver = &quot;virtio-scsi&quot;</span><br><span class="line">  EntropySource = &quot;/dev/urandom&quot;</span><br><span class="line">  SharedFS = &quot;virtio-fs&quot;</span><br><span class="line">  VirtioFSDaemon = &quot;/opt/kata/libexec/kata-qemu/virtiofsd&quot;</span><br><span class="line">  SocketPath = &quot;&lt;&lt;unknown&gt;&gt;&quot;</span><br><span class="line">  Msize9p = 8192</span><br><span class="line">  MemorySlots = 10</span><br><span class="line">  PCIeRootPort = 0</span><br><span class="line">  HotplugVFIOOnRootBus = false</span><br><span class="line">  Debug = false</span><br><span class="line"></span><br><span class="line">[Runtime]</span><br><span class="line">  Path = &quot;/usr/bin/kata-runtime&quot;</span><br><span class="line">  Debug = false</span><br><span class="line">  Trace = false</span><br><span class="line">  DisableGuestSeccomp = true</span><br><span class="line">  DisableNewNetNs = false</span><br><span class="line">  SandboxCgroupOnly = true</span><br><span class="line">  [Runtime.Config]</span><br><span class="line">    Path = &quot;/etc/kata-containers/configuration.toml&quot;</span><br><span class="line">  [Runtime.Version]</span><br><span class="line">    OCI = &quot;1.0.2-dev&quot;</span><br><span class="line">    [Runtime.Version.Version]</span><br><span class="line">      Semver = &quot;2.4.3&quot;</span><br><span class="line">      Commit = &quot;fcad969e5200607df3b0b31983cc64488e156e99&quot;</span><br><span class="line">      Major = 2</span><br><span class="line">      Minor = 4</span><br><span class="line">      Patch = 3</span><br><span class="line"></span><br><span class="line">[Host]</span><br><span class="line">  Kernel = &quot;3.10.0-957.10.5.el7.x86_64&quot;</span><br><span class="line">  Architecture = &quot;amd64&quot;</span><br><span class="line">  VMContainerCapable = true</span><br><span class="line">  SupportVSocks = true</span><br><span class="line">  [Host.Distro]</span><br><span class="line">    Name = &quot;ArcherOS OS&quot;</span><br><span class="line">    Version = &quot;1.6&quot;</span><br><span class="line">  [Host.CPU]</span><br><span class="line">    Vendor = &quot;GenuineIntel&quot;</span><br><span class="line">    Model = &quot;Intel(R) Xeon(R) CPU E5-2650 v4 @ 2.20GHz&quot;</span><br><span class="line">    CPUs = 48</span><br><span class="line">  [Host.Memory]</span><br><span class="line">    Total = 131447232</span><br><span class="line">    Free = 62496172</span><br><span class="line">    Available = 63926992</span><br><span class="line"></span><br><span class="line">[Agent]</span><br><span class="line">  Debug = false</span><br><span class="line">  Trace = false</span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„ flags åŒ…æ‹¬</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>â€“json</td>
<td>ä»¥ JSON æ ¼å¼å±•ç¤º</td>
</tr>
</tbody></table>
<h2 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯¹äº Pod è€Œè¨€æ˜¯å…¶ SandboxID</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime <span class="built_in">exec</span> 27ab74433f11c0b64e404a841d5e2f8296a723ebfa4e598b4d9d32871173b82c</span></span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„ flags åŒ…æ‹¬</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>â€“kata-debug-port</td>
<td>debug console ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 1026 æˆ–è€… 0</td>
</tr>
</tbody></table>
<h2 id="metrics"><a href="#metrics" class="headerlink" title="metrics"></a>metrics</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯¹äº Pod è€Œè¨€æ˜¯å…¶ SandboxID</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime metrics 27ab74433f11c0b64e404a841d5e2f8296a723ebfa4e598b4d9d32871173b82c</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HELP kata_hypervisor_fds Open FDs <span class="keyword">for</span> hypervisor.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TYPE kata_hypervisor_fds gauge</span></span><br><span class="line">kata_hypervisor_fds 122</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HELP kata_hypervisor_io_stat Process IO statistics.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TYPE kata_hypervisor_io_stat gauge</span></span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;cancelledwritebytes&quot;&#125; 0</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;rchar&quot;&#125; 5.915546e+06</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;readbytes&quot;&#125; 1.1665408e+07</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;syscr&quot;&#125; 95522</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;syscw&quot;&#125; 202276</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;wchar&quot;&#125; 3.715404e+06</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;writebytes&quot;&#125; 2.097152e+06</span><br></pre></td></tr></table></figure>

<h2 id="direct-volume"><a href="#direct-volume" class="headerlink" title="direct-volume"></a>direct-volume</h2><h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime direct-volume add --volume-path /var/lib/kubelet/pods/8c3d29ad-84b8-45f0-9fcc-8e16778cb3cb/volumes/kubernetes.io~csi/pvc-a950ed68-622c-4ec4-81fa-506f16de2196/mount --mount-info \&#123;\&quot;volume-type\&quot;:\&quot;block\&quot;,\&quot;device\&quot;:\&quot;/dev/sdm\&quot;,\&quot;fstype\&quot;:\&quot;xfs\&quot;\&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„ flags åŒ…æ‹¬</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>â€“volume-path</td>
<td>å¾…æ“ä½œçš„ç›®æ ‡å·è·¯å¾„</td>
</tr>
<tr>
<td>â€“mount-info</td>
<td>ç®¡ç†å·æŒ‚è½½çš„è¯¦æƒ…ä¿¡æ¯</td>
</tr>
</tbody></table>
<h3 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime direct-volume delete --volume-path /var/lib/kubelet/pods/8c3d29ad-84b8-45f0-9fcc-8e16778cb3cb/volumes/kubernetes.io~csi/pvc-a950ed68-622c-4ec4-81fa-506f16de2196/mount</span></span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„ flags åŒ…æ‹¬</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>â€“volume-path</td>
<td>å¾…æ“ä½œçš„ç›®æ ‡å·è·¯å¾„</td>
</tr>
</tbody></table>
<h3 id="stats"><a href="#stats" class="headerlink" title="stats"></a>stats</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime direct-volume stats --volume-path /var/lib/kubelet/pods/8c3d29ad-84b8-45f0-9fcc-8e16778cb3cb/volumes/kubernetes.io~csi/pvc-a950ed68-622c-4ec4-81fa-506f16de2196/mount</span></span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„ flags åŒ…æ‹¬</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>â€“volume-path</td>
<td>å¾…æ“ä½œçš„ç›®æ ‡å·è·¯å¾„</td>
</tr>
</tbody></table>
<h3 id="resize"><a href="#resize" class="headerlink" title="resize"></a>resize</h3><p><em>æˆªè‡³ Kata Containers 2.4.3ï¼Œç¤¾åŒºä»æœªå®ç°</em></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime direct-volume resize --volume-path /var/lib/kubelet/pods/8c3d29ad-84b8-45f0-9fcc-8e16778cb3cb/volumes/kubernetes.io~csi/pvc-a950ed68-622c-4ec4-81fa-506f16de2196/mount --size 1756519562</span></span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„ flags åŒ…æ‹¬</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>â€“volume-path</td>
<td>å¾…æ“ä½œçš„ç›®æ ‡å·è·¯å¾„</td>
</tr>
<tr>
<td>â€“size</td>
<td>è°ƒæ•´åçš„é¢„æœŸå·å¤§å°ï¼ˆå•ä½ä¸ºï¼šByteï¼‰</td>
</tr>
</tbody></table>
<h2 id="factory"><a href="#factory" class="headerlink" title="factory"></a>factory</h2><h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kata-runtime factory init</span><br><span class="line">vm factory initialized</span><br></pre></td></tr></table></figure>

<h3 id="status"><a href="#status" class="headerlink" title="status"></a>status</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kata-runtime factory status</span><br><span class="line">vm factory is on</span><br></pre></td></tr></table></figure>

<h3 id="destroy"><a href="#destroy" class="headerlink" title="destroy"></a>destroy</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kata-runtime factory destroy</span><br><span class="line">vm factory destroyed</span><br></pre></td></tr></table></figure>

<h2 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h2><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime iptables get --sandbox-id xxx --v6</span></span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„ flags åŒ…æ‹¬</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>â€“sandbox-id</td>
<td>å¾…æ“ä½œçš„ Sandbox ID</td>
</tr>
<tr>
<td>â€“v6</td>
<td>è·å– IPV6 çš„ iptables</td>
</tr>
</tbody></table>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime iptables <span class="built_in">set</span> --sandbox-id xxx --v6 ./iptables</span></span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„ flags åŒ…æ‹¬</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>â€“sandbox-id</td>
<td>å¾…æ“ä½œçš„ Sandbox ID</td>
</tr>
<tr>
<td>â€“v6</td>
<td>è®¾ç½® IPV6 çš„ iptables</td>
</tr>
</tbody></table>
<h1 id="kata-monitor"><a href="#kata-monitor" class="headerlink" title="kata-monitor"></a>kata-monitor</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-monitor</span></span><br><span class="line">INFO[0000] announce                                      app=kata-monitor arch=amd64 git-commit=fcad969e5200607df3b0b31983cc64488e156e99 go-version=go1.16.10 listen-address=&quot;127.0.0.1:8090&quot; log-level=info os=linux runtime-endpoint=/run/containerd/containerd.sock version=0.3.0</span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„ flags åŒ…æ‹¬</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>â€“listen-address</td>
<td>ç›‘å¬ HTTP è¯·æ±‚çš„åœ°å€ï¼Œé»˜è®¤ä¸º 127.0.0.1:8090</td>
</tr>
<tr>
<td>â€“log-level</td>
<td>æœåŠ¡æ—¥å¿—çº§åˆ«ï¼Œå¯é€‰æœ‰ trace&#x2F;debug&#x2F;info&#x2F;warn&#x2F;error&#x2F;fatal&#x2F;panicï¼Œé»˜è®¤ä¸º info</td>
</tr>
<tr>
<td>â€“runtime-endpoint</td>
<td>CRI å®¹å™¨è¿è¡Œæ—¶æœåŠ¡çš„ socket åœ°å€ï¼Œé»˜è®¤ä¸º &#x2F;run&#x2F;containerd&#x2F;containerd.sock</td>
</tr>
</tbody></table>
</div><div class="article-licensing box"><div class="licensing-title"><p>ã€Œ Kata Containers ã€å¿«é€Ÿå¼€å§‹</p><p><a href="http://shenxianghong.github.io/2021/04/15/2021-04-15 Kata Containers å¿«é€Ÿå¼€å§‹/">http://shenxianghong.github.io/2021/04/15/2021-04-15 Kata Containers å¿«é€Ÿå¼€å§‹/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Shen Xianghong</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-04-15</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-05-29</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i>Â <a class="link-muted" rel="tag" href="/tags/Kata-Containers/">Kata Containers </a></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/04/22/2021-04-22%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">ã€Œ Kata Containers ã€æºç ç¼–è¯‘</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/04/06/2021-04-06%20Kata%20Containers%20%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%BB%84%E4%BB%B6%E6%A6%82%E8%BF%B0/"><span class="level-item">ã€Œ Kata Containers ã€æ¶æ„ä¸ç»„ä»¶æ¦‚è¿°</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars.githubusercontent.com/u/35031258?v=4" alt="ğŸ¾Corgi"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">ğŸ¾Corgi</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">50</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">9</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/shenxianghong" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Youtube" href="https://youtube.com"><i class="fab fa-youtube"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Bilibili" href="https://bilibili.com"><i class="fab fa-bilibili"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Reddit" href="https://reddit.com"><i class="fab fa-reddit"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://google.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Google</span></span><span class="level-right"><span class="level-item tag">google.com</span></span></a></li><li><a class="level is-mobile" href="https://poe.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Poe</span></span><span class="level-right"><span class="level-item tag">poe.com</span></span></a></li></ul></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#å®‰è£…"><span class="level-left"><span class="level-item">1</span><span class="level-item">å®‰è£…</span></span></a></li><li><a class="level is-mobile" href="#é…ç½®å‚æ•°"><span class="level-left"><span class="level-item">2</span><span class="level-item">é…ç½®å‚æ•°</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#hypervisor"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">hypervisor</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#QEMU"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">QEMU</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#CRI-é…ç½®"><span class="level-left"><span class="level-item">3</span><span class="level-item">CRI é…ç½®</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Containerd"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">Containerd</span></span></a></li><li><a class="level is-mobile" href="#CRI-O"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">CRI-O</span></span></a></li></ul></li><li><a class="level is-mobile" href="#RuntimeClass"><span class="level-left"><span class="level-item">4</span><span class="level-item">RuntimeClass</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#handler"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">handler</span></span></a></li><li><a class="level is-mobile" href="#scheduling"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">scheduling</span></span></a></li><li><a class="level is-mobile" href="#overhead"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">overhead</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Pod"><span class="level-left"><span class="level-item">5</span><span class="level-item">Pod</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#å®šåˆ¶åŒ–çš„-annotation"><span class="level-left"><span class="level-item">5.1.1</span><span class="level-item">å®šåˆ¶åŒ–çš„ annotation</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#VMCache"><span class="level-left"><span class="level-item">6</span><span class="level-item">VMCache</span></span></a></li><li><a class="level is-mobile" href="#VM-Templating"><span class="level-left"><span class="level-item">7</span><span class="level-item">VM Templating</span></span></a></li><li><a class="level is-mobile" href="#kata-runtime"><span class="level-left"><span class="level-item">8</span><span class="level-item">kata-runtime</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#check-kata-check"><span class="level-left"><span class="level-item">8.1</span><span class="level-item">check (kata-check)</span></span></a></li><li><a class="level is-mobile" href="#env-kata-env"><span class="level-left"><span class="level-item">8.2</span><span class="level-item">env (kata-env)</span></span></a></li><li><a class="level is-mobile" href="#exec"><span class="level-left"><span class="level-item">8.3</span><span class="level-item">exec</span></span></a></li><li><a class="level is-mobile" href="#metrics"><span class="level-left"><span class="level-item">8.4</span><span class="level-item">metrics</span></span></a></li><li><a class="level is-mobile" href="#direct-volume"><span class="level-left"><span class="level-item">8.5</span><span class="level-item">direct-volume</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#add"><span class="level-left"><span class="level-item">8.5.1</span><span class="level-item">add</span></span></a></li><li><a class="level is-mobile" href="#remove"><span class="level-left"><span class="level-item">8.5.2</span><span class="level-item">remove</span></span></a></li><li><a class="level is-mobile" href="#stats"><span class="level-left"><span class="level-item">8.5.3</span><span class="level-item">stats</span></span></a></li><li><a class="level is-mobile" href="#resize"><span class="level-left"><span class="level-item">8.5.4</span><span class="level-item">resize</span></span></a></li></ul></li><li><a class="level is-mobile" href="#factory"><span class="level-left"><span class="level-item">8.6</span><span class="level-item">factory</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#init"><span class="level-left"><span class="level-item">8.6.1</span><span class="level-item">init</span></span></a></li><li><a class="level is-mobile" href="#status"><span class="level-left"><span class="level-item">8.6.2</span><span class="level-item">status</span></span></a></li><li><a class="level is-mobile" href="#destroy"><span class="level-left"><span class="level-item">8.6.3</span><span class="level-item">destroy</span></span></a></li></ul></li><li><a class="level is-mobile" href="#iptables"><span class="level-left"><span class="level-item">8.7</span><span class="level-item">iptables</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#get"><span class="level-left"><span class="level-item">8.7.1</span><span class="level-item">get</span></span></a></li><li><a class="level is-mobile" href="#set"><span class="level-left"><span class="level-item">8.7.2</span><span class="level-item">set</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#kata-monitor"><span class="level-left"><span class="level-item">9</span><span class="level-item">kata-monitor</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Container-Runtime/"><span class="level-start"><span class="level-item">Container Runtime</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Disaster-Recovery/"><span class="level-start"><span class="level-item">Disaster Recovery</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Scheduling-Orchestration/"><span class="level-start"><span class="level-item">Scheduling &amp; Orchestration</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/Scheduling-Orchestration/Kubernetes/"><span class="level-start"><span class="level-item">Kubernetes</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Serverless/"><span class="level-start"><span class="level-item">Serverless</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Service-Mesh/"><span class="level-start"><span class="level-item">Service Mesh</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="ğŸ¾Corgi" height="28"></a><p class="is-size-7"><span>&copy; 2023 Shen Xianghong</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p><p class="is-size-7"><br/>And did you get what you wanted from this life, even so?</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>