<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>「 Kata Containers 」基础使用 - 🐾Corgi</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="🐾Corgi"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="🐾Corgi"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Kata Containers 基础使用示例"><meta property="og:type" content="blog"><meta property="og:title" content="「 Kata Containers 」基础使用"><meta property="og:url" content="http://shenxianghong.github.io/2021/04/15/2021-04-15%20Kata%20Containers%20%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"><meta property="og:site_name" content="🐾Corgi"><meta property="og:description" content="Kata Containers 基础使用示例"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://picsum.photos/0?sig=20210415"><meta property="article:published_time" content="2021-04-14T16:00:00.000Z"><meta property="article:modified_time" content="2023-05-08T03:01:16.737Z"><meta property="article:author" content="Shen Xianghong"><meta property="article:tag" content="Kata Containers"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://picsum.photos/0?sig=20210415"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://shenxianghong.github.io/2021/04/15/2021-04-15%20Kata%20Containers%20%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"},"headline":"「 Kata Containers 」基础使用","image":[],"datePublished":"2021-04-14T16:00:00.000Z","dateModified":"2023-05-08T03:01:16.737Z","author":{"@type":"Person","name":"Shen Xianghong"},"publisher":{"@type":"Organization","name":"🐾Corgi","logo":{"@type":"ImageObject","url":"http://shenxianghong.github.io/img/logo.svg"}},"description":"Kata Containers 基础使用示例"}</script><link rel="canonical" href="http://shenxianghong.github.io/2021/04/15/2021-04-15%20Kata%20Containers%20%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"><link rel="alternate" href="/atom.xml" title="🐾Corgi" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/xcode.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="🐾Corgi" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://picsum.photos/0?sig=20210415" alt="「 Kata Containers 」基础使用"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="fa fa-calendar"></i> <time dateTime="${date_xml(page.date)}" title="${date_xml(page.date)}">2021-04-15</time></span><span class="level-item"><i class="fa fa-calendar-check"></i> <time dateTime="${date_xml(page.updated)}" title="${date_xml(page.updated)}">2023-05-08</time></span><span class="level-item"><i class="far fa-folder-open"></i> <a class="link-muted" href="/categories/Container-Runtime/">Container Runtime</a></span><span class="level-item"><i class="far fa-clock"></i> an hour read (About 9766 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">「 Kata Containers 」基础使用</h1><div class="content"><div align=center><img width="200" style="border: 0px" src="https://katacontainers.io/static/logo-a1e2d09ad097b3fc8536cb77aa615c42.svg"></div>

<hr>
<blockquote>
<p>Based on <strong>v3.0.0</strong></p>
</blockquote>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>Kata Containers 社区仅提供了 x86 架构的制品，arm64 架构需要手动编译。这里以 x86 架构下的社区制品安装为例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wget https://github.com/kata-containers/kata-containers/releases/download/3.0.0/kata-static-3.0.0-x86_64.tar.xz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tar -xvf kata-static-3.0.0-x86_64.tar.xz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> -r ./opt/kata /opt</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> -r ./opt/kata/bin/kata-runtime /usr/local/bin</span></span><br></pre></td></tr></table></figure>

<p><strong>校验</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime check</span></span><br><span class="line">WARN[0000] Not running network checks as super user      arch=amd64 name=kata-runtime pid=18456 source=runtime</span><br><span class="line">System is capable of running Kata Containers</span><br><span class="line">System can currently create Kata Containers</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime <span class="built_in">env</span></span></span><br><span class="line">[Kernel]</span><br><span class="line">  Path = &quot;/opt/kata/share/kata-containers/vmlinux-5.19.2-96&quot;</span><br><span class="line">  Parameters = &quot;systemd.unit=kata-containers.target systemd.mask=systemd-networkd.service systemd.mask=systemd-networkd.socket scsi_mod.scan=none&quot;</span><br><span class="line"></span><br><span class="line">[Meta]</span><br><span class="line">  Version = &quot;1.0.26&quot;</span><br><span class="line"></span><br><span class="line">[Image]</span><br><span class="line">  Path = &quot;/opt/kata/share/kata-containers/kata-clearlinux-latest.image&quot;</span><br><span class="line"></span><br><span class="line">[Initrd]</span><br><span class="line">  Path = &quot;&quot;</span><br><span class="line"></span><br><span class="line">[Hypervisor]</span><br><span class="line">  MachineType = &quot;q35&quot;</span><br><span class="line">  Version = &quot;QEMU emulator version 6.2.0 (kata-static)\nCopyright (c) 2003-2021 Fabrice Bellard and the QEMU Project developers&quot;</span><br><span class="line">  Path = &quot;/opt/kata/bin/qemu-system-x86_64&quot;</span><br><span class="line">  BlockDeviceDriver = &quot;virtio-scsi&quot;</span><br><span class="line">  EntropySource = &quot;/dev/urandom&quot;</span><br><span class="line">  SharedFS = &quot;virtio-fs&quot;</span><br><span class="line">  VirtioFSDaemon = &quot;/opt/kata/libexec/virtiofsd&quot;</span><br><span class="line">  SocketPath = &quot;&quot;</span><br><span class="line">  Msize9p = 8192</span><br><span class="line">  MemorySlots = 10</span><br><span class="line">  PCIeRootPort = 0</span><br><span class="line">  HotplugVFIOOnRootBus = false</span><br><span class="line">  Debug = false</span><br><span class="line"></span><br><span class="line">[Runtime]</span><br><span class="line">  Path = &quot;/usr/local/bin/kata-runtime&quot;</span><br><span class="line">  Debug = false</span><br><span class="line">  Trace = false</span><br><span class="line">  DisableGuestSeccomp = true</span><br><span class="line">  DisableNewNetNs = false</span><br><span class="line">  SandboxCgroupOnly = false</span><br><span class="line">  [Runtime.Config]</span><br><span class="line">    Path = &quot;/opt/kata/share/defaults/kata-containers/configuration-qemu.toml&quot;</span><br><span class="line">  [Runtime.Version]</span><br><span class="line">    OCI = &quot;1.0.2-dev&quot;</span><br><span class="line">    [Runtime.Version.Version]</span><br><span class="line">      Semver = &quot;3.0.0&quot;</span><br><span class="line">      Commit = &quot;e2a8815ba46360acb8bf89a2894b0d437dc8548a&quot;</span><br><span class="line">      Major = 3</span><br><span class="line">      Minor = 0</span><br><span class="line">      Patch = 0</span><br><span class="line"></span><br><span class="line">[Host]</span><br><span class="line">  Kernel = &quot;3.10.0-957.10.4.el7.x86_64&quot;</span><br><span class="line">  Architecture = &quot;amd64&quot;</span><br><span class="line">  VMContainerCapable = true</span><br><span class="line">  SupportVSocks = true</span><br><span class="line">  [Host.Distro]</span><br><span class="line">    Name = &quot;CentOS Linux&quot;</span><br><span class="line">    Version = &quot;7&quot;</span><br><span class="line">  [Host.CPU]</span><br><span class="line">    Vendor = &quot;GenuineIntel&quot;</span><br><span class="line">    Model = &quot;QEMU Virtual CPU version (cpu64-rhel6)&quot;</span><br><span class="line">    CPUs = 4</span><br><span class="line">  [Host.Memory]</span><br><span class="line">    Total = 7989988</span><br><span class="line">    Free = 2159220</span><br><span class="line">    Available = 5454100</span><br><span class="line"></span><br><span class="line">[Agent]</span><br><span class="line">  Debug = false</span><br><span class="line">  Trace = false</span><br></pre></td></tr></table></figure>

<p><strong>默认配置</strong></p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright (c) 2017-2019 Intel Corporation</span></span><br><span class="line"><span class="comment"># Copyright (c) 2021 Adobe Inc.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">XXX:</span> WARNING: this file is auto-generated.</span></span><br><span class="line"><span class="comment"># <span class="doctag">XXX:</span></span></span><br><span class="line"><span class="comment"># <span class="doctag">XXX:</span> Source file: &quot;config/configuration-qemu.toml.in&quot;</span></span><br><span class="line"><span class="comment"># <span class="doctag">XXX:</span> Project:</span></span><br><span class="line"><span class="comment"># <span class="doctag">XXX:</span>   Name: Kata Containers</span></span><br><span class="line"><span class="comment"># <span class="doctag">XXX:</span>   Type: kata</span></span><br><span class="line"></span><br><span class="line"><span class="section">[hypervisor.qemu]</span></span><br><span class="line"><span class="attr">path</span> = <span class="string">&quot;/opt/kata/bin/qemu-system-x86_64&quot;</span></span><br><span class="line"><span class="attr">kernel</span> = <span class="string">&quot;/opt/kata/share/kata-containers/vmlinux.container&quot;</span></span><br><span class="line"><span class="attr">image</span> = <span class="string">&quot;/opt/kata/share/kata-containers/kata-containers.img&quot;</span></span><br><span class="line"><span class="attr">machine_type</span> = <span class="string">&quot;q35&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable confidential guest support.</span></span><br><span class="line"><span class="comment"># Toggling that setting may trigger different hardware features, ranging</span></span><br><span class="line"><span class="comment"># from memory encryption to both memory and CPU-state encryption and integrity.</span></span><br><span class="line"><span class="comment"># The Kata Containers runtime dynamically detects the available feature set and</span></span><br><span class="line"><span class="comment"># aims at enabling the largest possible one, returning an error if none is</span></span><br><span class="line"><span class="comment"># available, or none is supported by the hypervisor.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Known limitations:</span></span><br><span class="line"><span class="comment"># * Does not work by design:</span></span><br><span class="line"><span class="comment">#   - CPU Hotplug</span></span><br><span class="line"><span class="comment">#   - Memory Hotplug</span></span><br><span class="line"><span class="comment">#   - NVDIMM devices</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default false</span></span><br><span class="line"><span class="comment"># confidential_guest = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable running QEMU VMM as a non-root user.</span></span><br><span class="line"><span class="comment"># By default QEMU VMM run as root. When this is set to true, QEMU VMM process runs as</span></span><br><span class="line"><span class="comment"># a non-root random user. See documentation for the limitations of this mode.</span></span><br><span class="line"><span class="comment"># rootless = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># List of valid annotation names for the hypervisor</span></span><br><span class="line"><span class="comment"># Each member of the list is a regular expression, which is the base name</span></span><br><span class="line"><span class="comment"># of the annotation, e.g. &quot;path&quot; for io.katacontainers.config.hypervisor.path&quot;</span></span><br><span class="line"><span class="attr">enable_annotations</span> = [<span class="string">&quot;enable_iommu&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># List of valid annotations values for the hypervisor</span></span><br><span class="line"><span class="comment"># Each member of the list is a path pattern as described by glob(3).</span></span><br><span class="line"><span class="comment"># The default if not set is empty (all annotations rejected.)</span></span><br><span class="line"><span class="comment"># Your distribution recommends: [&quot;/opt/kata/bin/qemu-system-x86_64&quot;]</span></span><br><span class="line"><span class="attr">valid_hypervisor_paths</span> = [<span class="string">&quot;/opt/kata/bin/qemu-system-x86_64&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Optional space-separated list of options to pass to the guest kernel.</span></span><br><span class="line"><span class="comment"># For example, use `kernel_params = &quot;vsyscall=emulate&quot;` if you are having</span></span><br><span class="line"><span class="comment"># trouble running pre-2.15 glibc.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># WARNING: - any parameter specified here will take priority over the default</span></span><br><span class="line"><span class="comment"># parameter value of the same name used to start the virtual machine.</span></span><br><span class="line"><span class="comment"># Do not set values here unless you understand the impact of doing so as you</span></span><br><span class="line"><span class="comment"># may stop the virtual machine from booting.</span></span><br><span class="line"><span class="comment"># To see the list of default parameters, enable hypervisor debug, create a</span></span><br><span class="line"><span class="comment"># container and look for &#x27;default-kernel-parameters&#x27; log entries.</span></span><br><span class="line"><span class="attr">kernel_params</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to the firmware.</span></span><br><span class="line"><span class="comment"># If you want that qemu uses the default firmware leave this option empty</span></span><br><span class="line"><span class="attr">firmware</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to the firmware volume.</span></span><br><span class="line"><span class="comment"># firmware TDVF or OVMF can be split into FIRMWARE_VARS.fd (UEFI variables</span></span><br><span class="line"><span class="comment"># as configuration) and FIRMWARE_CODE.fd (UEFI program image). UEFI variables</span></span><br><span class="line"><span class="comment"># can be customized per each user while UEFI code is kept same.</span></span><br><span class="line"><span class="attr">firmware_volume</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Machine accelerators</span></span><br><span class="line"><span class="comment"># comma-separated list of machine accelerators to pass to the hypervisor.</span></span><br><span class="line"><span class="comment"># For example, `machine_accelerators = &quot;nosmm,nosmbus,nosata,nopit,static-prt,nofw&quot;`</span></span><br><span class="line"><span class="attr">machine_accelerators</span>=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Qemu seccomp sandbox feature</span></span><br><span class="line"><span class="comment"># comma-separated list of seccomp sandbox features to control the syscall access.</span></span><br><span class="line"><span class="comment"># For example, `seccompsandbox= &quot;on,obsolete=deny,spawn=deny,resourcecontrol=deny&quot;`</span></span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span> &quot;elevateprivileges=deny&quot; doesn&#x27;t work with daemonize option, so it&#x27;s removed from the seccomp sandbox</span></span><br><span class="line"><span class="comment"># Another note: enabling this feature may reduce performance, you may enable</span></span><br><span class="line"><span class="comment"># /proc/sys/net/core/bpf_jit_enable to reduce the impact. see https://man7.org/linux/man-pages/man8/bpfc.8.html</span></span><br><span class="line"><span class="comment">#seccompsandbox=&quot;on,obsolete=deny,spawn=deny,resourcecontrol=deny&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU features</span></span><br><span class="line"><span class="comment"># comma-separated list of cpu features to pass to the cpu</span></span><br><span class="line"><span class="comment"># For example, `cpu_features = &quot;pmu=off,vmx=off&quot;</span></span><br><span class="line"><span class="attr">cpu_features</span>=<span class="string">&quot;pmu=off&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default number of vCPUs per SB/VM:</span></span><br><span class="line"><span class="comment"># unspecified or 0                --&gt; will be set to 1</span></span><br><span class="line"><span class="comment"># &lt; 0                             --&gt; will be set to the actual number of physical cores</span></span><br><span class="line"><span class="comment"># &gt; 0 &lt;= number of physical cores --&gt; will be set to the specified number</span></span><br><span class="line"><span class="comment"># &gt; number of physical cores      --&gt; will be set to the actual number of physical cores</span></span><br><span class="line"><span class="attr">default_vcpus</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default maximum number of vCPUs per SB/VM:</span></span><br><span class="line"><span class="comment"># unspecified or == 0             --&gt; will be set to the actual number of physical cores or to the maximum number</span></span><br><span class="line"><span class="comment">#                                     of vCPUs supported by KVM if that number is exceeded</span></span><br><span class="line"><span class="comment"># &gt; 0 &lt;= number of physical cores --&gt; will be set to the specified number</span></span><br><span class="line"><span class="comment"># &gt; number of physical cores      --&gt; will be set to the actual number of physical cores or to the maximum number</span></span><br><span class="line"><span class="comment">#                                     of vCPUs supported by KVM if that number is exceeded</span></span><br><span class="line"><span class="comment"># WARNING: Depending of the architecture, the maximum number of vCPUs supported by KVM is used when</span></span><br><span class="line"><span class="comment"># the actual number of physical cores is greater than it.</span></span><br><span class="line"><span class="comment"># WARNING: Be aware that this value impacts the virtual machine&#x27;s memory footprint and CPU</span></span><br><span class="line"><span class="comment"># the hotplug functionality. For example, `default_maxvcpus = 240` specifies that until 240 vCPUs</span></span><br><span class="line"><span class="comment"># can be added to a SB/VM, but the memory footprint will be big. Another example, with</span></span><br><span class="line"><span class="comment"># `default_maxvcpus = 8` the memory footprint will be small, but 8 will be the maximum number of</span></span><br><span class="line"><span class="comment"># vCPUs supported by the SB/VM. In general, we recommend that you do not edit this variable,</span></span><br><span class="line"><span class="comment"># unless you know what are you doing.</span></span><br><span class="line"><span class="comment"># NOTICE: on arm platform with gicv2 interrupt controller, set it to 8.</span></span><br><span class="line"><span class="attr">default_maxvcpus</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bridges can be used to hot plug devices.</span></span><br><span class="line"><span class="comment"># Limitations:</span></span><br><span class="line"><span class="comment"># * Currently only pci bridges are supported</span></span><br><span class="line"><span class="comment"># * Until 30 devices per bridge can be hot plugged.</span></span><br><span class="line"><span class="comment"># * Until 5 PCI bridges can be cold plugged per VM.</span></span><br><span class="line"><span class="comment">#   This limitation could be a bug in qemu or in the kernel</span></span><br><span class="line"><span class="comment"># Default number of bridges per SB/VM:</span></span><br><span class="line"><span class="comment"># unspecified or 0   --&gt; will be set to 1</span></span><br><span class="line"><span class="comment"># &gt; 1 &lt;= 5           --&gt; will be set to the specified number</span></span><br><span class="line"><span class="comment"># &gt; 5                --&gt; will be set to 5</span></span><br><span class="line"><span class="attr">default_bridges</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default memory size in MiB for SB/VM.</span></span><br><span class="line"><span class="comment"># If unspecified then it will be set 2048 MiB.</span></span><br><span class="line"><span class="attr">default_memory</span> = <span class="number">2048</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default memory slots per SB/VM.</span></span><br><span class="line"><span class="comment"># If unspecified then it will be set 10.</span></span><br><span class="line"><span class="comment"># This is will determine the times that memory will be hotadded to sandbox/VM.</span></span><br><span class="line"><span class="comment">#memory_slots = 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default maximum memory in MiB per SB / VM</span></span><br><span class="line"><span class="comment"># unspecified or == 0           --&gt; will be set to the actual amount of physical RAM</span></span><br><span class="line"><span class="comment"># &gt; 0 &lt;= amount of physical RAM --&gt; will be set to the specified number</span></span><br><span class="line"><span class="comment"># &gt; amount of physical RAM      --&gt; will be set to the actual amount of physical RAM</span></span><br><span class="line"><span class="attr">default_maxmemory</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The size in MiB will be plused to max memory of hypervisor.</span></span><br><span class="line"><span class="comment"># It is the memory address space for the NVDIMM devie.</span></span><br><span class="line"><span class="comment"># If set block storage driver (block_device_driver) to &quot;nvdimm&quot;,</span></span><br><span class="line"><span class="comment"># should set memory_offset to the size of block device.</span></span><br><span class="line"><span class="comment"># Default 0</span></span><br><span class="line"><span class="comment">#memory_offset = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies virtio-mem will be enabled or not.</span></span><br><span class="line"><span class="comment"># Please note that this option should be used with the command</span></span><br><span class="line"><span class="comment"># &quot;echo 1 &gt; /proc/sys/vm/overcommit_memory&quot;.</span></span><br><span class="line"><span class="comment"># Default false</span></span><br><span class="line"><span class="comment">#enable_virtio_mem = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable block device from being used for a container&#x27;s rootfs.</span></span><br><span class="line"><span class="comment"># In case of a storage driver like devicemapper where a container&#x27;s</span></span><br><span class="line"><span class="comment"># root file system is backed by a block device, the block device is passed</span></span><br><span class="line"><span class="comment"># directly to the hypervisor for performance reasons.</span></span><br><span class="line"><span class="comment"># This flag prevents the block device from being passed to the hypervisor,</span></span><br><span class="line"><span class="comment"># virtio-fs is used instead to pass the rootfs.</span></span><br><span class="line"><span class="attr">disable_block_device_use</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Shared file system type:</span></span><br><span class="line"><span class="comment">#   - virtio-fs (default)</span></span><br><span class="line"><span class="comment">#   - virtio-9p</span></span><br><span class="line"><span class="comment">#   - virtio-fs-nydus</span></span><br><span class="line"><span class="attr">shared_fs</span> = <span class="string">&quot;virtio-fs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to vhost-user-fs daemon.</span></span><br><span class="line"><span class="attr">virtio_fs_daemon</span> = <span class="string">&quot;/opt/kata/libexec/virtiofsd&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># List of valid annotations values for the virtiofs daemon</span></span><br><span class="line"><span class="comment"># The default if not set is empty (all annotations rejected.)</span></span><br><span class="line"><span class="comment"># Your distribution recommends: [&quot;/opt/kata/libexec/virtiofsd&quot;]</span></span><br><span class="line"><span class="attr">valid_virtio_fs_daemon_paths</span> = [<span class="string">&quot;/opt/kata/libexec/virtiofsd&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Default size of DAX cache in MiB</span></span><br><span class="line"><span class="attr">virtio_fs_cache_size</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extra args for virtiofsd daemon</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Format example:</span></span><br><span class="line"><span class="comment">#   [&quot;-o&quot;, &quot;arg1=xxx,arg2&quot;, &quot;-o&quot;, &quot;hello world&quot;, &quot;--arg3=yyy&quot;]</span></span><br><span class="line"><span class="comment"># Examples:</span></span><br><span class="line"><span class="comment">#   Set virtiofsd log level to debug : [&quot;-o&quot;, &quot;log_level=debug&quot;] or [&quot;-d&quot;]</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># see `virtiofsd -h` for possible options.</span></span><br><span class="line"><span class="attr">virtio_fs_extra_args</span> = [<span class="string">&quot;--thread-pool-size=1&quot;</span>, <span class="string">&quot;-o&quot;</span>, <span class="string">&quot;announce_submounts&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cache mode:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  - none</span></span><br><span class="line"><span class="comment">#    Metadata, data, and pathname lookup are not cached in guest. They are</span></span><br><span class="line"><span class="comment">#    always fetched from host and any changes are immediately pushed to host.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  - auto</span></span><br><span class="line"><span class="comment">#    Metadata and pathname lookup cache expires after a configured amount of</span></span><br><span class="line"><span class="comment">#    time (default is 1 second). Data is cached while the file is open (close</span></span><br><span class="line"><span class="comment">#    to open consistency).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  - always</span></span><br><span class="line"><span class="comment">#    Metadata, data, and pathname lookup are cached in guest and never expire.</span></span><br><span class="line"><span class="attr">virtio_fs_cache</span> = <span class="string">&quot;auto&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Block storage driver to be used for the hypervisor in case the container</span></span><br><span class="line"><span class="comment"># rootfs is backed by a block device. This is virtio-scsi, virtio-blk</span></span><br><span class="line"><span class="comment"># or nvdimm.</span></span><br><span class="line"><span class="attr">block_device_driver</span> = <span class="string">&quot;virtio-scsi&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># aio is the I/O mechanism used by qemu</span></span><br><span class="line"><span class="comment"># Options:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - threads</span></span><br><span class="line"><span class="comment">#     Pthread based disk I/O.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - native</span></span><br><span class="line"><span class="comment">#     Native Linux I/O.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - io_uring</span></span><br><span class="line"><span class="comment">#     Linux io_uring API. This provides the fastest I/O operations on Linux, requires kernel&gt;5.1 and</span></span><br><span class="line"><span class="comment">#     qemu &gt;=5.0.</span></span><br><span class="line"><span class="attr">block_device_aio</span> = <span class="string">&quot;io_uring&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies cache-related options will be set to block devices or not.</span></span><br><span class="line"><span class="comment"># Default false</span></span><br><span class="line"><span class="comment">#block_device_cache_set = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies cache-related options for block devices.</span></span><br><span class="line"><span class="comment"># Denotes whether use of O_DIRECT (bypass the host page cache) is enabled.</span></span><br><span class="line"><span class="comment"># Default false</span></span><br><span class="line"><span class="comment">#block_device_cache_direct = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies cache-related options for block devices.</span></span><br><span class="line"><span class="comment"># Denotes whether flush requests for the device are ignored.</span></span><br><span class="line"><span class="comment"># Default false</span></span><br><span class="line"><span class="comment">#block_device_cache_noflush = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable iothreads (data-plane) to be used. This causes IO to be</span></span><br><span class="line"><span class="comment"># handled in a separate IO thread. This is currently only implemented</span></span><br><span class="line"><span class="comment"># for SCSI.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">enable_iothreads</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable pre allocation of VM RAM, default false</span></span><br><span class="line"><span class="comment"># Enabling this will result in lower container density</span></span><br><span class="line"><span class="comment"># as all of the memory will be allocated and locked</span></span><br><span class="line"><span class="comment"># This is useful when you want to reserve all the memory</span></span><br><span class="line"><span class="comment"># upfront or in the cases where you want memory latencies</span></span><br><span class="line"><span class="comment"># to be very predictable</span></span><br><span class="line"><span class="comment"># Default false</span></span><br><span class="line"><span class="comment">#enable_mem_prealloc = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable huge pages for VM RAM, default false</span></span><br><span class="line"><span class="comment"># Enabling this will result in the VM memory</span></span><br><span class="line"><span class="comment"># being allocated using huge pages.</span></span><br><span class="line"><span class="comment"># This is useful when you want to use vhost-user network</span></span><br><span class="line"><span class="comment"># stacks within the container. This will automatically</span></span><br><span class="line"><span class="comment"># result in memory pre allocation</span></span><br><span class="line"><span class="comment">#enable_hugepages = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable vhost-user storage device, default false</span></span><br><span class="line"><span class="comment"># Enabling this will result in some Linux reserved block type</span></span><br><span class="line"><span class="comment"># major range 240-254 being chosen to represent vhost-user devices.</span></span><br><span class="line"><span class="attr">enable_vhost_user_store</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The base directory specifically used for vhost-user devices.</span></span><br><span class="line"><span class="comment"># Its sub-path &quot;block&quot; is used for block devices; &quot;block/sockets&quot; is</span></span><br><span class="line"><span class="comment"># where we expect vhost-user sockets to live; &quot;block/devices&quot; is where</span></span><br><span class="line"><span class="comment"># simulated block device nodes for vhost-user devices to live.</span></span><br><span class="line"><span class="attr">vhost_user_store_path</span> = <span class="string">&quot;/var/run/kata-containers/vhost-user&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable vIOMMU, default false</span></span><br><span class="line"><span class="comment"># Enabling this will result in the VM having a vIOMMU device</span></span><br><span class="line"><span class="comment"># This will also add the following options to the kernel&#x27;s</span></span><br><span class="line"><span class="comment"># command line: intel_iommu=on,iommu=pt</span></span><br><span class="line"><span class="comment">#enable_iommu = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable IOMMU_PLATFORM, default false</span></span><br><span class="line"><span class="comment"># Enabling this will result in the VM device having iommu_platform=on set</span></span><br><span class="line"><span class="comment">#enable_iommu_platform = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># List of valid annotations values for the vhost user store path</span></span><br><span class="line"><span class="comment"># The default if not set is empty (all annotations rejected.)</span></span><br><span class="line"><span class="comment"># Your distribution recommends: [&quot;/var/run/kata-containers/vhost-user&quot;]</span></span><br><span class="line"><span class="attr">valid_vhost_user_store_paths</span> = [<span class="string">&quot;/var/run/kata-containers/vhost-user&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable file based guest memory support. The default is an empty string which</span></span><br><span class="line"><span class="comment"># will disable this feature. In the case of virtio-fs, this is enabled</span></span><br><span class="line"><span class="comment"># automatically and &#x27;/dev/shm&#x27; is used as the backing folder.</span></span><br><span class="line"><span class="comment"># This option will be ignored if VM templating is enabled.</span></span><br><span class="line"><span class="comment">#file_mem_backend = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># List of valid annotations values for the file_mem_backend annotation</span></span><br><span class="line"><span class="comment"># The default if not set is empty (all annotations rejected.)</span></span><br><span class="line"><span class="comment"># Your distribution recommends: [&quot;&quot;]</span></span><br><span class="line"><span class="attr">valid_file_mem_backends</span> = [<span class="string">&quot;&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># -pflash can add image file to VM. The arguments of it should be in format</span></span><br><span class="line"><span class="comment"># of [&quot;/path/to/flash0.img&quot;, &quot;/path/to/flash1.img&quot;]</span></span><br><span class="line"><span class="attr">pflashes</span> = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># This option changes the default hypervisor and kernel parameters</span></span><br><span class="line"><span class="comment"># to enable debug output where available.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default false</span></span><br><span class="line"><span class="comment">#enable_debug = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable the customizations done in the runtime when it detects</span></span><br><span class="line"><span class="comment"># that it is running on top a VMM. This will result in the runtime</span></span><br><span class="line"><span class="comment"># behaving as it would when running on bare metal.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#disable_nesting_checks = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the msize used for 9p shares. It is the number of bytes</span></span><br><span class="line"><span class="comment"># used for 9p packet payload.</span></span><br><span class="line"><span class="comment">#msize_9p = 8192</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If false and nvdimm is supported, use nvdimm device to plug guest image.</span></span><br><span class="line"><span class="comment"># Otherwise virtio-block device is used.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># nvdimm is not supported when `confidential_guest = true`.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default is false</span></span><br><span class="line"><span class="comment">#disable_image_nvdimm = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># VFIO devices are hotplugged on a bridge by default.</span></span><br><span class="line"><span class="comment"># Enable hotplugging on root bus. This may be required for devices with</span></span><br><span class="line"><span class="comment"># a large PCI bar, as this is a current limitation with hotplugging on</span></span><br><span class="line"><span class="comment"># a bridge.</span></span><br><span class="line"><span class="comment"># Default false</span></span><br><span class="line"><span class="comment">#hotplug_vfio_on_root_bus = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Before hot plugging a PCIe device, you need to add a pcie_root_port device.</span></span><br><span class="line"><span class="comment"># Use this parameter when using some large PCI bar devices, such as Nvidia GPU</span></span><br><span class="line"><span class="comment"># The value means the number of pcie_root_port</span></span><br><span class="line"><span class="comment"># This value is valid when hotplug_vfio_on_root_bus is true and machine_type is &quot;q35&quot;</span></span><br><span class="line"><span class="comment"># Default 0</span></span><br><span class="line"><span class="comment">#pcie_root_port = 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If vhost-net backend for virtio-net is not desired, set to true. Default is false, which trades off</span></span><br><span class="line"><span class="comment"># security (vhost-net runs ring0) for network I/O performance.</span></span><br><span class="line"><span class="comment">#disable_vhost_net = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default entropy source.</span></span><br><span class="line"><span class="comment"># The path to a host source of entropy (including a real hardware RNG)</span></span><br><span class="line"><span class="comment"># /dev/urandom and /dev/random are two main options.</span></span><br><span class="line"><span class="comment"># Be aware that /dev/random is a blocking source of entropy.  If the host</span></span><br><span class="line"><span class="comment"># runs out of entropy, the VMs boot time will increase leading to get startup</span></span><br><span class="line"><span class="comment"># timeouts.</span></span><br><span class="line"><span class="comment"># The source of entropy /dev/urandom is non-blocking and provides a</span></span><br><span class="line"><span class="comment"># generally acceptable source of entropy. It should work well for pretty much</span></span><br><span class="line"><span class="comment"># all practical purposes.</span></span><br><span class="line"><span class="comment">#entropy_source= &quot;/dev/urandom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># List of valid annotations values for entropy_source</span></span><br><span class="line"><span class="comment"># The default if not set is empty (all annotations rejected.)</span></span><br><span class="line"><span class="comment"># Your distribution recommends: [&quot;/dev/urandom&quot;,&quot;/dev/random&quot;,&quot;&quot;]</span></span><br><span class="line"><span class="attr">valid_entropy_sources</span> = [<span class="string">&quot;/dev/urandom&quot;</span>,<span class="string">&quot;/dev/random&quot;</span>,<span class="string">&quot;&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to OCI hook binaries in the *guest rootfs*.</span></span><br><span class="line"><span class="comment"># This does not affect host-side hooks which must instead be added to</span></span><br><span class="line"><span class="comment"># the OCI spec passed to the runtime.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can create a rootfs with hooks by customizing the osbuilder scripts:</span></span><br><span class="line"><span class="comment"># https://github.com/kata-containers/kata-containers/tree/main/tools/osbuilder</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Hooks must be stored in a subdirectory of guest_hook_path according to their</span></span><br><span class="line"><span class="comment"># hook type, i.e. &quot;guest_hook_path/&#123;prestart,poststart,poststop&#125;&quot;.</span></span><br><span class="line"><span class="comment"># The agent will scan these directories for executable files and add them, in</span></span><br><span class="line"><span class="comment"># lexicographical order, to the lifecycle of the guest container.</span></span><br><span class="line"><span class="comment"># Hooks are executed in the runtime namespace of the guest. See the official documentation:</span></span><br><span class="line"><span class="comment"># https://github.com/opencontainers/runtime-spec/blob/v1.0.1/config.md#posix-platform-hooks</span></span><br><span class="line"><span class="comment"># Warnings will be logged if any error is encountered while scanning for hooks,</span></span><br><span class="line"><span class="comment"># but it will not abort container execution.</span></span><br><span class="line"><span class="comment">#guest_hook_path = &quot;/usr/share/oci/hooks&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Use rx Rate Limiter to control network I/O inbound bandwidth(size in bits/sec for SB/VM).</span></span><br><span class="line"><span class="comment"># In Qemu, we use classful qdiscs HTB(Hierarchy Token Bucket) to discipline traffic.</span></span><br><span class="line"><span class="comment"># Default 0-sized value means unlimited rate.</span></span><br><span class="line"><span class="comment">#rx_rate_limiter_max_rate = 0</span></span><br><span class="line"><span class="comment"># Use tx Rate Limiter to control network I/O outbound bandwidth(size in bits/sec for SB/VM).</span></span><br><span class="line"><span class="comment"># In Qemu, we use classful qdiscs HTB(Hierarchy Token Bucket) and ifb(Intermediate Functional Block)</span></span><br><span class="line"><span class="comment"># to discipline traffic.</span></span><br><span class="line"><span class="comment"># Default 0-sized value means unlimited rate.</span></span><br><span class="line"><span class="comment">#tx_rate_limiter_max_rate = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set where to save the guest memory dump file.</span></span><br><span class="line"><span class="comment"># If set, when GUEST_PANICKED event occurred,</span></span><br><span class="line"><span class="comment"># guest memeory will be dumped to host filesystem under guest_memory_dump_path,</span></span><br><span class="line"><span class="comment"># This directory will be created automatically if it does not exist.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The dumped file(also called vmcore) can be processed with crash or gdb.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># WARNING:</span></span><br><span class="line"><span class="comment">#   Dump guest’s memory can take very long depending on the amount of guest memory</span></span><br><span class="line"><span class="comment">#   and use much disk space.</span></span><br><span class="line"><span class="comment">#guest_memory_dump_path=&quot;/var/crash/kata&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If enable paging.</span></span><br><span class="line"><span class="comment"># Basically, if you want to use &quot;gdb&quot; rather than &quot;crash&quot;,</span></span><br><span class="line"><span class="comment"># or need the guest-virtual addresses in the ELF vmcore,</span></span><br><span class="line"><span class="comment"># then you should enable paging.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See: https://www.qemu.org/docs/master/qemu-qmp-ref.html#Dump-guest-memory for details</span></span><br><span class="line"><span class="comment">#guest_memory_dump_paging=false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable swap in the guest. Default false.</span></span><br><span class="line"><span class="comment"># When enable_guest_swap is enabled, insert a raw file to the guest as the swap device</span></span><br><span class="line"><span class="comment"># if the swappiness of a container (set by annotation &quot;io.katacontainers.container.resource.swappiness&quot;)</span></span><br><span class="line"><span class="comment"># is bigger than 0.</span></span><br><span class="line"><span class="comment"># The size of the swap device should be</span></span><br><span class="line"><span class="comment"># swap_in_bytes (set by annotation &quot;io.katacontainers.container.resource.swap_in_bytes&quot;) - memory_limit_in_bytes.</span></span><br><span class="line"><span class="comment"># If swap_in_bytes is not set, the size should be memory_limit_in_bytes.</span></span><br><span class="line"><span class="comment"># If swap_in_bytes and memory_limit_in_bytes is not set, the size should</span></span><br><span class="line"><span class="comment"># be default_memory.</span></span><br><span class="line"><span class="comment">#enable_guest_swap = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># use legacy serial for guest console if available and implemented for architecture. Default false</span></span><br><span class="line"><span class="comment">#use_legacy_serial = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># disable applying SELinux on the VMM process (default false)</span></span><br><span class="line"><span class="attr">disable_selinux</span>=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="section">[factory]</span></span><br><span class="line"><span class="comment"># VM templating support. Once enabled, new VMs are created from template</span></span><br><span class="line"><span class="comment"># using vm cloning. They will share the same initial kernel, initramfs and</span></span><br><span class="line"><span class="comment"># agent memory by mapping it readonly. It helps speeding up new container</span></span><br><span class="line"><span class="comment"># creation and saves a lot of memory if there are many kata containers running</span></span><br><span class="line"><span class="comment"># on the same host.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># When disabled, new VMs are created from scratch.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span> Requires &quot;initrd=&quot; to be set (&quot;image=&quot; is not supported).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default false</span></span><br><span class="line"><span class="comment">#enable_template = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies the path of template.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default &quot;/run/vc/vm/template&quot;</span></span><br><span class="line"><span class="comment">#template_path = &quot;/run/vc/vm/template&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The number of caches of VMCache:</span></span><br><span class="line"><span class="comment"># unspecified or == 0   --&gt; VMCache is disabled</span></span><br><span class="line"><span class="comment"># &gt; 0                   --&gt; will be set to the specified number</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># VMCache is a function that creates VMs as caches before using it.</span></span><br><span class="line"><span class="comment"># It helps speed up new container creation.</span></span><br><span class="line"><span class="comment"># The function consists of a server and some clients communicating</span></span><br><span class="line"><span class="comment"># through Unix socket.  The protocol is gRPC in protocols/cache/cache.proto.</span></span><br><span class="line"><span class="comment"># The VMCache server will create some VMs and cache them by factory cache.</span></span><br><span class="line"><span class="comment"># It will convert the VM to gRPC format and transport it when gets</span></span><br><span class="line"><span class="comment"># requestion from clients.</span></span><br><span class="line"><span class="comment"># Factory grpccache is the VMCache client.  It will request gRPC format</span></span><br><span class="line"><span class="comment"># VM and convert it back to a VM.  If VMCache function is enabled,</span></span><br><span class="line"><span class="comment"># kata-runtime will request VM from factory grpccache when it creates</span></span><br><span class="line"><span class="comment"># a new sandbox.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default 0</span></span><br><span class="line"><span class="comment">#vm_cache_number = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify the address of the Unix socket that is used by VMCache.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default /var/run/kata-containers/cache.sock</span></span><br><span class="line"><span class="comment">#vm_cache_endpoint = &quot;/var/run/kata-containers/cache.sock&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[agent.kata]</span></span><br><span class="line"><span class="comment"># If enabled, make the agent display debug-level messages.</span></span><br><span class="line"><span class="comment"># (default: disabled)</span></span><br><span class="line"><span class="comment">#enable_debug = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable agent tracing.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If enabled, the agent will generate OpenTelemetry trace spans.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Notes:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># - If the runtime also has tracing enabled, the agent spans will be</span></span><br><span class="line"><span class="comment">#   associated with the appropriate runtime parent span.</span></span><br><span class="line"><span class="comment"># - If enabled, the runtime will wait for the container to shutdown,</span></span><br><span class="line"><span class="comment">#   increasing the container shutdown time slightly.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># (default: disabled)</span></span><br><span class="line"><span class="comment">#enable_tracing = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Comma separated list of kernel modules and their parameters.</span></span><br><span class="line"><span class="comment"># These modules will be loaded in the guest kernel using modprobe(8).</span></span><br><span class="line"><span class="comment"># The following example can be used to load two kernel modules with parameters</span></span><br><span class="line"><span class="comment">#  - kernel_modules=[&quot;e1000e InterruptThrottleRate=3000,3000,3000 EEE=1&quot;, &quot;i915 enable_ppgtt=0&quot;]</span></span><br><span class="line"><span class="comment"># The first word is considered as the module name and the rest as its parameters.</span></span><br><span class="line"><span class="comment"># Container will not be started when:</span></span><br><span class="line"><span class="comment">#  * A kernel module is specified and the modprobe command is not installed in the guest</span></span><br><span class="line"><span class="comment">#    or it fails loading the module.</span></span><br><span class="line"><span class="comment">#  * The module is not available in the guest or it doesn&#x27;t met the guest kernel</span></span><br><span class="line"><span class="comment">#    requirements, like architecture and version.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">kernel_modules</span>=[]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable debug console.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If enabled, user can connect guest OS running inside hypervisor</span></span><br><span class="line"><span class="comment"># through &quot;kata-runtime exec &lt;sandbox-id&gt;&quot; command</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#debug_console_enabled = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Agent connection dialing timeout value in seconds</span></span><br><span class="line"><span class="comment"># (default: 30)</span></span><br><span class="line"><span class="comment">#dial_timeout = 30</span></span><br><span class="line"></span><br><span class="line"><span class="section">[runtime]</span></span><br><span class="line"><span class="comment"># If enabled, the runtime will log additional debug messages to the</span></span><br><span class="line"><span class="comment"># system log</span></span><br><span class="line"><span class="comment"># (default: disabled)</span></span><br><span class="line"><span class="comment">#enable_debug = true</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Internetworking model</span></span><br><span class="line"><span class="comment"># Determines how the VM should be connected to the</span></span><br><span class="line"><span class="comment"># the container network interface</span></span><br><span class="line"><span class="comment"># Options:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - macvtap</span></span><br><span class="line"><span class="comment">#     Used when the Container network interface can be bridged using</span></span><br><span class="line"><span class="comment">#     macvtap.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - none</span></span><br><span class="line"><span class="comment">#     Used when customize network. Only creates a tap device. No veth pair.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - tcfilter</span></span><br><span class="line"><span class="comment">#     Uses tc filter rules to redirect traffic from the network interface</span></span><br><span class="line"><span class="comment">#     provided by plugin to a tap interface connected to the VM.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">internetworking_model</span>=<span class="string">&quot;tcfilter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># disable guest seccomp</span></span><br><span class="line"><span class="comment"># Determines whether container seccomp profiles are passed to the virtual</span></span><br><span class="line"><span class="comment"># machine and applied by the kata agent. If set to true, seccomp is not applied</span></span><br><span class="line"><span class="comment"># within the guest</span></span><br><span class="line"><span class="comment"># (default: true)</span></span><br><span class="line"><span class="attr">disable_guest_seccomp</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If enabled, the runtime will create opentracing.io traces and spans.</span></span><br><span class="line"><span class="comment"># (See https://www.jaegertracing.io/docs/getting-started).</span></span><br><span class="line"><span class="comment"># (default: disabled)</span></span><br><span class="line"><span class="comment">#enable_tracing = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the full url to the Jaeger HTTP Thrift collector.</span></span><br><span class="line"><span class="comment"># The default if not set will be &quot;http://localhost:14268/api/traces&quot;</span></span><br><span class="line"><span class="comment">#jaeger_endpoint = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sets the username to be used if basic auth is required for Jaeger.</span></span><br><span class="line"><span class="comment">#jaeger_user = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sets the password to be used if basic auth is required for Jaeger.</span></span><br><span class="line"><span class="comment">#jaeger_password = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If enabled, the runtime will not create a network namespace for shim and hypervisor processes.</span></span><br><span class="line"><span class="comment"># This option may have some potential impacts to your host. It should only be used when you know what you&#x27;re doing.</span></span><br><span class="line"><span class="comment"># `disable_new_netns` conflicts with `internetworking_model=tcfilter` and `internetworking_model=macvtap`. It works only</span></span><br><span class="line"><span class="comment"># with `internetworking_model=none`. The tap device will be in the host network namespace and can connect to a bridge</span></span><br><span class="line"><span class="comment"># (like OVS) directly.</span></span><br><span class="line"><span class="comment"># (default: false)</span></span><br><span class="line"><span class="comment">#disable_new_netns = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if enabled, the runtime will add all the kata processes inside one dedicated cgroup.</span></span><br><span class="line"><span class="comment"># The container cgroups in the host are not created, just one single cgroup per sandbox.</span></span><br><span class="line"><span class="comment"># The runtime caller is free to restrict or collect cgroup stats of the overall Kata sandbox.</span></span><br><span class="line"><span class="comment"># The sandbox cgroup path is the parent cgroup of a container with the PodSandbox annotation.</span></span><br><span class="line"><span class="comment"># The sandbox cgroup is constrained if there is no container type annotation.</span></span><br><span class="line"><span class="comment"># See: https://pkg.go.dev/github.com/kata-containers/kata-containers/src/runtime/virtcontainers#ContainerType</span></span><br><span class="line"><span class="attr">sandbox_cgroup_only</span>=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If enabled, the runtime will attempt to determine appropriate sandbox size (memory, CPU) before booting the virtual machine. In</span></span><br><span class="line"><span class="comment"># this case, the runtime will not dynamically update the amount of memory and CPU in the virtual machine. This is generally helpful</span></span><br><span class="line"><span class="comment"># when a hardware architecture or hypervisor solutions is utilized which does not support CPU and/or memory hotplug.</span></span><br><span class="line"><span class="comment"># Compatibility for determining appropriate sandbox (VM) size:</span></span><br><span class="line"><span class="comment"># - When running with pods, sandbox sizing information will only be available if using Kubernetes &gt;= 1.23 and containerd &gt;= 1.6. CRI-O</span></span><br><span class="line"><span class="comment">#   does not yet support sandbox sizing annotations.</span></span><br><span class="line"><span class="comment"># - When running single containers using a tool like ctr, container sizing information will be available.</span></span><br><span class="line"><span class="attr">static_sandbox_resource_mgmt</span>=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If specified, sandbox_bind_mounts identifieds host paths to be mounted (ro) into the sandboxes shared path.</span></span><br><span class="line"><span class="comment"># This is only valid if filesystem sharing is utilized. The provided path(s) will be bindmounted into the shared fs directory.</span></span><br><span class="line"><span class="comment"># If defaults are utilized, these mounts should be available in the guest at `/run/kata-containers/shared/containers/sandbox-mounts`</span></span><br><span class="line"><span class="comment"># These will not be exposed to the container workloads, and are only provided for potential guest services.</span></span><br><span class="line"><span class="attr">sandbox_bind_mounts</span>=[]</span><br><span class="line"></span><br><span class="line"><span class="comment"># VFIO Mode</span></span><br><span class="line"><span class="comment"># Determines how VFIO devices should be be presented to the container.</span></span><br><span class="line"><span class="comment"># Options:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  - vfio</span></span><br><span class="line"><span class="comment">#    Matches behaviour of OCI runtimes (e.g. runc) as much as</span></span><br><span class="line"><span class="comment">#    possible.  VFIO devices will appear in the container as VFIO</span></span><br><span class="line"><span class="comment">#    character devices under /dev/vfio.  The exact names may differ</span></span><br><span class="line"><span class="comment">#    from the host (they need to match the VM&#x27;s IOMMU group numbers</span></span><br><span class="line"><span class="comment">#    rather than the host&#x27;s)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  - guest-kernel</span></span><br><span class="line"><span class="comment">#    This is a Kata-specific behaviour that&#x27;s useful in certain cases.</span></span><br><span class="line"><span class="comment">#    The VFIO device is managed by whatever driver in the VM kernel</span></span><br><span class="line"><span class="comment">#    claims it.  This means it will appear as one or more device nodes</span></span><br><span class="line"><span class="comment">#    or network interfaces depending on the nature of the device.</span></span><br><span class="line"><span class="comment">#    Using this mode requires specially built workloads that know how</span></span><br><span class="line"><span class="comment">#    to locate the relevant device interfaces within the VM.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">vfio_mode</span>=<span class="string">&quot;guest-kernel&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If enabled, the runtime will not create Kubernetes emptyDir mounts on the guest filesystem. Instead, emptyDir mounts will</span></span><br><span class="line"><span class="comment"># be created on the host and shared via virtio-fs. This is potentially slower, but allows sharing of files from host to guest.</span></span><br><span class="line"><span class="attr">disable_guest_empty_dir</span>=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enabled experimental feature list, format: [&quot;a&quot;, &quot;b&quot;].</span></span><br><span class="line"><span class="comment"># Experimental features are features not stable enough for production,</span></span><br><span class="line"><span class="comment"># they may break compatibility, and are prepared for a big version bump.</span></span><br><span class="line"><span class="comment"># Supported experimental features:</span></span><br><span class="line"><span class="comment"># (default: [])</span></span><br><span class="line"><span class="attr">experimental</span>=[]</span><br><span class="line"></span><br><span class="line"><span class="comment"># If enabled, user can run pprof tools with shim v2 process through kata-monitor.</span></span><br><span class="line"><span class="comment"># (default: false)</span></span><br><span class="line"><span class="comment"># enable_pprof = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># WARNING: All the options in the following section have not been implemented yet.</span></span><br><span class="line"><span class="comment"># This section was added as a placeholder. DO NOT USE IT!</span></span><br><span class="line"><span class="section">[image]</span></span><br><span class="line"><span class="comment"># Container image service.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Offload the CRI image management service to the Kata agent.</span></span><br><span class="line"><span class="comment"># (default: false)</span></span><br><span class="line"><span class="comment">#service_offload = true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Container image decryption keys provisioning.</span></span><br><span class="line"><span class="comment"># Applies only if service_offload is true.</span></span><br><span class="line"><span class="comment"># Keys can be provisioned locally (e.g. through a special command or</span></span><br><span class="line"><span class="comment"># a local file) or remotely (usually after the guest is remotely attested).</span></span><br><span class="line"><span class="comment"># The provision setting is a complete URL that lets the Kata agent decide</span></span><br><span class="line"><span class="comment"># which method to use in order to fetch the keys.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Keys can be stored in a local file, in a measured and attested initrd:</span></span><br><span class="line"><span class="comment">#provision=data:///local/key/file</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Keys could be fetched through a special command or binary from the</span></span><br><span class="line"><span class="comment"># initrd (guest) image, e.g. a firmware call:</span></span><br><span class="line"><span class="comment">#provision=file:///path/to/bin/fetcher/in/guest</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Keys can be remotely provisioned. The Kata agent fetches them from e.g.</span></span><br><span class="line"><span class="comment"># a HTTPS URL:</span></span><br><span class="line"><span class="comment">#provision=https://my-key-broker.foo/tenant/&lt;tenant-id&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="CRI-配置"><a href="#CRI-配置" class="headerlink" title="CRI 配置"></a>CRI 配置</h1><p>Kata Containers 在与 Kubernetes 集成时，默认支持 Containerd 和 CRI-O 作为 CRI，不支持使用 docker-shim 作为 CRI。</p>
<h2 id="Containerd"><a href="#Containerd" class="headerlink" title="Containerd"></a>Containerd</h2><p><em>&#x2F;etc&#x2F;containerd&#x2F;config.toml</em></p>
<p>在 Docker（docker-shim）作为 CRI 的场景下，Containerd 本身也是 Docker 的组件之一，但是禁用了 Containerd 作为 CRI。</p>
<p><strong>非 CRI</strong></p>
<p>默认安装 Docker 服务时，会自动安装 Containerd，配置文件如下：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   Copyright 2018-2022 Docker Inc.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment">#   you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment">#   You may obtain a copy of the License at</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#       http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#   Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">#   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment">#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">#   See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">#   limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">disabled_plugins</span> = [<span class="string">&quot;cri&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#root = &quot;/var/lib/containerd&quot;</span></span><br><span class="line"><span class="comment">#state = &quot;/run/containerd&quot;</span></span><br><span class="line"><span class="comment">#subreaper = true</span></span><br><span class="line"><span class="comment">#oom_score = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[grpc]</span></span><br><span class="line"><span class="comment">#  address = &quot;/run/containerd/containerd.sock&quot;</span></span><br><span class="line"><span class="comment">#  uid = 0</span></span><br><span class="line"><span class="comment">#  gid = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[debug]</span></span><br><span class="line"><span class="comment">#  address = &quot;/run/containerd/debug.sock&quot;</span></span><br><span class="line"><span class="comment">#  uid = 0</span></span><br><span class="line"><span class="comment">#  gid = 0</span></span><br><span class="line"><span class="comment">#  level = &quot;info&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>CRI</strong></p>
<p>借助 Containerd 自带的配置生成能力，创建其作为 CRI 的配置文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">mkdir</span> -p /etc/containerd</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">containerd config default | sudo <span class="built_in">tee</span> /etc/containerd/config.toml</span></span><br></pre></td></tr></table></figure>

<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">disabled_plugins</span> = []</span><br><span class="line"><span class="attr">imports</span> = []</span><br><span class="line"><span class="attr">oom_score</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">plugin_dir</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">required_plugins</span> = []</span><br><span class="line"><span class="attr">root</span> = <span class="string">&quot;/var/lib/containerd&quot;</span></span><br><span class="line"><span class="attr">state</span> = <span class="string">&quot;/run/containerd&quot;</span></span><br><span class="line"><span class="attr">temp</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="section">[cgroup]</span></span><br><span class="line">  <span class="attr">path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[debug]</span></span><br><span class="line">  <span class="attr">address</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">format</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">gid</span> = <span class="number">0</span></span><br><span class="line">  <span class="attr">level</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">uid</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[grpc]</span></span><br><span class="line">  <span class="attr">address</span> = <span class="string">&quot;/run/containerd/containerd.sock&quot;</span></span><br><span class="line">  <span class="attr">gid</span> = <span class="number">0</span></span><br><span class="line">  <span class="attr">max_recv_message_size</span> = <span class="number">16777216</span></span><br><span class="line">  <span class="attr">max_send_message_size</span> = <span class="number">16777216</span></span><br><span class="line">  <span class="attr">tcp_address</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">tcp_tls_ca</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">tcp_tls_cert</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">tcp_tls_key</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">uid</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[metrics]</span></span><br><span class="line">  <span class="attr">address</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">grpc_histogram</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="section">[plugins]</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.gc.v1.scheduler&quot;]</span></span><br><span class="line">    <span class="attr">deletion_threshold</span> = <span class="number">0</span></span><br><span class="line">    <span class="attr">mutation_threshold</span> = <span class="number">100</span></span><br><span class="line">    <span class="attr">pause_threshold</span> = <span class="number">0.02</span></span><br><span class="line">    <span class="attr">schedule_delay</span> = <span class="string">&quot;0s&quot;</span></span><br><span class="line">    <span class="attr">startup_delay</span> = <span class="string">&quot;100ms&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;]</span></span><br><span class="line">    <span class="attr">device_ownership_from_security_context</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">disable_apparmor</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">disable_cgroup</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">disable_hugetlb_controller</span> = <span class="literal">true</span></span><br><span class="line">    <span class="attr">disable_proc_mount</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">disable_tcp_service</span> = <span class="literal">true</span></span><br><span class="line">    <span class="attr">enable_selinux</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">enable_tls_streaming</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">enable_unprivileged_icmp</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">enable_unprivileged_ports</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">ignore_image_defined_volumes</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">max_concurrent_downloads</span> = <span class="number">3</span></span><br><span class="line">    <span class="attr">max_container_log_line_size</span> = <span class="number">16384</span></span><br><span class="line">    <span class="attr">netns_mounts_under_state_dir</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">restrict_oom_score_adj</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">sandbox_image</span> = <span class="string">&quot;registry.k8s.io/pause:3.6&quot;</span></span><br><span class="line">    <span class="attr">selinux_category_range</span> = <span class="number">1024</span></span><br><span class="line">    <span class="attr">stats_collect_period</span> = <span class="number">10</span></span><br><span class="line">    <span class="attr">stream_idle_timeout</span> = <span class="string">&quot;4h0m0s&quot;</span></span><br><span class="line">    <span class="attr">stream_server_address</span> = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    <span class="attr">stream_server_port</span> = <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="attr">systemd_cgroup</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">tolerate_missing_hugetlb_controller</span> = <span class="literal">true</span></span><br><span class="line">    <span class="attr">unset_seccomp_profile</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.cni]</span></span><br><span class="line">      <span class="attr">bin_dir</span> = <span class="string">&quot;/opt/cni/bin&quot;</span></span><br><span class="line">      <span class="attr">conf_dir</span> = <span class="string">&quot;/etc/cni/net.d&quot;</span></span><br><span class="line">      <span class="attr">conf_template</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">ip_pref</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">max_conf_num</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd]</span></span><br><span class="line">      <span class="attr">default_runtime_name</span> = <span class="string">&quot;runc&quot;</span></span><br><span class="line">      <span class="attr">disable_snapshot_annotations</span> = <span class="literal">true</span></span><br><span class="line">      <span class="attr">discard_unpacked_layers</span> = <span class="literal">false</span></span><br><span class="line">      <span class="attr">ignore_rdt_not_enabled_errors</span> = <span class="literal">false</span></span><br><span class="line">      <span class="attr">no_pivot</span> = <span class="literal">false</span></span><br><span class="line">      <span class="attr">snapshotter</span> = <span class="string">&quot;overlayfs&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime]</span></span><br><span class="line">        <span class="attr">base_runtime_spec</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">cni_conf_dir</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">cni_max_conf_num</span> = <span class="number">0</span></span><br><span class="line">        <span class="attr">container_annotations</span> = []</span><br><span class="line">        <span class="attr">pod_annotations</span> = []</span><br><span class="line">        <span class="attr">privileged_without_host_devices</span> = <span class="literal">false</span></span><br><span class="line">        <span class="attr">runtime_engine</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_root</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_type</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime.options]</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes]</span></span><br><span class="line"></span><br><span class="line">        <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]</span></span><br><span class="line">          <span class="attr">base_runtime_spec</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">cni_conf_dir</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">cni_max_conf_num</span> = <span class="number">0</span></span><br><span class="line">          <span class="attr">container_annotations</span> = []</span><br><span class="line">          <span class="attr">pod_annotations</span> = []</span><br><span class="line">          <span class="attr">privileged_without_host_devices</span> = <span class="literal">false</span></span><br><span class="line">          <span class="attr">runtime_engine</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">runtime_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">runtime_root</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">runtime_type</span> = <span class="string">&quot;io.containerd.runc.v2&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]</span></span><br><span class="line">            <span class="attr">BinaryName</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">CriuImagePath</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">CriuPath</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">CriuWorkPath</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">IoGid</span> = <span class="number">0</span></span><br><span class="line">            <span class="attr">IoUid</span> = <span class="number">0</span></span><br><span class="line">            <span class="attr">NoNewKeyring</span> = <span class="literal">false</span></span><br><span class="line">            <span class="attr">NoPivotRoot</span> = <span class="literal">false</span></span><br><span class="line">            <span class="attr">Root</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">ShimCgroup</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="attr">SystemdCgroup</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.untrusted_workload_runtime]</span></span><br><span class="line">        <span class="attr">base_runtime_spec</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">cni_conf_dir</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">cni_max_conf_num</span> = <span class="number">0</span></span><br><span class="line">        <span class="attr">container_annotations</span> = []</span><br><span class="line">        <span class="attr">pod_annotations</span> = []</span><br><span class="line">        <span class="attr">privileged_without_host_devices</span> = <span class="literal">false</span></span><br><span class="line">        <span class="attr">runtime_engine</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_root</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">runtime_type</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.untrusted_workload_runtime.options]</span></span><br><span class="line"></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.image_decryption]</span></span><br><span class="line">      <span class="attr">key_model</span> = <span class="string">&quot;node&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry]</span></span><br><span class="line">      <span class="attr">config_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.auths]</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs]</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.headers]</span></span><br><span class="line"></span><br><span class="line">      <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors]</span></span><br><span class="line"></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.x509_key_pair_streaming]</span></span><br><span class="line">      <span class="attr">tls_cert_file</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">tls_key_file</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.internal.v1.opt&quot;]</span></span><br><span class="line">    <span class="attr">path</span> = <span class="string">&quot;/opt/containerd&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.internal.v1.restart&quot;]</span></span><br><span class="line">    <span class="attr">interval</span> = <span class="string">&quot;10s&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.internal.v1.tracing&quot;]</span></span><br><span class="line">    <span class="attr">sampling_ratio</span> = <span class="number">1.0</span></span><br><span class="line">    <span class="attr">service_name</span> = <span class="string">&quot;containerd&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.metadata.v1.bolt&quot;]</span></span><br><span class="line">    <span class="attr">content_sharing_policy</span> = <span class="string">&quot;shared&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.monitor.v1.cgroups&quot;]</span></span><br><span class="line">    <span class="attr">no_prometheus</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.runtime.v1.linux&quot;]</span></span><br><span class="line">    <span class="attr">no_shim</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">runtime</span> = <span class="string">&quot;runc&quot;</span></span><br><span class="line">    <span class="attr">runtime_root</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">shim</span> = <span class="string">&quot;containerd-shim&quot;</span></span><br><span class="line">    <span class="attr">shim_debug</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.runtime.v2.task&quot;]</span></span><br><span class="line">    <span class="attr">platforms</span> = [<span class="string">&quot;linux/amd64&quot;</span>]</span><br><span class="line">    <span class="attr">sched_core</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.service.v1.diff-service&quot;]</span></span><br><span class="line">    <span class="attr">default</span> = [<span class="string">&quot;walking&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.service.v1.tasks-service&quot;]</span></span><br><span class="line">    <span class="attr">rdt_config_file</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.aufs&quot;]</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.btrfs&quot;]</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.devmapper&quot;]</span></span><br><span class="line">    <span class="attr">async_remove</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">base_image_size</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">discard_blocks</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">fs_options</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">fs_type</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">pool_name</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.native&quot;]</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.overlayfs&quot;]</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">upperdir_label</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.snapshotter.v1.zfs&quot;]</span></span><br><span class="line">    <span class="attr">root_path</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[plugins.&quot;io.containerd.tracing.processor.v1.otlp&quot;]</span></span><br><span class="line">    <span class="attr">endpoint</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">insecure</span> = <span class="literal">false</span></span><br><span class="line">    <span class="attr">protocol</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[proxy_plugins]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[stream_processors]</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[stream_processors.&quot;io.containerd.ocicrypt.decoder.v1.tar&quot;]</span></span><br><span class="line">    <span class="attr">accepts</span> = [<span class="string">&quot;application/vnd.oci.image.layer.v1.tar+encrypted&quot;</span>]</span><br><span class="line">    <span class="attr">args</span> = [<span class="string">&quot;--decryption-keys-path&quot;</span>, <span class="string">&quot;/etc/containerd/ocicrypt/keys&quot;</span>]</span><br><span class="line">    <span class="attr">env</span> = [<span class="string">&quot;OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf&quot;</span>]</span><br><span class="line">    <span class="attr">path</span> = <span class="string">&quot;ctd-decoder&quot;</span></span><br><span class="line">    <span class="attr">returns</span> = <span class="string">&quot;application/vnd.oci.image.layer.v1.tar&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="section">[stream_processors.&quot;io.containerd.ocicrypt.decoder.v1.tar.gzip&quot;]</span></span><br><span class="line">    <span class="attr">accepts</span> = [<span class="string">&quot;application/vnd.oci.image.layer.v1.tar+gzip+encrypted&quot;</span>]</span><br><span class="line">    <span class="attr">args</span> = [<span class="string">&quot;--decryption-keys-path&quot;</span>, <span class="string">&quot;/etc/containerd/ocicrypt/keys&quot;</span>]</span><br><span class="line">    <span class="attr">env</span> = [<span class="string">&quot;OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf&quot;</span>]</span><br><span class="line">    <span class="attr">path</span> = <span class="string">&quot;ctd-decoder&quot;</span></span><br><span class="line">    <span class="attr">returns</span> = <span class="string">&quot;application/vnd.oci.image.layer.v1.tar+gzip&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[timeouts]</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.bolt.open&quot;</span> = <span class="string">&quot;0s&quot;</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.shim.cleanup&quot;</span> = <span class="string">&quot;5s&quot;</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.shim.load&quot;</span> = <span class="string">&quot;5s&quot;</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.shim.shutdown&quot;</span> = <span class="string">&quot;3s&quot;</span></span><br><span class="line">  <span class="attr">&quot;io.containerd.timeout.task.state&quot;</span> = <span class="string">&quot;2s&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ttrpc]</span></span><br><span class="line">  <span class="attr">address</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">gid</span> = <span class="number">0</span></span><br><span class="line">  <span class="attr">uid</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>可以看到，Containerd 的默认 OCI 运行时为 runC，可以通过新增以下内容，用于对 Kata Containers 的支持：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes]</span></span><br><span class="line">    <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.kata]</span></span><br><span class="line">        <span class="attr">runtime_type</span> = <span class="string">&quot;io.containerd.kata.v2&quot;</span></span><br><span class="line">        <span class="attr">privileged_without_host_devices</span> = <span class="literal">true</span></span><br><span class="line">        <span class="attr">pod_annotations</span> = [<span class="string">&quot;io.katacontainers.*&quot;</span>]</span><br><span class="line">        <span class="attr">container_annotations</span> = [<span class="string">&quot;io.katacontainers.*&quot;</span>]</span><br><span class="line">        <span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.kata.options]</span></span><br><span class="line">           <span class="attr">ConfigPath</span> = <span class="string">&quot;/opt/kata/share/defaults/kata-containers/configuration.toml&quot;</span>、</span><br></pre></td></tr></table></figure>

<h2 id="CRI-O"><a href="#CRI-O" class="headerlink" title="CRI-O"></a>CRI-O</h2><p>TODO</p>
<h1 id="RuntimeClass"><a href="#RuntimeClass" class="headerlink" title="RuntimeClass"></a>RuntimeClass</h1><p>RuntimeClass 是一个用于选择容器运行时配置的特性，容器运行时配置用于运行 Pod 中的容器。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">RuntimeClass</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">node.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kata-containers</span></span><br><span class="line"><span class="attr">handler:</span> <span class="string">kata</span></span><br><span class="line"><span class="attr">overhead:</span></span><br><span class="line">  <span class="attr">podFixed:</span></span><br><span class="line">    <span class="attr">memory:</span> <span class="string">&quot;140Mi&quot;</span></span><br><span class="line">    <span class="attr">cpu:</span> <span class="string">&quot;250m&quot;</span></span><br><span class="line"><span class="attr">scheduling:</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">runtime:</span> <span class="string">kata</span></span><br></pre></td></tr></table></figure>

<h2 id="handler"><a href="#handler" class="headerlink" title="handler"></a>handler</h2><p>需要和 CRI 中注册的 handler（HANDLER_NAME） 保持一致，用于声明由具体实现的 runtime。</p>
<p><strong>Containerd</strong></p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.$&#123;HANDLER_NAME&#125;]</span></span><br></pre></td></tr></table></figure>

<p><strong>CRI-O</strong></p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[crio.runtime.runtimes.$&#123;HANDLER_NAME&#125;]</span></span><br></pre></td></tr></table></figure>

<h2 id="scheduling"><a href="#scheduling" class="headerlink" title="scheduling"></a>scheduling</h2><p>通过为 RuntimeClass 指定 scheduling 字段， 可以通过设置约束，确保运行该 RuntimeClass 的 Pod 被调度到支持该 RuntimeClass 的节点上。 如果未设置 scheduling，则假定所有节点均支持此 RuntimeClass 。</p>
<p>为了确保 Pod 会被调度到支持指定运行时的节点上，每个节点需要设置一个通用的 label 用于被 runtimeclass.scheduling.nodeSelector 挑选。在 admission 阶段，RuntimeClass 的 nodeSelector 将会与 Pod 的 nodeSelector 合并，取二者的交集。如果有冲突，Pod 将会被拒绝。</p>
<p>如果节点需要阻止某些需要特定 RuntimeClass 的 Pod，可以在 tolerations 中指定。 与 nodeSelector 一样，tolerations 也在 admission 阶段与 Pod 的 tolerations 合并，取二者的并集。</p>
<h2 id="overhead"><a href="#overhead" class="headerlink" title="overhead"></a>overhead</h2><p>在节点上运行 Pod 时，Pod 本身占用大量系统资源。这些资源是运行 Pod 内容器所需资源的附加资源。Overhead 是一个特性，用于计算 Pod 基础设施在容器请求和限制之上消耗的资源。</p>
<p>在 Kubernetes 中，Pod 的开销是根据与 Pod 的 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/containers/runtime-class/">RuntimeClass</a> 相关联的开销在<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/access-authn-authz/extensible-admission-controllers/#what-are-admission-webhooks">准入</a>时设置的。</p>
<p>如果启用了 Pod Overhead，在调度 Pod 时，除了考虑容器资源请求的总和外，还要考虑 Pod 开销。 类似地，kubelet 将在确定 Pod cgroups 的大小和执行 Pod 驱逐排序时也会考虑 Pod 开销。</p>
<h1 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h1><h3 id="定制化的-annotation"><a href="#定制化的-annotation" class="headerlink" title="定制化的 annotation"></a>定制化的 annotation</h3><p>Kata Containers 可以通过 Pod annotation 的方式实现定制化每一个 Pod 的底层 Kata 参数。需要做的是上层 CRI 将 Pod annotation 透传至底层 runtime，同时 Kata Containers 开启识别特定的 Pod annotation，并且 CRI 需要支持此功能（如 Containerd 依赖 1.4.x 以上的版本才可以，且对应的 runtime 配置中新增相关 annotations 支持；CRI-O 默认透传所有参数，无需额外配置）</p>
<p><strong>全局配置</strong></p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Type</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><code>io.katacontainers.config_path</code></td>
<td>string</td>
<td>Kata config file location that overrides the default config paths</td>
</tr>
<tr>
<td><code>io.katacontainers.pkg.oci.bundle_path</code></td>
<td>string</td>
<td>OCI bundle path</td>
</tr>
<tr>
<td><code>io.katacontainers.pkg.oci.container_type</code></td>
<td>string</td>
<td>OCI container type. Only accepts <code>pod_container</code> and <code>pod_sandbox</code></td>
</tr>
</tbody></table>
<p><strong>Runtime 配置</strong></p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Type</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><code>io.katacontainers.config.runtime.experimental</code></td>
<td><code>boolean</code></td>
<td>determines if experimental features enabled</td>
</tr>
<tr>
<td><code>io.katacontainers.config.runtime.disable_guest_seccomp</code></td>
<td><code>boolean</code></td>
<td>determines if <code>seccomp</code> should be applied inside guest</td>
</tr>
<tr>
<td><code>io.katacontainers.config.runtime.disable_new_netns</code></td>
<td><code>boolean</code></td>
<td>determines if a new netns is created for the hypervisor process</td>
</tr>
<tr>
<td><code>io.katacontainers.config.runtime.internetworking_model</code></td>
<td>string</td>
<td>determines how the VM should be connected to the container network interface. Valid values are <code>macvtap</code>, <code>tcfilter</code> and <code>none</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.runtime.sandbox_cgroup_only</code></td>
<td><code>boolean</code></td>
<td>determines if Kata processes are managed only in sandbox cgroup</td>
</tr>
<tr>
<td><code>io.katacontainers.config.runtime.enable_pprof</code></td>
<td><code>boolean</code></td>
<td>enables Golang <code>pprof</code> for <code>containerd-shim-kata-v2</code> process</td>
</tr>
</tbody></table>
<p><strong>Agent 配置</strong></p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Type</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><code>io.katacontainers.config.agent.enable_tracing</code></td>
<td><code>boolean</code></td>
<td>enable tracing for the agent</td>
</tr>
<tr>
<td><code>io.katacontainers.config.agent.container_pipe_size</code></td>
<td>uint32</td>
<td>specify the size of the std(in&#x2F;out) pipes created for containers</td>
</tr>
<tr>
<td><code>io.katacontainers.config.agent.kernel_modules</code></td>
<td>string</td>
<td>the list of kernel modules and their parameters that will be loaded in the guest kernel. Semicolon separated list of kernel modules and their parameters. These modules will be loaded in the guest kernel using <code>modprobe</code>(8). E.g., <code>e1000e InterruptThrottleRate=3000,3000,3000 EEE=1; i915 enable_ppgtt=0</code></td>
</tr>
</tbody></table>
<p><strong>Hypervisor 配置</strong></p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Type</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><code>io.katacontainers.config.hypervisor.asset_hash_type</code></td>
<td>string</td>
<td>the hash type used for assets verification, default is <code>sha512</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.block_device_cache_direct</code></td>
<td><code>boolean</code></td>
<td>Denotes whether use of <code>O_DIRECT</code> (bypass the host page cache) is enabled</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.block_device_cache_noflush</code></td>
<td><code>boolean</code></td>
<td>Denotes whether flush requests for the device are ignored</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.block_device_cache_set</code></td>
<td><code>boolean</code></td>
<td>cache-related options will be set to block devices or not</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.block_device_driver</code></td>
<td>string</td>
<td>the driver to be used for block device, valid values are <code>virtio-blk</code>, <code>virtio-scsi</code>, <code>nvdimm</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.cpu_features</code></td>
<td><code>string</code></td>
<td>Comma-separated list of CPU features to pass to the CPU (QEMU)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.ctlpath</code> (R)</td>
<td><code>string</code></td>
<td>Path to the <code>acrnctl</code>binary for the ACRN hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.default_max_vcpus</code></td>
<td>uint32</td>
<td>the maximum number of vCPUs allocated for the VM by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.default_memory</code></td>
<td>uint32</td>
<td>the memory assigned for a VM by the hypervisor in <code>MiB</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.default_vcpus</code></td>
<td>uint32</td>
<td>the default vCPUs assigned for a VM by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.disable_block_device_use</code></td>
<td><code>boolean</code></td>
<td>disallow a block device from being used</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.disable_image_nvdimm</code></td>
<td><code>boolean</code></td>
<td>specify if a <code>nvdimm</code> device should be used as rootfs for the guest (QEMU)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.disable_vhost_net</code></td>
<td><code>boolean</code></td>
<td>specify if <code>vhost-net</code> is not available on the host</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_hugepages</code></td>
<td><code>boolean</code></td>
<td>if the memory should be <code>pre-allocated</code> from huge pages</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_iommu_platform</code></td>
<td><code>boolean</code></td>
<td>enable <code>iommu</code> on CCW devices (QEMU s390x)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_iommu</code></td>
<td><code>boolean</code></td>
<td>enable <code>iommu</code> on Q35 (QEMU x86_64)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_iothreads</code></td>
<td><code>boolean</code></td>
<td>enable IO to be processed in a separate thread. Supported currently for virtio-<code>scsi</code> driver</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_mem_prealloc</code></td>
<td><code>boolean</code></td>
<td>the memory space used for <code>nvdimm</code> device by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_vhost_user_store</code></td>
<td><code>boolean</code></td>
<td>enable vhost-user storage device (QEMU)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_virtio_mem</code></td>
<td><code>boolean</code></td>
<td>enable virtio-mem (QEMU)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.entropy_source</code> (R)</td>
<td>string</td>
<td>the path to a host source of entropy (<code>/dev/random</code>, <code>/dev/urandom</code> or real hardware RNG device)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.file_mem_backend</code> (R)</td>
<td>string</td>
<td>file based memory backend root directory</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.firmware_hash</code></td>
<td>string</td>
<td>container firmware SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.firmware</code></td>
<td>string</td>
<td>the guest firmware that will run the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.firmware_volume_hash</code></td>
<td>string</td>
<td>container firmware volume SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.firmware_volume</code></td>
<td>string</td>
<td>the guest firmware volume that will be passed to the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.guest_hook_path</code></td>
<td>string</td>
<td>the path within the VM that will be used for drop in hooks</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.hotplug_vfio_on_root_bus</code></td>
<td><code>boolean</code></td>
<td>indicate if devices need to be hotplugged on the root bus instead of a bridge</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.hypervisor_hash</code></td>
<td>string</td>
<td>container hypervisor binary SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.image_hash</code></td>
<td>string</td>
<td>container guest image SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.image</code></td>
<td>string</td>
<td>the guest image that will run in the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.initrd_hash</code></td>
<td>string</td>
<td>container guest initrd SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.initrd</code></td>
<td>string</td>
<td>the guest initrd image that will run in the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.jailer_hash</code></td>
<td>string</td>
<td>container jailer SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.jailer_path</code> (R)</td>
<td>string</td>
<td>the jailer that will constrain the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.kernel_hash</code></td>
<td>string</td>
<td>container kernel image SHA-512 hash value</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.kernel_params</code></td>
<td>string</td>
<td>additional guest kernel parameters</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.kernel</code></td>
<td>string</td>
<td>the kernel used to boot the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.machine_accelerators</code></td>
<td>string</td>
<td>machine specific accelerators for the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.machine_type</code></td>
<td>string</td>
<td>the type of machine being emulated by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.memory_offset</code></td>
<td>uint64</td>
<td>the memory space used for <code>nvdimm</code> device by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.memory_slots</code></td>
<td>uint32</td>
<td>the memory slots assigned to the VM by the hypervisor</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.msize_9p</code></td>
<td>uint32</td>
<td>the <code>msize</code> for 9p shares</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.path</code></td>
<td>string</td>
<td>the hypervisor that will run the container VM</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.pcie_root_port</code></td>
<td>specify the number of PCIe Root Port devices. The PCIe Root Port device is used to hot-plug a PCIe device (QEMU)</td>
<td></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.shared_fs</code></td>
<td>string</td>
<td>the shared file system type, either <code>virtio-9p</code> or <code>virtio-fs</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.use_vsock</code></td>
<td><code>boolean</code></td>
<td>specify use of <code>vsock</code> for agent communication</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.vhost_user_store_path</code> (R)</td>
<td><code>string</code></td>
<td>specify the directory path where vhost-user devices related folders, sockets and device nodes should be (QEMU)</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.virtio_fs_cache_size</code></td>
<td>uint32</td>
<td>virtio-fs DAX cache size in <code>MiB</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.virtio_fs_cache</code></td>
<td>string</td>
<td>the cache mode for virtio-fs, valid values are <code>always</code>, <code>auto</code> and <code>none</code></td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.virtio_fs_daemon</code></td>
<td>string</td>
<td>virtio-fs <code>vhost-user</code>daemon path</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.virtio_fs_extra_args</code></td>
<td>string</td>
<td>extra options passed to <code>virtiofs</code> daemon</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.enable_guest_swap</code></td>
<td><code>boolean</code></td>
<td>enable swap in the guest</td>
</tr>
<tr>
<td><code>io.katacontainers.config.hypervisor.use_legacy_serial</code></td>
<td><code>boolean</code></td>
<td>uses legacy serial device for guest’s console (QEMU)</td>
</tr>
</tbody></table>
<p><strong>Container 配置</strong></p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Type</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><code>io.katacontainers.container.resource.swappiness&quot;</code></td>
<td><code>uint64</code></td>
<td>specify the <code>Resources.Memory.Swappiness</code></td>
</tr>
<tr>
<td><code>io.katacontainers.container.resource.swap_in_bytes&quot;</code></td>
<td><code>uint64</code></td>
<td>specify the <code>Resources.Memory.Swap</code></td>
</tr>
</tbody></table>
<p>例如，通过 Pod Annotation 启动一个忽略底层默认大小的，具有 5C 的 VM</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">io.katacontainers.config.hypervisor.default_vcpus:</span> <span class="string">&quot;5&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">runtimeClassName:</span> <span class="string">kata-containers</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">uname-kata</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;uname -r &amp;&amp; tail -f /dev/null&quot;</span>]</span><br></pre></td></tr></table></figure>

<h1 id="VMCache"><a href="#VMCache" class="headerlink" title="VMCache"></a>VMCache</h1><p>VMCache 是一项新功能，可在使用前将 VM 创建为缓存。它有助于加快新容器的创建。</p>
<p>该功能由借助 Unix Socket 通信的一个 Server 和一些 Client 组成。该协议是 protocols&#x2F;cache&#x2F;cache.proto 中的 gRPC。</p>
<p>VMCache Server 将创建一些 VM 并通过 factory cache 缓存它们。它将 VM 转换为 gRPC 格式并在收到 client 请求时传输它。</p>
<p>grpccache Factory 是 VMCache 客户端。它将请求 gRPC 格式的 VM 并将其转换回 VM。如果启用了 VMCache 功能，kata-runtime 在创建新的 sandbox 时会向 grpccache 请求 VM。</p>
<p><strong>与 VM Tmplating 的区别</strong></p>
<p>VM Tmplating 和 VMCache 都有助于加快新容器的创建。</p>
<p>当启用 VM 模板时，通过从预先创建的模板 VM 克隆来创建新的 VM，它们将以只读模式共享相同的 initramfs、内核和 agent 内存。因此，如果在同一台主机上运行许多 Kata 容器，它会节省大量内存。</p>
<p>VMCache 不容易受到共享内存 CVE 的影响，因为每个 VM 不共享内存。</p>
<p><strong>如何启用 VM Cache</strong></p>
<p>配置文件中修改以下配置项：</p>
<ul>
<li>vm_cache_number 指定 VMCache 缓存的个数，不指定或者为 0 时代表 VMCache 被禁用；&gt; 0 时即为缓存个数</li>
<li>vm_cache_endpoint 指定 socket 地址</li>
</ul>
<p>通过以下命令创建一个 VM 模板供以后使用，通过 CTRL+C 退出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime factory init</span></span><br></pre></td></tr></table></figure>

<p><strong>已知限制</strong></p>
<ul>
<li>无法与 VM Templating 共存</li>
<li>仅支持 QEMU 作为 hypervisor</li>
</ul>
<h1 id="VM-Templating"><a href="#VM-Templating" class="headerlink" title="VM Templating"></a>VM Templating</h1><p>VM Templating 是 Kata Containers 的一项功能，可以借助克隆技术创建新的 VM。启用后，通过从预先创建的模板 VM 克隆创建新的 VM，它们将以只读模式共享相同的 initramfs、内核和 agent 内存。类似于内核的 fork 进程操作，这里 fork 的是 VM。</p>
<p><strong>与 VMCache 的区别</strong></p>
<p>VMCache 和 VM Templating 都有助于加快新容器的创建。</p>
<p>启用 VMCache 后，VMCache 服务器会创建新的 VM。所以它不容易受到共享内存 CVE 的攻击，因为每个 VM 都不共享内存。</p>
<p>如果在同一台主机上运行许多 Kata 容器，VM Templating 可以节省大量内存</p>
<p><strong>优势</strong></p>
<p>如果在同一主机上运行许多 Kata 容器，VM Templating 有助于加快新容器的创建并节省大量内存。如果正在运行高密度工作负载，或者非常关心容器启动速度，VM Templating 可能非常有用。</p>
<p>在一个示例中，创建了 100 个 Kata 容器，每个容器都拥有 128MB 的 Guest 内存，并且在启用 VM Templating 特性时最终总共节省了 9GB 的内存，这大约是 Guest 内存总量的 72%。<a target="_blank" rel="noopener" href="https://github.com/kata-containers/runtime/pull/303#issuecomment-395846767">完整结果参考</a>。</p>
<p>在另一个示例中，使用 containerd shimv2 创建了 10 个 Kata 容器，并计算了每个容器的平均启动速度。结果表明，VM Templating 将 Kata 容器的创建速度提高了 38.68%。<a target="_blank" rel="noopener" href="https://gist.github.com/bergwolf/06974a3c5981494a40e2c408681c085d">完整结果参考</a>。</p>
<p><strong>不足</strong></p>
<p>VM Templating 的一个缺点是它无法避免跨 VM 侧通道攻击，例如最初针对 Linux KSM 功能的 CVE-2015-2877。得出的结论是，“相互不信任的租户之间用于内存保护的共享直到写入的方法本质上是可检测的信息泄露，并且可以归类为潜在的被误解的行为而不是漏洞。”如果对此敏感，不要使用 VM Templating 或 KSM。</p>
<p><strong>如何启用 VM Templating</strong></p>
<p>配置文件中修改以下配置项：</p>
<ul>
<li>hypervisor 为 qemu，且版本为 v4.1.0 以上</li>
<li>enable_template 设为 true</li>
<li>VM 镜像为 initrd 类型</li>
<li>shared_fs 不为 virtio-fs</li>
</ul>
<p>通过以下命令创建一个VM 模板供以后使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kata-runtime factory init</span><br><span class="line">vm factory initialized</span><br></pre></td></tr></table></figure>

<p>创建的模板位于</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls /run/vc/vm/template</span><br><span class="line">memory  state</span><br></pre></td></tr></table></figure>

<p>通过以下命令销毁</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kata-runtime factory destroy</span><br><span class="line">vm factory destroyed</span><br></pre></td></tr></table></figure>

<p>如果不想手动调用 kata-runtime factory init，默认创建的第一个 Kata 容器将自动创建一个 VM 模板。</p>
<h1 id="Kata-Runtime"><a href="#Kata-Runtime" class="headerlink" title="Kata Runtime"></a>Kata Runtime</h1><h2 id="check-kata-check"><a href="#check-kata-check" class="headerlink" title="check (kata-check)"></a>check (kata-check)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime check --verbose</span></span><br><span class="line">INFO[0000] Looking for releases                          arch=amd64 name=kata-runtime pid=33900 source=runtime url=&quot;https://api.github.com/repos/kata-containers/kata-containers/releases&quot;</span><br><span class="line">Newer major release available: 3.0.0 (url: https://github.com/kata-containers/kata-containers/releases/download/3.0.0/kata-containers-3.0.0-vendor.tar.gz, date: 2022-10-09T09:48:18Z)</span><br><span class="line">INFO[0002] CPU property found                            arch=amd64 description=&quot;Intel Architecture CPU&quot; name=GenuineIntel pid=33900 source=runtime type=attribute</span><br><span class="line">INFO[0002] CPU property found                            arch=amd64 description=&quot;Virtualization support&quot; name=vmx pid=33900 source=runtime type=flag</span><br><span class="line">INFO[0002] CPU property found                            arch=amd64 description=&quot;64Bit CPU&quot; name=lm pid=33900 source=runtime type=flag</span><br><span class="line">INFO[0002] CPU property found                            arch=amd64 description=SSE4.1 name=sse4_1 pid=33900 source=runtime type=flag</span><br><span class="line">INFO[0002] kernel property found                         arch=amd64 description=&quot;Host kernel accelerator for virtio&quot; name=vhost pid=33900 source=runtime type=module</span><br><span class="line">INFO[0002] kernel property found                         arch=amd64 description=&quot;Host kernel accelerator for virtio network&quot; name=vhost_net pid=33900 source=runtime type=module</span><br><span class="line">INFO[0002] kernel property found                         arch=amd64 description=&quot;Host Support for Linux VM Sockets&quot; name=vhost_vsock pid=33900 source=runtime type=module</span><br><span class="line">INFO[0002] kernel property found                         arch=amd64 description=&quot;Intel KVM&quot; name=kvm_intel pid=33900 source=runtime type=module</span><br><span class="line">INFO[0002] kernel property found                         arch=amd64 description=&quot;Kernel-based Virtual Machine&quot; name=kvm pid=33900 source=runtime type=module</span><br><span class="line">System is capable of running Kata Containers</span><br></pre></td></tr></table></figure>

<p>可选的 flags 包括</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–check-version-only</td>
<td>仅对比前使用版本和最新可用版本（需要网络支持，且非 root 用户）</td>
</tr>
<tr>
<td>–include-all-releases</td>
<td>包含过滤预发布的版本</td>
</tr>
<tr>
<td>–no-network-checks</td>
<td>不借助网络执行检测</td>
</tr>
<tr>
<td>–only-list-releases</td>
<td>仅列出较新的可用版本（需要网络支持，且非 root 用户）</td>
</tr>
<tr>
<td>–strict</td>
<td>进行严格检查</td>
</tr>
<tr>
<td>–verbose</td>
<td>展示详细的检查项</td>
</tr>
</tbody></table>
<h2 id="env-kata-env"><a href="#env-kata-env" class="headerlink" title="env (kata-env)"></a>env (kata-env)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime <span class="built_in">env</span></span> </span><br><span class="line">[Kernel]</span><br><span class="line">  Path = &quot;/opt/kata/share/kata-containers/vmlinux.container&quot;</span><br><span class="line">  Parameters = &quot;systemd.unit=kata-containers.target systemd.mask=systemd-networkd.service systemd.mask=systemd-networkd.socket scsi_mod.scan=none agent.debug_console agent.debug_console_vport=1026&quot;</span><br><span class="line"></span><br><span class="line">[Meta]</span><br><span class="line">  Version = &quot;1.0.26&quot;</span><br><span class="line"></span><br><span class="line">[Image]</span><br><span class="line">  Path = &quot;/opt/kata/share/kata-containers/kata-containers.img&quot;</span><br><span class="line"></span><br><span class="line">[Initrd]</span><br><span class="line">  Path = &quot;&quot;</span><br><span class="line"></span><br><span class="line">[Hypervisor]</span><br><span class="line">  MachineType = &quot;q35&quot;</span><br><span class="line">  Version = &quot;QEMU emulator version 6.2.0 (kata-static)\nCopyright (c) 2003-2021 Fabrice Bellard and the QEMU Project developers&quot;</span><br><span class="line">  Path = &quot;/opt/kata/bin/qemu-system-x86_64&quot;</span><br><span class="line">  BlockDeviceDriver = &quot;virtio-scsi&quot;</span><br><span class="line">  EntropySource = &quot;/dev/urandom&quot;</span><br><span class="line">  SharedFS = &quot;virtio-fs&quot;</span><br><span class="line">  VirtioFSDaemon = &quot;/opt/kata/libexec/kata-qemu/virtiofsd&quot;</span><br><span class="line">  SocketPath = &quot;&lt;&lt;unknown&gt;&gt;&quot;</span><br><span class="line">  Msize9p = 8192</span><br><span class="line">  MemorySlots = 10</span><br><span class="line">  PCIeRootPort = 0</span><br><span class="line">  HotplugVFIOOnRootBus = false</span><br><span class="line">  Debug = false</span><br><span class="line"></span><br><span class="line">[Runtime]</span><br><span class="line">  Path = &quot;/usr/bin/kata-runtime&quot;</span><br><span class="line">  Debug = false</span><br><span class="line">  Trace = false</span><br><span class="line">  DisableGuestSeccomp = true</span><br><span class="line">  DisableNewNetNs = false</span><br><span class="line">  SandboxCgroupOnly = true</span><br><span class="line">  [Runtime.Config]</span><br><span class="line">    Path = &quot;/etc/kata-containers/configuration.toml&quot;</span><br><span class="line">  [Runtime.Version]</span><br><span class="line">    OCI = &quot;1.0.2-dev&quot;</span><br><span class="line">    [Runtime.Version.Version]</span><br><span class="line">      Semver = &quot;2.4.3&quot;</span><br><span class="line">      Commit = &quot;fcad969e5200607df3b0b31983cc64488e156e99&quot;</span><br><span class="line">      Major = 2</span><br><span class="line">      Minor = 4</span><br><span class="line">      Patch = 3</span><br><span class="line"></span><br><span class="line">[Host]</span><br><span class="line">  Kernel = &quot;3.10.0-957.10.5.el7.x86_64&quot;</span><br><span class="line">  Architecture = &quot;amd64&quot;</span><br><span class="line">  VMContainerCapable = true</span><br><span class="line">  SupportVSocks = true</span><br><span class="line">  [Host.Distro]</span><br><span class="line">    Name = &quot;ArcherOS OS&quot;</span><br><span class="line">    Version = &quot;1.6&quot;</span><br><span class="line">  [Host.CPU]</span><br><span class="line">    Vendor = &quot;GenuineIntel&quot;</span><br><span class="line">    Model = &quot;Intel(R) Xeon(R) CPU E5-2650 v4 @ 2.20GHz&quot;</span><br><span class="line">    CPUs = 48</span><br><span class="line">  [Host.Memory]</span><br><span class="line">    Total = 131447232</span><br><span class="line">    Free = 62496172</span><br><span class="line">    Available = 63926992</span><br><span class="line"></span><br><span class="line">[Agent]</span><br><span class="line">  Debug = false</span><br><span class="line">  Trace = false</span><br></pre></td></tr></table></figure>

<p>可选的 flags 包括</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–json</td>
<td>以 JSON 格式展示</td>
</tr>
</tbody></table>
<h2 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">对于 Pod 而言是其 SandboxID</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime <span class="built_in">exec</span> 27ab74433f11c0b64e404a841d5e2f8296a723ebfa4e598b4d9d32871173b82c</span></span><br></pre></td></tr></table></figure>

<p>可选的 flags 包括</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–kata-debug-port</td>
<td>debug console 监听的端口，默认为 1026 或者 0</td>
</tr>
</tbody></table>
<h2 id="metrics"><a href="#metrics" class="headerlink" title="metrics"></a>metrics</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">对于 Pod 而言是其 SandboxID</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime metrics 27ab74433f11c0b64e404a841d5e2f8296a723ebfa4e598b4d9d32871173b82c</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HELP kata_hypervisor_fds Open FDs <span class="keyword">for</span> hypervisor.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TYPE kata_hypervisor_fds gauge</span></span><br><span class="line">kata_hypervisor_fds 122</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HELP kata_hypervisor_io_stat Process IO statistics.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TYPE kata_hypervisor_io_stat gauge</span></span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;cancelledwritebytes&quot;&#125; 0</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;rchar&quot;&#125; 5.915546e+06</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;readbytes&quot;&#125; 1.1665408e+07</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;syscr&quot;&#125; 95522</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;syscw&quot;&#125; 202276</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;wchar&quot;&#125; 3.715404e+06</span><br><span class="line">kata_hypervisor_io_stat&#123;item=&quot;writebytes&quot;&#125; 2.097152e+06</span><br></pre></td></tr></table></figure>

<h2 id="direct-volume"><a href="#direct-volume" class="headerlink" title="direct-volume"></a>direct-volume</h2><h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime direct-volume add --volume-path /var/lib/kubelet/pods/8c3d29ad-84b8-45f0-9fcc-8e16778cb3cb/volumes/kubernetes.io~csi/pvc-a950ed68-622c-4ec4-81fa-506f16de2196/mount --mount-info \&#123;\&quot;volume-type\&quot;:\&quot;block\&quot;,\&quot;device\&quot;:\&quot;/dev/sdm\&quot;,\&quot;fstype\&quot;:\&quot;xfs\&quot;\&#125;</span></span><br></pre></td></tr></table></figure>

<p>可选的 flags 包括</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–volume-path</td>
<td>待操作的目标卷路径</td>
</tr>
<tr>
<td>–mount-info</td>
<td>管理卷挂载的详情信息</td>
</tr>
</tbody></table>
<h3 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime direct-volume delete --volume-path /var/lib/kubelet/pods/8c3d29ad-84b8-45f0-9fcc-8e16778cb3cb/volumes/kubernetes.io~csi/pvc-a950ed68-622c-4ec4-81fa-506f16de2196/mount</span></span><br></pre></td></tr></table></figure>

<p>可选的 flags 包括</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–volume-path</td>
<td>待操作的目标卷路径</td>
</tr>
</tbody></table>
<h3 id="stats"><a href="#stats" class="headerlink" title="stats"></a>stats</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime direct-volume stats --volume-path /var/lib/kubelet/pods/8c3d29ad-84b8-45f0-9fcc-8e16778cb3cb/volumes/kubernetes.io~csi/pvc-a950ed68-622c-4ec4-81fa-506f16de2196/mount</span></span><br></pre></td></tr></table></figure>

<p>可选的 flags 包括</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–volume-path</td>
<td>待操作的目标卷路径</td>
</tr>
</tbody></table>
<h3 id="resize"><a href="#resize" class="headerlink" title="resize"></a>resize</h3><p><em>截至 Kata Containers 2.4.3，社区仍未实现</em></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime direct-volume resize --volume-path /var/lib/kubelet/pods/8c3d29ad-84b8-45f0-9fcc-8e16778cb3cb/volumes/kubernetes.io~csi/pvc-a950ed68-622c-4ec4-81fa-506f16de2196/mount --size 1756519562</span></span><br></pre></td></tr></table></figure>

<p>可选的 flags 包括</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–volume-path</td>
<td>待操作的目标卷路径</td>
</tr>
<tr>
<td>–size</td>
<td>调整后的预期卷大小（单位为：Byte）</td>
</tr>
</tbody></table>
<h2 id="factory"><a href="#factory" class="headerlink" title="factory"></a>factory</h2><h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kata-runtime factory init</span><br><span class="line">vm factory initialized</span><br></pre></td></tr></table></figure>

<h3 id="status"><a href="#status" class="headerlink" title="status"></a>status</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kata-runtime factory status</span><br><span class="line">vm factory is on</span><br></pre></td></tr></table></figure>

<h3 id="destroy"><a href="#destroy" class="headerlink" title="destroy"></a>destroy</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kata-runtime factory destroy</span><br><span class="line">vm factory destroyed</span><br></pre></td></tr></table></figure>

<h2 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h2><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime iptables get --sandbox-id xxx --v6</span></span><br></pre></td></tr></table></figure>

<p>可选的 flags 包括</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–sandbox-id</td>
<td>待操作的 Sandbox ID</td>
</tr>
<tr>
<td>–v6</td>
<td>获取 IPV6 的 iptables</td>
</tr>
</tbody></table>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-runtime iptables <span class="built_in">set</span> --sandbox-id xxx --v6 ./iptables</span></span><br></pre></td></tr></table></figure>

<p>可选的 flags 包括</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–sandbox-id</td>
<td>待操作的 Sandbox ID</td>
</tr>
<tr>
<td>–v6</td>
<td>设置 IPV6 的 iptables</td>
</tr>
</tbody></table>
<h1 id="Kata-Monitor"><a href="#Kata-Monitor" class="headerlink" title="Kata Monitor"></a>Kata Monitor</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kata-monitor</span></span><br><span class="line">INFO[0000] announce                                      app=kata-monitor arch=amd64 git-commit=fcad969e5200607df3b0b31983cc64488e156e99 go-version=go1.16.10 listen-address=&quot;127.0.0.1:8090&quot; log-level=info os=linux runtime-endpoint=/run/containerd/containerd.sock version=0.3.0</span><br></pre></td></tr></table></figure>

<p>可选的 flags 包括</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–listen-address</td>
<td>监听 HTTP 请求的地址，默认为 127.0.0.1:8090</td>
</tr>
<tr>
<td>–log-level</td>
<td>服务日志级别，可选有 trace&#x2F;debug&#x2F;info&#x2F;warn&#x2F;error&#x2F;fatal&#x2F;panic，默认为 info</td>
</tr>
<tr>
<td>–runtime-endpoint</td>
<td>CRI 容器运行时服务的 socket 地址，默认为 &#x2F;run&#x2F;containerd&#x2F;containerd.sock</td>
</tr>
</tbody></table>
</div><div class="article-licensing box"><div class="licensing-title"><p>「 Kata Containers 」基础使用</p><p><a href="http://shenxianghong.github.io/2021/04/15/2021-04-15 Kata Containers 基础使用/">http://shenxianghong.github.io/2021/04/15/2021-04-15 Kata Containers 基础使用/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Shen Xianghong</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-04-15</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-05-08</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i> <a class="link-muted" rel="tag" href="/tags/Kata-Containers/">Kata Containers </a></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/04/22/2021-04-22%20Kata%20Containers%20%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">「 Kata Containers 」源码编译</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/04/06/2021-04-06%20Kata%20Containers%20%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%BB%84%E4%BB%B6%E6%A6%82%E8%BF%B0/"><span class="level-item">「 Kata Containers 」架构与组件概述</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars.githubusercontent.com/u/35031258?v=4" alt="🐾Corgi"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">🐾Corgi</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">50</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">9</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/shenxianghong" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Youtube" href="https://youtube.com"><i class="fab fa-youtube"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Bilibili" href="https://bilibili.com"><i class="fab fa-bilibili"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Reddit" href="https://reddit.com"><i class="fab fa-reddit"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://google.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Google</span></span><span class="level-right"><span class="level-item tag">google.com</span></span></a></li><li><a class="level is-mobile" href="https://freegpt.one" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ChatGPT</span></span><span class="level-right"><span class="level-item tag">freegpt.one</span></span></a></li></ul></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#安装"><span class="level-left"><span class="level-item">1</span><span class="level-item">安装</span></span></a></li><li><a class="level is-mobile" href="#CRI-配置"><span class="level-left"><span class="level-item">2</span><span class="level-item">CRI 配置</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Containerd"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Containerd</span></span></a></li><li><a class="level is-mobile" href="#CRI-O"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">CRI-O</span></span></a></li></ul></li><li><a class="level is-mobile" href="#RuntimeClass"><span class="level-left"><span class="level-item">3</span><span class="level-item">RuntimeClass</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#handler"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">handler</span></span></a></li><li><a class="level is-mobile" href="#scheduling"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">scheduling</span></span></a></li><li><a class="level is-mobile" href="#overhead"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">overhead</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Pod"><span class="level-left"><span class="level-item">4</span><span class="level-item">Pod</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#定制化的-annotation"><span class="level-left"><span class="level-item">4.1.1</span><span class="level-item">定制化的 annotation</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#VMCache"><span class="level-left"><span class="level-item">5</span><span class="level-item">VMCache</span></span></a></li><li><a class="level is-mobile" href="#VM-Templating"><span class="level-left"><span class="level-item">6</span><span class="level-item">VM Templating</span></span></a></li><li><a class="level is-mobile" href="#Kata-Runtime"><span class="level-left"><span class="level-item">7</span><span class="level-item">Kata Runtime</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#check-kata-check"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">check (kata-check)</span></span></a></li><li><a class="level is-mobile" href="#env-kata-env"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">env (kata-env)</span></span></a></li><li><a class="level is-mobile" href="#exec"><span class="level-left"><span class="level-item">7.3</span><span class="level-item">exec</span></span></a></li><li><a class="level is-mobile" href="#metrics"><span class="level-left"><span class="level-item">7.4</span><span class="level-item">metrics</span></span></a></li><li><a class="level is-mobile" href="#direct-volume"><span class="level-left"><span class="level-item">7.5</span><span class="level-item">direct-volume</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#add"><span class="level-left"><span class="level-item">7.5.1</span><span class="level-item">add</span></span></a></li><li><a class="level is-mobile" href="#remove"><span class="level-left"><span class="level-item">7.5.2</span><span class="level-item">remove</span></span></a></li><li><a class="level is-mobile" href="#stats"><span class="level-left"><span class="level-item">7.5.3</span><span class="level-item">stats</span></span></a></li><li><a class="level is-mobile" href="#resize"><span class="level-left"><span class="level-item">7.5.4</span><span class="level-item">resize</span></span></a></li></ul></li><li><a class="level is-mobile" href="#factory"><span class="level-left"><span class="level-item">7.6</span><span class="level-item">factory</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#init"><span class="level-left"><span class="level-item">7.6.1</span><span class="level-item">init</span></span></a></li><li><a class="level is-mobile" href="#status"><span class="level-left"><span class="level-item">7.6.2</span><span class="level-item">status</span></span></a></li><li><a class="level is-mobile" href="#destroy"><span class="level-left"><span class="level-item">7.6.3</span><span class="level-item">destroy</span></span></a></li></ul></li><li><a class="level is-mobile" href="#iptables"><span class="level-left"><span class="level-item">7.7</span><span class="level-item">iptables</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#get"><span class="level-left"><span class="level-item">7.7.1</span><span class="level-item">get</span></span></a></li><li><a class="level is-mobile" href="#set"><span class="level-left"><span class="level-item">7.7.2</span><span class="level-item">set</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Kata-Monitor"><span class="level-left"><span class="level-item">8</span><span class="level-item">Kata Monitor</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Container-Runtime/"><span class="level-start"><span class="level-item">Container Runtime</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Disaster-Recovery/"><span class="level-start"><span class="level-item">Disaster Recovery</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Kubernetes/"><span class="level-start"><span class="level-item">Kubernetes</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/Programming/Elegant-Coding/"><span class="level-start"><span class="level-item">Elegant Coding</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Quick-Start/"><span class="level-start"><span class="level-item">Quick Start</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Serverless/"><span class="level-start"><span class="level-item">Serverless</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Service-Mesh/"><span class="level-start"><span class="level-item">Service Mesh</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="🐾Corgi" height="28"></a><p class="is-size-7"><span>&copy; 2023 Shen Xianghong</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p><p class="is-size-7"><br/>And did you get what you wanted from this life, even so?</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>