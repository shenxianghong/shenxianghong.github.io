<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ã€Œ Kata Containers ã€æ¶æ„ä¸ç»„ä»¶æ¦‚è¿° - ğŸ¾Corgi</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="ğŸ¾Corgi"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="ğŸ¾Corgi"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Kata Containers 2.x ä¸ 1.x ç‰ˆæœ¬å·®å¼‚å¯¹æ¯”ã€æ•´ä½“æ¶æ„ä¸ç»„ä»¶åŠŸèƒ½æ¦‚è¿°"><meta property="og:type" content="blog"><meta property="og:title" content="ã€Œ Kata Containers ã€æ¶æ„ä¸ç»„ä»¶æ¦‚è¿°"><meta property="og:url" content="http://shenxianghong.github.io/2021/04/06/2021-04-06%20Kata%20Containers%20%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%BB%84%E4%BB%B6%E6%A6%82%E8%BF%B0/"><meta property="og:site_name" content="ğŸ¾Corgi"><meta property="og:description" content="Kata Containers 2.x ä¸ 1.x ç‰ˆæœ¬å·®å¼‚å¯¹æ¯”ã€æ•´ä½“æ¶æ„ä¸ç»„ä»¶åŠŸèƒ½æ¦‚è¿°"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://picsum.photos/0?sig=20210406"><meta property="article:published_time" content="2021-04-05T16:00:00.000Z"><meta property="article:modified_time" content="2023-05-04T00:54:28.323Z"><meta property="article:author" content="Shen Xianghong"><meta property="article:tag" content="Kata Containers"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://picsum.photos/0?sig=20210406"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://shenxianghong.github.io/2021/04/06/2021-04-06%20Kata%20Containers%20%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%BB%84%E4%BB%B6%E6%A6%82%E8%BF%B0/"},"headline":"ã€Œ Kata Containers ã€æ¶æ„ä¸ç»„ä»¶æ¦‚è¿°","image":[],"datePublished":"2021-04-05T16:00:00.000Z","dateModified":"2023-05-04T00:54:28.323Z","author":{"@type":"Person","name":"Shen Xianghong"},"publisher":{"@type":"Organization","name":"ğŸ¾Corgi","logo":{"@type":"ImageObject","url":"http://shenxianghong.github.io/img/logo.svg"}},"description":"Kata Containers 2.x ä¸ 1.x ç‰ˆæœ¬å·®å¼‚å¯¹æ¯”ã€æ•´ä½“æ¶æ„ä¸ç»„ä»¶åŠŸèƒ½æ¦‚è¿°"}</script><link rel="canonical" href="http://shenxianghong.github.io/2021/04/06/2021-04-06%20Kata%20Containers%20%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%BB%84%E4%BB%B6%E6%A6%82%E8%BF%B0/"><link rel="alternate" href="/atom.xml" title="ğŸ¾Corgi" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/xcode.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="ğŸ¾Corgi" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://picsum.photos/0?sig=20210406" alt="ã€Œ Kata Containers ã€æ¶æ„ä¸ç»„ä»¶æ¦‚è¿°"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="fa fa-calendar"></i>Â <time dateTime="${date_xml(page.date)}" title="${date_xml(page.date)}">2021-04-06</time></span><span class="level-item is-hidden-mobile"><i class="fa fa-calendar-check"></i>Â <time dateTime="${date_xml(page.updated)}" title="${date_xml(page.updated)}">2023-05-04</time></span><span class="level-item"><i class="far fa-folder-open"></i>Â <a class="link-muted" href="/categories/Overview/">Overview</a></span><span class="level-item"><i class="far fa-clock"></i>Â an hour read (About 7858 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">ã€Œ Kata Containers ã€æ¶æ„ä¸ç»„ä»¶æ¦‚è¿°</h1><div class="content"><div align=center><img width="200" style="border: 0px" src="https://katacontainers.io/static/logo-a1e2d09ad097b3fc8536cb77aa615c42.svg"></div>

<hr>
<blockquote>
<p>Based on <strong>v2.1.1</strong></p>
</blockquote>
<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>Kata Containers æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå®ƒé‡‡ç”¨è½»é‡åŒ–è™šæ‹Ÿæœºä½œä¸ºå®¹å™¨çš„éš”ç¦»æ¥æ„å»ºä¸€ä¸ªå®‰å…¨å®¹å™¨è¿è¡Œæ—¶ï¼Œè€Œå…¶è™šæ‹ŸåŒ–æŠ€æœ¯ä½œä¸ºå®¹å™¨çš„äºŒå±‚ä¿æŠ¤ä¸ºè´Ÿè½½æä¾›äº†æ›´å¥½çš„éš”ç¦»æ€§ï¼Œè¿™ä½¿å¾— Kata Containers å…¼å…·ä¼ ç»Ÿå®¹å™¨çš„å½¢æ€å’Œè™šæ‹Ÿæœºçš„å®‰å…¨æ€§ã€‚ æ—©åœ¨ 2015 å¹´ï¼Œæ¥è‡ªè‹±ç‰¹å°”å¼€æºæŠ€æœ¯ä¸­å¿ƒçš„å·¥ç¨‹å¸ˆå°±å¼€å§‹æ¢ç´¢é‡‡ç”¨ è‹±ç‰¹å°”Â® è™šæ‹ŸæŠ€æœ¯(è‹±ç‰¹å°”Â® Virtualization Technologyï¼Œè‹±ç‰¹å°”Â® VT)æ¥æé«˜å®¹å™¨çš„å®‰å…¨éš”ç¦»æ€§ï¼Œå¹¶ä»¥æ­¤å‘èµ·äº†è‹±ç‰¹å°”Â® Clear Containers å¼€æºé¡¹ç›®ï¼Œä¸æ­¤åŒæ—¶ï¼Œæ¥è‡ª Hyper.shï¼ˆä¸€å®¶ä¸­å›½çš„é«˜ç§‘æŠ€åˆåˆ›å…¬å¸ï¼‰çš„å·¥ç¨‹å¸ˆä¹Ÿå‘èµ·äº† runV10 å¼€æºé¡¹ç›®ï¼Œè¿™ä¸¤ä¸ªé¡¹ç›®é‡‡ç”¨çš„æŠ€æœ¯å’Œç›®çš„éƒ½éå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯ä¸ºäº†å°†å®¹å™¨ç½®äºä¸€ä¸ªå®‰å…¨â€œæ²™ç®±â€œï¼Œä»¥ä¾¿è¿›ä¸€æ­¥ä¿ƒè¿›è¯¥æŠ€æœ¯å‘å±•å’Œæˆç†Ÿã€‚éšååœ¨ 2017 å¹´ï¼Œè‹±ç‰¹å°”å’Œ Hyper.sh å›¢é˜Ÿå°†è¿™ä¸¤ä¸ªå¼€æºé¡¹ç›®åœ¨ç¤¾åŒºåˆå¹¶æˆäº†ä¸€ä¸ªæ–°çš„é¡¹ç›® Kata Containersã€‚ ä¼ ç»Ÿè™šæ‹Ÿæœºï¼ˆVMsï¼‰å¯æä¾›ç¡¬ä»¶éš”ç¦»ï¼Œè€Œå®¹å™¨å¯å¿«é€Ÿå“åº”ï¼Œä¸”å ç”¨ç©ºé—´ç›¸å¯¹è¾ƒå°ï¼ŒKata Containers å°†è¿™ä¸¤è€…çš„ä¼˜åŠ¿å®Œç¾ç»“åˆäº†èµ·æ¥ã€‚ æ¯ä¸ª container æˆ– container pod éƒ½åœ¨è‡ªå·±å•ç‹¬çš„è™šæ‹Ÿæœºä¸­å¯åŠ¨ï¼Œ å¹¶ä¸å†èƒ½å¤Ÿè®¿é—®ä¸»æœºå†…æ ¸ï¼Œæœç»äº†æ¶æ„ä»£ç ä¾µå…¥å…¶å®ƒç›¸ä¸´å®¹å™¨çš„å¯èƒ½ã€‚ç”±äº Kata Containers åŒæ—¶å…·å¤‡ç¡¬ä»¶éš”ç¦»ï¼Œä¹Ÿä½¿å¾—äº’ä¸ä¿¡ä»»çš„ç§Ÿæˆ·ï¼Œç”šè‡³äºç”Ÿäº§åº”ç”¨æˆ–å‰ç”Ÿäº§åº”ç”¨éƒ½èƒ½å¤Ÿåœ¨åŒä¸€é›†ç¾¤å†…å®‰å…¨è¿è¡Œï¼Œä»è€Œä½¿å¾—åœ¨è£¸æœºä¸Šè¿è¡Œå®¹å™¨å³æœåŠ¡ï¼ˆContainers as a Service, CaaSï¼‰æˆä¸ºå¯èƒ½ã€‚</p>
<h1 id="Guest-assets"><a href="#Guest-assets" class="headerlink" title="Guest assets"></a>Guest assets</h1><p>Kata Containers åˆ›å»ºä¸€ä¸ª VMï¼Œåœ¨å…¶ä¸­è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚éœ€è¦é€šè¿‡å¯åŠ¨ Hypervisor åˆ›å»ºè™šæ‹Ÿæœºæ¥å®ç°è¿™ä¸€ç‚¹ã€‚Hypervisor éœ€è¦ä¸¤ä¸ª assets æ¥å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼šä¸€ä¸ª Linux å†…æ ¸å’Œä¸€ä¸ªç”¨äºå¼•å¯¼ VM çš„å°å‹æ ¹æ–‡ä»¶ç³»ç»Ÿé•œåƒã€‚</p>
<h2 id="Kernel"><a href="#Kernel" class="headerlink" title="Kernel"></a>Kernel</h2><p>Guest å†…æ ¸ä¼ é€’åˆ° Hypervisor ç”¨äºå¼•å¯¼è™šæ‹Ÿæœºã€‚ Kata Containers ä¸­æä¾›äº†ä¸€ä¸ªå¯¹è™šæœºå¯åŠ¨æ—¶é—´å’Œå†…å­˜å ç”¨åšäº†é«˜åº¦ä¼˜åŒ–çš„é»˜è®¤å†…æ ¸ï¼Œä»…æä¾›äº†å®¹å™¨å·¥ä½œè´Ÿè½½æ‰€éœ€çš„å¿…è¦æœåŠ¡ã€‚è¯¥å†…æ ¸æ˜¯åŸºäºæœ€æ–°çš„ä¸Šæ¸¸ Linux å†…æ ¸åšçš„å®šåˆ¶åŒ–ã€‚</p>
<h2 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h2><p>Hypervisor ä½¿ç”¨ä¸€ä¸ªé•œåƒæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æä¾›äº†ä¸€ä¸ªæœ€å°çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œä¾› Guest å†…æ ¸ç”¨æ¥å¯åŠ¨ VM å’Œæ‰˜ç®¡ Kata å®¹å™¨ã€‚ Kata Containers æ”¯æŒåŸºäº initrd å’Œ rootfs çš„æœ€å° Guest é•œåƒï¼ˆä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰çš„ Hypervisor å‡æ”¯æŒï¼‰ã€‚é»˜è®¤åŒ…åŒæ—¶æä¾› image å’Œ initrdï¼Œä¸¤è€…éƒ½æ˜¯ä½¿ç”¨ osbuilder å·¥å…·åˆ›å»ºçš„ã€‚</p>
<h3 id="rootfs"><a href="#rootfs" class="headerlink" title="rootfs"></a>rootfs</h3><p>é»˜è®¤æ‰“åŒ…çš„ rootfs æ˜ åƒï¼Œä¹Ÿç§° mini O&#x2F;Sï¼Œæ˜¯ä¸€ä¸ªé«˜åº¦ä¼˜åŒ–çš„å®¹å™¨å¼•å¯¼ç³»ç»Ÿã€‚</p>
<p>ä½¿ç”¨æ­¤é•œåƒå¯åŠ¨ Kata å®¹å™¨çš„èƒŒåæµç¨‹ä¸ºï¼š</p>
<ol>
<li>è¿è¡Œæ—¶å°†å¯åŠ¨ Hypervisor</li>
<li>Hypervisor å°†ä½¿ç”¨ Guest å†…æ ¸å¯åŠ¨ rootfs é•œåƒ</li>
<li>å†…æ ¸å°†åœ¨ VM æ ¹ç¯å¢ƒä¸­ä»¥ PID 1ï¼ˆsystemdï¼‰å¯åŠ¨ init å®ˆæŠ¤è¿›ç¨‹</li>
<li>åœ¨ rootfs ä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„ systemd å°†åœ¨ VM çš„æ ¹ä¸Šä¸‹æ–‡ä¸­å¯åŠ¨ Kata Agent</li>
<li>Kata Agent å°†åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ç¯å¢ƒï¼Œå°†å…¶æ ¹æ–‡ä»¶ç³»ç»Ÿè®¾ç½®ä¸ºç”¨æˆ·è¯·æ±‚çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ Ubuntuã€busybox ç­‰ï¼‰</li>
<li>Kata Agent å°†åœ¨æ–°å®¹å™¨å†…æ‰§è¡Œå®¹å™¨å¯åŠ¨å‘½ä»¤</li>
</ol>
<p>ä¸‹è¡¨æ€»ç»“äº†é»˜è®¤çš„ rootfsï¼Œæ˜¾ç¤ºäº†åˆ›å»ºçš„ç¯å¢ƒã€åœ¨è¿™äº›ç¯å¢ƒä¸­è¿è¡Œçš„æœåŠ¡ï¼ˆé€‚ç”¨äºæ‰€æœ‰å¹³å°ï¼‰ä»¥åŠæ¯ä¸ªæœåŠ¡ä½¿ç”¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼š</p>
<table>
<thead>
<tr>
<th>Process</th>
<th>Environment</th>
<th>systemd service?</th>
<th>rootfs</th>
<th>User accessible</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td>systemd</td>
<td>VM root</td>
<td>n&#x2F;a</td>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/guest-assets.md#guest-image">VM guest image</a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/Developer-Guide.md#connect-to-debug-console">debug console</a></td>
<td>The init daemon, running as PID 1</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/README.md#agent">Agent</a></td>
<td>VM root</td>
<td>yes</td>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/guest-assets.md#guest-image">VM guest image</a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/Developer-Guide.md#connect-to-debug-console">debug console</a></td>
<td>Runs as a systemd service</td>
</tr>
<tr>
<td><code>chronyd</code></td>
<td>VM root</td>
<td>yes</td>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/guest-assets.md#guest-image">VM guest image</a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/Developer-Guide.md#connect-to-debug-console">debug console</a></td>
<td>Used to synchronise the time with the host</td>
</tr>
<tr>
<td>container workload (<code>sh(1)</code> in <a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/example-command.md">the example</a>)</td>
<td>VM container</td>
<td>no</td>
<td>User specified (Ubuntu in <a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/example-command.md">the example</a>)</td>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/README.md#exec-command">exec command</a></td>
<td>Managed by the agent</td>
</tr>
</tbody></table>
<div align=center><img width="600" style="border: 0px" src="/gallery/kata-containers/rootfs.png"></div>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps -ef</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;</span></span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 11:53 ?        00:00:00 /sbin/init</span><br><span class="line">root         2     0  0 11:53 ?        00:00:00 [kthreadd]</span><br><span class="line">&lt;skip...&gt;</span><br><span class="line">root        61     1  0 11:53 ?        00:00:00 /usr/bin/kata-agent</span><br><span class="line">root        71    61  0 11:53 ?        00:00:00 /pause</span><br><span class="line">root        73    61  0 11:53 ?        00:00:00 tail -f /dev/null</span><br><span class="line">root        75    61  0 11:55 pts/0    00:00:00 [bash]</span><br><span class="line">root        77    75  0 11:55 pts/0    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./usr/bin/kata-agent</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;</span></span><br><span class="line">&#123;&quot;msg&quot;:&quot;announce&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2021-07-14T14:56:42.558066805+08:00&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;pid&quot;:&quot;88325&quot;,&quot;subsystem&quot;:&quot;root&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;api-version&quot;:&quot;0.0.1&quot;,&quot;agent-version&quot;:&quot;2.1.0&quot;,&quot;config&quot;:&quot;AgentConfig &#123; debug_console: false, dev_mode: false, log_level: Info, hotplug_timeout: 3s, debug_console_vport: 0, log_vport: 0, container_pipe_size: 0, server_addr: \&quot;vsock://-1:1024\&quot;, unified_cgroup_hierarchy: false &#125;&quot;,&quot;agent-type&quot;:&quot;rust&quot;,&quot;agent-commit&quot;:&quot;2.1.0-645e950b8e0e238886adbff695a793126afb584f&quot;&#125;</span><br><span class="line">&#123;&quot;msg&quot;:&quot;starting uevents handler&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2021-07-14T14:56:42.558356885+08:00&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;pid&quot;:&quot;88325&quot;,&quot;version&quot;:&quot;0.1.0&quot;&#125;</span><br><span class="line">&#123;&quot;msg&quot;:&quot;ttRPC server started&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2021-07-14T14:56:42.558522099+08:00&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;rpc&quot;,&quot;pid&quot;:&quot;88325&quot;,&quot;address&quot;:&quot;vsock://-1:1024&quot;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="initrd"><a href="#initrd" class="headerlink" title="initrd"></a>initrd</h3><p>initrd é•œåƒæ˜¯ä¸€ä¸ªå‹ç¼©çš„ cpio(1) å½’æ¡£æ–‡ä»¶ï¼Œå®ƒæ˜¯ä»åŠ è½½åˆ°å†…å­˜ä¸­çš„ rootfs åˆ›å»ºçš„ï¼Œå¹¶ç”¨ä½œ Linux å¯åŠ¨è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå†…æ ¸å°†å…¶è§£å‹åˆ°ä¸€ä¸ªç‰¹æ®Šçš„ tmpfs æŒ‚è½½å®ä¾‹ä¸­ï¼Œè¯¥å®ä¾‹æˆä¸ºåˆå§‹æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>ä½¿ç”¨æ­¤é•œåƒå¯åŠ¨ Kata å®¹å™¨çš„èƒŒåæµç¨‹ä¸ºï¼š</p>
<ol>
<li>è¿è¡Œæ—¶å°†å¯åŠ¨ Hypervisor</li>
<li>Hypervisor å°†ä½¿ç”¨ Guest å†…æ ¸å¯åŠ¨ initrd é•œåƒ</li>
<li>å†…æ ¸å°†åœ¨ VM æ ¹ç¯å¢ƒä¸­ä»¥ PID 1ï¼ˆKata Agentï¼‰å¯åŠ¨ init å®ˆæŠ¤è¿›ç¨‹</li>
<li>Kata Agent å°†åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ç¯å¢ƒï¼Œå°†å…¶æ ¹æ–‡ä»¶ç³»ç»Ÿè®¾ç½®ä¸ºç”¨æˆ·è¯·æ±‚çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ Ubuntuã€busybox ç­‰ï¼‰</li>
<li>Kata Agent å°†åœ¨æ–°å®¹å™¨å†…æ‰§è¡Œå®¹å™¨å¯åŠ¨å‘½ä»¤</li>
</ol>
<p>ä¸‹è¡¨æ€»ç»“äº†é»˜è®¤çš„ initrdï¼Œæ˜¾ç¤ºäº†åˆ›å»ºçš„ç¯å¢ƒã€åœ¨è¿™äº›ç¯å¢ƒä¸­è¿è¡Œçš„æœåŠ¡ï¼ˆé€‚ç”¨äºæ‰€æœ‰å¹³å°ï¼‰ä»¥åŠæ¯ä¸ªæœåŠ¡ä½¿ç”¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼š</p>
<table>
<thead>
<tr>
<th>Process</th>
<th>Environment</th>
<th>rootfs</th>
<th>User accessible</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/README.md#agent">Agent</a></td>
<td>VM root</td>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/guest-assets.md#guest-image">VM guest image</a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/Developer-Guide.md#connect-to-debug-console">debug console</a></td>
<td>Runs as the init daemon (PID 1)</td>
</tr>
<tr>
<td>container workload</td>
<td>VM container</td>
<td>User specified (Ubuntu in this example)</td>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/README.md#exec-command">exec command</a></td>
<td>Managed by the agent</td>
</tr>
</tbody></table>
<div align=center><img width="600" style="border: 0px" src="/gallery/kata-containers/initrd.png"></div>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps -ef</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;</span></span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 06:23 hvc0     00:00:02 /init</span><br><span class="line">root         2     0  0 06:23 ?        00:00:00 [kthreadd]</span><br><span class="line">&lt;skip...&gt;</span><br><span class="line">root        41     1  0 06:23 hvc0     00:00:00 /pause</span><br><span class="line">root        43     1  0 06:23 hvc0     00:00:00 tail -f /dev/null</span><br><span class="line">root        45     1  0 06:24 pts/0    00:00:00 [bash]</span><br><span class="line">root        58    45  0 06:27 pts/0    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./sbin/init</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;</span></span><br><span class="line">&#123;&quot;msg&quot;:&quot;announce&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2021-07-14T14:58:37.454291069+08:00&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;pid&quot;:&quot;66236&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;subsystem&quot;:&quot;root&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;api-version&quot;:&quot;0.0.1&quot;,&quot;agent-type&quot;:&quot;rust&quot;,&quot;agent-commit&quot;:&quot;2.1.0-645e950b8e0e238886adbff695a793126afb584f&quot;,&quot;agent-version&quot;:&quot;2.1.0&quot;,&quot;config&quot;:&quot;AgentConfig &#123; debug_console: false, dev_mode: false, log_level: Info, hotplug_timeout: 3s, debug_console_vport: 0, log_vport: 0, container_pipe_size: 0, server_addr: \&quot;vsock://-1:1024\&quot;, unified_cgroup_hierarchy: false &#125;&quot;&#125;</span><br><span class="line">&#123;&quot;msg&quot;:&quot;starting uevents handler&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2021-07-14T14:58:37.455243334+08:00&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;pid&quot;:&quot;66236&quot;,&quot;source&quot;:&quot;agent&quot;&#125;</span><br><span class="line">&#123;&quot;msg&quot;:&quot;ttRPC server started&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2021-07-14T14:58:37.455325746+08:00&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;pid&quot;:&quot;66236&quot;,&quot;subsystem&quot;:&quot;rpc&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;address&quot;:&quot;vsock://-1:1024&quot;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“</strong></p>
<table>
<thead>
<tr>
<th>Image type</th>
<th>Default distro</th>
<th>Init daemon</th>
<th>Reason</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/background.md#root-filesystem-image">image</a></td>
<td><a target="_blank" rel="noopener" href="https://clearlinux.org/">Clear Linux</a> (for x86_64 systems)</td>
<td>systemd</td>
<td>Minimal and highly optimized</td>
<td>systemd offers flexibility</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/guest-assets.md#initrd-image">initrd</a></td>
<td><a target="_blank" rel="noopener" href="https://alpinelinux.org/">Alpine Linux</a></td>
<td>Kata <a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs/design/architecture/README.md#agent">agent</a> (as no systemd support)</td>
<td>Security hardened and tiny C library</td>
<td></td>
</tr>
</tbody></table>
<h2 id="osbuilder"><a href="#osbuilder" class="headerlink" title="osbuilder"></a>osbuilder</h2><p>osbuilder æœ¬èº«æ˜¯ Kata Containers é¡¹ç›®ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œä¸»è¦è´Ÿè´£æ„å»º Guest OS çš„å¼•å¯¼é•œåƒã€‚</p>
<p>Kata Containers æ”¯æŒä¸¤ç§å¼•å¯¼é•œåƒï¼šrootfs å’Œ initrdã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œé»˜è®¤éƒ½ä¼šå°† Kata Agent ç¼–è¯‘åˆ°é•œåƒä¸­ï¼Œåœ¨å¯¹ Kata Agent æœ‰å®šåˆ¶åŒ–éœ€æ±‚çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥æ‰‹åŠ¨ç¼–è¯‘åæ·»åŠ åˆ°é•œåƒä¸­ã€‚</p>
<h1 id="Virtualization"><a href="#Virtualization" class="headerlink" title="Virtualization"></a>Virtualization</h1><p>Kata å®¹å™¨æ˜¯åœ¨ä¼ ç»Ÿå‘½åç©ºé—´å®¹å™¨æä¾›çš„éš”ç¦»ä¹‹ä¸Šåˆ›å»ºçš„ç¬¬äºŒå±‚éš”ç¦»ã€‚ç¡¬ä»¶è™šæ‹ŸåŒ–æ¥å£æ˜¯è¿™ä¸ªé™„åŠ å±‚çš„åŸºç¡€ã€‚ Kata å°†å¯åŠ¨ä¸€ä¸ªè½»é‡çº§è™šæ‹Ÿæœºï¼Œå¹¶ä½¿ç”¨ Guest çš„ Linux å†…æ ¸æ¥åˆ›å»ºå®¹å™¨å·¥ä½œè´Ÿè½½ï¼Œæˆ–è€…åœ¨å¤šå®¹å™¨ Pod çš„æƒ…å†µä¸‹åˆ›å»ºå·¥ä½œè´Ÿè½½ã€‚åœ¨ Kubernetes å’Œ Kata å®ç°ä¸­ï¼Œæ²™ç®±æ˜¯åœ¨ Pod çº§åˆ«è¿›è¡Œçš„ã€‚åœ¨ Kata ä¸­ï¼Œè¿™ä¸ªæ²™ç®±æ˜¯ä½¿ç”¨è™šæ‹Ÿæœºåˆ›å»ºçš„ã€‚</p>
<h2 id="æ¦‚å¿µæ˜ å°„"><a href="#æ¦‚å¿µæ˜ å°„" class="headerlink" title="æ¦‚å¿µæ˜ å°„"></a>æ¦‚å¿µæ˜ å°„</h2><p>Kata å®¹å™¨çš„å…¸å‹éƒ¨ç½²å°†é€šè¿‡å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆå³ CRIï¼‰å®ç°åœ¨ Kubernetes ä¸­è¿›è¡Œã€‚åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼ŒKubelet å°†ä¸ CRI å®ç°è€…ï¼ˆä¾‹å¦‚ Containerd æˆ– CRI-Oï¼‰äº¤äº’ï¼Œåè€…å°†ä¾æ¬¡ä¸ Kata Containersï¼ˆåŸºäº OCI çš„è¿è¡Œæ—¶ï¼‰äº¤äº’ã€‚</p>
<div align=center><img width="700" style="border: 0px" src="/gallery/kata-containers/virtual-map.png"></div>

<h2 id="Hypervisorï¼ˆVMMï¼‰"><a href="#Hypervisorï¼ˆVMMï¼‰" class="headerlink" title="Hypervisorï¼ˆVMMï¼‰"></a>Hypervisorï¼ˆVMMï¼‰</h2><p>Kata Containers æœ¬èº«æ”¯æŒå¤šç§ hypervisor  å·¥å…·ï¼Œå¦‚ QEMUã€cloud-hypervisorã€firecrackerã€ACRN å’Œ Dragonballï¼ˆKata 3.0 å¼•å…¥ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>Hypervisor</th>
<th>Written in</th>
<th>Architectures</th>
<th>Type</th>
<th>Configuration file</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://projectacrn.org/">ACRN</a></td>
<td>C</td>
<td><code>x86_64</code></td>
<td>Type 1 (bare metal)</td>
<td><code>configuration-acrn.toml</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/cloud-hypervisor/cloud-hypervisor">Cloud Hypervisor</a></td>
<td>rust</td>
<td><code>aarch64</code>, <code>x86_64</code></td>
<td>Type 2 (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine">KVM</a>)</td>
<td><code>configuration-clh.toml</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/firecracker-microvm/firecracker">Firecracker</a></td>
<td>rust</td>
<td><code>aarch64</code>, <code>x86_64</code></td>
<td>Type 2 (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine">KVM</a>)</td>
<td><code>configuration-fc.toml</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.qemu-project.org/">QEMU</a></td>
<td>C</td>
<td>all</td>
<td>Type 2 (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine">KVM</a>)</td>
<td><code>configuration-qemu.toml</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/openanolis/dragonball-sandbox"><code>Dragonball</code></a></td>
<td>rust</td>
<td><code>aarch64</code>, <code>x86_64</code></td>
<td>Type 2 (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine">KVM</a>)</td>
<td><code>configuration-dragonball.toml</code></td>
</tr>
</tbody></table>
<p><strong>å¼‚åŒç‚¹å‚è€ƒ</strong></p>
<table>
<thead>
<tr>
<th>Hypervisor</th>
<th>Summary</th>
<th>Features</th>
<th>Limitations</th>
<th>Container Creation speed</th>
<th>Memory density</th>
<th>Use cases</th>
<th>Comment</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://projectacrn.org/">ACRN</a></td>
<td>Safety critical and real-time workloads</td>
<td></td>
<td></td>
<td>excellent</td>
<td>excellent</td>
<td>Embedded and IOT systems</td>
<td>For advanced users</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/cloud-hypervisor/cloud-hypervisor">Cloud Hypervisor</a></td>
<td>Low latency, small memory footprint, small attack surface</td>
<td>Minimal</td>
<td></td>
<td>excellent</td>
<td>excellent</td>
<td>High performance modern cloud workloads</td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/firecracker-microvm/firecracker">Firecracker</a></td>
<td>Very slimline</td>
<td>Extremely minimal</td>
<td>Doesnâ€™t support all device types</td>
<td>excellent</td>
<td>excellent</td>
<td>Serverless &#x2F; FaaS</td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.qemu-project.org/">QEMU</a></td>
<td>Lots of features</td>
<td>Lots</td>
<td></td>
<td>good</td>
<td>good</td>
<td>Good option for most users</td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/openanolis/dragonball-sandbox"><code>Dragonball</code></a></td>
<td>Built-in VMM, low CPU and memory overhead</td>
<td>Minimal</td>
<td></td>
<td>excellent</td>
<td>excellent</td>
<td>Optimized for most container workloads</td>
<td><code>out-of-the-box</code> Kata Containers experience</td>
</tr>
</tbody></table>
<h3 id="QEMU-x2F-KVM"><a href="#QEMU-x2F-KVM" class="headerlink" title="QEMU&#x2F;KVM"></a>QEMU&#x2F;KVM</h3><p>Kata Containers with QEMU ä¸ Kubernetes å®Œå…¨å…¼å®¹ï¼ˆæ­¤å¤–ï¼ŒKata ç¤¾åŒºå¯¹ QEMU ä½œäº†<a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/tree/main/tools/packaging/qemu/patches">å®šåˆ¶åŒ–çš„ patch è¡¥ä¸</a>ï¼‰</p>
<p>æ ¹æ®ä¸»æœºæ¶æ„ï¼ŒKata Containers æ”¯æŒå„ç§æœºå™¨ç±»å‹ï¼Œä¾‹å¦‚ x86 ç³»ç»Ÿä¸Šçš„ q35ã€ARM ç³»ç»Ÿä¸Šçš„ virt å’Œ IBM Power ç³»ç»Ÿä¸Šçš„ pseriesã€‚é»˜è®¤çš„ Kata Containers æœºå™¨ç±»å‹æ˜¯ q35ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æ›´æ”¹æœºå™¨ç±»å‹åŠå…¶æœºå™¨åŠ é€Ÿå™¨ã€‚</p>
<p>ä½¿ç”¨åˆ°çš„è®¾å¤‡å’Œç‰¹æ€§æœ‰ï¼š</p>
<ul>
<li>virtio VSOCK or virtio serial</li>
<li>virtio block or virtio SCSI</li>
<li><a target="_blank" rel="noopener" href="https://www.redhat.com/en/virtio-networking-series">virtio net</a></li>
<li>virtio fs or virtio 9p (recommend: virtio fs)</li>
<li>VFIO</li>
<li>hotplug</li>
<li>machine accelerators</li>
</ul>
<p>Kata å®¹å™¨ä¸­ä½¿ç”¨æœºå™¨åŠ é€Ÿå™¨å’Œçƒ­æ’æ‹”æ¥ç®¡ç†èµ„æºé™åˆ¶ã€ç¼©çŸ­å¯åŠ¨æ—¶é—´å¹¶å‡å°‘å†…å­˜å ç”¨ã€‚</p>
<h4 id="Machine-accelerators"><a href="#Machine-accelerators" class="headerlink" title="Machine accelerators"></a>Machine accelerators</h4><p>æœºå™¨åŠ é€Ÿå™¨æ˜¯ç‰¹å®šäºä½“ç³»ç»“æ„çš„ï¼Œå¯ç”¨äºæé«˜æ€§èƒ½å¹¶å¯ç”¨æœºå™¨ç±»å‹çš„ç‰¹å®šåŠŸèƒ½ã€‚ Kata å®¹å™¨ä¸­æ”¯æŒä»¥ä¸‹æœºå™¨åŠ é€Ÿå™¨ï¼š</p>
<ul>
<li>NVDIMMï¼šæ­¤æœºå™¨åŠ é€Ÿå™¨ç‰¹å®šäº x86ï¼Œå¹¶ä¸”ä»…å— q35 æœºå™¨ç±»å‹æ”¯æŒã€‚ nvdimm ç”¨äºå°†æ ¹æ–‡ä»¶ç³»ç»Ÿä½œä¸ºæŒä¹…å†…å­˜è®¾å¤‡æä¾›ç»™è™šæ‹Ÿæœº</li>
</ul>
<h4 id="è®¾å¤‡çƒ­æ’æ‹”"><a href="#è®¾å¤‡çƒ­æ’æ‹”" class="headerlink" title="è®¾å¤‡çƒ­æ’æ‹”"></a>è®¾å¤‡çƒ­æ’æ‹”</h4><p>Kata Containers VM ä»¥æœ€å°‘çš„èµ„æºå¯åŠ¨ï¼Œå…è®¸æ›´å¿«çš„å¯åŠ¨æ—¶é—´å’Œå‡å°‘å†…å­˜å ç”¨ã€‚éšç€å®¹å™¨å¯åŠ¨çš„è¿›è¡Œï¼Œè®¾å¤‡ä¼šçƒ­æ’æ‹”åˆ° VMã€‚ä¾‹å¦‚ï¼Œå½“æŒ‡å®šäº†åŒ…å«é¢å¤– CPU çš„ CPU çº¦æŸæ—¶ï¼Œå¯ä»¥çƒ­æ·»åŠ å®ƒä»¬ã€‚ Kata Containers æ”¯æŒçƒ­æ·»åŠ ä»¥ä¸‹è®¾å¤‡ï¼š</p>
<ul>
<li>Virtio block</li>
<li>Virtio SCSI</li>
<li>VFIO</li>
<li>CPU</li>
</ul>
<h3 id="Firecracker-x2F-KVM"><a href="#Firecracker-x2F-KVM" class="headerlink" title="Firecracker&#x2F;KVM"></a>Firecracker&#x2F;KVM</h3><p>Firecracker å»ºç«‹åœ¨ rust-VMM ä¸­çš„è®¸å¤š rust crate ä¸Šï¼Œå…·æœ‰éå¸¸æœ‰é™çš„è®¾å¤‡æ¨¡å‹ï¼Œæä¾›æ›´è½»çš„ä½“é‡å’Œæ”»å‡»é¢ï¼Œä¸“æ³¨äºåŠŸèƒ½å³æœåŠ¡ï¼Œå¦‚ç”¨ä¾‹ã€‚å› æ­¤ï¼Œå¸¦æœ‰ Firecracker VMM çš„ Kata å®¹å™¨æ”¯æŒ CRI API çš„ä¸€ä¸ªå­é›†ã€‚ Firecracker ä¸æ”¯æŒæ–‡ä»¶ç³»ç»Ÿå…±äº«ï¼Œå› æ­¤ä»…æ”¯æŒåŸºäºå—çš„å­˜å‚¨é©±åŠ¨ç¨‹åºã€‚ Firecracker ä¸æ”¯æŒè®¾å¤‡çƒ­æ’æ‹”ï¼Œä¹Ÿä¸æ”¯æŒ VFIOã€‚å› æ­¤ï¼Œå¸¦æœ‰ Firecracker VMM çš„ Kata Containers ä¸æ”¯æŒåœ¨å¯åŠ¨åæ›´æ–°å®¹å™¨èµ„æºï¼Œä¹Ÿä¸æ”¯æŒè®¾å¤‡é€ä¼ ã€‚</p>
<p>ä½¿ç”¨åˆ°çš„è®¾å¤‡ï¼š</p>
<ul>
<li>virtio VSOCK</li>
<li>virtio block</li>
<li>virtio net</li>
</ul>
<h3 id="Cloud-Hypervisor-x2F-KVM"><a href="#Cloud-Hypervisor-x2F-KVM" class="headerlink" title="Cloud Hypervisor&#x2F;KVM"></a>Cloud Hypervisor&#x2F;KVM</h3><p>Cloud Hypervisor åŸºäº rust-vmmï¼Œæ—¨åœ¨ä¸ºè¿è¡Œç°ä»£äº‘å·¥ä½œè´Ÿè½½æä¾›æ›´å°çš„å ç”¨ç©ºé—´å’Œæ›´å°çš„æ”»å‡»é¢ã€‚å…·æœ‰ Cloud Hypervisor çš„ Kata Containers æä¾›ä¸ Kubernetes çš„å‡ ä¹å®Œå…¨å…¼å®¹æ€§ï¼Œä¸ QEMU é…ç½®ç›¸å½“ã€‚ä» Kata Containers 1.12 å’Œ 2.0.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒCloud Hypervisor é…ç½®æ”¯æŒ CPU å’Œå†…å­˜å¤§å°è°ƒæ•´ã€è®¾å¤‡çƒ­æ’æ‹”ï¼ˆç£ç›˜å’Œ VFIOï¼‰ã€é€šè¿‡ virtio-fs å…±äº«æ–‡ä»¶ç³»ç»Ÿã€åŸºäºå—çš„å·ã€ä» VM æ˜ åƒå¯åŠ¨ç”± pmem è®¾å¤‡æ”¯æŒï¼Œå¹¶ä¸ºæ¯ä¸ª VMM çº¿ç¨‹ï¼ˆä¾‹å¦‚æ‰€æœ‰ virtio è®¾å¤‡å·¥ä½œçº¿ç¨‹ï¼‰æä¾›ç»†ç²’åº¦çš„ seccomp è¿‡æ»¤å™¨ã€‚</p>
<p>ä½¿ç”¨åˆ°çš„è®¾å¤‡å’Œç‰¹æ€§æœ‰ï¼š</p>
<ul>
<li>virtio VSOCK or virtio serial</li>
<li>virtio block</li>
<li>virtio net</li>
<li>virtio fs</li>
<li>virtio pmem</li>
<li>VFIO</li>
<li>hotplug</li>
<li>seccomp filters</li>
<li><a target="_blank" rel="noopener" href="https://github.com/cloud-hypervisor/cloud-hypervisor/blob/main/vmm/src/api/openapi/cloud-hypervisor.yaml">HTTP OpenAPI</a></li>
</ul>
<p><strong>æ€»ç»“</strong></p>
<table>
<thead>
<tr>
<th>Solution</th>
<th>release introduced</th>
<th>brief summary</th>
</tr>
</thead>
<tbody><tr>
<td>Cloud Hypervisor</td>
<td>1.10</td>
<td>upstream Cloud Hypervisor with rich feature support, e.g. hotplug, VFIO and FS sharing</td>
</tr>
<tr>
<td>Firecracker</td>
<td>1.5</td>
<td>upstream Firecracker, rust-VMM based, no VFIO, no FS sharing, no memory&#x2F;CPU hotplug</td>
</tr>
<tr>
<td>QEMU</td>
<td>1.0</td>
<td>upstream QEMU, with support for hotplug and filesystem sharing</td>
</tr>
</tbody></table>
<h1 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h1><p>Kata Containers ä¸ç°æœ‰æ ‡å‡†è¿è¡Œæ—¶å…¼å®¹ã€‚ä»å­˜å‚¨çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ„å‘³ç€å®¹å™¨å·¥ä½œè´Ÿè½½å¯èƒ½ä½¿ç”¨çš„å­˜å‚¨é‡æ²¡æœ‰é™åˆ¶ã€‚ç”±äº cgroups æ— æ³•è®¾ç½®å­˜å‚¨åˆ†é…é™åˆ¶ï¼Œå¦‚æœå¸Œæœ›é™åˆ¶å®¹å™¨ä½¿ç”¨çš„å­˜å‚¨é‡ï¼Œè¯·è€ƒè™‘ä½¿ç”¨ç°æœ‰è®¾æ–½ï¼Œä¾‹å¦‚ quota(1) é™åˆ¶æˆ– device mapper é™åˆ¶ã€‚</p>
<h2 id="virtio-SCSI"><a href="#virtio-SCSI" class="headerlink" title="virtio SCSI"></a>virtio SCSI</h2><p>virtio-scsi ç”¨äºå°†å·¥ä½œè´Ÿè½½é•œåƒï¼ˆä¾‹å¦‚ busybox:latestï¼‰å…±äº«åˆ° VM å†…çš„å®¹å™¨ç¯å¢ƒä¸­ã€‚ç°é˜¶æ®µï¼ŒKata Containers æ”¯æŒ virtio SCSI å’Œ virtio BLKï¼Œåè€…ç”±äºè¾ƒå¤šé™åˆ¶å·²ä¸åšæ¨èã€‚</p>
<h2 id="virtio-FS"><a href="#virtio-FS" class="headerlink" title="virtio FS"></a>virtio FS</h2><p>virtio-fsï¼ˆVIRTIOï¼‰è¦†ç›–æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹æ¥å…±äº«å·¥ä½œè´Ÿè½½é•œåƒã€‚Kata Agent ä½¿ç”¨æ­¤æŒ‚è½½ç‚¹ä½œä¸ºå®¹å™¨è¿›ç¨‹çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>å¯¹äº virtio-fsï¼Œè¿è¡Œæ—¶ä¸ºæ¯ä¸ªåˆ›å»ºçš„ VM å¯åŠ¨ä¸€ä¸ª virtiofsd å®ˆæŠ¤è¿›ç¨‹ï¼ˆåœ¨ä¸»æœºä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼‰ã€‚</p>
<p>Kata Containers ä½¿ç”¨è½»é‡çº§è™šæ‹Ÿæœºå’Œç¡¬ä»¶è™šæ‹ŸåŒ–æŠ€æœ¯æ¥æä¾›æ›´å¼ºéš”ç¦»ï¼Œä»¥æ„å»ºå®‰å…¨çš„å®¹å™¨è¿è¡Œæ—¶ã€‚ä½†ä¹Ÿæ­£æ˜¯å› ä¸ºä½¿ç”¨äº†è™šæ‹Ÿæœºï¼Œå®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿæ— æ³•åƒ runC é‚£æ ·ç›´æ¥ä½¿ç”¨ä¸»æœºä¸Šæ„å»ºå¥½çš„ç›®å½•ï¼Œè€Œéœ€è¦æœ‰ä¸€ç§æ–¹æ³•æŠŠ Host ä¸Šçš„ç›®å½•å…±äº«ç»™ Guestã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæœ‰ä¸¤ç§æ–¹æ³•èƒ½å¤Ÿé€ä¼  Host ç›®å½•æˆ–è€…æ•°æ®ç»™ Guestï¼Œä¸€ç§æ˜¯åŸºäº file çš„æ–¹æ¡ˆï¼Œä¸€ä¸ªæ˜¯åŸºäº block çš„æ–¹æ¡ˆã€‚è€Œè¿™ä¸¤ç§æ–¹æ¡ˆå„æœ‰åˆ©å¼Šï¼Œè¿™é‡Œåˆ†åˆ«ä»¥ 9pfs å’Œ devicemapper ä¸ºä¾‹æ¥è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>9pfs</th>
<th>devicemapper</th>
</tr>
</thead>
<tbody><tr>
<td>ä¼˜åŠ¿</td>
<td>ä½¿ç”¨ host çš„ overlayfsï¼Œå……åˆ†åˆ©ç”¨ host page cache</td>
<td>æ€§èƒ½è¾ƒå¥½ï¼ŒPOSIX è¯­ä¹‰å…¼å®¹æ€§è¾ƒå¥½</td>
</tr>
<tr>
<td>ç—›ç‚¹</td>
<td>åŸºäºç½‘ç»œåè®®ï¼Œæœªå¯¹è™šæ‹ŸåŒ–åœºæ™¯åšä¼˜åŒ–ï¼Œæ€§èƒ½è¾ƒå·®ï¼›POSIX è¯­ä¹‰å…¼å®¹æ€§ä¸å¥½</td>
<td>æ— æ³•åˆ©ç”¨ host page cacheï¼Œéœ€è¦ç»´æŠ¤ lvm volume</td>
</tr>
</tbody></table>
<p>é’ˆå¯¹ä»¥ä¸Šä¸¤ä¸ªæ–¹æ¡ˆçš„ç—›ç‚¹å’Œä¼˜åŠ¿ï¼Œvirtio-fs åœ¨æŸç§ç¨‹åº¦ä¸Šåšäº†å¾ˆå¥½çš„äº’è¡¥ï¼Œåœ¨ Kata Containers ä¸­ï¼Œæ”¯æŒä¸¤ç§æ–‡ä»¶å…±äº«æ–¹å¼ï¼švirtio-fs å’Œ virtio-9pï¼Œåœ¨ Kata Containers 2.x ä¹‹åï¼Œvirtio-fs ä½œä¸ºé»˜è®¤ä¸”æ¨èçš„æ–¹æ¡ˆé€‰æ‹©ã€‚</p>
<p>virtio-fs æœ¬èº«é‡‡ç”¨ç±»ä¼¼äº CS çš„æ¶æ„ï¼Œé€‰æ‹© FUSE ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿï¼Œè€Œéç½‘ç»œæ–‡ä»¶ç³»ç»Ÿåè®®ã€‚server ç«¯æ˜¯ä½äº host ä¸Šçš„ virtiofsdï¼Œç”¨äºå‘ Guest æä¾› fuse æœåŠ¡ï¼›client ç«¯æ˜¯æŠŠ guest kernel æŠ½è±¡æˆä¸€ä¸ª fuse clientï¼Œç”¨äºæŒ‚è½½ host ä¸Šå¯¼å‡ºçš„ç›®å½•ã€‚ä¸¤è€…ä¹‹é—´é€šè¿‡ vhost_user å»ºç«‹è¿æ¥ã€‚</p>
<p>æœ€å¤§çš„ç‰¹ç‚¹æ˜¯åˆ©ç”¨äº† VM å’Œ VMM åŒæ—¶éƒ¨ç½²åœ¨ä¸€ä¸ª host ä¸Šçš„ï¼Œæ•°æ®çš„å…±äº«è®¿é—®éƒ½æ˜¯é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼ï¼Œé¿å…äº† VM å’Œ VMM ä¹‹é—´çš„ç½‘ç»œé€šè®¯ï¼Œå…±äº«å†…å­˜è®¿é—®æ¯”åŸºäºç½‘ç»œæ–‡ä»¶ç³»ç»Ÿåè®®è®¿é—®è¦æ›´è½»é‡çº§ä¹Ÿæœ‰æ›´å¥½çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè¯­ä¹‰å’Œä¸€è‡´æ€§ã€‚åœ¨é¢å¯¹å¤š Guest è¦ mmap åŒä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œvirtio-fs ä¼šå°†è¯¥æ–‡ä»¶ mmap åˆ° QEMU çš„è¿›ç¨‹ç©ºé—´é‡Œï¼Œå…¶ä½™çš„ guest é€šè¿‡ DAX ç›´æ¥è®¿é—®ã€‚</p>
<div align=center><img width="400" style="border: 0px" src="/gallery/kata-containers/virtiofs.png"></div>

<div align=center><img width="700" style="border: 0px" src="/gallery/kata-containers/virtiofs-detail.png"></div>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">qemu è¿›ç¨‹å‚æ•°èŠ‚é€‰</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps -ef | grep qemu</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;</span></span><br><span class="line">/usr/bin/qemu-system-x86_64</span><br><span class="line">-name sandbox-f13846d4f1d58e82b2d3f461c3f2296c57992d415e32d7b41f689cf1126ee8d9</span><br><span class="line">-uuid 50041ac8-a9ed-4a60-9db1-44a55b2343d8</span><br><span class="line">-machine pc,accel=kvm,kernel_irqchip</span><br><span class="line">-cpu host,pmu=off</span><br><span class="line"> </span><br><span class="line">-device vhost-vsock-pci,disable-modern=false,vhostfd=3,id=vsock-117410659,guest-cid=117410659 -chardev socket,id=char-25f51af992a053e1,path=/run/vc/vm/f13846d4f1d58e82b2d3f461c3f2296c57992d415e32d7b41f689cf1126ee8d9/vhost-fs.sock -device vhost-user-fs-pci,chardev=char-25f51af992a053e1,tag=kataShared</span><br><span class="line"> </span><br><span class="line">-kernel /usr/share/kata-containers/vmlinux-5.10.25-85</span><br><span class="line">-initrd /usr/share/kata-containers/kata-containers-initrd-2021-07-14-11:02:27.932339999+0800-645e950</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®¿ä¸»æœºå…±äº«ç›®å½•</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ll /run/kata-containers/shared/sandboxes/f13846d4f1d58e82b2d3f461c3f2296c57992d415e32d7b41f689cf1126ee8d9/shared</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;</span></span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x 3 root root  60 Jul 19 14:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e</span><br><span class="line">            drwxr-xr-x 1 root root 40 Jul 19 14:57 rootfs</span><br><span class="line">-rw-rw-rw- 1 root root   0 Jul 19 14:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e-1b95530f54b2fab0-termination-log</span><br><span class="line">drwxrwxrwt 3 root root 140 Jul 19 14:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e-395f94e69275ce07-serviceaccount</span><br><span class="line">            lrwxrwxrwx 1 root root 13 Jul 19 14:57 ca.crt -&gt; ..data/ca.crt</span><br><span class="line">            lrwxrwxrwx 1 root root 16 Jul 19 14:57 namespace -&gt; ..data/namespace</span><br><span class="line">            lrwxrwxrwx 1 root root 12 Jul 19 14:57 token -&gt; ..data/token</span><br><span class="line">-rw-r--r-- 1 root root 212 Jul 19 14:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e-45f076005d889842-hosts</span><br><span class="line">-rw-r--r-- 1 root root 103 Jul 19 14:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e-70624933bdd41bd7-resolv.conf</span><br><span class="line">-rw-r--r-- 1 root root  15 Jul 19 14:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e-c4568deafa816abf-hostname</span><br><span class="line">drwxr-xr-x 3 root root  60 Jul 19 14:57 f13846d4f1d58e82b2d3f461c3f2296c57992d415e32d7b41f689cf1126ee8d9</span><br><span class="line">            drwxr-xr-x 1 root root 40 Jul 19 14:57 rootfs</span><br><span class="line">-rw-r--r-- 1 root root 103 Jul 19 14:57 f13846d4f1d58e82b2d3f461c3f2296c57992d415e32d7b41f689cf1126ee8d9-172f4c5d001a82b4-resolv.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è™šæ‹Ÿæœº mount ç‚¹</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mount | grep kataShared</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;</span></span><br><span class="line">kataShared on /run/kata-containers/shared/containers type virtiofs (rw,relatime)</span><br><span class="line">kataShared on /run/kata-containers/f13846d4f1d58e82b2d3f461c3f2296c57992d415e32d7b41f689cf1126ee8d9/rootfs type virtiofs (rw,relatime)</span><br><span class="line">kataShared on /run/kata-containers/6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e/rootfs type virtiofs (rw,relatime)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è™šæ‹Ÿæœºå…±äº«ç›®å½•</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> -l /run/kata-containers/shared/containers</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;</span></span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x 3 root root  60 Jul 19 06:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e</span><br><span class="line">-rw-rw-rw- 1 root root   0 Jul 19 06:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e-1b95530f54b2fab0-termination-log</span><br><span class="line">drwxrwxrwt 3 root root 140 Jul 19 06:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e-395f94e69275ce07-serviceaccount</span><br><span class="line">-rw-r--r-- 1 root root 212 Jul 19 06:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e-45f076005d889842-hosts</span><br><span class="line">-rw-r--r-- 1 root root 103 Jul 19 06:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e-70624933bdd41bd7-resolv.conf</span><br><span class="line">-rw-r--r-- 1 root root  15 Jul 19 06:57 6cc73ba11330cfbdb54bf40c77613d5f832aad01413d566ff8dabbf4e29d748e-c4568deafa816abf-hostname</span><br><span class="line">drwxr-xr-x 3 root root  60 Jul 19 06:57 f13846d4f1d58e82b2d3f461c3f2296c57992d415e32d7b41f689cf1126ee8d9</span><br><span class="line">-rw-r--r-- 1 root root 103 Jul 19 06:57 f13846d4f1d58e82b2d3f461c3f2296c57992d415e32d7b41f689cf1126ee8d9-172f4c5d001a82b4-resolv.conf</span><br></pre></td></tr></table></figure>

<div align=center><img width="600" style="border: 0px" src="/gallery/kata-containers/storage-compare.png"></div>

<h2 id="Devicemapper"><a href="#Devicemapper" class="headerlink" title="Devicemapper"></a>Devicemapper</h2><p>devicemapper snapshotter æ˜¯ä¸€ä¸ªç‰¹ä¾‹ã€‚snapshotter ä½¿ç”¨ä¸“ç”¨çš„å—è®¾å¤‡è€Œä¸æ˜¯æ ¼å¼åŒ–çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”åœ¨å—çº§åˆ«è€Œä¸æ˜¯æ–‡ä»¶çº§åˆ«è¿è¡Œã€‚ç”¨äºå®¹å™¨æ ¹æ–‡ä»¶ç³»ç»Ÿç›´æ¥ä½¿ç”¨åº•å±‚å—è®¾å¤‡è€Œä¸æ˜¯è¦†ç›–æ–‡ä»¶ç³»ç»Ÿã€‚å—è®¾å¤‡æ˜ å°„åˆ°è¦†ç›–å±‚çš„é¡¶éƒ¨è¯»å†™å±‚ã€‚ä¸ä½¿ç”¨ virtio-fs å…±äº«å®¹å™¨æ–‡ä»¶ç³»ç»Ÿç›¸æ¯”ï¼Œè¿™ç§æ–¹æ³•æä¾›äº†æ›´å¥½çš„ I&#x2F;O æ€§èƒ½ã€‚</p>
<p>Kata Containers å…·æœ‰çƒ­æ’æ‹”æ·»åŠ å’Œçƒ­æ’æ‹”ç§»é™¤å—è®¾å¤‡çš„èƒ½åŠ›ã€‚è¿™ä½¿å¾—åœ¨ VM å¯åŠ¨åå¯åŠ¨çš„å®¹å™¨å¯ä»¥ä½¿ç”¨å—è®¾å¤‡ã€‚</p>
<p>ç”¨æˆ·å¯ä»¥é€šè¿‡åœ¨å®¹å™¨å†…è°ƒç”¨ mount(8) æ¥æ£€æŸ¥å®¹å™¨æ˜¯å¦ä½¿ç”¨ devicemapper å—è®¾å¤‡ä½œä¸ºå…¶ rootfsã€‚å¦‚æœä½¿ç”¨ devicemapper å—è®¾å¤‡ï¼Œæ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆ&#x2F;ï¼‰å°†ä» &#x2F;dev&#x2F;vda æŒ‚è½½ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è¿è¡Œæ—¶é…ç½®ç¦æ­¢ç›´æ¥æŒ‚è½½åº•å±‚å—è®¾å¤‡ã€‚</p>
<h1 id="VSOCKs"><a href="#VSOCKs" class="headerlink" title="VSOCKs"></a>VSOCKs</h1><p>è™šæ‹Ÿæœºä¸­çš„è¿›ç¨‹å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¸ä¸»æœºä¸­çš„è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼š</p>
<ul>
<li>ä½¿ç”¨ä¸²å£ï¼Œè™šæ‹Ÿæœºä¸­çš„è¿›ç¨‹å¯ä»¥åœ¨ä¸²å£è®¾å¤‡è¯»&#x2F;å†™æ•°æ®ï¼Œä¸»æœºä¸­çš„è¿›ç¨‹å¯ä»¥ä»åœ¨ Unix socket è¯»&#x2F;å†™æ•°æ®ã€‚ä½†æ˜¯ï¼Œä¸²è¡Œé“¾æ¥ä¸€æ¬¡é™åˆ¶å¯¹ä¸€ä¸ªè¿›ç¨‹çš„è¯»&#x2F;å†™è®¿é—®</li>
<li>æ›´æ–°ã€æ›´ç®€å•çš„æ–¹æ³•æ˜¯ VSOCKï¼Œå®ƒå¯ä»¥æ¥å—æ¥è‡ªå¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥</li>
</ul>
<p>åœ¨ Kata Containers 2.x ä¸­å®ç°é»˜è®¤é‡‡ç”¨ Vsock çš„æ–¹å¼ï¼ˆä¾èµ– 4.8 ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸å’Œ vhost_vsock å†…æ ¸æ¨¡å—ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.----------------------.</span><br><span class="line">| .------------------. |</span><br><span class="line">| | .-----.  .-----. | |</span><br><span class="line">| | |cont1|  |cont2| | |</span><br><span class="line">| | `-----&#x27;  `-----&#x27; | |</span><br><span class="line">| |       |   |      | |</span><br><span class="line">| |    .---------.   | |</span><br><span class="line">| |    |  agent  |   | |</span><br><span class="line">| |    `---------&#x27;   | |</span><br><span class="line">| |       |   |      | |</span><br><span class="line">| | POD .-------.    | |</span><br><span class="line">| `-----| vsock |----&#x27; |</span><br><span class="line">|       `-------&#x27;      |</span><br><span class="line">|         |   |        |</span><br><span class="line">|  .------.   .------. |</span><br><span class="line">|  | shim |   | shim | |</span><br><span class="line">|  `------&#x27;   `------&#x27; |</span><br><span class="line">| Host                 |</span><br><span class="line">`----------------------&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>ä¼˜åŠ¿</strong></p>
<ul>
<li><p>é«˜å¯†åº¦ Pod</p>
<p>åœ¨ shimv1 ä½¿ç”¨ Kata Proxy å»ºç«‹ VM å’Œä¸»æœºä¹‹é—´çš„è¿æ¥ï¼Œæ¯ä¸€ä¸ª Pod çš„å†…å­˜å¤§å°å¤§æ¦‚æ˜¯ 4.5 MB å·¦å³ï¼Œåœ¨é«˜å¯†åº¦ Pod çš„é›†ç¾¤ä¸­ï¼Œå†…å­˜çš„æ¶ˆè€—è¿‡å¤§ã€‚</p>
</li>
<li><p>å¯é æ€§</p>
<p>Kata Proxy è´Ÿè´£è™šæ‹Ÿæœºå’Œä¸»æœºè¿›ç¨‹ä¹‹é—´çš„è¿æ¥ï¼Œå¦‚æœ Kata Proxy å¼‚å¸¸ï¼Œæ‰€æœ‰è¿æ¥éƒ½ä¼šä¸­æ–­ï¼Œå°½ç®¡å®¹å™¨ä»åœ¨è¿è¡Œã€‚ç”±äºé€šè¿‡ VSOCK çš„é€šä¿¡æ˜¯ç›´æ¥çš„ï¼Œä¸å®¹å™¨å¤±å»é€šä¿¡çš„å”¯ä¸€åœºæ™¯æ˜¯ VM æœ¬èº«æˆ– containerd-shim-kata-v2 å¼‚å¸¸åœæ­¢ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¹å™¨ä¹Ÿä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</p>
</li>
</ul>
<h1 id="Networking"><a href="#Networking" class="headerlink" title="Networking"></a>Networking</h1><p>Kata Containers å—é™äº hypervisor çš„åŠŸèƒ½ï¼Œæ²¡æœ‰ç›´æ¥é‡‡ç”¨ Docker é»˜è®¤çš„ Bridge ç½‘ç»œæ–¹æ¡ˆï¼Œè€Œæ˜¯é‡‡ç”¨çš„ MACVTAP æˆ–è€… TC Filterï¼ˆä½¿ç”¨ tc rules å°† veth çš„ ingress å’Œ egress é˜Ÿåˆ—åˆ†åˆ«å¯¹æ¥ tap çš„ egress å’Œ ingress é˜Ÿåˆ—å®ç° veth å’Œ tap çš„ç›´è¿ï¼‰æ–¹æ¡ˆã€‚Kata Containers æœ¬èº«æ˜¯æ”¯æŒ CNI ç®¡ç†ç½‘ç»œçš„ï¼Œç½‘ç»œæ–¹é¢ç›¸æ¯”å®¹å™¨ï¼Œè™½æœ‰é¢å¤–å¼€é”€ä½†å…¼å®¹æ€§ä¸å·®ã€‚</p>
<p>Docker é»˜è®¤é‡‡ç”¨çš„å®¹å™¨ç½‘ç»œæ–¹æ¡ˆæ˜¯åŸºäº network namespace + bridge + veth pairs çš„ï¼Œå³åœ¨ host ä¸Šåˆ›å»ºä¸€ä¸ª network namespaceï¼Œåœ¨ docker0 ç½‘æ¡¥ä¸Šè¿æ¥ veth pairs çš„ä¸€ç«¯ï¼Œå†å» network namespace ä¸­è¿ä¸Šå¦ä¸€ç«¯ï¼Œæ‰“é€šå®¹å™¨å’Œ host ä¹‹é—´çš„ç½‘ç»œã€‚<br>è¿™ç§æ–¹æ¡ˆå¾—ç›Šäº namespace æŠ€æœ¯ï¼Œè€Œè®¸å¤š hypervisor æ¯”å¦‚ QEMU ä¸èƒ½å¤„ç† veth interfacesã€‚æ‰€ä»¥ Kata Containers ä¸º VM åˆ›å»ºäº† TAP interfaces æ¥æ‰“é€š VM å’Œ host ä¹‹é—´çš„ç½‘ç»œã€‚ä¼ ç»Ÿçš„ Container Engine æ¯”å¦‚ Dockerï¼Œä¼šä¸ºå®¹å™¨åˆ›å»º network namespace å’Œ veth pairï¼Œç„¶å Kata ä¼šå°† veth pair çš„ä¸€ç«¯è¿ä¸Š TAPï¼Œå³ MACVTAP æ–¹æ¡ˆã€‚</p>
<div align=center><img width="700" style="border: 0px" src="https://github.com/kata-containers/kata-containers/blob/main/docs/design/arch-images/network.png?raw=true"></div>

<p>Kata Containers ç½‘ç»œç”± network namespacesã€tap å’Œ tc æ‰“é€šï¼Œåˆ›å»º sandbox ä¹‹å‰é¦–å…ˆåˆ›å»ºç½‘ç»œå‘½åç©ºé—´ï¼Œé‡Œé¢æœ‰ veth-pair å’Œ tap ä¸¤ç§ç½‘ç»œæ¥å£ï¼Œeth0 å±äº veth-pair ç±»å‹æ¥å£ï¼Œä¸€ç«¯æ¥å…¥ CNI åˆ›å»ºçš„ç½‘ç»œå‘½åç©ºé—´ï¼Œä¸€ç«¯æ¥å…¥å®¿ä¸»æœºï¼›tap0_kata å±äº tap ç±»å‹æ¥å£ï¼Œä¸€ç«¯æ¥å…¥ cni åˆ›å»ºçš„ç½‘ç»œå‘½åç©ºé—´ï¼Œä¸€ç«¯æ¥å…¥ QEMU åˆ›å»ºçš„ hypervisorï¼Œå¹¶ä¸”åœ¨ CNI åˆ›å»ºçš„ç½‘ç»œå‘½åç©ºé—´ä½¿ç”¨ tc ç­–ç•¥æ‰“é€š eth0 ç½‘ç»œæ¥å£å’Œ tap0_kata ç½‘ç»œæ¥å£ï¼Œç›¸å½“äºæŠŠ eth0 å’Œ tap0_kata ä¸¤ä¸ªç½‘ç»œæ¥å£è¿æˆä¸€æ¡çº¿ã€‚</p>
<p>Sandbox ç¯å¢ƒä¸­åªæœ‰ eth0 ç½‘ç»œæ¥å£ï¼Œè¿™ä¸ªæ¥å£æ˜¯ QEMU å’Œ tap æ¨¡æ‹Ÿå‡ºçš„æ¥å£ï¼Œmacã€ipã€æ©ç éƒ½å’Œå®¿ä¸»æœºä¸­ CNI åˆ›å»ºçš„ç½‘ç»œå‘½åç©ºé—´ä¸­ eth0 çš„é…ç½®ä¸€æ ·ã€‚</p>
<p>Container è¿è¡Œåœ¨ Sandbox ç¯å¢ƒä¸­ï¼ŒContainer é‡‡ç”¨å…±äº«å®¿ä¸»æœºç½‘ç»œå‘½åç©ºé—´æ–¹å¼åˆ›å»ºå®¹å™¨ï¼Œæ‰€ä»¥åœ¨ Container ä¸­çœ‹åˆ°çš„ç½‘ç»œé…ç½®å’Œ Sandbox ä¸€æ ·ã€‚</p>
<p><strong>ç½‘ç»œæµé‡èµ°å‘ï¼š</strong><br>æµé‡è¿›å…¥å®¿ä¸»æœºåé¦–å…ˆç”±ç‰©ç†ç½‘ç»œé€šè¿‡ç½‘æ¡¥æˆ–è€…è·¯ç”±æ¥å…¥åˆ°ç½‘ç»œå‘½åç©ºé—´ï¼Œç½‘ç»œå‘½åç©ºé—´ä¸­åœ¨ä½¿ç”¨ tc ç­–ç•¥ç‰µå¼•æµé‡åˆ° tap ç½‘ç»œæ¥å£ï¼Œç„¶åå†é€šè¿‡ tap ç½‘ç»œæ¥å£æŠŠæµé‡é€å…¥è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œæœ€åè™šæ‹ŸåŒ–ç¯å¢ƒä¸­çš„å®¹å™¨å…±äº«å®¿ä¸»æœºç½‘ç»œå‘½åç©ºé—´åå°±å¯ä»¥åœ¨å®¹å™¨ä¸­æ‹¿åˆ°ç½‘ç»œæµé‡ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 kata]# ip netns exec cni-d27eff58-b9c9-a258-3a1e-a34528d9796f ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: tunl0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN group default qlen 1000</span><br><span class="line">    link/ipip 0.0.0.0 brd 0.0.0.0</span><br><span class="line">4: eth0@if29: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1430 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether fe:68:1c:e3:47:da brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 10.244.166.150/32 brd 10.244.166.150 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::fc68:1cff:fee3:47da/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">5: tap0_kata: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1430 qdisc mq state UNKNOWN group default qlen 1000</span><br><span class="line">    link/ether 76:c7:1b:ab:30:64 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet6 fe80::74c7:1bff:feab:3064/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 kata]# ip netns exec cni-d27eff58-b9c9-a258-3a1e-a34528d9796f tc -s qdisc show dev eth0</span><br><span class="line">qdisc noqueue 0: root refcnt 2</span><br><span class="line"> Sent 0 bytes 0 pkt (dropped 0, overlimits 0 requeues 0)</span><br><span class="line"> backlog 0b 0p requeues 0</span><br><span class="line">qdisc ingress ffff: parent ffff:fff1 ----------------</span><br><span class="line"> Sent 480 bytes 5 pkt (dropped 0, overlimits 0 requeues 0)</span><br><span class="line"> backlog 0b 0p requeues 0</span><br><span class="line"> </span><br><span class="line">[root@node1 kata]# ip netns exec cni-d27eff58-b9c9-a258-3a1e-a34528d9796f tc -s filter show dev eth0 ingress</span><br><span class="line">filter protocol all pref 49152 u32</span><br><span class="line">filter protocol all pref 49152 u32 fh 800: ht divisor 1</span><br><span class="line">filter protocol all pref 49152 u32 fh 800::800 order 2048 key ht 800 bkt 0 terminal flowid ??? not_in_hw  (rule hit 5 success 5)</span><br><span class="line">  match 00000000/00000000 at 0 (success 5 )</span><br><span class="line">        action order 1: mirred (Egress Redirect to device tap0_kata) stolen</span><br><span class="line">        index 1 ref 1 bind 1 installed 439 sec used 437 sec</span><br><span class="line">        Action statistics:</span><br><span class="line">        Sent 480 bytes 5 pkt (dropped 0, overlimits 0 requeues 0)</span><br><span class="line">        backlog 0b 0p requeues 0</span><br><span class="line"> </span><br><span class="line">[root@node1 kata]# ip netns exec cni-d27eff58-b9c9-a258-3a1e-a34528d9796f tc -s filter show dev tap0_kata ingress</span><br><span class="line">filter protocol all pref 49152 u32</span><br><span class="line">filter protocol all pref 49152 u32 fh 800: ht divisor 1</span><br><span class="line">filter protocol all pref 49152 u32 fh 800::800 order 2048 key ht 800 bkt 0 terminal flowid ??? not_in_hw  (rule hit 12 success 12)</span><br><span class="line">  match 00000000/00000000 at 0 (success 12 )</span><br><span class="line">        action order 1: mirred (Egress Redirect to device eth0) stolen</span><br><span class="line">        index 2 ref 1 bind 1 installed 451 sec used 165 sec</span><br><span class="line">        Action statistics:</span><br><span class="line">        Sent 768 bytes 12 pkt (dropped 0, overlimits 0 requeues 0)</span><br><span class="line">        backlog 0b 0p requeues 0</span><br></pre></td></tr></table></figure>
<div align=center><img width="600" style="border: 0px" src="/gallery/kata-containers/networking2.png"></div>

<h1 id="Kata-Containers"><a href="#Kata-Containers" class="headerlink" title="Kata Containers"></a>Kata Containers</h1><h2 id="Kata-Runtime-v1"><a href="#Kata-Runtime-v1" class="headerlink" title="Kata Runtime (v1)"></a>Kata Runtime (v1)</h2><p>Kata Runtime å®ç° OCI è¿è¡Œæ—¶æ ‡å‡†ï¼Œè´Ÿè´£å¤„ç† OCI æ ‡å‡†å‘½ä»¤ï¼Œå¹¶å¯åŠ¨ Kata Shim å®ä¾‹ã€‚</p>
<h2 id="Kata-Agent-v1-amp-v2"><a href="#Kata-Agent-v1-amp-v2" class="headerlink" title="Kata Agent (v1 &amp; v2)"></a>Kata Agent (v1 &amp; v2)</h2><p>Kata Agent æ˜¯è¿è¡Œåœ¨ Kata åˆ›å»ºçš„ VM ä¸­çš„ç®¡ç†ç¨‹åºï¼Œä½¿ç”¨ libcontainer ç®¡ç†å®¹å™¨å’Œå®¹å™¨ä¸­çš„è¿›ç¨‹æœåŠ¡ã€‚å…·ä½“æ¥è¯´ï¼ŒKata Agent å€ŸåŠ© QEMUã€VIRTIO serial æˆ– VSOCK interface çš„å½¢å¼åœ¨ host ä¸Šæš´éœ²ä¸€ä¸ª socket æ–‡ä»¶ï¼Œå¹¶åœ¨ VM å†…è¿è¡Œä¸€ä¸ª gRPC server å’Œ Kata å…¶ä»–ç»„ä»¶äº¤äº’ï¼Œruntimeï¼ˆKata Runtime &amp; Containerd-Shim-Kata-V2ï¼‰ä¼šé€šè¿‡ gRPC æ¥ä¸ Kata Agent é€šä¿¡ï¼Œæ¥ç®¡ç† VM ä¸­çš„å®¹å™¨ã€‚</p>
<h2 id="Kata-Proxy-v1"><a href="#Kata-Proxy-v1" class="headerlink" title="Kata Proxy (v1)"></a>Kata Proxy (v1)</h2><p>å¯é€‰è¿›ç¨‹ï¼Œåœ¨æ”¯æŒ VSOCK çš„ç¯å¢ƒå¯ä»¥ä¸éœ€è¦ã€‚Kata Proxy ç»™å¤šä¸ª Kata Shim å’Œ Kata Runtime æä¾›å¯¹ Kata-Agent è®¿é—®å…¥å£ï¼Œè´Ÿè´£è·¯ç”± I&#x2F;O æµå’Œä¿¡å·ã€‚Kata Proxy è¿æ¥åˆ° Kata Agent çš„ socket ä¸Šã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒKata Runtime ä¼šé€šè¿‡ Kata Proxy æ¥ä¸ VM å†…çš„ Kata Agent é€šä¿¡ï¼Œç®¡ç† VM å†…å®¹å™¨è¿›ç¨‹ã€‚</p>
<h2 id="Kata-Shim-v1"><a href="#Kata-Shim-v1" class="headerlink" title="Kata Shim (v1)"></a>Kata Shim (v1)</h2><p>Kata Shim çš„å‡ºç°ä¸»è¦æ˜¯è€ƒè™‘äº† VM å†…æœ‰å¤šä¸ªå®¹å™¨çš„æƒ…å†µã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæ¯ä¸ªå®¹å™¨è¿›ç¨‹çš„å›æ”¶ç”±å¤–å±‚çš„ä¸€ä¸ª Reaper è´Ÿè´£ã€‚è€Œ Kata Containers æ–¹æ¡ˆä¸­ï¼Œå®¹å™¨è¿è¡Œåœ¨ä¸€ä¸ª VM å†…ï¼Œruntime æ˜¯æ— æ³•ç›‘æ§ã€æ§åˆ¶å’Œå›æ”¶è¿™äº› VM å†…çš„å®¹å™¨ï¼Œæœ€å¤šå°±æ˜¯çœ‹åˆ° QEMU ç­‰è¿›ç¨‹ï¼Œæ‰€ä»¥å°±è®¾è®¡äº† Kata Shimï¼Œç”¨æ¥ç›‘æ§å®¹å™¨è¿›ç¨‹ï¼Œå¤„ç†å®¹å™¨çš„æ‰€æœ‰ I&#x2F;O æµï¼Œä»¥åŠè½¬å‘æ‰€æœ‰çš„è¦å‘é€å‡ºå»çš„ä¿¡å·ã€‚Kata Runtime ä¼šä¸ºæ¯ä¸ªå®¹å™¨åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ Kata Shimï¼Œæ¯ä¸ª Pod sandboxï¼ˆinfraï¼‰ä¹Ÿä¼šæœ‰ä¸€ä¸ª Kata Shimã€‚</p>
<h2 id="Containerd-Shim-Kata-V2-v1-amp-v2"><a href="#Containerd-Shim-Kata-V2-v1-amp-v2" class="headerlink" title="Containerd-Shim-Kata-V2 (v1 &amp; v2)"></a>Containerd-Shim-Kata-V2 (v1 &amp; v2)</h2><p>åœ¨ Kata Containers v1.5 ç‰ˆæœ¬ä¹‹åï¼Œæ•´åˆäº†åŸæœ¬çš„ Kata Runtimeã€Kata Shimã€Kata Proxy ä»¥åŠ Reaper çš„åŠŸèƒ½ã€‚</p>
<p>åœ¨åŸæ–¹æ¡ˆï¼ˆv1ï¼‰ä¸­ï¼Œæ¯ä¸ª Pod éœ€è¦ 2N + 1 ä¸ª shimï¼ˆN ä»£è¡¨å®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨éœ€è¦ä¸€ä¸ª Containerd-Shim å’Œ Kata-Shimï¼Œè€Œæ¯ä¸€ä¸ª Pod sandbox ä¹Ÿéœ€è¦ä¸€ä¸ª Kata-Shimï¼‰ã€‚è€Œ Containerd-Shim-Kata-V2 å®ç°äº† <a target="_blank" rel="noopener" href="https://github.com/containerd/containerd/tree/master/runtime/v2">Containerd Runtime V2 (Shim APIï¼Œ ç”¨äº runtime å’Œ Containerd é›†æˆ)</a>ï¼ŒK8s åªéœ€è¦ä¸ºæ¯ä¸ª Podã€åŒ…æ‹¬å…¶å†…éƒ¨çš„å¤šä¸ªå®¹å™¨åˆ›å»ºä¸€ä¸ª shimv2 å°±å¤Ÿäº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ— è®º Kata-Agent çš„ gRPC server æ˜¯å¦ä½¿ç”¨ VSOCK æš´éœ²åˆ° host ä¸Šï¼Œéƒ½ä¸å†éœ€è¦å•ç‹¬çš„ Kata-Proxyã€‚</p>
<h2 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h2><div align=center><img width="800" style="border: 0px" src="https://github.com/kata-containers/kata-containers/raw/main/docs/design/arch-images/shimv2.svg"></div>

<ul>
<li>è“è‰²åŒºåŸŸä»£è¡¨çš„æ˜¯ Kubernetes CRI çš„ç»„ä»¶ï¼›çº¢è‰²åŒºåŸŸä»£è¡¨çš„æ˜¯ Kata Containers çš„ç»„ä»¶ï¼›é»„è‰²åŒºåŸŸä»£è¡¨çš„æ˜¯ Kata Containers çš„ VM</li>
<li>ShimV1 ä¸­ CRI çš„æµç¨‹åªä¼šé€šè¿‡ Kata-Proxy ï¼ˆé Vsock ç¯å¢ƒï¼‰å’Œ VM é€šä¿¡ç®¡ç†å®¹å™¨è¿›ç¨‹ç­‰</li>
<li>runc cmdline å°±æ˜¯å®ç°äº† OCI æ ‡å‡†çš„å‘½ä»¤è¡Œå·¥å…·</li>
<li>åœ¨ Kata 1.5 ä¹‹åç‰ˆæœ¬ä¸­ Kata-Runtime å¾—ä»¥ä¿ç•™ï¼Œä½†æ˜¯ä»…ç”¨ä½œå‘½ä»¤è¡Œå·¥å…·åˆ¤æ–­ Kata Containers çš„è¿è¡Œç¯å¢ƒç­‰ï¼ŒçœŸæ­£çš„ runtime ä¸º containerd-shim-kata-v2</li>
</ul>
<p><strong>Kata Containers 1.x</strong></p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/agent">agent</a></td>
<td>core</td>
<td>Management process running inside the virtual machine &#x2F; POD that sets up the container environment.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/documentation">documentation</a></td>
<td>documentation</td>
<td>Documentation common to all components (such as design and install documentation).</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/ksm-throttler">KSM throttler</a></td>
<td>optional core</td>
<td>Daemon that monitors containers and deduplicates memory to maximize container density on the host.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/osbuilder">osbuilder</a></td>
<td>infrastructure</td>
<td>Tool to create â€œmini O&#x2F;Sâ€ rootfs and initrd images for the hypervisor.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/packaging">packaging</a></td>
<td>infrastructure</td>
<td>Scripts and metadata for producing packaged binaries (components, hypervisors, kernel and rootfs).</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/proxy">proxy</a></td>
<td>core</td>
<td>Multiplexes communications between the shims, agent and runtime.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/runtime">runtime</a></td>
<td>core</td>
<td>Main component run by a container manager and providing a containerd shimv2 runtime implementation.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/shim">shim</a></td>
<td>core</td>
<td>Handles standard I&#x2F;O and signals on behalf of the container process.</td>
</tr>
</tbody></table>
<p><strong>Kata Containers 2.x</strong></p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/tools/agent-ctl">agent-ctl</a></td>
<td>utility</td>
<td>Tool that provides low-level access for testing the agent.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/src/agent">agent</a></td>
<td>core</td>
<td>Management process running inside the virtual machine &#x2F; POD that sets up the container environment.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/docs">documentation</a></td>
<td>documentation</td>
<td>Documentation common to all components (such as design and install documentation).</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/tools/osbuilder">osbuilder</a></td>
<td>infrastructure</td>
<td>Tool to create â€œmini O&#x2F;Sâ€ rootfs and initrd images for the hypervisor.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/tools/packaging">packaging</a></td>
<td>infrastructure</td>
<td>Scripts and metadata for producing packaged binaries (components, hypervisors, kernel and rootfs).</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/src/runtime">runtime</a></td>
<td>core</td>
<td>Main component run by a container manager and providing a containerd shimv2 runtime implementation.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/kata-containers/kata-containers/blob/main/src/trace-forwarder">trace-forwarder</a></td>
<td>utility</td>
<td>Agent tracing helper.</td>
</tr>
</tbody></table>
<p><strong>ä¸ Kubernetes é›†æˆæ¶æ„</strong></p>
<div align=center><img width="800" style="border: 0px" src="/gallery/kata-containers/with-kubernetes.png"></div>

<h1 id="æµç¨‹ç¤ºä¾‹"><a href="#æµç¨‹ç¤ºä¾‹" class="headerlink" title="æµç¨‹ç¤ºä¾‹"></a>æµç¨‹ç¤ºä¾‹</h1><p>ä»¥å®¹å™¨åˆ›å»ºæµç¨‹ä¸ºä¾‹ï¼Œåˆæ­¥ç†è§£ä¸‹ Kata Containers æ˜¯å¦‚ä½•è¿ä½œ</p>
<ol>
<li>ç”¨æˆ·é€šè¿‡ç±»ä¼¼äº <code>sudo ctr run --runtime &quot;io.containerd.kata.v2&quot; --rm -t &quot;quay.io/libpod/ubuntu:latest&quot; foo sh</code> å‘½ä»¤è¯·æ±‚ Container Manager åˆ›å»ºå®¹å™¨</li>
<li>Container Manager å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨ Kata è¿è¡Œæ—¶çš„å•ä¸ªå®ä¾‹ï¼Œå³ containerd-shim-kata-v2</li>
<li>Kata è¿è¡Œæ—¶åŠ è½½é…ç½®æ–‡ä»¶</li>
<li>Container Manager è°ƒç”¨ä¸€ç»„ shimv2 çš„ API</li>
<li>Kata è¿è¡Œæ—¶å¯åŠ¨é…ç½®å¥½çš„ Hypervisor</li>
<li>Hypervisor ä½¿ç”¨ Guest èµ„æºé…ç½®åˆ›å»ºå¹¶å¯åŠ¨ï¼ˆå¼•å¯¼ï¼‰VM<ol>
<li>Hypervisor DAX å°† Guest é•œåƒå…±äº«åˆ° VM ä¸­æˆä¸º VM rootfsï¼ˆå®‰è£…åœ¨ &#x2F;dev&#x2F;pmem* è®¾å¤‡ä¸Šï¼‰ï¼Œå³ VM æ ¹ç¯å¢ƒ</li>
<li>Hypervisor ä½¿ç”¨ virtio FS å°† OCI bundle å®‰è£…åˆ° VM çš„ rootfs å†…çš„å®¹å™¨ç‰¹å®šç›®å½•ä¸­ï¼ˆè¿™ä¸ªå®¹å™¨ç‰¹å®šç›®å½•å°†æˆä¸ºå®¹å™¨ rootfsï¼Œç§°ä¸ºå®¹å™¨ç¯å¢ƒï¼‰</li>
</ol>
</li>
<li>Kata Agent ä½œä¸º VM å¯åŠ¨çš„ä¸€éƒ¨åˆ†</li>
<li>è¿è¡Œæ—¶è°ƒç”¨ Kata Agent çš„ CreateSandbox API æ¥è¯·æ±‚ agent åˆ›å»ºå®¹å™¨<ol>
<li>Kata Agent åœ¨åŒ…å«å®¹å™¨ rootfs çš„ç‰¹å®šç›®å½•ä¸­åˆ›å»ºå®¹å™¨ç¯å¢ƒï¼ˆå®¹å™¨ç¯å¢ƒåœ¨å®¹å™¨ rootfs ç›®å½•ä¸­æ‰˜ç®¡å·¥ä½œè´Ÿè½½ï¼‰ï¼ˆagent åˆ›å»ºçš„å®¹å™¨ç¯å¢ƒç›¸å½“äº runc OCI è¿è¡Œæ—¶åˆ›å»ºçš„å®¹å™¨ç¯å¢ƒï¼›Linux cgroups å’Œå‘½åç©ºé—´ç”± Guest å†…æ ¸åœ¨ VM å†…åˆ›å»ºï¼Œç”¨äºå°†å·¥ä½œè´Ÿè½½ä¸åˆ›å»ºå®¹å™¨çš„ VM ç¯å¢ƒéš”ç¦»å¼€æ¥ï¼‰</li>
<li>Kata Agent åœ¨å®¹å™¨ç¯å¢ƒä¸­ç”Ÿæˆå·¥ä½œè´Ÿè½½</li>
</ol>
</li>
<li>Container Manager å°†å®¹å™¨çš„æ§åˆ¶æƒè¿”å›ç»™è¿è¡Œ ctr å‘½ä»¤çš„ç”¨æˆ·</li>
</ol>
</div><div class="article-licensing box"><div class="licensing-title"><p>ã€Œ Kata Containers ã€æ¶æ„ä¸ç»„ä»¶æ¦‚è¿°</p><p><a href="http://shenxianghong.github.io/2021/04/06/2021-04-06 Kata Containers æ¶æ„ä¸ç»„ä»¶æ¦‚è¿°/">http://shenxianghong.github.io/2021/04/06/2021-04-06 Kata Containers æ¶æ„ä¸ç»„ä»¶æ¦‚è¿°/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Shen Xianghong</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-04-06</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-05-04</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i>Â <a class="link-muted" rel="tag" href="/tags/Kata-Containers/">Kata Containers </a></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/04/15/2021-04-15%20Kata%20Containers%20%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">ã€Œ Kata Containers ã€åŸºç¡€ä½¿ç”¨</span></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars.githubusercontent.com/u/35031258?v=4" alt="ğŸ¾Corgi"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">ğŸ¾Corgi</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">50</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">9</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/shenxianghong" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Youtube" href="https://youtube.com"><i class="fab fa-youtube"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Bilibili" href="https://bilibili.com"><i class="fab fa-bilibili"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Reddit" href="https://reddit.com"><i class="fab fa-reddit"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://google.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Google</span></span><span class="level-right"><span class="level-item tag">google.com</span></span></a></li><li><a class="level is-mobile" href="https://freegpt.one" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ChatGPT</span></span><span class="level-right"><span class="level-item tag">freegpt.one</span></span></a></li></ul></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#æ¦‚è¿°"><span class="level-left"><span class="level-item">1</span><span class="level-item">æ¦‚è¿°</span></span></a></li><li><a class="level is-mobile" href="#Guest-assets"><span class="level-left"><span class="level-item">2</span><span class="level-item">Guest assets</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Kernel"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Kernel</span></span></a></li><li><a class="level is-mobile" href="#Image"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Image</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#rootfs"><span class="level-left"><span class="level-item">2.2.1</span><span class="level-item">rootfs</span></span></a></li><li><a class="level is-mobile" href="#initrd"><span class="level-left"><span class="level-item">2.2.2</span><span class="level-item">initrd</span></span></a></li></ul></li><li><a class="level is-mobile" href="#osbuilder"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">osbuilder</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Virtualization"><span class="level-left"><span class="level-item">3</span><span class="level-item">Virtualization</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#æ¦‚å¿µæ˜ å°„"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">æ¦‚å¿µæ˜ å°„</span></span></a></li><li><a class="level is-mobile" href="#Hypervisorï¼ˆVMMï¼‰"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Hypervisorï¼ˆVMMï¼‰</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#QEMU-x2F-KVM"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">QEMU/KVM</span></span></a></li><li><a class="level is-mobile" href="#Firecracker-x2F-KVM"><span class="level-left"><span class="level-item">3.2.2</span><span class="level-item">Firecracker/KVM</span></span></a></li><li><a class="level is-mobile" href="#Cloud-Hypervisor-x2F-KVM"><span class="level-left"><span class="level-item">3.2.3</span><span class="level-item">Cloud Hypervisor/KVM</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Storage"><span class="level-left"><span class="level-item">4</span><span class="level-item">Storage</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#virtio-SCSI"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">virtio SCSI</span></span></a></li><li><a class="level is-mobile" href="#virtio-FS"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">virtio FS</span></span></a></li><li><a class="level is-mobile" href="#Devicemapper"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">Devicemapper</span></span></a></li></ul></li><li><a class="level is-mobile" href="#VSOCKs"><span class="level-left"><span class="level-item">5</span><span class="level-item">VSOCKs</span></span></a></li><li><a class="level is-mobile" href="#Networking"><span class="level-left"><span class="level-item">6</span><span class="level-item">Networking</span></span></a></li><li><a class="level is-mobile" href="#Kata-Containers"><span class="level-left"><span class="level-item">7</span><span class="level-item">Kata Containers</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Kata-Runtime-v1"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">Kata Runtime (v1)</span></span></a></li><li><a class="level is-mobile" href="#Kata-Agent-v1-amp-v2"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">Kata Agent (v1 &amp; v2)</span></span></a></li><li><a class="level is-mobile" href="#Kata-Proxy-v1"><span class="level-left"><span class="level-item">7.3</span><span class="level-item">Kata Proxy (v1)</span></span></a></li><li><a class="level is-mobile" href="#Kata-Shim-v1"><span class="level-left"><span class="level-item">7.4</span><span class="level-item">Kata Shim (v1)</span></span></a></li><li><a class="level is-mobile" href="#Containerd-Shim-Kata-V2-v1-amp-v2"><span class="level-left"><span class="level-item">7.5</span><span class="level-item">Containerd-Shim-Kata-V2 (v1 &amp; v2)</span></span></a></li><li><a class="level is-mobile" href="#æ•´ä½“æ¶æ„"><span class="level-left"><span class="level-item">7.6</span><span class="level-item">æ•´ä½“æ¶æ„</span></span></a></li></ul></li><li><a class="level is-mobile" href="#æµç¨‹ç¤ºä¾‹"><span class="level-left"><span class="level-item">8</span><span class="level-item">æµç¨‹ç¤ºä¾‹</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Code-Walkthrough/"><span class="level-start"><span class="level-item">Code Walkthrough</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Getting-Started/"><span class="level-start"><span class="level-item">Getting Started</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Meetup/"><span class="level-start"><span class="level-item">Meetup</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Overview/"><span class="level-start"><span class="level-item">Overview</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/Programming/Elegant-Coding/"><span class="level-start"><span class="level-item">Elegant Coding</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Quick-Start/"><span class="level-start"><span class="level-item">Quick Start</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="ğŸ¾Corgi" height="28"></a><p class="is-size-7"><span>&copy; 2023 Shen Xianghong</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p><p class="is-size-7"><br/>And did you get what you wanted from this life, even so?</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>