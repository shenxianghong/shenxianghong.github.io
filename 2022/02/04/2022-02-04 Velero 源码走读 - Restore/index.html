<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ã€Œ Velero ã€æºç èµ°è¯» â€” Restore - ğŸ¾Corgi</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="ğŸ¾Corgi"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="ğŸ¾Corgi"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Velero ä¸­ä¸ Restore ç›¸å…³çš„æºç èµ°è¯»"><meta property="og:type" content="blog"><meta property="og:title" content="ã€Œ Velero ã€æºç èµ°è¯» â€” Restore"><meta property="og:url" content="http://shenxianghong.github.io/2022/02/04/2022-02-04%20Velero%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20Restore/"><meta property="og:site_name" content="ğŸ¾Corgi"><meta property="og:description" content="Velero ä¸­ä¸ Restore ç›¸å…³çš„æºç èµ°è¯»"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://picsum.photos/0?sig=20220204"><meta property="article:published_time" content="2022-02-03T16:00:00.000Z"><meta property="article:modified_time" content="2023-05-08T07:34:39.376Z"><meta property="article:author" content="Shen Xianghong"><meta property="article:tag" content="Velero"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://picsum.photos/0?sig=20220204"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://shenxianghong.github.io/2022/02/04/2022-02-04%20Velero%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20Restore/"},"headline":"ã€Œ Velero ã€æºç èµ°è¯» â€” Restore","image":[],"datePublished":"2022-02-03T16:00:00.000Z","dateModified":"2023-05-08T07:34:39.376Z","author":{"@type":"Person","name":"Shen Xianghong"},"publisher":{"@type":"Organization","name":"ğŸ¾Corgi","logo":{"@type":"ImageObject","url":"http://shenxianghong.github.io/img/logo.svg"}},"description":"Velero ä¸­ä¸ Restore ç›¸å…³çš„æºç èµ°è¯»"}</script><link rel="canonical" href="http://shenxianghong.github.io/2022/02/04/2022-02-04%20Velero%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20Restore/"><link rel="alternate" href="/atom.xml" title="ğŸ¾Corgi" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/xcode.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="ğŸ¾Corgi" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://picsum.photos/0?sig=20220204" alt="ã€Œ Velero ã€æºç èµ°è¯» â€” Restore"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="fa fa-calendar"></i>Â <time dateTime="${date_xml(page.date)}" title="${date_xml(page.date)}">2022-02-04</time></span><span class="level-item"><i class="fa fa-calendar-check"></i>Â <time dateTime="${date_xml(page.updated)}" title="${date_xml(page.updated)}">2023-05-08</time></span><span class="level-item"><i class="far fa-folder-open"></i>Â <a class="link-muted" href="/categories/Disaster-Recovery/">Disaster Recovery</a></span><span class="level-item"><i class="far fa-clock"></i>Â 31 minutes read (About 4599 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">ã€Œ Velero ã€æºç èµ°è¯» â€” Restore</h1><div class="content"><div align=center><img width="170" style="border: 0px" src="https://velero.io/img/Velero.svg"></div>

<hr>
<blockquote>
<p>Based on <strong>v1.6.3</strong></p>
</blockquote>
<h1 id="Restore"><a href="#Restore" class="headerlink" title="Restore"></a>Restore</h1><p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/vmware-tanzu/velero/release-1.6/pkg/apis/velero/v1/restore.go">API</a></p>
<h2 id="restore"><a href="#restore" class="headerlink" title="restore"></a>restore</h2><p><em><u>pkg&#x2F;cmd&#x2F;cli&#x2F;restore&#x2F;restore</u></em></p>
<p>velero restore åŒ…æ‹¬ 5 ä¸ªå­å‘½ä»¤ï¼šcreateã€deleteã€describeã€get å’Œ logsã€‚</p>
<h2 id="create"><a href="#create" class="headerlink" title="create"></a>create</h2><p><em><u>pkg&#x2F;cmd&#x2F;cli&#x2F;restore&#x2F;create.go</u></em></p>
<p><strong>æ ¡éªŒè§„åˆ™</strong></p>
<ul>
<li>â€“from-backup å’Œ â€“from-schedule å‚æ•°æœ‰ä¸”ä»…èƒ½æœ‰ä¸€ä¸ª</li>
<li>åœ¨æŒ‡å®š â€“from-backup æˆ–è€… â€“from-schedule å‚æ•°æ—¶ï¼Œå…¶åœ¨é›†ç¾¤ä¸­å¿…é¡»å­˜åœ¨</li>
<li>åœ¨æŒ‡å®š â€“from-schedule å‚æ•°æ—¶ï¼Œåˆ™ç”±è¯¥ Schedule åˆ›å»ºå‡ºçš„ Backup è‡³å°‘æœ‰ä¸€ä¸ª</li>
</ul>
<p><strong>ä¸»ä½“æµç¨‹</strong></p>
<ol>
<li>å¦‚æœæŒ‡å®šäº† â€“from-schedule å‚æ•°å¹¶ä¸” â€“allow-partially-failed å‚æ•°ä¸º true æ—¶ï¼Œè·å–é›†ç¾¤ä¸­ç”±è¯¥ Schedule åˆ›å»ºå‡ºçš„çŠ¶æ€ä¸º Completed æˆ–è€… PartiallyFailed çš„æœ€æ–° Backupï¼Œä½œä¸ºæ¢å¤çš„åŸºå‡†ï¼Œå¹¶ä¸”å°† â€“from-schedule ä¿¡æ¯ç½®ç©ºï¼›å¦åˆ™ï¼Œåˆ™ç›´æ¥é€ä¼  â€“from-schedule ä¿¡æ¯ç”¨äºåç»­æ„å»º Restore å¯¹è±¡</li>
<li>æ ¹æ®å‘½ä»¤è¡Œå‚æ•°ï¼Œæ„å»º Restore å¯¹è±¡ï¼Œä¸‹å‘è‡³é›†ç¾¤ä¸­åˆ›å»ºï¼Œåç»­ç”± Restore Controller è´Ÿè´£ç»´æŠ¤</li>
<li>å¦‚æœå¼€å¯äº† â€“waitï¼Œåˆ™å¯åŠ¨ informer ç›‘å¬ Restore å¯¹è±¡çŠ¶æ€ï¼Œé˜»å¡ç›´è‡³çŠ¶æ€ä¸å†æ˜¯ New æˆ–è€… InProgress</li>
</ol>
<h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><p><em><u>pkg&#x2F;cmd&#x2F;cli&#x2F;restore&#x2F;delete.go</u></em></p>
<p><strong>æ ¡éªŒè§„åˆ™</strong></p>
<ul>
<li>nameã€â€“all å’Œ â€“selector å‚æ•°æœ‰ä¸”ä»…èƒ½æœ‰ä¸€ä¸ª</li>
<li>è¦åˆ é™¤çš„ Restore åœ¨é›†ç¾¤ä¸­å¿…é¡»å­˜åœ¨</li>
</ul>
<p><strong>ä¸»ä½“æµç¨‹</strong></p>
<ol>
<li>æ ¹æ®å‘½ä»¤è¡Œå‚æ•°ï¼Œè·å–é›†ç¾¤ä¸­çš„ Restore èµ„æºå¹¶åˆ é™¤</li>
</ol>
<h2 id="describe"><a href="#describe" class="headerlink" title="describe"></a>describe</h2><p><em><u>pkg&#x2F;cmd&#x2F;cli&#x2F;restore&#x2F;describe.go</u></em></p>
<p><strong>æ ¡éªŒè§„åˆ™</strong></p>
<ul>
<li>è¦è·å–çš„ Restore åœ¨é›†ç¾¤ä¸­å¿…é¡»å­˜åœ¨</li>
</ul>
<p><strong>ä¸»ä½“æµç¨‹</strong></p>
<ol>
<li>è·å–åˆ° PodVolumeRestore ä¿¡æ¯</li>
<li>å°†ä»¥ä¸Šä¿¡æ¯å’Œ Restore çš„å…ƒä¿¡æ¯ã€è§„æ ¼ã€çŠ¶æ€ä»¥åŠ Pod å·æ•°æ®æ¢å¤ç­‰æ±‡æ€»ä½œä¸ºæè¿°ä¿¡æ¯æ ¼å¼åŒ–è¾“å‡º<ul>
<li>å¦‚æœ Restore ä¸­æœ‰ Error æˆ–è€… Warning çš„æ—¥å¿—æ—¶ï¼Œä¼šæ„å»º DownloadRequest å¯¹è±¡è·å–  RestoreResults çš„ä¿¡æ¯ï¼Œå±•ç¤ºåŸå› </li>
<li>åœ¨å¼€å¯ â€“details æ—¶ï¼Œä¼šè¾“å‡ºæ¢å¤çš„ Pod å·ä¿¡æ¯</li>
</ul>
</li>
</ol>
<h2 id="get"><a href="#get" class="headerlink" title="get"></a>get</h2><p><em><u>pkg&#x2F;cmd&#x2F;cli&#x2F;restore&#x2F;get.go</u></em></p>
<p><strong>æ ¡éªŒè§„åˆ™</strong></p>
<ul>
<li>è¦è·å–çš„ Restore åœ¨é›†ç¾¤ä¸­å¿…é¡»å­˜åœ¨</li>
</ul>
<p><strong>ä¸»ä½“æµç¨‹</strong></p>
<ol>
<li>è·å–åˆ° Restore èµ„æºï¼Œæ ¹æ® â€“output æŒ‡å®šçš„æ ·å¼æ ¼å¼åŒ–è¾“å‡º</li>
</ol>
<h2 id="logs"><a href="#logs" class="headerlink" title="logs"></a>logs</h2><p><em><u>pkg&#x2F;cmd&#x2F;cli&#x2F;restore&#x2F;logs.go</u></em></p>
<p><strong>æ ¡éªŒè§„åˆ™</strong></p>
<ul>
<li>è¦è·å–çš„ Restore åœ¨é›†ç¾¤ä¸­å¿…é¡»å­˜åœ¨</li>
<li>Restore çš„çŠ¶æ€å¿…é¡»ä¸º Completedã€PartiallyFailed æˆ–è€… Failed</li>
</ul>
<p><strong>ä¸»ä½“æµç¨‹</strong></p>
<ol>
<li>æ ¹æ®å‘½ä»¤è¡Œå‚æ•°ï¼Œæ„å»º DownloadRequest å¯¹è±¡ï¼Œä¸‹å‘è‡³é›†ç¾¤ä¸­åˆ›å»º RestoreLogï¼Œä¸‹å‘è‡³é›†ç¾¤ä¸­åˆ›å»ºï¼Œåç»­ç”± DownloadRequest Controller è´Ÿè´£ç»´æŠ¤ï¼Œè·å– RestoreLog çš„ä¿¡æ¯</li>
<li>é˜»å¡ç›´è‡³ DownloadRequest çš„ DownloadURL è¢«è®¾ç½®ï¼Œå°†å†…å®¹å†™å…¥ stdout ä¸­</li>
</ol>
<h1 id="PodVolumeRestore"><a href="#PodVolumeRestore" class="headerlink" title="PodVolumeRestore"></a>PodVolumeRestore</h1><p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/vmware-tanzu/velero/release-1.6/pkg/apis/velero/v1/pod_volume_restore.go">API</a> </p>
<p>å¯¹è±¡ä¸æ”¯æŒæ‰‹åŠ¨åˆ›å»ºï¼Œè€Œæ˜¯åœ¨æ¢å¤æµç¨‹ä¸­ï¼Œç”± Restore Controller è°ƒç”¨ <strong>restoreItem</strong>ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ª Pod å·ï¼Œåˆ›å»ºä¸€ä¸ªè¯¥å¯¹è±¡ã€‚</p>
<h1 id="Restore-Controller"><a href="#Restore-Controller" class="headerlink" title="Restore Controller"></a>Restore Controller</h1><p><em><u>pkg&#x2F;controller&#x2F;restore_controller.go</u></em><br><em><u>pkg&#x2F;restore&#x2F;restore.go</u></em></p>
<h2 id="NewRestoreController"><a href="#NewRestoreController" class="headerlink" title="NewRestoreController"></a>NewRestoreController</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/controller/restore_controller.go#L99">NewRestoreController æºç </a></p>
<p>å·¥å‚å‡½æ•°</p>
<ol>
<li>æ³¨å†Œ Generic Controller ä¸­çš„ syncHandler å’Œ resyncFunc</li>
<li>ç›‘å¬ Restore èµ„æºçš„ Add äº‹ä»¶ï¼Œå°†çŠ¶æ€æ˜¯ç©ºæˆ–è€… New çš„ Restore ä»¥ keyï¼ˆnamespace&#x2F;nameï¼‰çš„å½¢å¼åŠ å…¥ Generic Controller çš„ queue ä¸­</li>
</ol>
<h2 id="processQueueItem"><a href="#processQueueItem" class="headerlink" title="processQueueItem"></a>processQueueItem</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/controller/restore_controller.go#L178">processQueueItem æºç </a></p>
<p>æ³¨å†Œåœ¨ Generic Controller ä¸­ syncHandler çš„å®ç°</p>
<ol>
<li>å‡½æ•°å…¥å‚å°±æ˜¯ Generic Controller çš„ queue ä¸­å¾…å¤„ç†çš„ Restore keyï¼Œé€šè¿‡è§£æè·å–çš„ namespace å’Œ name æŸ¥è¯¢åˆ°é›†ç¾¤ä¸­çš„ Restore å¯¹è±¡</li>
<li>ä»…å¤„ç†çŠ¶æ€ä¸ºç©ºæˆ–è€… New çš„ Restore å¯¹è±¡ï¼Œè°ƒç”¨ <strong>processRestore</strong>ï¼Œæ‰§è¡Œæ¢å¤</li>
</ol>
<h2 id="processRestore"><a href="#processRestore" class="headerlink" title="processRestore"></a>processRestore</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/controller/restore_controller.go#L215">processRestore æºç </a></p>
<p>æ¢å¤çš„æ•´ä½“æµç¨‹</p>
<ol>
<li><p>è°ƒç”¨ <strong>validateAndComplete</strong> åšä¸€äº›æ ¡éªŒå‡†å¤‡å·¥ä½œï¼Œå¹¶æ ¹æ®æ ¡éªŒç»“æœè®¾ç½®çŠ¶æ€ä¸º Restore çš„çŠ¶æ€ä¸º FailedValidation æˆ–è€… InProgress</p>
</li>
<li><p>è¿‡æ»¤æ‰æ ¡éªŒå¤±è´¥çš„ Restoreï¼Œè°ƒç”¨ <strong>runValidatedRestore</strong>ï¼Œæ‰§è¡Œæ¢å¤å’Œä¸Šä¼ æ¢å¤ä¿¡æ¯çš„æµç¨‹</p>
</li>
<li><p>æ ¹æ®æ­¥éª¤ 2 çš„æ¢å¤ç»“æœï¼Œè®¾ç½® Restore çš„çŠ¶æ€</p>
<ul>
<li>å¦‚æœæœ‰é”™è¯¯è¿”å›ï¼ˆå‡½æ•°è¿”å› errorï¼‰ï¼Œåˆ™è®¤ä¸ºæ¢å¤å¤±è´¥ï¼Œå°† Restore çŠ¶æ€è®¾ä¸º Failed</li>
<li>å¦‚æœ Restore çš„ Errors å­˜åœ¨é”™è¯¯ä¿¡æ¯ï¼Œåˆ™ä¸ºéƒ¨åˆ†å¤±è´¥ï¼Œå°† Restore çŠ¶æ€è®¾ä¸º PartiallyFailed</li>
<li>å¦åˆ™è®¤ä¸º Restore å·²å®Œå…¨æ¢å¤ï¼Œå°† Restore çŠ¶æ€è®¾ä¸º Completed</li>
</ul>
<p><em>runValidatedRestore æ‰§è¡Œæ¢å¤è¿‡ç¨‹ä¸­ä¼šè®¾ç½® Restore å¯¹è±¡çš„ status.Errors å’Œ status.Warning ä¿¡æ¯</em></p>
</li>
</ol>
<h2 id="validateAndComplete"><a href="#validateAndComplete" class="headerlink" title="validateAndComplete"></a>validateAndComplete</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/controller/restore_controller.go#L288">validateAndComplete æºç </a></p>
<p>æ ¡éªŒ Restore å¯¹è±¡å¹¶è¿”å› backupInfo ä¿¡æ¯</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> backupInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">	backup      *api.Backup</span><br><span class="line">	location    *velerov1api.BackupStorageLocation</span><br><span class="line">	backupStore persistence.BackupStore</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>åœ¨ Restore å¯¹è±¡çš„ ExcludedResources ä¸­è¿½åŠ ä»¥ä¸‹èµ„æºï¼ˆä»¥ä¸‹èµ„æºä¼šè¢«å¤‡ä»½ï¼Œä½†æ˜¯ä¸ä¼šè¢«æ¢å¤ï¼‰<ul>
<li>nodes</li>
<li>events</li>
<li>events.events.k8s.io</li>
<li>backups.velero.io</li>
<li>restores.velero.io</li>
<li>resticrepositories.velero.io</li>
</ul>
</li>
<li>æ ¡éªŒ Restore å¯¹è±¡çš„ IncludedResources ä¸­æ˜¯å¦åŒ…å«ä¸Šè¿°èµ„æº</li>
<li>æ ¡éªŒ included&#x2F;excluded resources&#x2F;namespaces ä¿¡æ¯ä»¥åŠ â€“from-backup å’Œ â€“from-schedule æ˜¯å¦æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª</li>
<li>å¦‚æœæŒ‡å®šäº† â€“from-scheduleï¼Œåˆ™æ ¡éªŒå¹¶è·å– Schedule ä¸‹æœ€æ–°çš„ä¸€æ¬¡ Backupï¼Œå¹¶è®¾ç½®åœ¨ Restore ä¸­<br><em>å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ â€“from-backup å¿…ç„¶è®¾ç½®äº†ï¼Œå› æ­¤å°±ä¸éœ€è¦è®¾ç½® Restore çš„ Backup ä¿¡æ¯äº†</em></li>
<li>æ ¹æ® Restore çš„ Backup ä¿¡æ¯ï¼ŒæŸ¥è¯¢å¹¶è¿”å› BackupStorageLocationã€Backup å’Œ StorageProvider ä¿¡æ¯</li>
</ol>
<h2 id="runValidatedRestore"><a href="#runValidatedRestore" class="headerlink" title="runValidatedRestore"></a>runValidatedRestore</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/controller/restore_controller.go#L430">runValidatedRestore æºç </a></p>
<p>æ¢å¤çš„æ•´ä½“æµç¨‹</p>
<ol>
<li><p>è·å–æ³¨å†Œçš„ RestoreItemActions æ’ä»¶<br><em>åç»­åœ¨è°ƒç”¨ <strong>Restore</strong> å‡½æ•°æ¢å¤æ—¶ä¼šä½¿ç”¨åˆ°</em></p>
</li>
<li><p>è°ƒç”¨ StorageProvider çš„ GetBackupContents æ¥å£ï¼Œè·å–åˆ° Backup å†…å®¹æ–‡ä»¶ä¿¡æ¯ï¼Œå†™å…¥ä¸´æ—¶æ–‡ä»¶ä¸­</p>
</li>
<li><p>æ ¹æ® Restore ä¸­çš„ Backup åç§°ä¿¡æ¯ï¼Œè·å–åˆ°é›†ç¾¤ä¸­ PodVolumeBackup ä¿¡æ¯</p>
</li>
<li><p>è°ƒç”¨ StorageProvider çš„ GetBackupVolumeSnapshots æ¥å£ï¼Œè·å–åˆ° VolumeSnapshot ä¿¡æ¯</p>
</li>
<li><p>ç”¨ä»¥ä¸Šä¿¡æ¯æ„å»º Restore Requestï¼ˆåŸç†ç±»ä¼¼ Backup çš„ Requestï¼Œä¸åšèµ˜è¿°ï¼‰ï¼Œå…¶ä¸­ BackupReader ä¸ºæ­¥éª¤ 2 ä¸­çš„ä¸´æ—¶æ–‡ä»¶å¥æŸ„</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Request <span class="keyword">struct</span> &#123;</span><br><span class="line">	*velerov1api.Restore</span><br><span class="line"></span><br><span class="line">	Log              logrus.FieldLogger</span><br><span class="line">	Backup           *velerov1api.Backup</span><br><span class="line">	PodVolumeBackups []*velerov1api.PodVolumeBackup</span><br><span class="line">	VolumeSnapshots  []*volume.Snapshot</span><br><span class="line">	BackupReader     io.Reader</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è°ƒç”¨ <strong>Restore</strong> è¿›è¡Œæ¢å¤ï¼Œè¿”å›æ¢å¤çš„ç»“æœ</p>
</li>
<li><p>é‡æ–°è·å– StorageProviderï¼Œé¿å…é•¿æ—¶é—´æ¢å¤ä¸­è®¤è¯ä¿¡æ¯å˜åŠ¨</p>
</li>
<li><p>å…³é—­æ—¥å¿—æ–‡ä»¶ï¼Œæœ¬æ¬¡æ¢å¤ä»»åŠ¡æ—¥å¿—è®°å½•å®Œæ¯•ï¼Œè°ƒç”¨ StorageProvider çš„ PutRestoreLog æ¥å£ï¼Œå°†æ¢å¤ä»»åŠ¡çš„æ—¥å¿—ä¿¡æ¯ä¸Šä¼ è‡³ BackupStorageLocation </p>
</li>
<li><p>ç»Ÿè®¡ Warning å’Œ Error çº§åˆ«æ—¥å¿—æ•°é‡ï¼Œæ›´æ–°è‡³ Restore å¯¹è±¡ä¸­ï¼Œå¹¶æ„å»º Result å¯¹è±¡ï¼ˆå³ä»£ç å—ä¸­çš„ m å¯¹è±¡ï¼‰ï¼Œè®°å½•è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ—¥å¿—ä¿¡æ¯</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">restore.Status.Warnings = <span class="built_in">len</span>(restoreWarnings.Velero) + <span class="built_in">len</span>(restoreWarnings.Cluster)</span><br><span class="line"><span class="keyword">for</span> _, w := <span class="keyword">range</span> restoreWarnings.Namespaces &#123;</span><br><span class="line">	restore.Status.Warnings += <span class="built_in">len</span>(w)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restore.Status.Errors = <span class="built_in">len</span>(restoreErrors.Velero) + <span class="built_in">len</span>(restoreErrors.Cluster)</span><br><span class="line"><span class="keyword">for</span> _, e := <span class="keyword">range</span> restoreErrors.Namespaces &#123;</span><br><span class="line">	restore.Status.Errors += <span class="built_in">len</span>(e)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m := <span class="keyword">map</span>[<span class="type">string</span>]pkgrestore.Result&#123;</span><br><span class="line">	<span class="string">&quot;warnings&quot;</span>: restoreWarnings,</span><br><span class="line">	<span class="string">&quot;errors&quot;</span>:   restoreErrors,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è°ƒç”¨ StorageProvider çš„ PutRestoreResults æ¥å£ï¼Œå°† Result ä¿¡æ¯ä¸Šä¼ è‡³ BackupStorageLocation ä¸­</p>
</li>
</ol>
<p>è°ƒç”¨ StorageProvider æ¥å£ä¸Šä¼ çš„å…·ä½“æ–‡ä»¶å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>BackupStorageLocation ä¸­çš„æ–‡ä»¶</th>
<th>æ•°æ®æº</th>
</tr>
</thead>
<tbody><tr>
<td>Log</td>
<td>restore-&lt;restore&gt;-logs.gz</td>
<td>æ­¥éª¤ 8 ä¸­æœ€ç»ˆç”Ÿæˆçš„ log æ–‡ä»¶</td>
</tr>
<tr>
<td>Results</td>
<td>restore-&lt;restore&gt;-results.gz</td>
<td>æ­¥éª¤ 9 ä¸­æœ€ç»ˆç”Ÿæˆçš„ Result å¯¹è±¡</td>
</tr>
</tbody></table>
<h2 id="Restore-1"><a href="#Restore-1" class="headerlink" title="Restore"></a>Restore</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/restore/restore.go#L159">Restore æºç </a></p>
<p>æ¢å¤åŠ¨ä½œæœ¬èº«çš„æµç¨‹</p>
<ol>
<li>è·å–åˆ° resource &amp; namespace çš„ included &amp; excludedã€resources hook ä»¥åŠ resolvedActionsï¼ˆRestoreItemActionï¼‰ï¼Œæ„å»º Restore Contextï¼ŒContext æ˜¯ç”¨äºæ‰§è¡Œæ¢å¤æ‰€éœ€è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
<li>å°† request ä¸­çš„ BackupReader è§£å‹ï¼Œå¹¶å°†å†…å®¹è§£ææˆ Backup çš„èµ„æºä¿¡æ¯</li>
<li>å¦‚æœ Velero å¼€å¯äº† APIGroupVersions ç‰¹æ€§ï¼Œè°ƒç”¨ <a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/restore/prioritize_group_version.go#L46">chooseAPIVersionsToRestore</a> å¯¹å¤š API Group Versions çš„èµ„æºé€‰æ‹©ä¸€ä¸ªè¦æ¢å¤çš„ç‰ˆæœ¬</li>
<li>ç”Ÿæˆ update é˜Ÿåˆ—ï¼Œç”¨äºè®°å½• Restore çŠ¶æ€ä¿¡æ¯ï¼ŒåŒæ—¶å¯åŠ¨ä¸€ä¸ª Goroutine ç›‘å¬é˜Ÿåˆ—ï¼Œæ¯ç§’é’Ÿè·å–ä¸€æ¬¡ update é˜Ÿåˆ—ä¸­çš„è¿›åº¦å¹¶æ›´æ–°è‡³é›†ç¾¤çš„ Restore ä¸­</li>
<li>é¦–å…ˆæ¢å¤ CRD èµ„æºï¼Œè°ƒç”¨ <strong>getOrderedResourceCollection</strong> å…ˆè·å–è¦æ¢å¤çš„ CRD èµ„æºé›†åˆï¼Œè°ƒç”¨ <strong>processSelectedResource</strong> å¼€å§‹æ¢å¤</li>
<li>æ¥ä¸‹æ¥è°ƒç”¨ <strong>getOrderedResourceCollection</strong> è·å–å‰©ä½™å¾…æ¢å¤èµ„æºçš„æœ‰åºé›†åˆï¼Œå¹¶è°ƒç”¨ <strong>processSelectedResource</strong> æ¢å¤<br><em>å†…ç½®çš„æ¢å¤é¡ºåºä¸ºï¼š<br>1. customresourcedefinitions<br />2. namespaces<br />3. storageclasses<br />4. volumesnapshotclass.snapshot.storage.k8s.io<br />5. volumesnapshotcontents.snapshot.storage.k8s.io<br />6. volumesnapshots.snapshot.storage.k8s.io<br />7. persistentvolumes<br />8. persistentvolumeclaims<br />9. secrets<br />10. configmaps<br />11. serviceaccounts<br />12. limitranges<br />13. pods<br />14. replicasets.apps<br />15. clusters.cluster.x-k8s.io<br />16. clusterresourcesets.addons.cluster.x-k8s.io</em></li>
<li>å…ƒæ•°æ®æ¢å¤å·²ç»å®Œæˆï¼Œæ›´æ–°é›†ç¾¤ä¸­ Restore çš„è¿›åº¦ä¿¡æ¯</li>
<li>ç­‰å¾… Restic æ¢å¤æ‰€æœ‰çš„ Pod å·æ•°æ®<br><em>PodVolumeRestore çš„åˆ›å»ºä½äºæ­¥éª¤ 6 ä¸­</em></li>
<li>ç­‰å¾… post restore exec hook æ‰§è¡Œå®Œæ¯•</li>
</ol>
<h2 id="getOrderedResourceCollection"><a href="#getOrderedResourceCollection" class="headerlink" title="getOrderedResourceCollection"></a>getOrderedResourceCollection</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/restore/restore.go#L1642">getOrderedResourceCollection æºç </a></p>
<p>æ„å»ºè¦æ¢å¤çš„èµ„æºå¯¹è±¡çš„æœ‰åºé›†åˆ</p>
<ol>
<li>æ„å»ºéœ€è¦æ¢å¤çš„èµ„æºåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­å…ƒç´ ä¸ºèµ„æºçš„åç§°ï¼Œæ¯”å¦‚ customresourcedefinitions ç­‰</li>
<li>é’ˆå¯¹æ¯ä¸€ä¸ªèµ„æºåç§°ï¼Œæ„å»º GroupResourceï¼Œè·³è¿‡å·²ç»å¤„ç†çš„ã€è¢« included å’Œ excluded æ’é™¤åœ¨å¤–çš„ã€ç±»å‹ä¸º namespace çš„ GroupResource</li>
<li>é’ˆå¯¹è¯¥ GroupResource çš„æ¯ä¸€ç»„èµ„æºå®ä¾‹ï¼ˆè¿™ç»„èµ„æºå®ä¾‹æ˜¯ä»¥ namespace åšçš„åˆ’åˆ†ï¼‰ï¼Œå¦‚æœè¯¥èµ„æºå®ä¾‹çš„å‘½åç©ºé—´è¢«æ’é™¤ï¼Œåˆ™å¿½ç•¥ï¼›å¦åˆ™ï¼Œæ ¹æ®æ¢å¤æ—¶çš„å‘½åç©ºé—´æ˜ å°„å…³ç³»ï¼Œè·å–æœ€ç»ˆè¦åˆ›å»ºæ¢å¤èµ„æºçš„å‘½åç©ºé—´</li>
<li>å¦‚æœæœ€ç»ˆè¦æ¢å¤åˆ°çš„å‘½åç©ºé—´ä¸ºç©ºï¼Œä»£è¡¨è¯¥èµ„æºæ˜¯é›†ç¾¤çº§åˆ«çš„ï¼Œå¹¶ä¸”åœ¨æœªæŒ‡å®šåŒ…å«å…¨éƒ¨å‘½åç©ºé—´æˆ–è€…æŒ‡å®šäº†ç‰¹å®šæ¢å¤çš„å‘½åç©ºé—´çš„æƒ…å†µï¼Œåˆ™å¿½ç•¥</li>
<li>é’ˆå¯¹æ¯ä¸€ç»„èµ„æºå®ä¾‹ä¸­çš„å…·ä½“èµ„æºï¼Œæ ¹æ® Backup çš„ Content ç›®å½•è¯»å–è¯¥èµ„æºæ–‡ä»¶ä¿¡æ¯ï¼Œååºåˆ—åŒ–æˆå¯¹è±¡ç»“æ„ï¼Œæœ€ç»ˆé’ˆå¯¹è¯¥èµ„æºç»„å®ä¾‹ï¼Œæ„å»ºå‡ºä¸€ä¸ªå¯æ¢å¤ã€å¾…æ¢å¤çš„èµ„æºé›†åˆ</li>
</ol>
<h2 id="processSelectedResource"><a href="#processSelectedResource" class="headerlink" title="processSelectedResource"></a>processSelectedResource</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/restore/restore.go#L582">processSelectedResource æºç </a></p>
<p>å•ä¸ª item èµ„æºçš„æ¢å¤æµç¨‹</p>
<ol>
<li>é’ˆå¯¹æ¯ä¸€ä¸ªè¦æ¢å¤çš„ item èµ„æºï¼Œåœ¨è¦æ¢å¤åˆ°çš„å‘½åç©ºé—´ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæå‰åˆ›å»º</li>
<li>æ ¹æ® Backup çš„ Content ç›®å½•è¯»å–è¯¥èµ„æºæ–‡ä»¶ä¿¡æ¯ï¼Œååºåˆ—åŒ–æˆå¯¹è±¡ç»“æ„ï¼Œè°ƒç”¨ <strong>restoreItem</strong> è¿›è¡Œæ¢å¤</li>
<li>æ¯æ¢å¤å®Œä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™æ›´æ–°ä¸€ä¸‹ update é˜Ÿåˆ—ï¼Œä¸ŠæŠ¥æ¢å¤è¿›åº¦</li>
</ol>
<h2 id="restoreItem"><a href="#restoreItem" class="headerlink" title="restoreItem"></a>restoreItem</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/restore/restore.go#L907">restoreItem æºç </a></p>
<p>å•ä¸ª item èµ„æºçš„æ¢å¤æµç¨‹</p>
<ol>
<li>ä¼ å…¥çš„ item æ˜¯è§£æ„çŠ¶æ€çš„èµ„æºä¿¡æ¯ï¼ˆruntime.Unstructuredï¼‰</li>
<li>å¦‚æœæœ€ç»ˆè¦æ¢å¤åˆ°çš„å‘½åç©ºé—´ä¸ä¸ºç©ºï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µæå‰åˆ›å»ºï¼›å¦‚æœä¸ºç©ºï¼Œä»£è¡¨è¯¥èµ„æºæ˜¯é›†ç¾¤çº§åˆ«çš„ï¼Œåœ¨ä¸æ¢å¤é›†ç¾¤çº§åˆ«èµ„æºæ—¶ï¼Œä¼šå¿½ç•¥æ‰è¯¥èµ„æº</li>
<li>ä»¥ä¸‹èµ„æºè§†ä¸ºâ€œå®Œæˆâ€ï¼Œä¸ä¼šè¿›è¡Œæ¢å¤<ul>
<li>ç›¸ä½ä¸º Succeed æˆ–è€… Failed çš„ Pod</li>
<li>å·²ç»æœ‰å®Œæˆæ—¶é—´çš„ Job</li>
<li>å·²ç»æ¢å¤çš„èµ„æº</li>
<li>mirror Pod</li>
</ul>
</li>
<li>å¦‚æœæ¢å¤çš„èµ„æºæ˜¯ PV ç±»å‹ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹åœºæ™¯<ul>
<li>å¦‚æœè¦æ¢å¤çš„ PV ä¸­æœ‰å¿«ç…§ä¿¡æ¯ï¼Œä»£è¡¨ç€å¤‡ä»½æ—¶ SnapshotProvider æ‰§è¡Œè¿‡å¿«ç…§æ“ä½œ<br>å…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦å¯¹å…¶é‡å‘½åï¼Œä»¥ä¸‹æƒ…å†µä¸éœ€è¦é‡å‘½å<ul>
<li>æ¢å¤æ—¶æœªæŒ‡å®šå‘½åç©ºé—´æ˜ å°„å…³ç³»</li>
<li>è¦æ¢å¤çš„ PV æœªè¢«è®¤é¢†</li>
<li>è®¤é¢†è¯¥ PV çš„å‘½åç©ºé—´ä¸éœ€è¦è¢«æ˜ å°„</li>
<li>å½“å‰é›†ç¾¤ä¸­ä¸å­˜åœ¨é‡å PV<br>å¦‚æœæ¢å¤æ—¶ï¼ŒæŒ‡å®šäº†å‘½åç©ºé—´æ˜ å°„å…³ç³»ï¼Œéœ€è¦æ ¹æ®æ˜ å°„å…³ç³»ï¼Œå°†è®¤é¢† PV çš„å‘½åç©ºé—´ï¼ˆå³ spec.ClaimRef.Namespaceï¼‰è¿›è¡Œæ›´æ–°ï¼Œå¦‚æœåˆ¤æ–­åä¸éœ€è¦å¯¹ PV é‡å‘½åæ—¶ï¼Œåˆ™è¯´æ˜è¯¥ PV åº”è¯¥è¢«æ¢å¤ï¼Œåä¹‹éœ€è¦åˆ¤æ–­è¯¥ PV å¯¹è±¡æ˜¯å¦åº”è¯¥è¢«æ¢å¤ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹</li>
<li>å½“å‰é›†ç¾¤ä¸­ä¸å­˜åœ¨é‡å PVï¼Œåˆ™åº”è¯¥è¢«æ¢å¤</li>
<li>é‡å PV å¤„äº Release çŠ¶æ€ï¼Œç­‰å¾…ç›´è‡³è¶…æ—¶</li>
<li>é‡å PV æ²¡æœ‰è¢«è®¤é¢†ï¼Œåˆ™ä¸åº”è¯¥è¢«æ¢å¤</li>
<li>é‡å PV è¢«è®¤é¢†ï¼Œä½†æ˜¯æ²¡æ‰¾åˆ°ç›¸å…³ PVCï¼Œåˆ™ç­‰å¾… PVC åˆ›å»ºç›´è‡³è¶…æ—¶</li>
<li>è®¤é¢†é‡å PV çš„ PVC å¤„äºåˆ é™¤çŠ¶æ€ï¼Œç­‰å¾…ç›´è‡³è¶…æ—¶</li>
<li>è®¤é¢†é‡å PV çš„ PVC æ‰€åœ¨å‘½åç©ºé—´ä¸å­˜åœ¨æˆ–è€…å¤„äºåˆ é™¤çŠ¶æ€ï¼Œç­‰å¾…ç›´è‡³è¶…æ—¶</li>
<li><em>é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 10 åˆ†é’Ÿï¼Œæœªè¶…æ—¶æœŸé—´å†…ä¼šå‘¨æœŸæ€§åˆ¤æ–­ï¼Œä¸€æ—¦è¶…æ—¶åˆ™è¡¨ç¤ºä¸åº”è¯¥è¢«æ¢å¤</em><br>å¦‚æœ PV åº”è¯¥è¢«æ¢å¤ï¼Œåˆ™é‡ç½®ä¹‹å‰çš„ç»‘å®šä¿¡æ¯ï¼Œè°ƒç”¨ SnapshotProvider çš„ä¸€ç³»åˆ—æ¥å£æ¢å¤å·æ•°æ®ä¿¡æ¯ï¼Œå‚è€ƒ executePVActionï¼Œå¹¶æ ¹æ®éœ€è¦é‡å‘½å PV</li>
</ul>
</li>
<li>å¦‚æœè¦æ¢å¤çš„ PV çš„å·æ•°æ®æ˜¯ç”± Restic è´Ÿè´£å¤‡ä»½çš„ï¼ˆå³ PodVolumeBackup annotation ä¿¡æ¯ä¸­è®°å½•äº† pv.Spec.ClaimRef.Nameï¼‰ï¼Œåˆ™ä¸ä¼šæ¢å¤ï¼Œè€Œæ˜¯äº¤ç»™ StorageClass é‡æ–°åŠ¨æ€ä¾›åº”</li>
<li>å¦‚æœè¦æ¢å¤çš„ PV çš„å›æ”¶ç­–ç•¥ä¸º Deleteï¼Œåˆ™ä¸ä¼šæ¢å¤ï¼Œè€Œæ˜¯äº¤ç»™ StorageClass é‡æ–°åŠ¨æ€ä¾›åº”</li>
<li>å¦‚æœå¹¶éä»¥ä¸Šä»»æ„åœºæ™¯ï¼Œåˆ™ä¸éœ€è¦é¢å¤–çš„ç‰¹æ®Šæ“ä½œï¼Œé‡ç½®ç»‘å®šä¿¡æ¯ï¼Œè¿›è¡Œåç»­æµç¨‹ç›´æ¥æ¢å¤å³å¯</li>
</ul>
</li>
<li>åˆ é™¤æ‰ä¸å…³é”®çš„å…ƒä¿¡æ¯ï¼Œä»…ä¿ç•™ nameã€namespaceã€labels å’Œ annotationï¼Œå¹¶åˆ é™¤å¯¹è±¡ status ä¿¡æ¯ï¼Œæ‰§è¡Œ RestoreItemAction çš„åŠ¨ä½œ</li>
<li>å¦‚æœæ¢å¤çš„èµ„æºæ˜¯ PVC ç±»å‹ï¼Œåˆ™é‡ç½®ä¹‹å‰çš„å’Œ PV çš„ç»‘å®šä¿¡æ¯ä»¥åŠ K8s è®¾ç½®çš„ annotationï¼Œå¦‚æœè®¤é¢†çš„ PV é‡å‘½åäº†ï¼Œåˆ™åŒæ­¥æ›´æ–° PVC ä¿¡æ¯</li>
<li>æ ¹æ®å‘½åç©ºé—´æ˜ å°„å…³ç³»ï¼Œè®¾ç½® item çš„æ–°å‘½åç©ºé—´ï¼Œå¹¶è®¾ç½® velero.io&#x2F;backup-name å’Œ velero.io&#x2F;restore-name æ ‡ç­¾ä¿¡æ¯</li>
<li>åœ¨å½“å‰é›†ç¾¤ä¸­åˆ›å»º item èµ„æºï¼Œå¦‚æœ item èµ„æºå·²ç»å­˜åœ¨ï¼ˆä½†æ˜¯å´åˆä¸æ·±åº¦ä¸€è‡´ï¼‰å¹¶ä¸”æ˜¯ ServiceAccount ç±»å‹ï¼Œåˆ™ä¼šä»¥é›†ç¾¤å½“å‰çš„ ServiceAccount èµ„æºä¸ºå‡†åˆå¹¶ item èµ„æºå¹¶æ›´æ–°ï¼Œè€Œå¯¹äºå…¶ä»–ç±»å‹çš„èµ„æºåˆ™è®¤ä¸ºæ¢å¤å¤±è´¥ï¼ŒåŸå› æ˜¯å¤‡ä»½çš„ç‰ˆæœ¬å’Œæ¢å¤çš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼›è€Œå¦‚æœå·²å­˜åœ¨çš„ item å’Œå¾…æ¢å¤çš„ item æ·±åº¦ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯ä¸¤è€…ç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ä¼šæ¢å¤ï¼Œä¹Ÿä¸ä¼šè§†ä¸ºé”™è¯¯</li>
<li>å¦‚æœæ¢å¤çš„èµ„æºæ˜¯ Pod ç±»å‹ï¼Œä¼šé’ˆå¯¹æ¯ä¸€ä¸ªè¢« Restic å¤‡ä»½çš„å·ï¼Œåˆ›å»ºä¸€ä¸ª PodVolumeRestore å¯¹è±¡ï¼Œåç»­ç”± PodVolumeRestore Controller è´Ÿè´£ç»´æŠ¤ï¼ŒåŒæ—¶ï¼Œä¸»è¿›ç¨‹ä¼šé˜»å¡ç›´åˆ° PodVolumeRestore æœ‰çŠ¶æ€è¿”å›ï¼Œè¡¨ç¤ºå·æ•°æ®æ¢å¤å®Œæˆ</li>
<li>å¦‚æœæ¢å¤çš„èµ„æºæ˜¯ Pod ç±»å‹ï¼Œæ‰§è¡Œ post restore hook æ“ä½œ</li>
<li>å¦‚æœæ¢å¤çš„èµ„æºæ˜¯ CRD ç±»å‹ï¼Œåˆ™ç­‰å¾…ç›´è‡³ CRD èµ„æºå˜å¾—å¯ç”¨æ‰ç»§ç»­æ‰§è¡Œåç»­æ¢å¤æµç¨‹</li>
</ol>
<h1 id="PodVolumeRestore-Controller"><a href="#PodVolumeRestore-Controller" class="headerlink" title="PodVolumeRestore Controller"></a>PodVolumeRestore Controller</h1><p><em><u>pkg&#x2F;controller&#x2F;pod_volume_restore_controller.go</u></em><br><em><u>pkg&#x2F;restic&#x2F;exec_commands.go</u></em></p>
<h2 id="NewPodVolumeRestoreController"><a href="#NewPodVolumeRestoreController" class="headerlink" title="NewPodVolumeRestoreController"></a>NewPodVolumeRestoreController</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/controller/pod_volume_restore_controller.go#L72">NewPodVolumeRestoreController æºç </a></p>
<p>å·¥å‚å‡½æ•°</p>
<ol>
<li>æ³¨å†Œ Generic Controller ä¸­çš„ syncHandlerï¼Œå¹¶å°† PodVolumeRestoreã€Pod å’Œ PVC æ·»åŠ åˆ° cacheSyncWaitersï¼Œç­‰å¾…åŒæ­¥å®Œæˆ</li>
<li>ç›‘å¬ PodVolumeRestore èµ„æºçš„ Add å’Œ Update äº‹ä»¶ï¼Œæ ¹æ®çŠ¶æ€æ˜¯ New çš„ PodVolumeRestore èµ„æºè·å–åˆ°ç›¸å…³è”çš„ Podï¼Œå¦‚æœ Pod è¿è¡Œåœ¨æœ¬èŠ‚ç‚¹ï¼Œå¹¶ä¸” Restic Init Container å¤„äº Runningï¼Œåˆ™å°† PodVolumeRestore ä»¥ keyï¼ˆnamespace&#x2F;nameï¼‰ çš„å½¢å¼åŠ å…¥ Generic Controller çš„ queue ä¸­<br><em>restic-wait å¤„äºè¿è¡ŒçŠ¶æ€è¡¨ç¤ºï¼Œè¯¥ Pod æ­£åœ¨ç­‰å¾… Restic ä¸ºå…¶æ¢å¤å·æ•°æ®</em></li>
<li>ç›‘å¬ Pod èµ„æºçš„ Add å’Œ Update äº‹ä»¶ï¼Œé’ˆå¯¹è¿è¡Œåœ¨æœ¬èŠ‚ç‚¹ï¼Œå¹¶ä¸” Restic Init Container å¤„äº Runningï¼Œè·å–åˆ°ç›¸å…³è”çš„ PodVolumeRestore èµ„æºï¼Œå°†çŠ¶æ€æ˜¯ New çš„ PodVolumeRestore ä»¥ keyï¼ˆnamespace&#x2F;nameï¼‰ çš„å½¢å¼åŠ å…¥ Generic Controller çš„ queue ä¸­</li>
</ol>
<h2 id="processQueueItem-1"><a href="#processQueueItem-1" class="headerlink" title="processQueueItem"></a>processQueueItem</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/controller/pod_volume_restore_controller.go#L240">processQueueItem æºç </a></p>
<p>æ³¨å†Œåœ¨ Generic Controller ä¸­ syncHandler çš„å®ç°</p>
<ol>
<li>å‡½æ•°å…¥å‚å°±æ˜¯ Generic Controller çš„ queue ä¸­å¾…å¤„ç†çš„ PodVolumeRestore keyï¼Œé€šè¿‡è§£æè·å–çš„ namespace å’Œ name æŸ¥è¯¢åˆ°é›†ç¾¤ä¸­çš„ PodVolumeRestore å¯¹è±¡</li>
<li>è°ƒç”¨ <strong>processRestore</strong>ï¼Œæ‰§è¡Œå·æ•°æ®çš„å¤‡ä»½</li>
</ol>
<h2 id="processRestore-1"><a href="#processRestore-1" class="headerlink" title="processRestore"></a>processRestore</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/controller/pod_volume_restore_controller.go#L277">processRestore æºç </a></p>
<p>å·æ•°æ®æ¢å¤çš„æ•´ä½“æµç¨‹</p>
<ol>
<li>æ›´æ–° PodVolumeRestore çŠ¶æ€ä¸º InProgress</li>
<li>è·å–åˆ° PodVolumeRestore ç›¸å…³è”çš„ Podï¼Œè¿›ä¸€æ­¥è·å–åˆ° Pod å†…éƒ¨çš„æŒ‚è½½å·ç›®å½•ä¿¡æ¯</li>
<li>è°ƒç”¨ <strong>restorePodVolume</strong> æ‰§è¡Œå·æ•°æ®çš„æ¢å¤ï¼Œå¦‚æœè°ƒç”¨ç»“æœæœ‰é”™è¯¯è¿”å›ï¼Œåˆ™è®¾ç½® PodVolumeRestore çŠ¶æ€ä¸º Failed</li>
<li>æ›´æ–° PodVolumeRestore çŠ¶æ€ä¸º Completed</li>
</ol>
<h2 id="restorePodVolume"><a href="#restorePodVolume" class="headerlink" title="restorePodVolume"></a>restorePodVolume</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/controller/pod_volume_restore_controller.go#L326">restorePodVolume æºç </a></p>
<p>å€ŸåŠ© Restic èƒ½åŠ›æ¢å¤å·æ•°æ®çš„æµç¨‹</p>
<ol>
<li>æ ¹æ® Pod å†…éƒ¨çš„æŒ‚è½½å·ä¿¡æ¯å’Œ Restic Pod å†…éƒ¨çš„ &#x2F;host_pods ç›®å½•ï¼Œæ‹¼æ¥å‡ºåˆ° Pod æŒ‚è½½æ•°æ®å·ç›®å½•<br><em>æœ€ç»ˆæ•°æ®ä¼šä» Restic Repo å°†å·æ•°æ®æ¢å¤è‡³è¿™ä¸ªç›®å½•ï¼Œä¾‹å¦‚ &#x2F;host_pods&#x2F;new-pod-uid&#x2F;volumes&#x2F;volume-plugin-name&#x2F;volume-dir</em></li>
<li>ç”Ÿæˆç”¨äºè¿æ¥ Restic Repo æ‰€éœ€è¦çš„ä¸´æ—¶å¯†ç æ–‡ä»¶ï¼Œæ–‡ä»¶å›ºå®šä¸º &#x2F;tmp&#x2F;credentials&#x2F;velero&#x2F;velero-restic-credentials-repository-passwordï¼Œå†…å®¹ä¸º static-passw0rdï¼Œç”¨äº restic åŸç”Ÿå‘½ä»¤ä¸­çš„ â€“password å‚æ•°<br><em>å¯†ç ä¼šä»¥ Secret çš„å½¢å¼å­˜å‚¨åœ¨é›†ç¾¤ä¸­ï¼Œåä¸º velero-restic-credentialsï¼Œä½äº velero å‘½åç©ºé—´å†…</em></li>
<li>æ„å»º restic restore å‘½ä»¤</li>
<li>å¦‚æœ BackupStorageLocation æœ‰ caCert è¯ä¹¦ä¿¡æ¯ï¼Œä¼šå°†å…¶ä¸´æ—¶å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œä¾› Restic è®¤è¯ä½¿ç”¨ï¼Œå¹¶è®¾ç½®åœ¨ restic restore å‘½ä»¤ä¸­</li>
<li>ç»™ restic restore å‘½ä»¤è®¾ç½® Restic åŸç”Ÿæ‰€éœ€çš„ç¯å¢ƒå˜é‡ä¿¡æ¯</li>
<li>è°ƒç”¨ <strong>RunRestore</strong>ï¼Œæ‰§è¡Œ Restic åŸç”Ÿçš„å·æ•°æ®æ¢å¤æµç¨‹</li>
<li>ä¸ºäº†ä¿é™©èµ·è§ï¼Œå…ˆç§»é™¤å·ç›®å½•ä¸‹çš„ .velero ç›®å½•ï¼Œç„¶åé‡æ–°åˆ›å»ºï¼Œå¹¶å†™å…¥ Restore çš„ UIDï¼ŒRestic çš„ Init Container ä¼šä¸€è‡´ç­‰å¾…ç›´åˆ°è¯»å–åˆ°è¿™ä¸ªæ–‡ä»¶çš„ç”Ÿæˆ</li>
</ol>
<h2 id="RunRestore"><a href="#RunRestore" class="headerlink" title="RunRestore"></a>RunRestore</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware-tanzu/velero/blob/5fe3a50bfddc2becb4c0bd5e2d3d4053a23e95d2/pkg/restic/exec_commands.go#L186">RunRestore æºç </a></p>
<p>è°ƒç”¨ Restic åŸç”Ÿå¤‡ä»½å‘½ä»¤ restic restore</p>
<ol>
<li>é€šè¿‡ restic stats å‘½ä»¤è·å–åˆ°æ€»å¿«ç…§çš„å¤§å°ï¼Œå¹¶æ›´æ–°è‡³ PodVolumeRestore ä¸­</li>
<li>å°†å…¥å‚çš„ Command å¯¹è±¡æ„å»ºæˆå¯æ‰§è¡Œå‘½ä»¤å¹¶æ‰§è¡Œ</li>
<li>å¯åŠ¨ä¸€ä¸ª Goroutineï¼Œæ¯ 10 ç§’é’Ÿè·å–ä¸€æ¬¡å·²ç»æ¢å¤çš„æ•°æ®ç›®å½•æ€»å¤§å°ï¼Œå¹¶æ›´æ–° PodVolumeRestore æ€»æ¢å¤è¿›åº¦ï¼ˆå¾…æ¢å¤æ€»æ–‡ä»¶å¤§å°å’Œå½“å‰æ¢å¤æ–‡ä»¶å¤§å°ï¼‰</li>
<li>æ¢å¤å®Œæˆåï¼Œæ›´æ–° PodVolumeRestore è¿›åº¦è‡³ 100%<br><em>æ­¤å¤„æœªåˆ¤æ–­æ¢å¤æˆåŠŸä¸å¦ï¼Œåªæ˜¯å°†è¿›åº¦è®¾ä¸º 100%ï¼Œå¹¶è¿”å› restic restore çš„ stdoutï¼Œstderr å’Œ err ä¿¡æ¯ï¼Œç”±ä¸Šå±‚è°ƒç”¨æ–¹åˆ¤æ–­</em></li>
</ol>
</div><div class="article-licensing box"><div class="licensing-title"><p>ã€Œ Velero ã€æºç èµ°è¯» â€” Restore</p><p><a href="http://shenxianghong.github.io/2022/02/04/2022-02-04 Velero æºç èµ°è¯» - Restore/">http://shenxianghong.github.io/2022/02/04/2022-02-04 Velero æºç èµ°è¯» - Restore/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Shen Xianghong</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-02-04</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-05-08</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i>Â <a class="link-muted" rel="tag" href="/tags/Velero/">Velero </a></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/02/05/2022-02-05%20Velero%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20Request/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">ã€Œ Velero ã€æºç èµ°è¯» â€” Request</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/01/27/2022-01-27%20Velero%20%E6%BA%90%E7%A0%81%E8%B5%B0%E8%AF%BB%20-%20Backup/"><span class="level-item">ã€Œ Velero ã€æºç èµ°è¯» â€” Backup</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars.githubusercontent.com/u/35031258?v=4" alt="ğŸ¾Corgi"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">ğŸ¾Corgi</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">50</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">8</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/shenxianghong" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Youtube" href="https://youtube.com"><i class="fab fa-youtube"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Bilibili" href="https://bilibili.com"><i class="fab fa-bilibili"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Reddit" href="https://reddit.com"><i class="fab fa-reddit"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://google.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Google</span></span><span class="level-right"><span class="level-item tag">google.com</span></span></a></li><li><a class="level is-mobile" href="https://freegpt.one" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ChatGPT</span></span><span class="level-right"><span class="level-item tag">freegpt.one</span></span></a></li></ul></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Restore"><span class="level-left"><span class="level-item">1</span><span class="level-item">Restore</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#restore"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">restore</span></span></a></li><li><a class="level is-mobile" href="#create"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">create</span></span></a></li><li><a class="level is-mobile" href="#delete"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">delete</span></span></a></li><li><a class="level is-mobile" href="#describe"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">describe</span></span></a></li><li><a class="level is-mobile" href="#get"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">get</span></span></a></li><li><a class="level is-mobile" href="#logs"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">logs</span></span></a></li></ul></li><li><a class="level is-mobile" href="#PodVolumeRestore"><span class="level-left"><span class="level-item">2</span><span class="level-item">PodVolumeRestore</span></span></a></li><li><a class="level is-mobile" href="#Restore-Controller"><span class="level-left"><span class="level-item">3</span><span class="level-item">Restore Controller</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#NewRestoreController"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">NewRestoreController</span></span></a></li><li><a class="level is-mobile" href="#processQueueItem"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">processQueueItem</span></span></a></li><li><a class="level is-mobile" href="#processRestore"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">processRestore</span></span></a></li><li><a class="level is-mobile" href="#validateAndComplete"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">validateAndComplete</span></span></a></li><li><a class="level is-mobile" href="#runValidatedRestore"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">runValidatedRestore</span></span></a></li><li><a class="level is-mobile" href="#Restore-1"><span class="level-left"><span class="level-item">3.6</span><span class="level-item">Restore</span></span></a></li><li><a class="level is-mobile" href="#getOrderedResourceCollection"><span class="level-left"><span class="level-item">3.7</span><span class="level-item">getOrderedResourceCollection</span></span></a></li><li><a class="level is-mobile" href="#processSelectedResource"><span class="level-left"><span class="level-item">3.8</span><span class="level-item">processSelectedResource</span></span></a></li><li><a class="level is-mobile" href="#restoreItem"><span class="level-left"><span class="level-item">3.9</span><span class="level-item">restoreItem</span></span></a></li></ul></li><li><a class="level is-mobile" href="#PodVolumeRestore-Controller"><span class="level-left"><span class="level-item">4</span><span class="level-item">PodVolumeRestore Controller</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#NewPodVolumeRestoreController"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">NewPodVolumeRestoreController</span></span></a></li><li><a class="level is-mobile" href="#processQueueItem-1"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">processQueueItem</span></span></a></li><li><a class="level is-mobile" href="#processRestore-1"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">processRestore</span></span></a></li><li><a class="level is-mobile" href="#restorePodVolume"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">restorePodVolume</span></span></a></li><li><a class="level is-mobile" href="#RunRestore"><span class="level-left"><span class="level-item">4.5</span><span class="level-item">RunRestore</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Container-Runtime/"><span class="level-start"><span class="level-item">Container Runtime</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Disaster-Recovery/"><span class="level-start"><span class="level-item">Disaster Recovery</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/Kubernetes/"><span class="level-start"><span class="level-item">Kubernetes</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/Programming/Elegant-Coding/"><span class="level-start"><span class="level-item">Elegant Coding</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Quick-Start/"><span class="level-start"><span class="level-item">Quick Start</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Serverless/"><span class="level-start"><span class="level-item">Serverless</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Service-Mesh/"><span class="level-start"><span class="level-item">Service Mesh</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="ğŸ¾Corgi" height="28"></a><p class="is-size-7"><span>&copy; 2023 Shen Xianghong</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p><p class="is-size-7"><br/>And did you get what you wanted from this life, even so?</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>